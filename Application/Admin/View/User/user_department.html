<!doctype html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>{$meta_title}｜{:C('WEB_SITE_TITLE')}后台管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="author" content="XinHaiThink">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="generator" content="CoreThink">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="XinHaiThink">
    <meta name="format-detection" content="telephone=no,email=no">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <link rel="apple-touch-icon" type="image/x-icon" href="/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/Public/libs/cui/css/cui.min.css">
    <link rel="stylesheet" type="text/css" href="/./Application/Admin/View/Public/css/admin.css?v=20150903">
    <link rel="stylesheet" type="text/css" href="/./Application/Admin/View/Public/css/theme/default.css">
    
    <!--[if lt IE 9]>
        <script src="http://cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
        <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- 如果配置里CDN静态资源列表则使用CDN否则使用静态资源 -->
            <script type="text/javascript" src="/Public/libs/jquery/1.x/jquery.min.js"></script>
   <link rel="stylesheet" href="./Public/libs/ztree/css/zTreeStyle/zTreeStyle.css" type="text/css">
	<script type="text/javascript" src="/Public/libs/ztree/js/jquery.ztree.core-3.5.js"></script>
	<script type="text/javascript" src="/Public/libs/ztree/js/jquery.ztree.excheck-3.5.js"></script>
	<script type="text/javascript" src="/Public/libs/ztree/js/jquery.ztree.exedit-3.5.js"></script>
	<SCRIPT type="text/javascript">
  		var setting = {
			check: {
				enable: true,
			},
			data: {
				simpleData: {
					enable: true
				}
			},
			view: {
				expandSpeed: "",
			},
			
		};
  		
  		
		var zNodes =[
			<volist name="departments" id="vo">
			{name:"{$vo.name}", id:"{$vo.id}", pId:"{$vo.pid}", count:500, times:1, open:true,iconOpen:"/Public/libs/ztree/css/zTreeStyle/img/diy/1_open.png", iconClose:"/Public/libs/ztree/css/zTreeStyle/img/diy/1_close.png", icon:"/Public/libs/ztree/css/zTreeStyle/img/diy/people.png",  <php>if(in_array($vo['id'],$user_deps)) echo 'checked:true';</php>},
			</volist>
		];

		$(document).ready(function(){
			$.fn.zTree.init($("#treeDemo"), setting, zNodes);
			setCheck();
		});
		function setCheck() {
			var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
			type = { "Y" : "", "N" : "" };
			zTree.setting.check.chkboxType = type;
			
		}
		 //2018/12/26 获取选中节点 周书森
        function onCheck(e,treeId,treeNode){
            var treeObj=$.fn.zTree.getZTreeObj("treeDemo"),
            nodes=treeObj.getCheckedNodes(true),
            v="";
            $('#user_dep_map').html();
            for(var i=0;i<nodes.length;i++){
               // v+=nodes[i].name + ",";
               // alert(nodes[i].id); //获取选中节点的值
               v += nodes[i].id+',';
              // $('#user_dep_map').append('<input type="hidden" name="dep_ids[]" value="'+nodes[i].id+'">');
            }
            $('#dep_ids').val(v);
      }
	</SCRIPT>
 
    </head>

<body>
    <div class="clearfix full-header">
        
    </div>

    <div class="clearfix full-container">
        
    <link rel="stylesheet" type="text/css" href="/Public/libs/cui/css/cui.extend.min.css">
<style type="text/css">
    .builder {
        background: #fff;
    }
    .builder .builder-tabs,
    .builder .builder-toolbar,
    .builder .builder-container {
        margin-bottom: 20px;
    }
    .builder .builder-container .builder-data-empty {
        margin-bottom: 20px;
        background-color: #f9f9f9;
    }
    .builder .builder-container .builder-data-empty .empty-info {
        padding: 130px 0;
        color: #555;
    }
    .builder .builder-container .builder-table .panel {
        margin-bottom: 0px;
    }
    .builder .builder-container .builder-table .panel .table td {
        max-width: 600px;
        vertical-align: middle;
    }
    .builder .builder-container .builder-table .panel .table td img {
        max-width: 200px;
        max-height: 40px;
    }
    .builder .builder-container .pagination {
        margin-bottom: 0px;
    }
    .builder-form-box .builder-form.form-horizontal .tab-content .form-group {
        margin: 15px 0;
    }
    @media (max-width: 768px) {
        .row,
        .container-fluid {
            padding: 0;
            margin: 0;
        }
        .builder-list-toolbar .button-list .btn {
            margin-bottom: 15px;
        }
    }
    @media (min-width: 768px) {
        .builder-form-box .builder-form.form-horizontal {
            padding: 0 15px;
        }
        .builder-form-box .builder-form.form-horizontal .control-label {
            text-align: left;
        }
        .builder-form-box .builder-form.form-horizontal .left {
            width: 15%;
            float: left;
        }
        .builder-form-box .builder-form.form-horizontal .right {
            width: 85%;
            float: left;
        }
        .builder-form-box .builder-form-container .builder-form .input,
        .builder-form-box .builder-form-container .builder-form .select,
        .builder-form-box .builder-form-container .builder-form .textarea,
        .builder-form-box .builder-form-container .builder-form .list-group {
            width: 70%;
        }
        .builder-form-box .builder-form .submit,
        .builder-form-box .builder-form .return {
            min-width: 120px;
        }
    }
    @media (min-width: 992px) {
        .builder-form-box .builder-form.form-horizontal .left {
            width: 12%;
            float: left;
        }
        .builder-form-box .builder-form.form-horizontal .right {
            width: 88%;
            float: left;
        }
    }
    .builder-form-box .img-box .remove-picture {
        color: red;
        position: absolute;
        top: 0;
        right: 2px;
        background: #fff;
        border-radius: 20px;
        cursor: pointer;
    }
    .builder-form-box .img-box .remove-picture:hover {
        color: #DD0000;
        box-shadow: inset 0 1px 1px red, 0 0 8px red;
    }
    .builder-form-box .file-box .remove-file {
        color: red;
        position: absolute;
        top: 12px;
        right: 10px;
        border-radius: 20px;
        cursor: pointer;
    }
    .builder-form-box .file-box .remove-file:hover {
        color: #DD0000;
        box-shadow: inset 0 1px 1px red, 0 0 8px red;
    }
    .builder-form-box .board_list .board {
        padding: 0px;
        margin-right: 10px;
    }
</style>

<div class="builder builder-form-box panel-body">
    
    
    <div class="builder-container builder-form-container" style="text-align:center;">
        <div class="row">
            <div class="col-xs-12">
                <form action="{:U('user_department')}"   method="post" class="form-horizontal form builder-form">
                	<div style="margin-left:25px; margin-bottom:25px;">
                		<input type="hidden" name="id" value="{$Think.get.id}">
                		<input type="hidden" id="dep_ids" name="dep_ids" value="">
                		<div id="user_dep_map"></div>
	                    <ul id="treeDemo" class="ztree"></ul>
	                </div>
				    <div class="form-group">
                        <button class="btn btn-primary btn-block submit ajax-post visible-xs visible-sm" type="submit" target-form="builder-form">确定</button>
                        <button class="btn btn-primary submit ajax-post visible-md-inline visible-lg-inline" type="submit" target-form="builder-form" onclick="onCheck()">确定</button>
                        <button class="btn btn-default return visible-md-inline visible-lg-inline" onclick="javascript:history.back(-1);return false;">返回</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
  
    </div>

<script type="text/javascript" src="/Public/libs/cui/js/cui.extend.min.js"></script>
<script type="text/javascript">
    $(function() {
        if (!$('.builder')) {
            return false;
        }

        //给数组增加查找指定的元素索引方法
        Array.prototype.indexOf = function(val) {
            for (var i = 0; i < this.length; i++) {
                if (this[i] == val) return i;
            }
            return -1;
        };

        //给数组增加删除方法
        Array.prototype.remove = function(val) {
            var index = this.indexOf(val);
            if (index > -1) {
                this.splice(index, 1);
            }
        };
    });
</script>



    </div>

    <div class="clearfix full-footer">
        
    </div>

    <div class="clearfix full-script">
        <div class="container-fluid">
            <input type="hidden" id="corethink_home_img" value="/./Application/Home/View/Public/img">
            <script type="text/javascript" src="/Public/libs/cui/js/cui.min.js"></script>
            <script type="text/javascript" src="/./Application/Admin/View/Public/js/admin.js?v=20150903"></script>
            
        </div>
    </div>
</body>
</html>