{"version":3,"sources":["cui.extend.js"],"names":["$","UTCDate","Date","UTC","apply","arguments","Array","prototype","indexOf","find","i","undefined","this","length","n","Datetimepicker","element","options","that","container","language","data","dates","split","isRTL","rtl","formatType","format","DPGlobal","parseFormat","getDefaultFormat","isInline","isVisible","isInput","is","fontAwesome","bootcssVer","component","parent","componentReset","hasInput","linkField","linkFormat","minuteStep","pickerPosition","showMeridian","initialDate","zIndex","icons","leftArrow","rightArrow","icontype","_attachEvents","clickedOutside","e","target","closest","hide","formatViewType","minView","convertViewMode","maxView","modes","wheelViewModeNavigation","wheelViewModeNavigationInverseDirection","wheelViewModeNavigationDelay","startViewMode","startView","viewMode","viewSelect","forceParse","template","templateV3","replace","picker","appendTo","on","click","proxy","mousedown","fn","mousewheel","console","log","addClass","selector","toggleClass","document","autoclose","keyboardNavigation","todayBtn","todayHighlight","weekStart","weekEnd","startDate","Infinity","endDate","daysOfWeekDisabled","setStartDate","setEndDate","setDaysOfWeekDisabled","setMinutesDisabled","minutesDisabled","setHoursDisabled","hoursDisabled","fillDow","fillMonths","update","showMode","show","constructor","_events","_detachEvents","focus","keyup","keydown","push","reset","el","ev","off","height","outerHeight","place","window","stopPropagation","preventDefault","trigger","type","date","val","setValue","remove","datetimepicker","getDate","d","getUTCDate","getTime","getTimezoneOffset","setDate","setUTCDate","viewDate","fill","setFormat","formatted","getFormattedDate","formatDate","parseDate","updateNavArrows","isArray","map","parseInt","index_highest","each","index_current","css","offset","top","left","containerOffset","outerWidth","bodyWidth","body","clientWidth","innerWidth","fromArgs","String","dowCnt","html","daysMin","append","monthsShort","year","getUTCFullYear","month","getUTCMonth","dayMonth","hours","getUTCHours","minutes","getUTCMinutes","startYear","startMonth","endYear","endMonth","currentDate","valueOf","today","text","months","toggle","prevMonth","day","getDaysInMonth","getUTCDay","nextMonth","clsName","getFullYear","getMonth","inArray","empty","join","txt","meridian","meridianOld","actual","meridiem","toUpperCase","Math","floor","currentYear","end","removeClass","eq","slice","yearCont","hour","visibility","wheelPause","originalEvent","delta","wheelDelta","mode","setTimeout","nodeName","toLowerCase","className","dir","navStep","moveHour","moveDate","moveMonth","moveYear","convertViewModeText","getHours","getMinutes","getSeconds","_setDate","seconds","getUTCSeconds","index","setUTCMonth","setUTCFullYear","hasClass","setUTCHours","substr","setUTCMinutes","oldViewMode","which","change","moveMinute","new_date","new_month","test","mag","abs","dateWithinRange","keyCode","newDate","newViewDate","dateChanged","ctrlKey","shiftKey","newViewMode","max","min","filter","old","option","args","shift","internal_return","$this","extend","defaults","Constructor","en","days","daysShort","suffix","navFnc","isLeapYear","field","Error","validParts","nonpunctuation","separators","parts","match","dateUTC","setMilliseconds","part","part_re","exec","call","filtered","toString","parsed","setters_order","setters_map","hh","v","h","HH","H","ii","ss","setUTCSeconds","s","yyyy","yy","m","isNaN","p","cnt","substring","M","MM","D","DD","P","dd","mm","y","Y","F","t","j","l","w","N","S","a","g","G","A","seps","headTemplate","headTemplateV3","contTemplate","footTemplate","noConflict","jQuery","dragsort","opts","lists","list","lastPos","cont","children","size","get","newList","draggedItem","placeHolderItem","pos","offsetLimit","scroll","init","tagName","itemSelector","dragSelector","placeHolderTemplate","attr","grabItem","bind","uninit","styleDragHandlers","unbind","getItems","cursor","item","insideMoveableItem","dragSelectorExclude","dragHandle","parentNode","listElem","dragStart","mousemove","mouseup","dropItem","mt","ml","pageY","pageX","dragBetween","containerHeight","round","right","bottom","width","clone","after","borderWidth","next","listTable","id","orig","position","opacity","z-index","moveX","moveY","maxX","maxY","scrollY","setInterval","scrollContainer","scrollTop","scrollX","scrollLeft","createDropTargets","buildPositionTable","setPos","swapItems","wheel","x","offsetParent","not","scrollSpeed","browser","safari","mozilla","detail","loc","elm","removeAttr","before","clearInterval","dragEnd","nextItem","prepend","ei","findPos","nlist","fixed","idx","insertAfter","insertBefore","ph","dt","iconpicker","self","buttonSize","columns","open","allowedSizes","templates","sizes","$el","currentTarget","closeMenu","openMenu","icon","clickCallback","select","str","doFilter","$sizeSelector","$container","resize","createMenu","eval","$menu","class","style","$filter","sizeSelector","innerHeight","button","title","name","data-icon","data-filter","detach","scrollbarWidth","getScrollbarWidth","ceil","ucwords","$1","sortObj","obj","key","tempArry","tempObj","sort","b","localeCompare","$inner","$outer","inner","outer","width1","offsetWidth","width2","root","factory","origin","modules","_require","deps","callback","len","getModule","_define","setModule","returned","module","exports","exportsTo","host","last","ucFirst","charAt","hasOwnProperty","pop","makeExport","dollar","__dollar","define","amd","WebUploader","require","Zepto","_","Deferred","when","isPromise","anything","then","promise","uncurryThis","bindFn","context","createObject","proto","f","Object","create","noop","Function","version","ua","ret","webkit","chrome","ie","firefox","opera","parseFloat","navigator","userAgent","os","android","ios","inherits","Super","protos","staticProtos","child","__super__","nextTick","cb","guid","counter","prefix","random","formatSize","pointLength","units","unit","toFixed","Base","findHandlers","arr","grep","handler","_cb","ctx","eachEvent","events","iterator","separator","triggerHanders","stoped","ctx2","set","me","once","allEvents","installTo","Mediator","Uploader","_init","upload","stop","getFile","getFiles","addFile","addFiles","removeFile","cancelFile","skipFile","retry","isInProgress","makeThumb","md5File","getDimension","addButton","predictRuntimeType","refresh","disable","enable","command","request","state","isPlainObject","getStats","stats","successNum","numOfSuccess","progressNum","numOfProgress","cancelNum","numOfCancel","invalidNum","numOfInvalid","uploadFailNum","numOfUploadFailed","queueNum","numOfQueue","interruptNum","numofInterrupt","isFunction","concat","destroy","Runtime","uid","factories","getFirstKey","getContainer","_container","createElement","overflow","_parent","orders","addRuntime","hasRuntime","runtime","RuntimeClient","standalone","deferred","runtimeReady","done","connectRuntime","cache","__promise","resolve","__client","runtimeOrder","add","__standalone","getRuntime","disconnectRuntime","unshift","getRuid","ruid","RuntimeClent","DragAndDrop","accept","disableGlobalDnd","isArrayLike","nodeType","Widget","uploader","owner","_destroy","IGNORE","widgetClass","invoke","apiName","responseMap","widgets","_widgets","deactives","disableWidgets","klass","_name","widget","rlt","rlts","dfds","pipe","register","widgetProto","unRegister","splice","Dnd","dnd","files","items","FilePaste","paste","Blob","source","ext","start","getSource","File","file","rExt","RegExp","lastModifiedDate","toLocaleString","FilePicker","innerHTML","label","multiple","_refer","_resizeHandler","shimContainer","btn","pick","pickers","addBtn","promises","swf","gid","idPrefix","idSuffix","WUFile","statusText","statusMap","Status","INITED","loaded","msg","setStatus","ERROR","status","prevStatus","getStatus","QUEUED","PROGRESS","COMPLETE","CANCELLED","INTERRUPT","INVALID","Queue","numofDeleted","_queue","_map","STATUS","_fileAdded","fileId","fetch","sts","existing","cur","pre","_onFileStatusChange","curStatus","preStatus","extensions","queue","placeholder","_ruid","_wrapFile","acceptFile","invalid","_addFile","auto","fetchFile","noForceStart","sortFiles","support","Transport","_blob","_formData","formData","_headers","headers","_timeout","clearTimeout","_timer","server","method","withCredentials","fileVal","timeout","sendAsBinary","appendBlob","blob","filename","value","setRequestHeader","send","abort","getResponse","getResponseAsJson","duration","CuteFile","chunkSize","api","pending","total","chunks","has","block","chunk","cuted","blocks","remaning","prepareNextFile","chunked","chunkRetry","threads","runing","progress","pool","stack","__tick","_tick","transport","_trigged","_promise","startUpload","stopUpload","interrupt","_putback","_popBlock","_tr","_getStats","skipped","always","_nextBlock","_startSend","_getStack","act","preparing","_prepareNextFile","_finishFile","fail","reason","_doSend","percentage","requestAccept","tr","totalPercent","uploaded","reject","_raw","flag","retried","hds","validators","addValidator","removeValidator","count","fileNumLimit","fileSizeLimit","fileSingleSizeLimit","hashString","_char","hash","charCodeAt","mapping","duplicate","__hash","CompBase","Html5Runtime","comp","instance","client","components","FileReader","DataView","webkitSlice","mozSlice","elem","dragEnterHandler","_dragEnterHandler","dragOverHandler","_dragOverHandler","dragLeaveHandler","_dragLeaveHandler","dropHandler","_dropHandler","dndOver","denied","_denied","dataTransfer","dropEffect","parentElem","contains","_leaveTimer","getData","err","_getTansferFiles","results","canAccessFolder","webkitGetAsEntry","isDirectory","_traverseDirectoryTree","entry","isFile","createReader","readEntries","entries","mimeTypes","hander","_pasteHander","allowed","clipboardData","kind","getAsFile","mouseHandler","input","display","background","callee","cloneNode","replaceChild","_status","_response","binary","fr","xhr","_initAjax","param","FormData","k","_setRequestHeader","overrideMimeType","onload","result","readAsArrayBuffer","_parseJson","_xhr","onprogress","onreadystatechange","XMLHttpRequest","XDomainRequest","lengthComputable","readyState","responseText","json","JSON","parse","ex","getFlashVersion","plugins","description","ActiveXObject","GetVariable","ex2","FlashRuntime","evt","clients","jsreciver","flashExec","flash","getFlash","_flash","copy","_responseJson","url","forceURLStream","mimeType","percent","readBody","decodeURIComponent","preset"],"mappings":"CA0BC,SAAUA,GA8BT,QAASC,KACP,MAAO,IAAIC,MAAKA,KAAKC,IAAIC,MAAMF,KAAMG,YA5BjC,WAAaC,OAAMC,YACvBD,MAAMC,UAAUC,QAAU,SAAUC,EAAMC,GAC9BC,SAAND,IAAiBA,EAAI,GACjB,EAAJA,IAAOA,GAAKE,KAAKC,QACb,EAAJH,IAAOA,EAAI,EACf,KAAK,GAAII,GAAIF,KAAKC,OAAYC,EAAJJ,EAAOA,IAC/B,GAAIA,IAAKE,OAAQA,KAAKF,KAAOD,EAC3B,MAAOC,EAGX,OAAO,IA2BX,IAAIK,GAAiB,SAAUC,EAASC,GACtC,GAAIC,GAAON,IAEXA,MAAKI,QAAUhB,EAAEgB,GAIjBJ,KAAKO,UAAYF,EAAQE,WAAa,OAEtCP,KAAKQ,SAAWH,EAAQG,UAAYR,KAAKI,QAAQK,KAAK,kBAAoB,KAC1ET,KAAKQ,SAAWR,KAAKQ,WAAYE,GAAQV,KAAKQ,SAAWR,KAAKQ,SAASG,MAAM,KAAK,GAClFX,KAAKQ,SAAWR,KAAKQ,WAAYE,GAAQV,KAAKQ,SAAW,KACzDR,KAAKY,MAAQF,EAAMV,KAAKQ,UAAUK,MAAO,EACzCb,KAAKc,WAAaT,EAAQS,YAAcd,KAAKI,QAAQK,KAAK,gBAAkB,WAC5ET,KAAKe,OAASC,EAASC,YAAYZ,EAAQU,QAAUf,KAAKI,QAAQK,KAAK,gBAAkBC,EAAMV,KAAKQ,UAAUO,QAAUC,EAASE,iBAAiBlB,KAAKc,WAAY,SAAUd,KAAKc,YAClLd,KAAKmB,UAAW,EAChBnB,KAAKoB,WAAY,EACjBpB,KAAKqB,QAAUrB,KAAKI,QAAQkB,GAAG,SAC/BtB,KAAKuB,YAAclB,EAAQkB,aAAevB,KAAKI,QAAQK,KAAK,kBAAmB,EAE/ET,KAAKwB,WAAanB,EAAQmB,aAAexB,KAAKqB,QAAWrB,KAAKI,QAAQkB,GAAG,iBAAmB,EAAI,EAAOtB,KAAKwB,WAAaxB,KAAKI,QAAQkB,GAAG,gBAAkB,EAAI,GAE/JtB,KAAKyB,UAAYzB,KAAKI,QAAQkB,GAAG,SAAgC,GAAnBtB,KAAKwB,WAAkBxB,KAAKI,QAAQP,KAAK,yNAAyN6B,SAAW1B,KAAKI,QAAQP,KAAK,yFAAyF6B,UAAY,EAClb1B,KAAK2B,eAAiB3B,KAAKI,QAAQkB,GAAG,SAAgC,GAAnBtB,KAAKwB,WAAkBxB,KAAKI,QAAQP,KAAK,sEAAsE6B,SAAS1B,KAAKI,QAAQP,KAAK,2CAA2C6B,UAAY,EACpP1B,KAAK4B,SAAW5B,KAAKyB,WAAazB,KAAKI,QAAQP,KAAK,SAASI,OACzDD,KAAKyB,WAAuC,IAA1BzB,KAAKyB,UAAUxB,SACnCD,KAAKyB,WAAY,GAEnBzB,KAAK6B,UAAYxB,EAAQwB,WAAa7B,KAAKI,QAAQK,KAAK,gBAAiB,EACzET,KAAK8B,WAAad,EAASC,YAAYZ,EAAQyB,YAAc9B,KAAKI,QAAQK,KAAK,gBAAkBO,EAASE,iBAAiBlB,KAAKc,WAAY,QAASd,KAAKc,YAC1Jd,KAAK+B,WAAa1B,EAAQ0B,YAAc/B,KAAKI,QAAQK,KAAK,gBAAkB,EAC5ET,KAAKgC,eAAiB3B,EAAQ2B,gBAAkBhC,KAAKI,QAAQK,KAAK,oBAAsB,eACxFT,KAAKiC,aAAe5B,EAAQ4B,cAAgBjC,KAAKI,QAAQK,KAAK,mBAAoB,EAClFT,KAAKkC,YAAc7B,EAAQ6B,aAAe,GAAI5C,MAC9CU,KAAKmC,OAAS9B,EAAQ8B,QAAUnC,KAAKI,QAAQK,KAAK,YAAcV,OAEhEC,KAAKoC,OACHC,UAAWrC,KAAKuB,YAAc,gBAAuC,IAApBvB,KAAKwB,WAAmB,uBAAyB,kBAClGc,WAAYtC,KAAKuB,YAAc,iBAAwC,IAApBvB,KAAKwB,WAAmB,wBAA0B,oBAEvGxB,KAAKuC,SAAWvC,KAAKuB,YAAc,KAAO,YAE1CvB,KAAKwC,gBAELxC,KAAKyC,eAAiB,SAAUC,GAE0B,IAAlDtD,EAAEsD,EAAEC,QAAQC,QAAQ,mBAAmB3C,QACvCK,EAAKuC,QAIb7C,KAAK8C,eAAiB,WAClB,kBAAoBzC,GACtBL,KAAK8C,eAAiBzC,EAAQyC,eACrB,kBAAoB9C,MAAKI,QAAQK,SAC1CT,KAAK8C,eAAiB9C,KAAKI,QAAQK,KAAK,mBAG1CT,KAAK+C,QAAU,EACX,WAAa1C,GACfL,KAAK+C,QAAU1C,EAAQ0C,QACd,WAAa/C,MAAKI,QAAQK,SACnCT,KAAK+C,QAAU/C,KAAKI,QAAQK,KAAK,aAEnCT,KAAK+C,QAAU/B,EAASgC,gBAAgBhD,KAAK+C,SAE7C/C,KAAKiD,QAAUjC,EAASkC,MAAMjD,OAAS,EACnC,WAAaI,GACfL,KAAKiD,QAAU5C,EAAQ4C,QACd,WAAajD,MAAKI,QAAQK,SACnCT,KAAKiD,QAAUjD,KAAKI,QAAQK,KAAK,aAEnCT,KAAKiD,QAAUjC,EAASgC,gBAAgBhD,KAAKiD,SAE7CjD,KAAKmD,yBAA0B,EAC3B,2BAA6B9C,GAC/BL,KAAKmD,wBAA0B9C,EAAQ8C,wBAC9B,2BAA6BnD,MAAKI,QAAQK,SACnDT,KAAKmD,wBAA0BnD,KAAKI,QAAQK,KAAK,+BAGnDT,KAAKoD,yCAA0C,EAE3C,2CAA6C/C,GAC/CL,KAAKoD,wCAA0C/C,EAAQ+C,wCAC9C,2CAA6CpD,MAAKI,QAAQK,SACnET,KAAKoD,wCAA0CpD,KAAKI,QAAQK,KAAK,2CAGnET,KAAKqD,6BAA+B,IAChC,gCAAkChD,GACpCL,KAAKqD,6BAA+BhD,EAAQgD,6BACnC,gCAAkCrD,MAAKI,QAAQK,SACxDT,KAAKqD,6BAA+BrD,KAAKI,QAAQK,KAAK,qCAGxDT,KAAKsD,cAAgB,EACjB,aAAejD,GACjBL,KAAKsD,cAAgBjD,EAAQkD,UACpB,aAAevD,MAAKI,QAAQK,SACrCT,KAAKsD,cAAgBtD,KAAKI,QAAQK,KAAK,eAEzCT,KAAKsD,cAAgBtC,EAASgC,gBAAgBhD,KAAKsD,eACnDtD,KAAKwD,SAAWxD,KAAKsD,cAErBtD,KAAKyD,WAAazD,KAAK+C,QACnB,cAAgB1C,GAClBL,KAAKyD,WAAapD,EAAQoD,WACjB,cAAgBzD,MAAKI,QAAQK,SACtCT,KAAKyD,WAAazD,KAAKI,QAAQK,KAAK,gBAEtCT,KAAKyD,WAAazC,EAASgC,gBAAgBhD,KAAKyD,YAEhDzD,KAAK0D,YAAa,EACd,cAAgBrD,GAClBL,KAAK0D,WAAarD,EAAQqD,WACjB,kBAAoB1D,MAAKI,QAAQK,SAC1CT,KAAK0D,WAAa1D,KAAKI,QAAQK,KAAK,oBAGtC,KADA,GAAIkD,GAA+B,IAApB3D,KAAKwB,WAAmBR,EAAS4C,WAAa5C,EAAS2C,SAC5B,KAAnCA,EAAS/D,QAAQ,eACtB+D,EAAWA,EAASE,QAAQ,aAAc7D,KAAKuC,SAEjD,MAA2C,KAApCoB,EAAS/D,QAAQ,gBACtB+D,EAAWA,EAASE,QAAQ,cAAe7D,KAAKoC,MAAMC,UAExD,MAA4C,KAArCsB,EAAS/D,QAAQ,iBACtB+D,EAAWA,EAASE,QAAQ,eAAgB7D,KAAKoC,MAAME,WAsBzD,IApBAtC,KAAK8D,OAAS1E,EAAEuE,GACbI,SAAS/D,KAAKmB,SAAWnB,KAAKI,QAAUJ,KAAKO,WAC7CyD,IACCC,MAAW7E,EAAE8E,MAAMlE,KAAKiE,MAAOjE,MAC/BmE,UAAW/E,EAAE8E,MAAMlE,KAAKmE,UAAWnE,QAGnCA,KAAKmD,0BACH/D,EAAEgF,GAAGC,WACPrE,KAAK8D,OAAOE,IAAIK,WAAYjF,EAAE8E,MAAMlE,KAAKqE,WAAYrE,QAErDsE,QAAQC,IAAI,iHAIZvE,KAAKmB,SACPnB,KAAK8D,OAAOU,SAAS,yBAErBxE,KAAK8D,OAAOU,SAAS,2BAA6BxE,KAAKgC,eAAiB,kBAEtEhC,KAAKY,MAAO,CACdZ,KAAK8D,OAAOU,SAAS,qBACrB,IAAIC,GAA+B,IAApBzE,KAAKwB,WAAmB,yBAA2B,kBAClExB,MAAK8D,OAAOjE,KAAK4E,GAAUC,YAAY1E,KAAKoC,MAAMC,UAAY,IAAMrC,KAAKoC,MAAME,YAGjFlD,EAAEuF,UAAUX,GAAG,YAAahE,KAAKyC,gBAEjCzC,KAAK4E,WAAY,EACb,aAAevE,GACjBL,KAAK4E,UAAYvE,EAAQuE,UAChB,iBAAmB5E,MAAKI,QAAQK,SACzCT,KAAK4E,UAAY5E,KAAKI,QAAQK,KAAK,mBAGrCT,KAAK6E,oBAAqB,EACtB,sBAAwBxE,GAC1BL,KAAK6E,mBAAqBxE,EAAQwE,mBACzB,0BAA4B7E,MAAKI,QAAQK,SAClDT,KAAK6E,mBAAqB7E,KAAKI,QAAQK,KAAK,6BAG9CT,KAAK8E,SAAYzE,EAAQyE,UAAY9E,KAAKI,QAAQK,KAAK,oBAAqB,EAC5ET,KAAK+E,eAAkB1E,EAAQ0E,gBAAkB/E,KAAKI,QAAQK,KAAK,0BAA2B,EAE9FT,KAAKgF,WAAc3E,EAAQ2E,WAAahF,KAAKI,QAAQK,KAAK,mBAAqBC,EAAMV,KAAKQ,UAAUwE,WAAa,GAAK,EACtHhF,KAAKiF,SAAYjF,KAAKgF,UAAY,GAAK,EACvChF,KAAKkF,YAAaC,EAAAA,GAClBnF,KAAKoF,QAAUD,EAAAA,EACfnF,KAAKqF,sBACLrF,KAAKsF,aAAajF,EAAQ6E,WAAalF,KAAKI,QAAQK,KAAK,mBACzDT,KAAKuF,WAAWlF,EAAQ+E,SAAWpF,KAAKI,QAAQK,KAAK,iBACrDT,KAAKwF,sBAAsBnF,EAAQgF,oBAAsBrF,KAAKI,QAAQK,KAAK,+BAC3ET,KAAKyF,mBAAmBpF,EAAQqF,iBAAmB1F,KAAKI,QAAQK,KAAK,yBACrET,KAAK2F,iBAAiBtF,EAAQuF,eAAiB5F,KAAKI,QAAQK,KAAK,uBACjET,KAAK6F,UACL7F,KAAK8F,aACL9F,KAAK+F,SACL/F,KAAKgG,WAEDhG,KAAKmB,UACPnB,KAAKiG,OAIT9F,GAAeR,WACbuG,YAAa/F,EAEbgG,WACA3D,cAAe,WACbxC,KAAKoG,gBACDpG,KAAKqB,QACPrB,KAAKmG,UACFnG,KAAKI,SACJiG,MAASjH,EAAE8E,MAAMlE,KAAKiG,KAAMjG,MAC5BsG,MAASlH,EAAE8E,MAAMlE,KAAK+F,OAAQ/F,MAC9BuG,QAASnH,EAAE8E,MAAMlE,KAAKuG,QAASvG,SAI5BA,KAAKyB,WAAazB,KAAK4B,UAC9B5B,KAAKmG,UAEFnG,KAAKI,QAAQP,KAAK,UACjBwG,MAASjH,EAAE8E,MAAMlE,KAAKiG,KAAMjG,MAC5BsG,MAASlH,EAAE8E,MAAMlE,KAAK+F,OAAQ/F,MAC9BuG,QAASnH,EAAE8E,MAAMlE,KAAKuG,QAASvG,SAEhCA,KAAKyB,WACJwC,MAAO7E,EAAE8E,MAAMlE,KAAKiG,KAAMjG,SAG1BA,KAAK2B,gBACP3B,KAAKmG,QAAQK,MACXxG,KAAK2B,gBACJsC,MAAO7E,EAAE8E,MAAMlE,KAAKyG,MAAOzG,UAIzBA,KAAKI,QAAQkB,GAAG,OACvBtB,KAAKmB,UAAW,EAGhBnB,KAAKmG,UACFnG,KAAKI,SACJ6D,MAAO7E,EAAE8E,MAAMlE,KAAKiG,KAAMjG,QAIhC,KAAK,GAAW0G,GAAIC,EAAX7G,EAAI,EAAWA,EAAIE,KAAKmG,QAAQlG,OAAQH,IAC/C4G,EAAK1G,KAAKmG,QAAQrG,GAAG,GACrB6G,EAAK3G,KAAKmG,QAAQrG,GAAG,GACrB4G,EAAG1C,GAAG2C,IAIVP,cAAe,WACb,IAAK,GAAWM,GAAIC,EAAX7G,EAAI,EAAWA,EAAIE,KAAKmG,QAAQlG,OAAQH,IAC/C4G,EAAK1G,KAAKmG,QAAQrG,GAAG,GACrB6G,EAAK3G,KAAKmG,QAAQrG,GAAG,GACrB4G,EAAGE,IAAID,EAET3G,MAAKmG,YAGPF,KAAM,SAAUvD,GACd1C,KAAK8D,OAAOmC,OACZjG,KAAK6G,OAAS7G,KAAKyB,UAAYzB,KAAKyB,UAAUqF,cAAgB9G,KAAKI,QAAQ0G,cACvE9G,KAAK0D,YACP1D,KAAK+F,SAEP/F,KAAK+G,QACL3H,EAAE4H,QAAQhD,GAAG,SAAU5E,EAAE8E,MAAMlE,KAAK+G,MAAO/G,OACvC0C,IACFA,EAAEuE,kBACFvE,EAAEwE,kBAEJlH,KAAKoB,WAAY,EACjBpB,KAAKI,QAAQ+G,SACXC,KAAM,OACNC,KAAMrH,KAAKqH,QAIfxE,KAAM,SAAUH,GACT1C,KAAKoB,YACNpB,KAAKmB,WACTnB,KAAK8D,OAAOjB,OACZzD,EAAE4H,QAAQJ,IAAI,SAAU5G,KAAK+G,OAC7B/G,KAAKwD,SAAWxD,KAAKsD,cACrBtD,KAAKgG,WACAhG,KAAKqB,SACRjC,EAAEuF,UAAUiC,IAAI,YAAa5G,KAAK6C,MAIlC7C,KAAK0D,aAED1D,KAAKqB,SAAWrB,KAAKI,QAAQkH,OAC3BtH,KAAK4B,UAAY5B,KAAKI,QAAQP,KAAK,SAASyH,QAGlDtH,KAAKuH,WACPvH,KAAKoB,WAAY,EACjBpB,KAAKI,QAAQ+G,SACXC,KAAM,OACNC,KAAMrH,KAAKqH,UAIfG,OAAQ,WACNxH,KAAKoG,gBACLhH,EAAEuF,UAAUiC,IAAI,YAAa5G,KAAKyC,gBAClCzC,KAAK8D,OAAO0D,eACLxH,MAAK8D,aACL9D,MAAKI,QAAQK,OAAOgH,gBAG7BC,QAAS,WACP,GAAIC,GAAI3H,KAAK4H,YACb,OAAO,IAAItI,MAAKqI,EAAEE,UAAqC,IAAxBF,EAAEG,sBAGnCF,WAAY,WACV,MAAO5H,MAAKqH,MAGdU,QAAS,SAAUJ,GACjB3H,KAAKgI,WAAW,GAAI1I,MAAKqI,EAAEE,UAAqC,IAAxBF,EAAEG,uBAG5CE,WAAY,SAAUL,GAChBA,GAAK3H,KAAKkF,WAAayC,GAAK3H,KAAKoF,SACnCpF,KAAKqH,KAAOM,EACZ3H,KAAKuH,WACLvH,KAAKiI,SAAWjI,KAAKqH,KACrBrH,KAAKkI,QAELlI,KAAKI,QAAQ+G,SACXC,KAAW,aACXC,KAAWM,EACXzC,UAAWlF,KAAKkF,UAChBE,QAAWpF,KAAKoF,WAKtB+C,UAAW,SAAUpH,GACnBf,KAAKe,OAASC,EAASC,YAAYF,EAAQf,KAAKc,WAChD,IAAIV,EACAJ,MAAKqB,QACPjB,EAAUJ,KAAKI,QACNJ,KAAKyB,YACdrB,EAAUJ,KAAKI,QAAQP,KAAK,UAE1BO,GAAWA,EAAQkH,OACrBtH,KAAKuH,YAITA,SAAU,WACR,GAAIa,GAAYpI,KAAKqI,kBAChBrI,MAAKqB,QAMRrB,KAAKI,QAAQkH,IAAIc,IALbpI,KAAKyB,WACPzB,KAAKI,QAAQP,KAAK,SAASyH,IAAIc,GAEjCpI,KAAKI,QAAQK,KAAK,OAAQ2H,IAIxBpI,KAAK6B,WACPzC,EAAE,IAAMY,KAAK6B,WAAWyF,IAAItH,KAAKqI,iBAAiBrI,KAAK8B,cAI3DuG,iBAAkB,SAAUtH,GAE1B,MADchB,SAAVgB,IAAqBA,EAASf,KAAKe,QAChCC,EAASsH,WAAWtI,KAAKqH,KAAMtG,EAAQf,KAAKQ,SAAUR,KAAKc,aAGpEwE,aAAc,SAAUJ,GACtBlF,KAAKkF,UAAYA,KAAcC,EAAAA,GAC3BnF,KAAKkF,cAAeC,EAAAA,KACtBnF,KAAKkF,UAAYlE,EAASuH,UAAUvI,KAAKkF,UAAWlF,KAAKe,OAAQf,KAAKQ,SAAUR,KAAKc,aAEvFd,KAAK+F,SACL/F,KAAKwI,mBAGPjD,WAAY,SAAUH,GACpBpF,KAAKoF,QAAUA,GAAWD,EAAAA,EACtBnF,KAAKoF,UAAYD,EAAAA,IACnBnF,KAAKoF,QAAUpE,EAASuH,UAAUvI,KAAKoF,QAASpF,KAAKe,OAAQf,KAAKQ,SAAUR,KAAKc,aAEnFd,KAAK+F,SACL/F,KAAKwI,mBAGPhD,sBAAuB,SAAUH,GAC/BrF,KAAKqF,mBAAqBA,MACrBjG,EAAEqJ,QAAQzI,KAAKqF,sBAClBrF,KAAKqF,mBAAqBrF,KAAKqF,mBAAmB1E,MAAM,SAE1DX,KAAKqF,mBAAqBjG,EAAEsJ,IAAI1I,KAAKqF,mBAAoB,SAAUsC,GACjE,MAAOgB,UAAShB,EAAG,MAErB3H,KAAK+F,SACL/F,KAAKwI,mBAGP/C,mBAAoB,SAAUC,GAC5B1F,KAAK0F,gBAAkBA,MAClBtG,EAAEqJ,QAAQzI,KAAK0F,mBAClB1F,KAAK0F,gBAAkB1F,KAAK0F,gBAAgB/E,MAAM,SAEpDX,KAAK0F,gBAAkBtG,EAAEsJ,IAAI1I,KAAK0F,gBAAiB,SAAUiC,GAC3D,MAAOgB,UAAShB,EAAG,MAErB3H,KAAK+F,SACL/F,KAAKwI,mBAGP7C,iBAAkB,SAAUC,GAC1B5F,KAAK4F,cAAgBA,MAChBxG,EAAEqJ,QAAQzI,KAAK4F,iBAClB5F,KAAK4F,cAAgB5F,KAAK4F,cAAcjF,MAAM,SAEhDX,KAAK4F,cAAgBxG,EAAEsJ,IAAI1I,KAAK4F,cAAe,SAAU+B,GACvD,MAAOgB,UAAShB,EAAG,MAErB3H,KAAK+F,SACL/F,KAAKwI,mBAGPzB,MAAO,WACL,IAAI/G,KAAKmB,SAAT,CAEA,IAAKnB,KAAKmC,OAAQ,CAChB,GAAIyG,GAAgB,CACpBxJ,GAAE,OAAOyJ,KAAK,WACZ,GAAIC,GAAgBH,SAASvJ,EAAEY,MAAM+I,IAAI,UAAW,GAChDD,GAAgBF,IAClBA,EAAgBE,KAGpB9I,KAAKmC,OAASyG,EAAgB,GAGhC,GAAII,GAAQC,EAAKC,EAAMC,CAErBA,GADEnJ,KAAKO,oBAAqBnB,GACVY,KAAKO,UAAUyI,SAEf5J,EAAEY,KAAKO,WAAWyI,SAGlChJ,KAAKyB,WACPuH,EAAShJ,KAAKyB,UAAUuH,SACxBE,EAAOF,EAAOE,MACa,eAAvBlJ,KAAKgC,gBAA0D,YAAvBhC,KAAKgC,kBAC/CkH,GAAQlJ,KAAKyB,UAAU2H,aAAepJ,KAAK8D,OAAOsF,gBAGpDJ,EAAShJ,KAAKI,QAAQ4I,SACtBE,EAAOF,EAAOE,KAGhB,IAAIG,GAAY1E,SAAS2E,KAAKC,aAAevC,OAAOwC,UAChDN,GAAO,IAAMG,IACfH,EAAOG,EAAY,KAInBJ,EADyB,YAAvBjJ,KAAKgC,gBAAuD,aAAvBhC,KAAKgC,eACtCgH,EAAOC,IAAMjJ,KAAK8D,OAAOgD,cAEzBkC,EAAOC,IAAMjJ,KAAK6G,OAG1BoC,GAAYE,EAAgBF,IAC5BC,GAAcC,EAAgBD,KAE9BlJ,KAAK8D,OAAOiF,KACVE,IAAQA,EACRC,KAAQA,EACR/G,OAAQnC,KAAKmC,WAIjB4D,OAAQ,WACN,GAAIsB,GAAMoC,GAAW,CACjBhK,YAAaA,UAAUQ,SAAmC,gBAAjBR,WAAU,IAAmBA,UAAU,YAAcH,QAChG+H,EAAO5H,UAAU,GACjBgK,GAAW,IAEXpC,GAAQrH,KAAKqB,QAAUrB,KAAKI,QAAQkH,MAAQtH,KAAKI,QAAQP,KAAK,SAASyH,QAAUtH,KAAKI,QAAQK,KAAK,SAAWT,KAAKkC,aAChG,gBAARmF,IAAoBA,YAAgBqC,WAC7CrC,EAAOA,EAAKxD,QAAQ,aAAa,MAIhCwD,IACHA,EAAO,GAAI/H,MACXmK,GAAW,GAGbzJ,KAAKqH,KAAOrG,EAASuH,UAAUlB,EAAMrH,KAAKe,OAAQf,KAAKQ,SAAUR,KAAKc,YAElE2I,GAAUzJ,KAAKuH,WAEfvH,KAAKqH,KAAOrH,KAAKkF,UACnBlF,KAAKiI,SAAW,GAAI3I,MAAKU,KAAKkF,WACrBlF,KAAKqH,KAAOrH,KAAKoF,QAC1BpF,KAAKiI,SAAW,GAAI3I,MAAKU,KAAKoF,SAE9BpF,KAAKiI,SAAW,GAAI3I,MAAKU,KAAKqH,MAEhCrH,KAAKkI,QAGPrC,QAAS,WAGP,IAFA,GAAI8D,GAAS3J,KAAKgF,UAChB4E,EAAO,OACFD,EAAS3J,KAAKgF,UAAY,GAC/B4E,GAAQ,mBAAqBlJ,EAAMV,KAAKQ,UAAUqJ,QAASF,IAAY,GAAK,OAE9EC,IAAQ,QACR5J,KAAK8D,OAAOjE,KAAK,8BAA8BiK,OAAOF,IAGxD9D,WAAY,WAGV,IAFA,GAAI8D,GAAO,GACT9J,EAAI,EACK,GAAJA,GACL8J,GAAQ,uBAAyBlJ,EAAMV,KAAKQ,UAAUuJ,YAAYjK,KAAO,SAE3EE,MAAK8D,OAAOjE,KAAK,6BAA6B+J,KAAKA,IAGrD1B,KAAM,WACJ,GAAiB,MAAblI,KAAKqH,MAAiC,MAAjBrH,KAAKiI,SAA9B,CAGA,GAAIN,GAAI,GAAIrI,MAAKU,KAAKiI,UACpB+B,EAAOrC,EAAEsC,iBACTC,EAAQvC,EAAEwC,cACVC,EAAWzC,EAAEC,aACbyC,EAAQ1C,EAAE2C,cACVC,EAAU5C,EAAE6C,gBACZC,EAAYzK,KAAKkF,cAAeC,EAAAA,GAAWnF,KAAKkF,UAAU+E,mBAAoB9E,EAAAA,GAC9EuF,EAAa1K,KAAKkF,cAAeC,EAAAA,GAAWnF,KAAKkF,UAAUiF,cAAgB,IAAKhF,EAAAA,GAChFwF,EAAU3K,KAAKoF,UAAYD,EAAAA,EAAWnF,KAAKoF,QAAQ6E,iBAAmB9E,EAAAA,EACtEyF,EAAW5K,KAAKoF,UAAYD,EAAAA,EAAWnF,KAAKoF,QAAQ+E,cAAgB,EAAIhF,EAAAA,EACxE0F,EAAc,GAAKxL,GAAQW,KAAKqH,KAAK4C,iBAAkBjK,KAAKqH,KAAK8C,cAAenK,KAAKqH,KAAKO,cAAekD,UACzGC,EAAQ,GAAIzL,KAGd,IAFAU,KAAK8D,OAAOjE,KAAK,uCACdmL,KAAKtK,EAAMV,KAAKQ,UAAUyK,OAAOf,GAAS,IAAMF,GACxB,QAAvBhK,KAAK8C,eAA0B,CACjC,GAAIsF,GAAYpI,KAAKqI,kBACrBrI,MAAK8D,OAAOjE,KAAK,wCAAwCmL,KAAK5C,GAC9DpI,KAAK8D,OAAOjE,KAAK,0CAA0CmL,KAAK5C,OAEhEpI,MAAK8D,OAAOjE,KAAK,wCACdmL,KAAKZ,EAAW,IAAM1J,EAAMV,KAAKQ,UAAUyK,OAAOf,GAAS,IAAMF,GACpEhK,KAAK8D,OAAOjE,KAAK,0CACdmL,KAAKZ,EAAW,IAAM1J,EAAMV,KAAKQ,UAAUyK,OAAOf,GAAS,IAAMF,EAEtEhK,MAAK8D,OAAOjE,KAAK,kBACdmL,KAAKtK,EAAMV,KAAKQ,UAAUuK,OAC1BG,OAAOlL,KAAK8E,YAAa,GAC5B9E,KAAKwI,kBACLxI,KAAK8F,YAGL,IAAIqF,GAAY9L,EAAQ2K,EAAME,EAAQ,EAAG,GAAI,EAAG,EAAG,EAAG,GACpDkB,EAAMpK,EAASqK,eAAeF,EAAUlB,iBAAkBkB,EAAUhB,cACtEgB,GAAUnD,WAAWoD,GACrBD,EAAUnD,WAAWoD,GAAOD,EAAUG,YAActL,KAAKgF,UAAY,GAAK,EAC1E,IAAIuG,GAAY,GAAIjM,MAAK6L,EACzBI,GAAUvD,WAAWuD,EAAU3D,aAAe,IAC9C2D,EAAYA,EAAUT,SAGtB,KAFA,GACIU,GADA5B,KAEGuB,EAAUL,UAAYS,GACvBJ,EAAUG,aAAetL,KAAKgF,WAChC4E,EAAKpD,KAAK,QAEZgF,EAAU,GACNL,EAAUlB,iBAAmBD,GAASmB,EAAUlB,kBAAoBD,GAAQmB,EAAUhB,cAAgBD,EACxGsB,GAAW,QACFL,EAAUlB,iBAAmBD,GAASmB,EAAUlB,kBAAoBD,GAAQmB,EAAUhB,cAAgBD,KAC/GsB,GAAW,QAGTxL,KAAK+E,gBACPoG,EAAUlB,kBAAoBc,EAAMU,eACpCN,EAAUhB,eAAiBY,EAAMW,YACjCP,EAAUvD,cAAgBmD,EAAMrD,YAChC8D,GAAW,UAETL,EAAUL,WAAaD,IACzBW,GAAW,YAERL,EAAUL,UAAY,OAAa9K,KAAKkF,WAAaiG,EAAUL,UAAY9K,KAAKoF,SACrB,KAA9DhG,EAAEuM,QAAQR,EAAUG,YAAatL,KAAKqF,uBACtCmG,GAAW,aAEb5B,EAAKpD,KAAK,iBAAmBgF,EAAU,KAAOL,EAAUvD,aAAe,SACnEuD,EAAUG,aAAetL,KAAKiF,SAChC2E,EAAKpD,KAAK,SAEZ2E,EAAUnD,WAAWmD,EAAUvD,aAAe,EAEhD5H,MAAK8D,OAAOjE,KAAK,8BAA8B+L,QAAQ9B,OAAOF,EAAKiC,KAAK,KAExEjC,IAGA,KAAK,GAFDkC,GAAM,GAAIC,EAAW,GAAIC,EAAc,GACvCpG,EAAgB5F,KAAK4F,kBAChB9F,EAAI,EAAO,GAAJA,EAAQA,IACtB,GAAiC,KAA7B8F,EAAchG,QAAQE,GAA1B,CACA,GAAImM,GAAS5M,EAAQ2K,EAAME,EAAOE,EAAUtK,EAC5C0L,GAAU,GAELS,EAAOnB,UAAY,MAAY9K,KAAKkF,WAAa+G,EAAOnB,UAAY9K,KAAKoF,QAC5EoG,GAAW,YACFnB,GAASvK,IAClB0L,GAAW,WAETxL,KAAKiC,cAAwD,GAAxCvB,EAAMV,KAAKQ,UAAU0L,SAASjM,QACrD8L,EAAgB,GAAJjM,EAASY,EAAMV,KAAKQ,UAAU0L,SAAS,GAAKxL,EAAMV,KAAKQ,UAAU0L,SAAS,GAClFH,GAAYC,IACK,IAAfA,GACFpC,EAAKpD,KAAK,eAEZoD,EAAKpD,KAAK,kCAAoCuF,EAASI,cAAgB,cAEzEH,EAAcD,EACdD,EAAOhM,EAAI,GAAKA,EAAI,GAAK,GACzB8J,EAAKpD,KAAK,oBAAsBgF,EAAU,UAAgB,GAAJ1L,EAAS,KAAO,MAAQ,KAAOgM,EAAM,WAClF,IAALhM,GACF8J,EAAKpD,KAAK,iBAGZsF,EAAMhM,EAAI,MACV8J,EAAKpD,KAAK,oBAAsBgF,EAAU,KAAOM,EAAM,YAG3D9L,KAAK8D,OAAOjE,KAAK,4BAA4B+J,KAAKA,EAAKiC,KAAK,KAE5DjC,KACAkC,EAAM,GAAIC,EAAW,GAAIC,EAAc,EAEvC,KAAK,GADDtG,GAAkB1F,KAAK0F,oBAClB5F,EAAI,EAAO,GAAJA,EAAQA,GAAKE,KAAK+B,WAChC,GAAmC,KAA/B2D,EAAgB9F,QAAQE,GAA5B,CACA,GAAImM,GAAS5M,EAAQ2K,EAAME,EAAOE,EAAUC,EAAOvK,EAAG,EACtD0L,GAAU,GACNS,EAAOnB,UAAY9K,KAAKkF,WAAa+G,EAAOnB,UAAY9K,KAAKoF,QAC/DoG,GAAW,YACFY,KAAKC,MAAM9B,EAAUvK,KAAK+B,aAAeqK,KAAKC,MAAMvM,EAAIE,KAAK+B,cACtEyJ,GAAW,WAETxL,KAAKiC,cAAwD,GAAxCvB,EAAMV,KAAKQ,UAAU0L,SAASjM,QACrD8L,EAAoB,GAAR1B,EAAa3J,EAAMV,KAAKQ,UAAU0L,SAAS,GAAKxL,EAAMV,KAAKQ,UAAU0L,SAAS,GACtFH,GAAYC,IACK,IAAfA,GACFpC,EAAKpD,KAAK,eAEZoD,EAAKpD,KAAK,oCAAsCuF,EAASI,cAAgB,cAE3EH,EAAcD,EACdD,EAAOzB,EAAQ,GAAKA,EAAQ,GAAK,GAEjCT,EAAKpD,KAAK,sBAAwBgF,EAAU,KAAOM,EAAM,KAAW,GAAJhM,EAAS,IAAMA,EAAIA,GAAK,WAC/E,IAALA,GACF8J,EAAKpD,KAAK,iBAGZsF,EAAMhM,EAAI,MAEV8J,EAAKpD,KAAK,sBAAwBgF,EAAU,KAAOnB,EAAQ,KAAW,GAAJvK,EAAS,IAAMA,EAAIA,GAAK,YAG9FE,KAAK8D,OAAOjE,KAAK,8BAA8B+J,KAAKA,EAAKiC,KAAK,IAE9D,IAAIS,GAActM,KAAKqH,KAAK4C,iBACxBgB,EAASjL,KAAK8D,OAAOjE,KAAK,0BAC3BA,KAAK,YACLmL,KAAKhB,GACLuC,MACA1M,KAAK,QAAQ2M,YAAY,SAC5B,IAAIF,GAAetC,EAAM,CAGf,GAAIhB,GAASiC,EAAOhL,OAAS,EACrCgL,GAAOwB,GAAGzM,KAAKqH,KAAK8C,cAAgBnB,GAAQxE,SAAS,WAE5CiG,EAAPT,GAAoBA,EAAOW,IAC7BM,EAAOzG,SAAS,YAEdwF,GAAQS,GACVQ,EAAOyB,MAAM,EAAGhC,EAAa,GAAGlG,SAAS,YAEvCwF,GAAQW,GACVM,EAAOyB,MAAM9B,GAAUpG,SAAS,YAGlCoF,EAAO,GACPI,EAAiC,GAA1BrB,SAASqB,EAAO,GAAI,GAC3B,IAAI2C,GAAW3M,KAAK8D,OAAOjE,KAAK,yBAC7BA,KAAK,YACLmL,KAAKhB,EAAO,KAAOA,EAAO,IAC1BuC,MACA1M,KAAK,KACRmK,IAAQ,CACR,KAAK,GAAIlK,GAAI,GAAQ,GAAJA,EAAQA,IACvB8J,GAAQ,qBAA4B,IAAL9J,GAAgB,IAALA,EAAU,OAAS,KAAOwM,GAAetC,EAAO,UAAY,KAAcS,EAAPT,GAAoBA,EAAOW,EAAU,YAAc,IAAM,KAAOX,EAAO,UACpLA,GAAQ,CAEV2C,GAAS/C,KAAKA,GACd5J,KAAK+G,UAGPyB,gBAAiB,WACf,GAAIb,GAAI,GAAIrI,MAAKU,KAAKiI,UACpB+B,EAAOrC,EAAEsC,iBACTC,EAAQvC,EAAEwC,cACViB,EAAMzD,EAAEC,aACRgF,EAAOjF,EAAE2C,aACX,QAAQtK,KAAKwD,UACX,IAAK,GACCxD,KAAKkF,cAAeC,EAAAA,IAAY6E,GAAQhK,KAAKkF,UAAU+E,kBACtDC,GAASlK,KAAKkF,UAAUiF,eACxBiB,GAAOpL,KAAKkF,UAAU0C,cACtBgF,GAAQ5M,KAAKkF,UAAUoF,cAC1BtK,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,WAE3C7M,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,YAEzC7M,KAAKoF,UAAYD,EAAAA,GAAY6E,GAAQhK,KAAKoF,QAAQ6E,kBACjDC,GAASlK,KAAKoF,QAAQ+E,eACtBiB,GAAOpL,KAAKoF,QAAQwC,cACpBgF,GAAQ5M,KAAKoF,QAAQkF,cACxBtK,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,WAE3C7M,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,WAE7C,MACF,KAAK,GACC7M,KAAKkF,cAAeC,EAAAA,IAAY6E,GAAQhK,KAAKkF,UAAU+E,kBACtDC,GAASlK,KAAKkF,UAAUiF,eACxBiB,GAAOpL,KAAKkF,UAAU0C,aACzB5H,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,WAE3C7M,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,YAEzC7M,KAAKoF,UAAYD,EAAAA,GAAY6E,GAAQhK,KAAKoF,QAAQ6E,kBACjDC,GAASlK,KAAKoF,QAAQ+E,eACtBiB,GAAOpL,KAAKoF,QAAQwC,aACvB5H,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,WAE3C7M,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,WAE7C,MACF,KAAK,GACC7M,KAAKkF,cAAeC,EAAAA,IAAY6E,GAAQhK,KAAKkF,UAAU+E,kBACtDC,GAASlK,KAAKkF,UAAUiF,cAC3BnK,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,WAE3C7M,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,YAEzC7M,KAAKoF,UAAYD,EAAAA,GAAY6E,GAAQhK,KAAKoF,QAAQ6E,kBACjDC,GAASlK,KAAKoF,QAAQ+E,cACzBnK,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,WAE3C7M,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,WAE7C,MACF,KAAK,GACL,IAAK,GACC7M,KAAKkF,cAAeC,EAAAA,IAAY6E,GAAQhK,KAAKkF,UAAU+E,iBACzDjK,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,WAE3C7M,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,YAEzC7M,KAAKoF,UAAYD,EAAAA,GAAY6E,GAAQhK,KAAKoF,QAAQ6E,iBACpDjK,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,WAE3C7M,KAAK8D,OAAOjE,KAAK,SAASkJ,KAAK8D,WAAY,cAMnDxI,WAAY,SAAU3B,GAKpB,GAHAA,EAAEwE,iBACFxE,EAAEuE,mBAEEjH,KAAK8M,WAAT,CAIA9M,KAAK8M,YAAa,CAElB,IAAIC,GAAgBrK,EAAEqK,cAElBC,EAAQD,EAAcE,WAEtBC,EAAOF,EAAQ,EAAI,EAAe,IAAVA,EAAe,EAAI,EAE3ChN,MAAKoD,0CACP8J,GAAQA,GAGVlN,KAAKgG,SAASkH,GAEdC,WAAW/N,EAAE8E,MAAM,WAEjBlE,KAAK8M,YAAa,GAEjB9M,MAAOA,KAAKqD,gCAIjBY,MAAO,SAAUvB,GACfA,EAAEuE,kBACFvE,EAAEwE,gBACF,IAAIvE,GAASvD,EAAEsD,EAAEC,QAAQC,QAAQ,uBAIjC,IAHID,EAAOrB,GAAG,IAAMtB,KAAKuC,YACvBI,EAASvD,EAAEuD,GAAQjB,SAASkB,QAAQ,yBAEjB,GAAjBD,EAAO1C,OAAa,CACtB,GAAI0C,EAAOrB,GAAG,aAOZ,WANAtB,MAAKI,QAAQ+G,SACXC,KAAW,aACXC,KAAWrH,KAAKiI,SAChB/C,UAAWlF,KAAKkF,UAChBE,QAAWpF,KAAKoF,SAIpB,QAAQzC,EAAO,GAAGyK,SAASC,eACzB,IAAK,KACH,OAAQ1K,EAAO,GAAG2K,WAChB,IAAK,SACHtN,KAAKgG,SAAS,EACd,MACF,KAAK,OACL,IAAK,OACH,GAAIuH,GAAMvM,EAASkC,MAAMlD,KAAKwD,UAAUgK,SAAkC,QAAvB7K,EAAO,GAAG2K,UAAsB,GAAK,EACxF,QAAQtN,KAAKwD,UACX,IAAK,GACHxD,KAAKiI,SAAWjI,KAAKyN,SAASzN,KAAKiI,SAAUsF,EAC7C,MACF,KAAK,GACHvN,KAAKiI,SAAWjI,KAAK0N,SAAS1N,KAAKiI,SAAUsF,EAC7C,MACF,KAAK,GACHvN,KAAKiI,SAAWjI,KAAK2N,UAAU3N,KAAKiI,SAAUsF,EAC9C,MACF,KAAK,GACL,IAAK,GACHvN,KAAKiI,SAAWjI,KAAK4N,SAAS5N,KAAKiI,SAAUsF,GAGjDvN,KAAKkI,OACLlI,KAAKI,QAAQ+G,SACXC,KAAWzE,EAAO,GAAG2K,UAAY,IAAMtN,KAAK6N,oBAAoB7N,KAAKwD,UACrE6D,KAAWrH,KAAKiI,SAChB/C,UAAWlF,KAAKkF,UAChBE,QAAWpF,KAAKoF,SAElB,MACF,KAAK,QACH,GAAIiC,GAAO,GAAI/H,KACf+H,GAAOhI,EAAQgI,EAAKoE,cAAepE,EAAKqE,WAAYrE,EAAKK,UAAWL,EAAKyG,WAAYzG,EAAK0G,aAAc1G,EAAK2G,aAAc,GAGvH3G,EAAOrH,KAAKkF,UAAWmC,EAAOrH,KAAKkF,UAC9BmC,EAAOrH,KAAKoF,UAASiC,EAAOrH,KAAKoF,SAE1CpF,KAAKwD,SAAWxD,KAAKsD,cACrBtD,KAAKgG,SAAS,GACdhG,KAAKiO,SAAS5G,GACdrH,KAAKkI,OACDlI,KAAK4E,WACP5E,KAAK6C,OAIX,KACF,KAAK,OACH,IAAKF,EAAOrB,GAAG,aAAc,CAC3B,GAAI0I,GAAOhK,KAAKiI,SAASgC,iBACvBC,EAAQlK,KAAKiI,SAASkC,cACtBiB,EAAMpL,KAAKiI,SAASL,aACpByC,EAAQrK,KAAKiI,SAASqC,cACtBC,EAAUvK,KAAKiI,SAASuC,gBACxB0D,EAAUlO,KAAKiI,SAASkG,eAqD1B,IAnDIxL,EAAOrB,GAAG,WACZtB,KAAKiI,SAASD,WAAW,GACzBkC,EAAQvH,EAAOjB,SAAS7B,KAAK,QAAQuO,MAAMzL,GAC3CyI,EAAMpL,KAAKiI,SAASL,aACpB5H,KAAKiI,SAASoG,YAAYnE,GAC1BlK,KAAKI,QAAQ+G,SACXC,KAAM,cACNC,KAAMrH,KAAKiI,WAETjI,KAAKyD,YAAc,GACrBzD,KAAKiO,SAAS5O,EAAQ2K,EAAME,EAAOkB,EAAKf,EAAOE,EAAS2D,EAAS,KAE1DvL,EAAOrB,GAAG,UACnBtB,KAAKiI,SAASD,WAAW,GACzBgC,EAAOrB,SAAShG,EAAOqI,OAAQ,KAAO,EACtChL,KAAKiI,SAASqG,eAAetE,GAC7BhK,KAAKI,QAAQ+G,SACXC,KAAM,aACNC,KAAMrH,KAAKiI,WAETjI,KAAKyD,YAAc,GACrBzD,KAAKiO,SAAS5O,EAAQ2K,EAAME,EAAOkB,EAAKf,EAAOE,EAAS2D,EAAS,KAE1DvL,EAAOrB,GAAG,UACnB+I,EAAQ1B,SAAShG,EAAOqI,OAAQ,KAAO,GACnCrI,EAAO4L,SAAS,YAAc5L,EAAO4L,SAAS,cACnC,IAATlE,GAAe1H,EAAO4L,SAAS,WACjClE,EAAQ,EACU,IAATA,GAAe1H,EAAO4L,SAAS,aACxClE,GAAS,KAGbrK,KAAKiI,SAASuG,YAAYnE,GAC1BrK,KAAKI,QAAQ+G,SACXC,KAAM,aACNC,KAAMrH,KAAKiI,WAETjI,KAAKyD,YAAc,GACrBzD,KAAKiO,SAAS5O,EAAQ2K,EAAME,EAAOkB,EAAKf,EAAOE,EAAS2D,EAAS,KAE1DvL,EAAOrB,GAAG,aACnBiJ,EAAU5B,SAAShG,EAAOqI,OAAOyD,OAAO9L,EAAOqI,OAAOpL,QAAQ,KAAO,GAAI,KAAO,EAChFI,KAAKiI,SAASyG,cAAcnE,GAC5BvK,KAAKI,QAAQ+G,SACXC,KAAM,eACNC,KAAMrH,KAAKiI,WAETjI,KAAKyD,YAAc,GACrBzD,KAAKiO,SAAS5O,EAAQ2K,EAAME,EAAOkB,EAAKf,EAAOE,EAAS2D,EAAS,KAGhD,GAAjBlO,KAAKwD,SAAe,CACtB,GAAImL,GAAc3O,KAAKwD,QACvBxD,MAAKgG,SAAS,IACdhG,KAAKkI,OACDyG,GAAe3O,KAAKwD,UAAYxD,KAAK4E,WACvC5E,KAAK6C,WAGP7C,MAAKkI,OACDlI,KAAK4E,WACP5E,KAAK6C,OAIX,KACF,KAAK,KACH,GAAIF,EAAOrB,GAAG,UAAYqB,EAAOrB,GAAG,aAAc,CAChD,GAAI8J,GAAMzC,SAAShG,EAAOqI,OAAQ,KAAO,EACrChB,EAAOhK,KAAKiI,SAASgC,iBACvBC,EAAQlK,KAAKiI,SAASkC,cACtBE,EAAQrK,KAAKiI,SAASqC,cACtBC,EAAUvK,KAAKiI,SAASuC,gBACxB0D,EAAUlO,KAAKiI,SAASkG,eACtBxL,GAAOrB,GAAG,QACE,IAAV4I,GACFA,EAAQ,GACRF,GAAQ,GAERE,GAAS,EAEFvH,EAAOrB,GAAG,UACN,IAAT4I,GACFA,EAAQ,EACRF,GAAQ,GAERE,GAAS,GAGblK,KAAKiI,SAASqG,eAAetE,GAC7BhK,KAAKiI,SAASoG,YAAYnE,EAAOkB,GACjCpL,KAAKI,QAAQ+G,SACXC,KAAM,YACNC,KAAMrH,KAAKiI,WAETjI,KAAKyD,YAAc,GACrBzD,KAAKiO,SAAS5O,EAAQ2K,EAAME,EAAOkB,EAAKf,EAAOE,EAAS2D,EAAS,IAGrE,GAAIS,GAAc3O,KAAKwD,QACvBxD,MAAKgG,SAAS,IACdhG,KAAKkI,OACDyG,GAAe3O,KAAKwD,UAAYxD,KAAK4E,WACvC5E,KAAK6C,UAOfoL,SAAU,SAAU5G,EAAMuH,GACnBA,GAAkB,QAATA,IACZ5O,KAAKqH,KAAOA,GACTuH,GAAkB,QAATA,IACZ5O,KAAKiI,SAAWZ,GAClBrH,KAAKkI,OACLlI,KAAKuH,UACL,IAAInH,EACAJ,MAAKqB,QACPjB,EAAUJ,KAAKI,QACNJ,KAAKyB,YACdrB,EAAUJ,KAAKI,QAAQP,KAAK,UAE1BO,IACFA,EAAQyO,SACJ7O,KAAK4E,aAAegK,GAAkB,QAATA,IAInC5O,KAAKI,QAAQ+G,SACXC,KAAM,aACNC,KAAMrH,KAAKqH,OAEF,MAARA,IACDrH,KAAKqH,KAAOrH,KAAKiI,WAGrB6G,WAAY,SAAUzH,EAAMkG,GAC1B,IAAKA,EAAK,MAAOlG,EACjB,IAAI0H,GAAW,GAAIzP,MAAK+H,EAAKyD,UAG7B,OADAiE,GAASL,cAAcK,EAASvE,gBAAmB+C,EAAMvN,KAAK+B,YACvDgN,GAGTtB,SAAU,SAAUpG,EAAMkG,GACxB,IAAKA,EAAK,MAAOlG,EACjB,IAAI0H,GAAW,GAAIzP,MAAK+H,EAAKyD,UAG7B,OADAiE,GAASP,YAAYO,EAASzE,cAAgBiD,GACvCwB,GAGTrB,SAAU,SAAUrG,EAAMkG,GACxB,IAAKA,EAAK,MAAOlG,EACjB,IAAI0H,GAAW,GAAIzP,MAAK+H,EAAKyD,UAG7B,OADAiE,GAAS/G,WAAW+G,EAASnH,aAAe2F,GACrCwB,GAGTpB,UAAW,SAAUtG,EAAMkG,GACzB,IAAKA,EAAK,MAAOlG,EACjB,IAIE2H,GAAWC,EAJTF,EAAW,GAAIzP,MAAK+H,EAAKyD,WAC3BM,EAAM2D,EAASnH,aACfsC,EAAQ6E,EAAS5E,cACjB+E,EAAM9C,KAAK+C,IAAI5B,EAGjB,IADAA,EAAMA,EAAM,EAAI,EAAI,GACT,GAAP2B,EACFD,EAAc,IAAP1B,EAGH,WACF,MAAOwB,GAAS5E,eAAiBD,GAI/B,WACF,MAAO6E,GAAS5E,eAAiB6E,GAEnCA,EAAY9E,EAAQqD,EACpBwB,EAASV,YAAYW,IAEL,EAAZA,GAAiBA,EAAY,MAC/BA,GAAaA,EAAY,IAAM,QAC5B,CAEL,IAAK,GAAIlP,GAAI,EAAOoP,EAAJpP,EAASA,IAEvBiP,EAAW/O,KAAK2N,UAAUoB,EAAUxB,EAEtCyB,GAAYD,EAAS5E,cACrB4E,EAAS/G,WAAWoD,GACpB6D,EAAO,WACL,MAAOD,IAAaD,EAAS5E,eAKjC,KAAO8E,KACLF,EAAS/G,aAAaoD,GACtB2D,EAASV,YAAYW,EAEvB,OAAOD,IAGTnB,SAAU,SAAUvG,EAAMkG,GACxB,MAAOvN,MAAK2N,UAAUtG,EAAY,GAANkG,IAG9B6B,gBAAiB,SAAU/H,GACzB,MAAOA,IAAQrH,KAAKkF,WAAamC,GAAQrH,KAAKoF,SAGhDmB,QAAS,SAAU7D,GACjB,GAAI1C,KAAK8D,OAAOxC,GAAG,kBAGjB,YAFiB,IAAboB,EAAE2M,SACJrP,KAAKiG,OAGT,IACEsH,GACA+B,EAASC,EAFPC,GAAc,CAGlB,QAAQ9M,EAAE2M,SACR,IAAK,IACHrP,KAAK6C,OACLH,EAAEwE,gBACF,MACF,KAAK,IACL,IAAK,IACH,IAAKlH,KAAK6E,mBAAoB,KAC9B0I,GAAmB,IAAb7K,EAAE2M,QAAgB,GAAK,EAC7B7L,SAAWxD,KAAKwD,SACZd,EAAE+M,QACJjM,UAAY,EACHd,EAAEgN,WACXlM,UAAY,GAEE,GAAZA,UACF8L,EAAUtP,KAAK4N,SAAS5N,KAAKqH,KAAMkG,GACnCgC,EAAcvP,KAAK4N,SAAS5N,KAAKiI,SAAUsF,IACtB,GAAZ/J,UACT8L,EAAUtP,KAAK2N,UAAU3N,KAAKqH,KAAMkG,GACpCgC,EAAcvP,KAAK2N,UAAU3N,KAAKiI,SAAUsF,IACvB,GAAZ/J,UACT8L,EAAUtP,KAAK0N,SAAS1N,KAAKqH,KAAMkG,GACnCgC,EAAcvP,KAAK0N,SAAS1N,KAAKiI,SAAUsF,IACtB,GAAZ/J,UACT8L,EAAUtP,KAAKyN,SAASzN,KAAKqH,KAAMkG,GACnCgC,EAAcvP,KAAKyN,SAASzN,KAAKiI,SAAUsF,IACtB,GAAZ/J,WACT8L,EAAUtP,KAAK8O,WAAW9O,KAAKqH,KAAMkG,GACrCgC,EAAcvP,KAAK8O,WAAW9O,KAAKiI,SAAUsF,IAE3CvN,KAAKoP,gBAAgBE,KACvBtP,KAAKqH,KAAOiI,EACZtP,KAAKiI,SAAWsH,EAChBvP,KAAKuH,WACLvH,KAAK+F,SACLrD,EAAEwE,iBACFsI,GAAc,EAEhB,MACF,KAAK,IACL,IAAK,IACH,IAAKxP,KAAK6E,mBAAoB,KAC9B0I,GAAmB,IAAb7K,EAAE2M,QAAgB,GAAK,EAC7B7L,SAAWxD,KAAKwD,SACZd,EAAE+M,QACJjM,UAAY,EACHd,EAAEgN,WACXlM,UAAY,GAEE,GAAZA,UACF8L,EAAUtP,KAAK4N,SAAS5N,KAAKqH,KAAMkG,GACnCgC,EAAcvP,KAAK4N,SAAS5N,KAAKiI,SAAUsF,IACtB,GAAZ/J,UACT8L,EAAUtP,KAAK2N,UAAU3N,KAAKqH,KAAMkG,GACpCgC,EAAcvP,KAAK2N,UAAU3N,KAAKiI,SAAUsF,IACvB,GAAZ/J,UACT8L,EAAUtP,KAAK0N,SAAS1N,KAAKqH,KAAY,EAANkG,GACnCgC,EAAcvP,KAAK0N,SAAS1N,KAAKiI,SAAgB,EAANsF,IACtB,GAAZ/J,SACLxD,KAAKiC,cACPqN,EAAUtP,KAAKyN,SAASzN,KAAKqH,KAAY,EAANkG,GACnCgC,EAAcvP,KAAKyN,SAASzN,KAAKiI,SAAgB,EAANsF,KAE3C+B,EAAUtP,KAAKyN,SAASzN,KAAKqH,KAAY,EAANkG,GACnCgC,EAAcvP,KAAKyN,SAASzN,KAAKiI,SAAgB,EAANsF,IAExB,GAAZ/J,WACT8L,EAAUtP,KAAK8O,WAAW9O,KAAKqH,KAAY,EAANkG,GACrCgC,EAAcvP,KAAK8O,WAAW9O,KAAKiI,SAAgB,EAANsF,IAE3CvN,KAAKoP,gBAAgBE,KACvBtP,KAAKqH,KAAOiI,EACZtP,KAAKiI,SAAWsH,EAChBvP,KAAKuH,WACLvH,KAAK+F,SACLrD,EAAEwE,iBACFsI,GAAc,EAEhB,MACF,KAAK,IACH,GAAqB,GAAjBxP,KAAKwD,SAAe,CACtB,GAAImL,GAAc3O,KAAKwD,QACvBxD,MAAKgG,SAAS,IACdhG,KAAKkI,OACDyG,GAAe3O,KAAKwD,UAAYxD,KAAK4E,WACvC5E,KAAK6C,WAGP7C,MAAKkI,OACDlI,KAAK4E,WACP5E,KAAK6C,MAGTH,GAAEwE,gBACF,MACF,KAAK,GACHlH,KAAK6C,OAGT,GAAI2M,EAAa,CACf,GAAIpP,EACAJ,MAAKqB,QACPjB,EAAUJ,KAAKI,QACNJ,KAAKyB,YACdrB,EAAUJ,KAAKI,QAAQP,KAAK,UAE1BO,GACFA,EAAQyO,SAEV7O,KAAKI,QAAQ+G,SACXC,KAAM,aACNC,KAAMrH,KAAKqH,SAKjBrB,SAAU,SAAUuH,GAClB,GAAIA,EAAK,CACP,GAAIoC,GAAcvD,KAAKwD,IAAI,EAAGxD,KAAKyD,IAAI7O,EAASkC,MAAMjD,OAAS,EAAGD,KAAKwD,SAAW+J,GAC9EoC,IAAe3P,KAAK+C,SAAW4M,GAAe3P,KAAKiD,UACrDjD,KAAKI,QAAQ+G,SACXC,KAAa,aACbC,KAAarH,KAAKiI,SAClB0G,YAAa3O,KAAKwD,SAClBmM,YAAaA,IAGf3P,KAAKwD,SAAWmM,GAapB3P,KAAK8D,OAAOjE,KAAK,QAAQgD,OAAOiN,OAAO,mBAAqB9O,EAASkC,MAAMlD,KAAKwD,UAAUgI,SAASzC,IAAI,UAAW,SAClH/I,KAAKwI,mBAGP/B,MAAO,SAAU/D,GACf1C,KAAKiO,SAAS,KAAM,SAGtBJ,oBAAsB,SAAUrK,GAC9B,OAAQA,GACN,IAAK,GACH,MAAO,QACT,KAAK,GACH,MAAO,MACT,KAAK,GACH,MAAO,OACT,KAAK,GACH,MAAO,KACT,KAAK,GACH,MAAO,SAKf,IAAIuM,GAAM3Q,EAAEgF,GAAGqD,cACfrI,GAAEgF,GAAGqD,eAAiB,SAAUuI,GAC9B,GAAIC,GAAOvQ,MAAMF,MAAM,KAAMC,UAC7BwQ,GAAKC,OACL,IAAIC,EAeJ,OAdAnQ,MAAK6I,KAAK,WACR,GAAIuH,GAAQhR,EAAEY,MACZS,EAAO2P,EAAM3P,KAAK,kBAClBJ,EAA2B,gBAAV2P,IAAsBA,CAIzC,OAHKvP,IACH2P,EAAM3P,KAAK,iBAAmBA,EAAO,GAAIN,GAAeH,KAAMZ,EAAEiR,UAAWjR,EAAEgF,GAAGqD,eAAe6I,SAAUjQ,KAEtF,gBAAV2P,IAA6C,kBAAhBvP,GAAKuP,KAC3CG,EAAkB1P,EAAKuP,GAAQxQ,MAAMiB,EAAMwP,GACnBlQ,SAApBoQ,IACK,EAHX,SAOsBpQ,SAApBoQ,EACKA,EAEAnQ,MAGXZ,EAAEgF,GAAGqD,eAAe6I,YAEpBlR,EAAEgF,GAAGqD,eAAe8I,YAAcpQ,CAClC,IAAIO,GAAQtB,EAAEgF,GAAGqD,eAAe/G,OAC9B8P,IACEC,MAAc,SAAU,SAAU,UAAW,YAAa,WAAY,SAAU,WAAY,UAC5FC,WAAc,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OAC/D7G,SAAc,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACxDoB,QAAc,UAAW,WAAY,QAAS,QAAS,MAAO,OAAQ,OAAQ,SAAU,YAAa,UAAW,WAAY,YAC5HlB,aAAc,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OAC3FmC,UAAc,KAAM,MACpByE,QAAc,KAAM,KAAM,KAAM,MAChC5F,MAAa,UAIb/J,GACFkC,QAEIsI,QAAS,UACToF,OAAS,QACTpD,QAAS,IAGThC,QAAS,QACToF,OAAS,OACTpD,QAAS,IAGThC,QAAS,OACToF,OAAS,QACTpD,QAAS,IAGThC,QAAS,SACToF,OAAS,WACTpD,QAAS,IAGThC,QAAS,QACToF,OAAS,WACTpD,QAAS,KAGbqD,WAAkB,SAAU7G,GAC1B,MAAUA,GAAO,IAAM,GAAOA,EAAO,MAAQ,GAAQA,EAAO,MAAQ,GAEtEqB,eAAkB,SAAUrB,EAAME,GAChC,OAAQ,GAAKlJ,EAAS6P,WAAW7G,GAAQ,GAAK,GAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAIE,IAE7FhJ,iBAAkB,SAAUkG,EAAM0J,GAChC,GAAY,YAAR1J,EACF,MAAa,SAAT0J,EACK,mBAEA,qBACJ,IAAY,OAAR1J,EACT,MAAa,SAAT0J,EACK,YAEA,aAET,MAAM,IAAIC,OAAM,yBAGpBC,WAAY,SAAU5J,GACpB,GAAY,YAARA,EACF,MAAO,gDACF,IAAY,OAARA,EACT,MAAO,6BAEP,MAAM,IAAI2J,OAAM,yBAGpBE,eAAgB,8BAChBhQ,YAAa,SAAUF,EAAQqG,GAG7B,GAAI8J,GAAanQ,EAAO8C,QAAQ7D,KAAKgR,WAAW5J,GAAO,QAAMzG,MAAM,QACjEwQ,EAAQpQ,EAAOqQ,MAAMpR,KAAKgR,WAAW5J,GACvC,KAAK8J,IAAeA,EAAWjR,SAAWkR,GAAyB,GAAhBA,EAAMlR,OACvD,KAAM,IAAI8Q,OAAM,uBAElB,QAAQG,WAAYA,EAAYC,MAAOA,IAEzC5I,UAAW,SAAUlB,EAAMtG,EAAQP,EAAU4G,GAC3C,GAAIC,YAAgB/H,MAAM,CACxB,GAAI+R,GAAU,GAAI/R,MAAK+H,EAAKyD,UAAuC,IAA3BzD,EAAKS,oBAE7C,OADAuJ,GAAQC,gBAAgB,GACjBD,EAWT,GATI,4BAA4BpC,KAAK5H,KACnCtG,EAASf,KAAKiB,YAAY,aAAcmG,IAEtC,gDAAgD6H,KAAK5H,KACvDtG,EAASf,KAAKiB,YAAY,mBAAoBmG,IAE5C,iEAAiE6H,KAAK5H,KACxEtG,EAASf,KAAKiB,YAAY,sBAAuBmG,IAE/C,wCAAwC6H,KAAK5H,GAAO,CACtD,GAEEkK,GAAMhE,EAFJiE,EAAU,oBACZL,EAAQ9J,EAAK+J,MAAM,qBAErB/J,GAAO,GAAI/H,KACX,KAAK,GAAIQ,GAAI,EAAGA,EAAIqR,EAAMlR,OAAQH,IAGhC,OAFAyR,EAAOC,EAAQC,KAAKN,EAAMrR,IAC1ByN,EAAM5E,SAAS4I,EAAK,IACZA,EAAK,IACX,IAAK,IACHlK,EAAKW,WAAWX,EAAKO,aAAe2F,EACpC,MACF,KAAK,IACHlG,EAAOlH,EAAeR,UAAUgO,UAAU+D,KAAKvR,EAAeR,UAAW0H,EAAMkG,EAC/E,MACF,KAAK,IACHlG,EAAKW,WAAWX,EAAKO,aAAqB,EAAN2F,EACpC,MACF,KAAK,IACHlG,EAAOlH,EAAeR,UAAUiO,SAAS8D,KAAKvR,EAAeR,UAAW0H,EAAMkG,GAIpF,MAAOlO,GAAQgI,EAAK4C,iBAAkB5C,EAAK8C,cAAe9C,EAAKO,aAAcP,EAAKiD,cAAejD,EAAKmD,gBAAiBnD,EAAK8G,gBAAiB,GAE/I,GAsDE7G,GAAKqK,EAAUJ,EAtDbJ,EAAQ9J,GAAQA,EAAKuK,WAAWR,MAAMpR,KAAKiR,oBAC7C5J,EAAO,GAAI/H,MAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAClCuS,KACAC,GAAiB,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,OAAQ,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAC5HC,GACEC,GAAM,SAAUrK,EAAGsK,GACjB,MAAOtK,GAAE6G,YAAYyD,IAEvBC,EAAM,SAAUvK,EAAGsK,GACjB,MAAOtK,GAAE6G,YAAYyD,IAEvBE,GAAM,SAAUxK,EAAGsK,GACjB,MAAOtK,GAAE6G,YAAiB,IAALyD,EAAU,EAAIA,IAErCG,EAAM,SAAUzK,EAAGsK,GACjB,MAAOtK,GAAE6G,YAAiB,IAALyD,EAAU,EAAIA,IAErCI,GAAM,SAAU1K,EAAGsK,GACjB,MAAOtK,GAAE+G,cAAcuD,IAEzBnS,EAAM,SAAU6H,EAAGsK,GACjB,MAAOtK,GAAE+G,cAAcuD,IAEzBK,GAAM,SAAU3K,EAAGsK,GACjB,MAAOtK,GAAE4K,cAAcN,IAEzBO,EAAM,SAAU7K,EAAGsK,GACjB,MAAOtK,GAAE4K,cAAcN,IAEzBQ,KAAM,SAAU9K,EAAGsK,GACjB,MAAOtK,GAAE2G,eAAe2D,IAE1BS,GAAM,SAAU/K,EAAGsK,GACjB,MAAOtK,GAAE2G,eAAe,IAAO2D,IAEjCU,EAAM,SAAUhL,EAAGsK,GAEjB,IADAA,GAAK,EACM,EAAJA,GAAOA,GAAK,EAGnB,KAFAA,GAAK,GACLtK,EAAE0G,YAAY4D,GACPtK,EAAEwC,eAAiB8H,GACxB,CAAA,GAAIW,MAAMjL,EAAEwC,eACV,MAAOxC,EAEPA,GAAEK,WAAWL,EAAEC,aAAe,GAClC,MAAOD,IAETA,EAAM,SAAUA,EAAGsK,GACjB,MAAOtK,GAAEK,WAAWiK,IAEtBY,EAAM,SAAUlL,EAAGsK,GACjB,MAAOtK,GAAE6G,YAAiB,GAALyD,EAAStK,EAAE2C,cAAgB,GAAK3C,EAAE2C,gBAQ7D,IAJAyH,EAAe,EAAIA,EAAgB,GAAIA,EAAgB,GAAIA,EAAe,EAC1EA,EAAgB,GAAIA,EAAe,EACnCA,EAAe,EAAIA,EAAe,EAClC1K,EAAOhI,EAAQgI,EAAKoE,cAAepE,EAAKqE,WAAYrE,EAAKK,UAAWL,EAAKyG,WAAYzG,EAAK0G,aAAc1G,EAAK2G,cACzGmD,EAAMlR,QAAUc,EAAOoQ,MAAMlR,OAAQ,CACvC,IAAK,GAAIH,GAAI,EAAGgT,EAAM/R,EAAOoQ,MAAMlR,OAAY6S,EAAJhT,EAASA,IAAK,CAGvD,GAFAwH,EAAMqB,SAASwI,EAAMrR,GAAI,IACzByR,EAAOxQ,EAAOoQ,MAAMrR,GAChB8S,MAAMtL,GACR,OAAQiK,GACN,IAAK,KACHI,EAAWvS,EAAEsB,EAAMF,GAAUyK,QAAQ6E,OAAO,WAC1C,GAAI6C,GAAI3S,KAAK0M,MAAM,EAAGyE,EAAMrR,GAAGG,QAC7B4S,EAAI1B,EAAMrR,GAAG4M,MAAM,EAAGiG,EAAE1S,OAC1B,OAAO0S,IAAKE,IAEdvL,EAAMlI,EAAEuM,QAAQgG,EAAS,GAAIjR,EAAMF,GAAUyK,QAAU,CACvD,MACF,KAAK,IACH0G,EAAWvS,EAAEsB,EAAMF,GAAUuJ,aAAa+F,OAAO,WAC/C,GAAI6C,GAAI3S,KAAK0M,MAAM,EAAGyE,EAAMrR,GAAGG,QAC7B4S,EAAI1B,EAAMrR,GAAG4M,MAAM,EAAGiG,EAAE1S,OAC1B,OAAO0S,GAAEtF,eAAiBwF,EAAExF,gBAE9B/F,EAAMlI,EAAEuM,QAAQgG,EAAS,GAAIjR,EAAMF,GAAUuJ,aAAe,CAC5D,MACF,KAAK,IACL,IAAK,IACHzC,EAAMlI,EAAEuM,QAAQwF,EAAMrR,GAAGuN,cAAe3M,EAAMF,GAAU0L,UAI9D2F,EAAON,GAAQjK,EAEjB,IAAK,GAAWkL,GAAP1S,EAAI,EAAMA,EAAIgS,EAAc7R,OAAQH,IAC3C0S,EAAIV,EAAchS,GACd0S,IAAKX,KAAWe,MAAMf,EAAOW,KAC/BT,EAAYS,GAAGnL,EAAMwK,EAAOW,IAGlC,MAAOnL,IAETiB,WAAkB,SAAUjB,EAAMtG,EAAQP,EAAU4G,GAClD,GAAY,MAARC,EACF,MAAO,EAET,IAAIC,EACJ,IAAY,YAARF,EACFE,GAEEoL,GAAMrL,EAAK4C,iBAAiB2H,WAAWmB,UAAU,GACjDN,KAAMpL,EAAK4C,iBAEX0I,EAAMtL,EAAK8C,cAAgB,EAC3B6I,EAAMtS,EAAMF,GAAUuJ,YAAY1C,EAAK8C,eACvC8I,GAAMvS,EAAMF,GAAUyK,OAAO5D,EAAK8C,eAElCxC,EAAMN,EAAKO,aACXsL,EAAMxS,EAAMF,GAAUkQ,UAAUrJ,EAAKiE,aACrC6H,GAAMzS,EAAMF,GAAUiQ,KAAKpJ,EAAKiE,aAChCuH,EAA0C,GAAnCnS,EAAMF,GAAU0L,SAASjM,OAAcS,EAAMF,GAAU0L,SAAS7E,EAAKiD,cAAgB,GAAK,EAAI,GAAK,GAE1G4H,EAAM7K,EAAKiD,cAEXxK,EAAMuH,EAAKmD,gBAEXgI,EAAMnL,EAAK8G,iBAG0B,GAAnCzN,EAAMF,GAAU0L,SAASjM,OAC3BqH,EAAI8K,EAAK9K,EAAI4K,EAAI,IAAM,EAAI,GAAK5K,EAAI4K,EAAI,GAGxC5K,EAAI8K,EAAI9K,EAAI4K,EAEd5K,EAAI6K,IAAM7K,EAAI8K,EAAI,GAAK,IAAM,IAAM9K,EAAI8K,EACvC9K,EAAI8L,EAAI9L,EAAIuL,EAAE1G,cACd7E,EAAI0K,IAAM1K,EAAI4K,EAAI,GAAK,IAAM,IAAM5K,EAAI4K,EACvC5K,EAAI+K,IAAM/K,EAAIxH,EAAI,GAAK,IAAM,IAAMwH,EAAIxH,EACvCwH,EAAIgL,IAAMhL,EAAIkL,EAAI,GAAK,IAAM,IAAMlL,EAAIkL,EACvClL,EAAI+L,IAAM/L,EAAIK,EAAI,GAAK,IAAM,IAAML,EAAIK,EACvCL,EAAIgM,IAAMhM,EAAIqL,EAAI,GAAK,IAAM,IAAMrL,EAAIqL,MAClC,CAAA,GAAY,OAARvL,EAmCT,KAAM,IAAI2J,OAAM,uBAjChBzJ,IAEEiM,EAAGlM,EAAK4C,iBAAiB2H,WAAWmB,UAAU,GAC9CS,EAAGnM,EAAK4C,iBAERwJ,EAAG/S,EAAMF,GAAUyK,OAAO5D,EAAK8C,eAC/B6I,EAAGtS,EAAMF,GAAUuJ,YAAY1C,EAAK8C,eACpCjK,EAAGmH,EAAK8C,cAAgB,EACxBuJ,EAAG1S,EAASqK,eAAehE,EAAK4C,iBAAkB5C,EAAK8C,eAEvDwJ,EAAGtM,EAAKO,aACRgM,EAAGlT,EAAMF,GAAUiQ,KAAKpJ,EAAKiE,aAC7B4H,EAAGxS,EAAMF,GAAUkQ,UAAUrJ,EAAKiE,aAClCuI,EAAGxM,EAAKiE,YACRwI,EAAwB,GAApBzM,EAAKiE,YAAmB,EAAIjE,EAAKiE,YACrCyI,EAAI1M,EAAKO,aAAe,IAAMlH,EAAMF,GAAUmQ,OAAO1Q,OAASS,EAAMF,GAAUmQ,OAAOtJ,EAAKO,aAAe,GAAK,GAAK,GAEnHoM,EAAuC,GAAnCtT,EAAMF,GAAU0L,SAASjM,OAAcS,EAAMF,GAAU0L,SAAS7E,EAAKiD,cAAgB,GAAK,EAAI,GAAK,GACvG2J,EAAI5M,EAAKiD,cAAgB,IAAM,EAAI,GAAKjD,EAAKiD,cAAgB;AAC7D4J,EAAG7M,EAAKiD,cAERxK,EAAGuH,EAAKmD,gBAERgI,EAAGnL,EAAK8G,iBAEV7G,EAAIqL,GAAKrL,EAAIpH,EAAI,GAAK,IAAM,IAAMoH,EAAIpH,EACtCoH,EAAIK,GAAKL,EAAIqM,EAAI,GAAK,IAAM,IAAMrM,EAAIqM,EACtCrM,EAAI6M,EAAI7M,EAAI0M,EAAEpC,WAAWzF,cACzB7E,EAAI4K,GAAK5K,EAAI2M,EAAI,GAAK,IAAM,IAAM3M,EAAI2M,EACtC3M,EAAI8K,GAAK9K,EAAI4M,EAAI,GAAK,IAAM,IAAM5M,EAAI4M,EACtC5M,EAAIxH,GAAKwH,EAAIxH,EAAI,GAAK,IAAM,IAAMwH,EAAIxH,EACtCwH,EAAIkL,GAAKlL,EAAIkL,EAAI,GAAK,IAAM,IAAMlL,EAAIkL,EAMxC,IAAK,GAFDnL,MACF+M,EAAOhV,EAAEiR,UAAWtP,EAAOmQ,YACpBpR,EAAI,EAAGgT,EAAM/R,EAAOoQ,MAAMlR,OAAY6S,EAAJhT,EAASA,IAC9CsU,EAAKnU,QACPoH,EAAKb,KAAK4N,EAAKlE,SAEjB7I,EAAKb,KAAKc,EAAIvG,EAAOoQ,MAAMrR,IAK7B,OAHIsU,GAAKnU,QACPoH,EAAKb,KAAK4N,EAAKlE,SAEV7I,EAAKwE,KAAK,KAEnB7I,gBAAkB,SAAUQ,GAC1B,OAAQA,GACN,IAAK,GACL,IAAK,SACHA,EAAW,CACX,MACF,KAAK,GACL,IAAK,OACHA,EAAW,CACX,MACF,KAAK,GACL,IAAK,QACHA,EAAW,CACX,MACF,KAAK,GACL,IAAK,MACHA,EAAW,CACX,MACF,KAAK,GACL,IAAK,OACHA,EAAW,EAIf,MAAOA,IAET6Q,aAAc,kLAOdC,eAAgB,sMAOhBC,aAAc,gDACdC,aAAc,8DAEhBxT,GAAS2C,SAAW,mGAGlB3C,EAASqT,aACTrT,EAASuT,aACTvT,EAASwT,aACT,mFAIAxT,EAASqT,aACTrT,EAASuT,aACTvT,EAASwT,aACT,kFAIAxT,EAASqT,aACT,kBACArT,EAASwT,aACT,mFAIAxT,EAASqT,aACTrT,EAASuT,aACTvT,EAASwT,aACT,kFAIAxT,EAASqT,aACTrT,EAASuT,aACTvT,EAASwT,aACT,uBAGFxT,EAAS4C,WAAa,mGAGpB5C,EAASsT,eACTtT,EAASuT,aACTvT,EAASwT,aACT,mFAIAxT,EAASsT,eACTtT,EAASuT,aACTvT,EAASwT,aACT,kFAIAxT,EAASsT,eACT,kBACAtT,EAASwT,aACT,mFAIAxT,EAASsT,eACTtT,EAASuT,aACTvT,EAASwT,aACT,kFAIAxT,EAASsT,eACTtT,EAASuT,aACTvT,EAASwT,aACT,uBAGFpV,EAAEgF,GAAGqD,eAAezG,SAAWA,EAK/B5B,EAAEgF,GAAGqD,eAAegN,WAAa,WAE/B,MADArV,GAAEgF,GAAGqD,eAAiBsI,EACf/P,MAMTZ,EAAEuF,UAAUX,GACV,8DACA,kCACA,SAAUtB,GACR,GAAI0N,GAAQhR,EAAEY,KACVoQ,GAAM3P,KAAK,oBACfiC,EAAEwE,iBAEFkJ,EAAM3I,eAAe,WAGzBrI,EAAE,WACAA,EAAE,0CAA0CqI,oBAG9CT,OAAO0N,QAOP,SAAStV,GACPA,EAAEgF,GAAGqD,eAAe/G,MAAM,UAClB+P,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OACxDC,WAAY,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACtD7G,SAAW,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC9CoB,QAAS,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAC3ElB,aAAc,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAChFgB,MAAO,KACP4F,UACAzE,UAAW,KAAM,QAE3BwI,QAQF,SAAUtV,GAETA,EAAEgF,GAAGuQ,SAAW,SAAStU,GACxB,GAAe,WAAXA,EAEH,WADAjB,GAAEY,KAAKyE,UAAU0C,QAAQ,kBAI1B,IAAIyN,GAAOxV,EAAEiR,UAAWjR,EAAEgF,GAAGuQ,SAASrE,SAAUjQ,GAC5CwU,KACAC,EAAO,KAAMC,EAAU,IAmW3B,OAjWA/U,MAAK6I,KAAK,SAAS/I,EAAGkV,GAGjB5V,EAAE4V,GAAM1T,GAAG,UAAyC,GAA7BlC,EAAE4V,GAAMC,WAAWC,QAAe9V,EAAE4V,GAAMC,WAAW3T,GAAG,WAClF0T,EAAO5V,EAAE4V,GAAMC,WAAWE,IAAI,GAE/B,IAAIC,IACHC,YAAa,KACbC,gBAAiB,KACjBC,IAAK,KACLvM,OAAQ,KACRwM,YAAa,KACbC,OAAQ,KACRlV,UAAWyU,EAEXU,KAAM,WAELd,EAAKe,QAAiD,GAAvCvW,EAAEY,KAAKO,WAAW0U,WAAWC,OAAc,KAAO9V,EAAEY,KAAKO,WAAW0U,WAAWE,IAAI,GAAGQ,QAAQtI,cACpF,IAArBuH,EAAKgB,eACRhB,EAAKgB,aAAehB,EAAKe,SACD,IAArBf,EAAKiB,eACRjB,EAAKiB,aAAejB,EAAKe,SACM,IAA5Bf,EAAKkB,sBACRlB,EAAKkB,oBAAsB,IAAMlB,EAAKe,QAAU,YAAcf,EAAKe,QAAU,KAG9EvW,EAAEY,KAAKO,WAAWwV,KAAK,eAAgBjW,GAAGqE,UAAUnE,KAAKgW,UAAUC,KAAK,kBAAmBjW,KAAKkW,QAChGlW,KAAKmW,mBAAkB,IAGxBD,OAAQ,WACP,GAAIpB,GAAOD,EAAMzV,EAAEY,MAAM+V,KAAK,gBAC9B3W,GAAE0V,EAAKvU,WAAW6V,OAAO,YAAatB,EAAKkB,UAAUI,OAAO,mBAC5DtB,EAAKqB,mBAAkB,IAGxBE,SAAU,WACT,MAAOjX,GAAEY,KAAKO,WAAW0U,SAASL,EAAKgB,eAGxCO,kBAAmB,SAASG,GAC3BtW,KAAKqW,WAAW3N,IAAI,WAAa,MAAOtJ,GAAEY,MAAMsB,GAAGsT,EAAKiB,cAAgB7V,KAAOZ,EAAEY,MAAMH,KAAK+U,EAAKiB,cAAcV,QAAUpM,IAAI,SAAUuN,EAAS,UAAY,KAG7JN,SAAU,SAAStT,GAClB,GAAIoS,GAAOD,EAAMzV,EAAEY,MAAM+V,KAAK,iBAC1BQ,EAAOnX,EAAEsD,EAAEC,QAAQC,QAAQ,oBAAsBgS,EAAKe,SAASR,IAAI,GACnEqB,EAAqB1B,EAAKuB,WAAWvG,OAAO,WAAa,MAAO9P,OAAQuW,IAASrB,OAAS,CAG9F,MAAe,GAAXxS,EAAEkM,OAAcxP,EAAEsD,EAAEC,QAAQrB,GAAGsT,EAAK6B,sBAAwBrX,EAAEsD,EAAEC,QAAQC,QAAQgS,EAAK6B,qBAAqBvB,OAAS,IAAMsB,EAA7H,CAKA9T,EAAEwE,gBAIF,KADA,GAAIwP,GAAahU,EAAEC,QACXvD,EAAEsX,GAAYpV,GAAGsT,EAAKiB,eAAe,CAC5C,GAAIa,GAAc1W,KAAM,MACxB0W,GAAaA,EAAWC,WAEzBvX,EAAEsX,GAAYX,KAAK,cAAe3W,EAAEsX,GAAY3N,IAAI,WACpD3J,EAAEsX,GAAY3N,IAAI,SAAU,OAG5B,IAAI6N,GAAW5W,KACXmH,EAAU,WACb2N,EAAK+B,UAAUnF,KAAKkF,EAAUlU,GAC9BtD,EAAE0V,EAAKvU,WAAW6V,OAAO,YAAajP,GAEvC/H,GAAE0V,EAAKvU,WAAWuW,UAAU3P,GAAS4P,QAAQ,WAAa3X,EAAE0V,EAAKvU,WAAW6V,OAAO,YAAajP,GAAU/H,EAAEsX,GAAY3N,IAAI,SAAU3J,EAAEsX,GAAYX,KAAK,oBAG1Jc,UAAW,SAASnU,GAQnB,GAPY,MAARoS,GAAoC,MAApBA,EAAKO,aACxBP,EAAKkC,WAENlC,EAAOD,EAAMzV,EAAEY,MAAM+V,KAAK,iBAC1BjB,EAAKO,YAAcjW,EAAEsD,EAAEC,QAAQC,QAAQ,oBAAsBgS,EAAKe,SAG9Df,EAAKiC,UAAUrX,MAAMsV,EAAKO,gBAAiB,EAE3C,YADAP,EAAKO,YAAc,KAKvBP,GAAKO,YAAYU,KAAK,eAAgB3W,EAAEY,MAAM+V,KAAK,gBAAkB,IAAM3W,EAAE0V,EAAKvU,WAAW0U,WAAW7G,MAAM0G,EAAKO,aAGnH,IAAI4B,GAAKtO,SAASmM,EAAKO,YAAYtM,IAAI,cACnCmO,EAAKvO,SAASmM,EAAKO,YAAYtM,IAAI,cAMvC,IALA+L,EAAK9L,OAAS8L,EAAKO,YAAYrM,SAC/B8L,EAAK9L,OAAOC,IAAMvG,EAAEyU,MAAQrC,EAAK9L,OAAOC,KAAO2J,MAAMqE,GAAM,EAAIA,GAAM,EACrEnC,EAAK9L,OAAOE,KAAOxG,EAAE0U,MAAQtC,EAAK9L,OAAOE,MAAQ0J,MAAMsE,GAAM,EAAIA,GAAM,GAGlEtC,EAAKyC,YAAa,CACtB,GAAIC,GAAqD,GAAnClY,EAAE0V,EAAKvU,WAAWuG,cAAqBsF,KAAKwD,IAAI,EAAGxD,KAAKmL,MAAM,GAAMzC,EAAKuB,WAAWnB,OAASJ,EAAKO,YAAYjM,aAAehK,EAAE0V,EAAKvU,WAAW6I,eAAiB0L,EAAKO,YAAYvO,cAAgB1H,EAAE0V,EAAKvU,WAAWuG,aACzOgO,GAAKU,YAAcpW,EAAE0V,EAAKvU,WAAWyI,SACrC8L,EAAKU,YAAYgC,MAAQ1C,EAAKU,YAAYtM,KAAO9J,EAAE0V,EAAKvU,WAAW6I,aAAe0L,EAAKO,YAAYjM,aACnG0L,EAAKU,YAAYiC,OAAS3C,EAAKU,YAAYvM,IAAMqO,EAAkBxC,EAAKO,YAAYvO,cAIrF,GAAIoL,GAAI4C,EAAKO,YAAYxO,SACrBgN,EAAIiB,EAAKO,YAAYqC,OAWzB,IAVoB,MAAhB9C,EAAKe,SACRb,EAAKO,YAAYJ,WAAWpM,KAAK,WAAazJ,EAAEY,MAAM0X,MAAMtY,EAAEY,MAAM0X,WACpE5C,EAAKQ,gBAAkBR,EAAKO,YAAYsC,QAAQ5B,KAAK,oBAAoB,GACzEjB,EAAKO,YAAYuC,MAAM9C,EAAKQ,iBAC5BR,EAAKQ,gBAAgBL,WAAWpM,KAAK,WAAazJ,EAAEY,MAAM+I,KAAM8O,YAAY,EAAGH,MAAOtY,EAAEY,MAAM0X,QAAU,EAAG7Q,OAAQzH,EAAEY,MAAM6G,SAAW,IAAK+C,KAAK,cAEhJkL,EAAKO,YAAYuC,MAAMhD,EAAKkB,qBAC5BhB,EAAKQ,gBAAkBR,EAAKO,YAAYyC,OAAO/O,KAAMlC,OAAQqL,EAAGwF,MAAO7D,IAAKkC,KAAK,oBAAoB,IAGlF,MAAhBnB,EAAKe,QAAiB,CACzB,GAAIoC,GAAYjD,EAAKO,YAAYzS,QAAQ,SAASuS,IAAI,EACtD/V,GAAE,cAAgB2Y,EAAUC,GAAK,oDAAsDD,EAAUzK,UAAY,uBAAuBvJ,SAAS,QAAQkR,WAAWnL,OAAOgL,EAAKO,aAI7K,GAAI4C,GAAOnD,EAAKO,YAAYU,KAAK,QACjCjB,GAAKO,YAAYU,KAAK,iBAAkBkC,EAAOA,EAAO,IACtDnD,EAAKO,YAAYtM,KAAMmP,SAAU,WAAYC,QAAS,GAAKC,UAAW,IAAKvR,OAAQqL,EAAGwF,MAAO7D,IAG7FiB,EAAKW,QAAW4C,MAAO,EAAGC,MAAO,EAAGC,KAAMnZ,EAAEuF,UAAU+S,QAAUtY,EAAE4H,QAAQ0Q,QAASc,KAAMpZ,EAAEuF,UAAUkC,SAAWzH,EAAE4H,QAAQH,UAC1HiO,EAAKW,OAAOgD,QAAUzR,OAAO0R,YAAY,WACxC,GAAI9D,EAAK+D,iBAAmB3R,OAE3B,WADA5H,GAAEwV,EAAK+D,iBAAiBC,UAAUxZ,EAAEwV,EAAK+D,iBAAiBC,YAAc9D,EAAKW,OAAO6C,MAGrF,IAAI5E,GAAItU,EAAEwV,EAAK+D,iBAAiBC,aAC5B9D,EAAKW,OAAO6C,MAAQ,GAAK5E,EAAIoB,EAAKW,OAAO+C,MAAQ1D,EAAKW,OAAO6C,MAAQ,GAAK5E,EAAI,KACjFtU,EAAEwV,EAAK+D,iBAAiBC,UAAUlF,EAAIoB,EAAKW,OAAO6C,OAClDxD,EAAKO,YAAYtM,IAAI,MAAO+L,EAAKO,YAAYrM,SAASC,IAAM6L,EAAKW,OAAO6C,MAAQ,KAE/E,IACHxD,EAAKW,OAAOoD,QAAU7R,OAAO0R,YAAY,WACxC,GAAI9D,EAAK+D,iBAAmB3R,OAE3B,WADA5H,GAAEwV,EAAK+D,iBAAiBG,WAAW1Z,EAAEwV,EAAK+D,iBAAiBG,aAAehE,EAAKW,OAAO4C,MAGvF,IAAIzE,GAAIxU,EAAEwV,EAAK+D,iBAAiBG,cAC5BhE,EAAKW,OAAO4C,MAAQ,GAAKzE,EAAIkB,EAAKW,OAAO8C,MAAQzD,EAAKW,OAAO4C,MAAQ,GAAKzE,EAAI,KACjFxU,EAAEwV,EAAK+D,iBAAiBG,WAAWlF,EAAIkB,EAAKW,OAAO4C,OACnDvD,EAAKO,YAAYtM,IAAI,OAAQ+L,EAAKO,YAAYrM,SAASE,KAAO4L,EAAKW,OAAO4C,MAAQ,KAEjF,IAGHjZ,EAAEyV,GAAOhM,KAAK,SAAS/I,EAAG8T,GAAKA,EAAEmF,oBAAqBnF,EAAEoF,uBACxDlE,EAAKmE,OAAOvW,EAAE0U,MAAO1U,EAAEyU,OACvB/X,EAAEuF,UAAUsR,KAAK,YAAanB,EAAKoE,WACnC9Z,EAAEuF,UAAUsR,KAAK,UAAWnB,EAAKkC,UAC7BpC,EAAK+D,iBAAmB3R,QAC3B5H,EAAE4H,QAAQiP,KAAK,4BAA6BnB,EAAKqE,QAInDF,OAAQ,SAASG,EAAG7F,GAEnB,GAAItK,GAAMsK,EAAIvT,KAAKgJ,OAAOC,IACtBC,EAAOkQ,EAAIpZ,KAAKgJ,OAAOE,IAGtB0L,GAAKyC,cACTpO,EAAMmD,KAAKyD,IAAI7P,KAAKwV,YAAYiC,OAAQrL,KAAKwD,IAAI3G,EAAKjJ,KAAKwV,YAAYvM,MACvEC,EAAOkD,KAAKyD,IAAI7P,KAAKwV,YAAYgC,MAAOpL,KAAKwD,IAAI1G,EAAMlJ,KAAKwV,YAAYtM,OAIzE,IAAIxH,GAAS1B,KAAKqV,YAAYgE,eAAeC,IAAI,QAAQtQ,QAOzD,IANc,MAAVtH,IACHuH,GAAOvH,EAAOuH,IACdC,GAAQxH,EAAOwH,MAIZ0L,EAAK+D,iBAAmB3R,OAC3BuM,GAAKnU,EAAE4H,QAAQ4R,YACfQ,GAAKha,EAAE4H,QAAQ8R,aACfvF,EAAInH,KAAKwD,IAAI,EAAG2D,EAAInU,EAAE4H,QAAQH,SAAW,GAAKuF,KAAKyD,IAAI,EAAG0D,EAAI,GAC9D6F,EAAIhN,KAAKwD,IAAI,EAAGwJ,EAAIha,EAAE4H,QAAQ0Q,QAAU,GAAKtL,KAAKyD,IAAI,EAAGuJ,EAAI,OACvD,CACN,GAAIpE,GAAO5V,EAAEwV,EAAK+D,iBACd3P,EAASgM,EAAKhM,QAClBuK,GAAInH,KAAKwD,IAAI,EAAG2D,EAAIyB,EAAKnO,SAAWmC,EAAOC,KAAOmD,KAAKyD,IAAI,EAAG0D,EAAIvK,EAAOC,KACzEmQ,EAAIhN,KAAKwD,IAAI,EAAGwJ,EAAIpE,EAAK0C,QAAU1O,EAAOE,MAAQkD,KAAKyD,IAAI,EAAGuJ,EAAIpQ,EAAOE,MAG1E4L,EAAKW,OAAO4C,MAAa,GAALe,EAAS,EAAIA,EAAIxE,EAAK2E,YAAcnN,KAAK+C,IAAIiK,GACjEtE,EAAKW,OAAO6C,MAAa,GAAL/E,EAAS,EAAIA,EAAIqB,EAAK2E,YAAcnN,KAAK+C,IAAIoE,GAGjEvT,KAAKqV,YAAYtM,KAAME,IAAKA,EAAKC,KAAMA,KAIxCiQ,MAAO,SAASzW,GACf,IAAKtD,EAAEoa,QAAQC,QAAUra,EAAEoa,QAAQE,UAAY5E,GAAQF,EAAK+D,iBAAmB3R,OAAQ,CACtF,GAAIgO,GAAO5V,EAAEwV,EAAK+D,iBACd3P,EAASgM,EAAKhM,QAClB,IAAItG,EAAE0U,MAAQpO,EAAOE,MAAQxG,EAAE0U,MAAQpO,EAAOE,KAAO8L,EAAK0C,SAAWhV,EAAEyU,MAAQnO,EAAOC,KAAOvG,EAAEyU,MAAQnO,EAAOC,IAAM+L,EAAKnO,SAAU,CAClI,GAAImG,GAAQtK,EAAEiX,OAAoB,EAAXjX,EAAEiX,OAAajX,EAAEuK,WAAa,EACrD+H,GAAK4D,UAAU5D,EAAK4D,YAAc5L,GAClCtK,EAAEwE,oBAML8R,mBAAoB,WACnB,GAAIzD,KACJvV,MAAKqW,WAAWiD,KAAKxE,EAAKO,YAAY,GAAIP,EAAKQ,gBAAgB,KAAKzM,KAAK,SAAS/I,GACjF,GAAI8Z,GAAMxa,EAAEY,MAAMgJ,QAClB4Q,GAAIpC,MAAQoC,EAAI1Q,KAAO9J,EAAEY,MAAMoJ,aAC/BwQ,EAAInC,OAASmC,EAAI3Q,IAAM7J,EAAEY,MAAM8G,cAC/B8S,EAAIC,IAAM7Z,KACVuV,EAAIzV,GAAK8Z,IAEV5Z,KAAKuV,IAAMA,GAGZyB,SAAU,WACT,GAAwB,MAApBlC,EAAKO,YAAT,CAKA,GAAI4C,GAAOnD,EAAKO,YAAYU,KAAK,iBAiBjC,IAhBAjB,EAAKO,YAAYU,KAAK,QAASkC,GACnB,IAARA,GACHnD,EAAKO,YAAYyE,WAAW,SAC7BhF,EAAKO,YAAYyE,WAAW,kBAE5BhF,EAAKqB,mBAAkB,GAEvBrB,EAAKQ,gBAAgByE,OAAOjF,EAAKO,aACjCP,EAAKQ,gBAAgB9N,SAErBpI,EAAE,oCAAoCoI,SAEtCR,OAAOgT,cAAclF,EAAKW,OAAOgD,SACjCzR,OAAOgT,cAAclF,EAAKW,OAAOoD,SAG7B/D,EAAKO,YAAYU,KAAK,iBAAmB3W,EAAEyV,GAAOzG,MAAM0G,GAAQ,IAAM1V,EAAE0V,EAAKvU,WAAW0U,WAAW7G,MAAM0G,EAAKO,cACrE,GAAxCT,EAAKqF,QAAQza,MAAMsV,EAAKO,aAAuB,CAClD,GAAIE,GAAMT,EAAKO,YAAYU,KAAK,gBAAgBpV,MAAM,KAClDuZ,EAAW9a,EAAEyV,EAAMU,EAAI,IAAIhV,WAAW0U,WAAWqE,IAAIxE,EAAKO,aAAa5I,GAAG8I,EAAI,GAC9E2E,GAAShF,OAAS,EACrBgF,EAASH,OAAOjF,EAAKO,aACH,GAAVE,EAAI,GACZnW,EAAEyV,EAAMU,EAAI,IAAIhV,WAAW4Z,QAAQrF,EAAKO,aAExCjW,EAAEyV,EAAMU,EAAI,IAAIhV,WAAWuJ,OAAOgL,EAAKO,aAS1C,MAPAP,GAAKO,YAAYyE,WAAW,gBAE5BhF,EAAKO,YAAc,KACnBjW,EAAEuF,UAAUyR,OAAO,YAAatB,EAAKoE,WACrC9Z,EAAEuF,UAAUyR,OAAO,UAAWtB,EAAKkC,UAC/BpC,EAAK+D,iBAAmB3R,QAC3B5H,EAAE4H,QAAQoP,OAAO,4BAA6BtB,EAAKqE,QAC7C,IAIRD,UAAW,SAASxW,GACnB,GAAwB,MAApBoS,EAAKO,YACR,OAAO,CAGRP,GAAKmE,OAAOvW,EAAE0U,MAAO1U,EAAEyU,MAKvB,KAAK,GAFDiD,GAAKtF,EAAKuF,QAAQ3X,EAAE0U,MAAO1U,EAAEyU,OAC7BmD,EAAQxF,EACHhV,EAAI,EAAS,IAANsa,GAAYxF,EAAKyC,aAAevX,EAAI+U,EAAM5U,OAAQH,IACjEsa,EAAKvF,EAAM/U,GAAGua,QAAQ3X,EAAE0U,MAAO1U,EAAEyU,OACjCmD,EAAQzF,EAAM/U,EAIf,IAAU,IAANsa,EACH,OAAO,CAGR,IAAInF,GAAW,WAAa,MAAO7V,GAAEkb,EAAM/Z,WAAW0U,WAAWqE,IAAIgB,EAAMjF,cACvEkF,EAAQtF,IAAWqE,IAAI1E,EAAKgB,cAAc/M,KAAK,SAAS/I,GAAKE,KAAKwa,IAAMvF,IAAW7G,MAAMpO,OAoB7F,OAjBe,OAAX+U,GAAmBA,EAAQ9L,IAAM6L,EAAKO,YAAYrM,SAASC,KAAO8L,EAAQ7L,KAAO4L,EAAKO,YAAYrM,SAASE,KAC9G9J,EAAEkb,EAAM/E,IAAI6E,GAAIP,KAAKE,OAAOjF,EAAKQ,iBAEjClW,EAAEkb,EAAM/E,IAAI6E,GAAIP,KAAKjC,MAAM9C,EAAKQ,iBAGjCiF,EAAM1R,KAAK,WACV,GAAIgR,GAAM5E,IAAWxI,GAAGzM,KAAKwa,KAAKrF,IAAI,EAClCnV,OAAQ6Z,GAAO5E,IAAW7G,MAAMpO,MAAQA,KAAKwa,IAChDpb,EAAEY,MAAMya,YAAYZ,GACZ7Z,MAAQ6Z,GAChBza,EAAEY,MAAM0a,aAAab,KAIvBza,EAAEyV,GAAOhM,KAAK,SAAS/I,EAAG8T,GAAKA,EAAEmF,oBAAqBnF,EAAEoF,uBACxDjE,EAAUD,EAAKO,YAAYrM,UACpB,GAIRqR,QAAS,SAASjB,EAAG7F,GACpB,IAAK,GAAIzT,GAAI,EAAGA,EAAIE,KAAKuV,IAAItV,OAAQH,IACpC,GAAIE,KAAKuV,IAAIzV,GAAGoJ,KAAOkQ,GAAKpZ,KAAKuV,IAAIzV,GAAG0X,MAAQ4B,GAAKpZ,KAAKuV,IAAIzV,GAAGmJ,IAAMsK,GAAKvT,KAAKuV,IAAIzV,GAAG2X,OAASlE,EAChG,MAAOzT,EAET,OAAO,IAIRiZ,kBAAmB,WACbnE,EAAKyC,aAGVjY,EAAEyV,GAAOhM,KAAK,WACb,GAAI8R,GAAKvb,EAAEY,KAAKO,WAAWV,KAAK,sBAC5B+a,EAAKxb,EAAEY,KAAKO,WAAWV,KAAK,oBAC5B8a,GAAGzF,OAAS,GAAK0F,EAAG1F,OAAS,EAChC0F,EAAGpT,SACkB,GAAbmT,EAAGzF,QAA4B,GAAb0F,EAAG1F,SACT,MAAhBN,EAAKe,QACRvW,EAAEwV,EAAKkB,qBAAqBC,KAAK,mBAAmB,GAAMhS,SAAS/D,KAAKO,WAGxEnB,EAAEY,KAAKO,WAAWuJ,OAAOgL,EAAKQ,gBAAgBwE,WAAW,oBAAoBnC,QAAQ5B,KAAK,mBAAmB,IAE9GjB,EAAKQ,gBAAgBS,KAAK,oBAAoB,OAMlDX,GAAQM,OACRb,EAAMrO,KAAK4O,KAGLpV,MAGRZ,EAAEgF,GAAGuQ,SAASrE,UACbsF,aAAc,GACdC,aAAc,GACdY,oBAAqB,kBACrBI,UAAW,aACXoD,QAAS,aACT5C,aAAa,EACbvB,oBAAqB,GACrB6C,gBAAiB3R,OACjBuS,YAAa,IAGZ7E,QACF,SAAStV,GACNA,EAAEgF,GAAGyW,WAAa,SAASxa,SAEvB,GAAIya,MAAO9a,IAiKX,OAhKAA,MAAK+a,WAAa,KAClB/a,KAAKgb,QAAU,GACfhb,KAAK6G,OAAS,IACd7G,KAAKqQ,OAAOhQ,SACZL,KAAKib,MAAO,EACZjb,KAAKkb,cAAgB,KAAM,KAAM,KAAM,KAAM,KAAM,MAGnDlb,KAAKmb,WACDrL,OAAQ,oNACRsL,MAAO,wZAIXpb,KAAKoC,MAAQ/B,QAAQ+B,MAGrBhD,EAAEY,MAAMgE,GAAG,QAAS,SAAStB,GACzBoY,KAAKO,IAAMjc,EAAEsD,EAAE4Y,eACXlc,EAAEsD,EAAE4Y,eAAezb,KAAK,cAAcI,OACtC6a,KAAKS,YAELT,KAAKU,aAKbpc,EAAEY,MAAMgE,GAAG,QAAS,QAAS,SAAStB,GAClCA,EAAEuE,iBACF,IAAIwU,GAAOrc,EAAEsD,EAAE4Y,eAAe7a,KAAK,OACRV,UAAvB+a,KAAKY,cACLZ,KAAKY,cAAcD,GAEnBX,KAAKO,IAAIxb,KAAK,mBAAmByH,IAAImU,GAAMpV,QAAQsV,SAEvDb,KAAKS,cAITnc,EAAEY,MAAMgE,GAAG,QAAS,aAAc,SAAStB,GACvCA,EAAEuE,oBAIN7H,EAAEY,MAAMgE,GAAG,QAAS,eAAgB,SAAStB,GACzC,GAAIkZ,GAAMxc,EAAEsD,EAAEC,QAAQ2E,KACtBwT,MAAKe,SAASD,KAIlBxc,EAAEY,MAAMgE,GAAG,QAAS,kBAAmB,SAAStB,GAC5C,GAAIwS,GAA2C,MAAnC9V,EAAEsD,EAAE4Y,eAAe7a,KAAK,QAAmB,GAAK,MAAQrB,EAAEsD,EAAE4Y,eAAe7a,KAAK,OAC5Fqa,MAAKgB,cAAcjc,KAAK,QAAQ2M,YAAY,UAC5CpN,EAAEsD,EAAE4Y,eAAe9W,SAAS,UAC5BsW,KAAKiB,WAAWlc,KAAK,KAAK2M,YAAY,iCAAiChI,SAAS0Q,GAChF4F,KAAKkB,WAIThc,KAAKic,WAAa,WACdjc,KAAKoC,MAAQ8Z,KAAKlc,KAAKoC,OACvBpC,KAAKmc,MAAQ/c,EAAE,SAAUgd,QAAO,YAAaC,MAAO,UAAYrc,KAAK6G,OAAS,OAC1E7G,KAAK8P,UAAW,IAChB9P,KAAKsc,QAAUld,EAAEY,KAAKmb,UAAUrL,QAChC9P,KAAKmc,MAAMrS,OAAO9J,KAAKsc,UAEvBtc,KAAKuc,gBAAiB,IACtBvc,KAAK8b,cAAgB1c,EAAEY,KAAKmb,UAAUC,OACtCpb,KAAK8b,cAAcjc,KAAK,eAAiBG,KAAK+a,WAAa,KAAKvW,SAAS,UACzExE,KAAKmc,MAAMrS,OAAO9J,KAAK8b,gBAE3B9b,KAAK+b,WAAa3c,EAAE,SAAUgd,QAAO,iBAAkBC,MAAO,UAAYrc,KAAKwc,YAAc,MAC7F,KAAK,GAAI1c,KAAKE,MAAKoC,MAAO,CACtB,GAAI8S,MAAQ9V,EAAEuM,QAAQ3L,KAAK+a,WAAY/a,KAAKkb,cAAgB,GAAM,OAASlb,KAAK+a,WAAa,GACzF0B,OAASrd,EAAE,OAAQgd,QAAO,OAAQM,MAAO1c,KAAKoC,MAAMtC,GAAG6c,KAAMC,YAAa5c,KAAKoC,MAAMtC,GAAG2E,SAAUoY,cAAe7c,KAAKoC,MAAMtC,GAAGgQ,QACnI2M,QAAO7S,KAAK,sBAAwB5J,KAAKoC,MAAMtC,GAAG2E,SAAWyQ,KAAO,UACpElV,KAAK+b,WAAWjS,OAAO2S,QAE3Bzc,KAAKmc,MAAMrS,OAAO9J,KAAK+b,aAI3B/b,KAAKwb,SAAW,SAAS9Y,GACrB1C,KAAKib,MAAO,EACZ7b,EAAEY,KAAKqb,KAAKvR,OAAO9J,KAAKmc,OACxBnc,KAAKgc,SACLhc,KAAKmc,MAAMtc,KAAK,gBAAgBwG,SAIpCrG,KAAKub,UAAY,WACbvb,KAAKib,MAAO,EACZjb,KAAKmc,MAAMW,UAIf9c,KAAKgc,OAAS,SAAShB,GACnBhb,KAAK+c,eAAiB/c,KAAK+c,gBAAkB/c,KAAKgd,mBAClD,IAAItF,GAAQtL,KAAK6Q,KAAK7d,EAAE,SAASgK,YAAW,GAAQpJ,KAAKgb,QAAUhb,KAAK+c,gBAAkB,KACtFlW,EAAS7G,KAAK6G,OAAoD,EAA1C8B,SAAS3I,KAAKmc,MAAMpT,IAAI,eAChDlC,IAAW7G,KAAK8P,UAAW,EAAS9P,KAAKsc,QAAQxV,aAAY,GAAQ,EACrED,GAAW7G,KAAKuc,gBAAiB,EAASvc,KAAK8b,cAAchV,aAAY,GAAQ,EACrF9G,KAAK+b,WAAWhT,KAAK2O,MAAOA,EAAO7Q,OAAQA,KAK/C7G,KAAK6b,SAAW,SAASD,GACT,KAARA,GACAxc,EAAEY,MAAMH,KAAK,wBAA0B+b,EAAM,MAAM3V,OACnD7G,EAAEY,MAAMH,KAAK,6BAA+B+b,EAAM,OAAO/Y,QAEzDzD,EAAEY,MAAMH,KAAK,UAAUoG,QAK/BjG,KAAKkd,QAAU,SAAStB,GACpB,OAAQA,EAAI/X,QAAQ,KAAM,KAAO,IAC5BA,QAAQ,iDAAkD,SAASsZ,GAChE,MAAOA,GAAGhR,iBAKtBnM,KAAKod,QAAU,SAASC,GACpB,GAAIC,GAEAxd,EADAyd,KAEAC,IACJ,KAAMF,IAAOD,GACTE,EAAS/W,KAAK8W,EAOlB,KALAC,EAASE,KACL,SAASzJ,EAAG0J,GACR,MAAO1J,GAAE3G,cAAcsQ,cAAeD,EAAErQ,iBAG1CvN,EAAI,EAAGA,EAAIyd,EAAStd,OAAQH,IAC9B0d,EAASD,EAASzd,IAAOud,EAAKE,EAASzd,GAE3C,OAAO0d,IAIXxd,KAAKgd,kBAAoB,WACrB,GAAIY,GAASxe,EAAE,sDACXye,EAASze,EAAE,2HAA2H0K,OAAO8T,GAC7IE,EAAQF,EAAO,GACfG,EAAQF,EAAO,EACnBze,GAAE,QAAQ0K,OAAOiU,EACjB,IAAIC,GAASF,EAAMG,WACnBJ,GAAO9U,IAAI,WAAY,SACvB,IAAImV,GAASH,EAAMxU,WAEnB,OADAsU,GAAOrW,SACCwW,EAASE,GAGrBpD,KAAKmB,aAEEjc,OAEZ0U,QASH,SAAWyJ,EAAMC,GACb,GAgGIC,GAhGAC,KAIAC,EAAW,SAAUC,EAAMC,GACvB,GAAIxO,GAAMyO,EAAK5e,CAGf,IAAqB,gBAAT0e,GACR,MAAOG,GAAWH,EAGlB,KADAvO,KACKyO,EAAMF,EAAKve,OAAQH,EAAI,EAAO4e,EAAJ5e,EAASA,IACpCmQ,EAAKzJ,KAAMmY,EAAWH,EAAM1e,IAGhC,OAAO2e,GAASjf,MAAO,KAAMyQ,IAKrC2O,EAAU,SAAU5G,EAAIwG,EAAMJ,GACA,IAArB3e,UAAUQ,SACXme,EAAUI,EACVA,EAAO,MAGXD,EAAUC,MAAY,WAClBK,EAAW7G,EAAIoG,EAAS3e,cAKhCof,EAAY,SAAU7G,EAAIoG,EAASnO,GAC/B,GAGI6O,GAHAC,GACIC,QAASZ,EAIO,mBAAZA,KACRnO,EAAKhQ,SAAWgQ,GAASsO,EAAUQ,EAAOC,QAASD,IACnDD,EAAWV,EAAQ5e,MAAO,KAAMyQ,GACnBlQ,SAAb+e,IAA2BC,EAAOC,QAAUF,IAGhDR,EAAStG,GAAO+G,EAAOC,SAI3BL,EAAY,SAAU3G,GAClB,GAAI+G,GAAST,EAAStG,IAAQmG,EAAMnG,EAEpC,KAAM+G,EACF,KAAM,IAAIhO,OAAO,IAAMiH,EAAK,iBAGhC,OAAO+G,IAIXE,EAAY,SAAU5B,GAClB,GAAIC,GAAK4B,EAAM/N,EAAOI,EAAM4N,EAAMC,CAGlCA,GAAU,SAAUxD,GAChB,MAAOA,IAAQA,EAAIyD,OAAQ,GAAIlT,cAAgByP,EAAInN,OAAQ,GAG/D,KAAM6O,IAAOgB,GAGT,GAFAY,EAAO7B,EAEDiB,EAAQgB,eAAgBhC,GAA9B,CAOA,IAHAnM,EAAQmM,EAAI3c,MAAM,KAClBwe,EAAOC,EAASjO,EAAMoO,OAEdhO,EAAO6N,EAASjO,EAAMjB,UAC1BgP,EAAM3N,GAAS2N,EAAM3N,OACrB2N,EAAOA,EAAM3N,EAGjB2N,GAAMC,GAASb,EAAShB,GAG5B,MAAOD,IAGXmC,EAAa,SAAUC,GAInB,MAHAtB,GAAKuB,SAAWD,EAGTR,EAAWb,EAASD,EAAMS,EAASL,IAK3B,iBAAXQ,SAAiD,gBAAnBA,QAAOC,QAG7CD,OAAOC,QAAUQ,IACS,kBAAXG,SAAyBA,OAAOC,IAM/CD,QAAS,UAAYH,IAKrBnB,EAASF,EAAK0B,YACd1B,EAAK0B,YAAcL,IACnBrB,EAAK0B,YAAYpL,WAAa,WAC1B0J,EAAK0B,YAAcxB,KAG3BrX,OAAQ,SAAUA,EAAQ2Y,EAAQG,GA+vJlC,MAzvJAH,GAAO,kBAAkB,WACrB,GAAIvgB,GAAI4H,EAAO0Y,UAAY1Y,EAAO0N,QAAU1N,EAAO+Y,KAEnD,KAAM3gB,EACF,KAAM,IAAI2R,OAAM,6BAGpB,OAAO3R,KAKXugB,EAAO,UACH,gBACD,SAAUK,GACT,MAAOA,KAKXL,EAAO,iBACH,UACD,SAAUvgB,GACT,OACI6gB,SAAU7gB,EAAE6gB,SACZC,KAAM9gB,EAAE8gB,KAERC,UAAW,SAAUC,GACjB,MAAOA,IAAqC,kBAAlBA,GAASC,SAO/CV,EAAO,WACH,iBACD,SAAUK,GACT,MAAOA,KAsBXL,EAAO,QACH,SACA,WACD,SAAUvgB,EAAGkhB,GAOZ,QAASC,GAAanc,GAClB,MAAO,YACH,MAAOsN,GAAKlS,MAAO4E,EAAI3E,YAI/B,QAAS+gB,GAAQpc,EAAIqc,GACjB,MAAO,YACH,MAAOrc,GAAG5E,MAAOihB,EAAShhB,YAIlC,QAASihB,GAAcC,GACnB,GAAIC,EAEJ,OAAKC,QAAOC,OACDD,OAAOC,OAAQH,IAEtBC,EAAI,aACJA,EAAEjhB,UAAYghB,EACP,GAAIC,IAzBnB,GAAIG,GAAO,aACPrP,EAAOsP,SAAStP,IAiCpB,QAKIuP,QAAS,QAKT7hB,EAAGA,EAEH6gB,SAAUK,EAAQL,SAElBE,UAAWG,EAAQH,UAEnBD,KAAMI,EAAQJ,KAcd1G,QAAS,SAAW0H,GAChB,GAAIC,MACAC,EAASF,EAAG9P,MAAO,oBACnBiQ,EAASH,EAAG9P,MAAO,qBACf8P,EAAG9P,MAAO,mBAEdkQ,EAAKJ,EAAG9P,MAAO,oBACX8P,EAAG9P,MAAO,kCACdmQ,EAAUL,EAAG9P,MAAO,qBACpBqI,EAASyH,EAAG9P,MAAO,oBACnBoQ,EAAQN,EAAG9P,MAAO,gBAStB,OAPAgQ,KAAWD,EAAIC,OAASK,WAAYL,EAAQ,KAC5CC,IAAWF,EAAIE,OAASI,WAAYJ,EAAQ,KAC5CC,IAAOH,EAAIG,GAAKG,WAAYH,EAAI,KAChCC,IAAYJ,EAAII,QAAUE,WAAYF,EAAS,KAC/C9H,IAAW0H,EAAI1H,OAASgI,WAAYhI,EAAQ,KAC5C+H,IAAUL,EAAIK,MAAQC,WAAYD,EAAO,KAElCL,GACPO,UAAUC,WASdC,GAAI,SAAWV,GACX,GAAIC,MAGAU,EAAUX,EAAG9P,MAAO,iCACpB0Q,EAAMZ,EAAG9P,MAAO,qCAMpB,OAHAyQ,KAAYV,EAAIU,QAAUJ,WAAYI,EAAS,KAC/CC,IAAQX,EAAIW,IAAML,WAAYK,EAAK,GAAIje,QAAS,KAAM,OAE/Csd,GACPO,UAAUC,WAqCdI,SAAU,SAAUC,EAAOC,EAAQC,GAC/B,GAAIC,EA0BJ,OAxBuB,kBAAXF,IACRE,EAAQF,EACRA,EAAS,MAETE,EADQF,GAAUA,EAAO3C,eAAe,eAChC2C,EAAO/b,YAEP,WACJ,MAAO8b,GAAMxiB,MAAOQ,KAAMP,YAKlCL,EAAEiR,QAAQ,EAAM8R,EAAOH,EAAOE,OAK9BC,EAAMC,UAAYJ,EAAMriB,UAIxBwiB,EAAMxiB,UAAY+gB,EAAcsB,EAAMriB,WACtCsiB,GAAU7iB,EAAEiR,QAAQ,EAAM8R,EAAMxiB,UAAWsiB,GAEpCE,GAOXpB,KAAMA,EAkBNP,OAAQA,EAORjc,IAAK,WACD,MAAKyC,GAAO1C,QACDkc,EAAQlc,QAAQC,IAAKD,SAEzByc,KAGXsB,SAAU,WAEN,MAAO,UAAUC,GACbnV,WAAYmV,EAAI,OA4BxB5V,MAAO6T,KAAgB7T,OAQvB6V,KAAM,WACF,GAAIC,GAAU,CAEd,OAAO,UAAUC,GAIb,IAHA,GAAIF,KAAS,GAAIjjB,OAAQsS,SAAU,IAC/B9R,EAAI,EAEI,EAAJA,EAAOA,IACXyiB,GAAQnW,KAAKC,MAAuB,MAAhBD,KAAKsW,UAAmB9Q,SAAU,GAG1D,QAAQ6Q,GAAU,OAASF,GAAQC,KAAW5Q,SAAU,QAqBhE+Q,WAAY,SAAUzN,EAAM0N,EAAaC,GACrC,GAAIC,EAIJ,KAFAD,EAAQA,IAAW,IAAK,IAAK,IAAK,IAAK,OAE9BC,EAAOD,EAAM3S,UAAYgF,EAAO,MACrCA,GAAc,IAGlB,QAAiB,MAAT4N,EAAe5N,EAAOA,EAAK6N,QAASH,GAAe,IACnDE,MAQpBnD,EAAO,YACH,QACD,SAAUqD,GAOT,QAASC,GAAcC,EAAKvG,EAAM8B,EAAUgC,GACxC,MAAOrhB,GAAE+jB,KAAMD,EAAK,SAAUE,GAC1B,MAAOA,MACGzG,GAAQyG,EAAQ1gB,IAAMia,MACtB8B,GAAY2E,EAAQd,KAAO7D,GAC7B2E,EAAQd,GAAGe,MAAQ5E,MACjBgC,GAAW2C,EAAQE,MAAQ7C,KAI7C,QAAS8C,GAAWC,EAAQ/E,EAAUgF,GAElCrkB,EAAEyJ,MAAO2a,GAAU,IAAI7iB,MAAO+iB,GAAa,SAAU1D,EAAG1C,GACpDmG,EAAUnG,EAAKmB,KAIvB,QAASkF,GAAgBH,EAAQvT,GAM7B,IALA,GAGImT,GAHAQ,GAAS,EACT9jB,EAAI,GACJ4e,EAAM8E,EAAOvjB,SAGPH,EAAI4e,GAGV,GAFA0E,EAAUI,EAAQ1jB,GAEbsjB,EAAQd,GAAG9iB,MAAO4jB,EAAQS,KAAM5T,MAAW,EAAQ,CACpD2T,GAAS,CACT,OAIR,OAAQA,EAtCZ,GAGI3B,GAHA7iB,EAAI4jB,EAAK5jB,EACTsN,KAAWA,MACXgX,EAAY,KAiMhB,OA1JAzB,IAuCIje,GAAI,SAAU2Y,EAAM8B,EAAUgC,GAC1B,GACIqD,GADAC,EAAK/jB,IAGT,OAAMye,IAINqF,EAAM9jB,KAAKmG,UAAYnG,KAAKmG,YAE5Bod,EAAW5G,EAAM8B,EAAU,SAAU9B,EAAM8B,GACvC,GAAI2E,IAAY1gB,EAAGia,EAEnByG,GAAQd,GAAK7D,EACb2E,EAAQE,IAAM7C,EACd2C,EAAQS,KAAOpD,GAAWsD,EAC1BX,EAAQpL,GAAK8L,EAAI7jB,OAEjB6jB,EAAItd,KAAM4c,KAGPpjB,MAhBIA,MA6BfgkB,KAAM,SAAUrH,EAAM8B,EAAUgC,GAC5B,GAAIsD,GAAK/jB,IAET,OAAMye,IAIN8E,EAAW5G,EAAM8B,EAAU,SAAU9B,EAAM8B,GACvC,GAAIuF,GAAO,WAEH,MADAD,GAAGnd,IAAK+V,EAAMqH,GACPvF,EAASjf,MAAOihB,GAAWsD,EAAItkB,WAG9CukB,GAAKX,IAAM5E,EACXsF,EAAG/f,GAAI2Y,EAAMqH,EAAMvD,KAGhBsD,GAbIA,GA0Bfnd,IAAK,SAAU+V,EAAM2F,EAAIgB,GACrB,GAAIE,GAASxjB,KAAKmG,OAElB,OAAMqd,GAIA7G,GAAS2F,GAAOgB,GAKtBC,EAAW5G,EAAM2F,EAAI,SAAU3F,EAAM2F,GACjCljB,EAAEyJ,KAAMoa,EAAcO,EAAQ7G,EAAM2F,EAAIgB,GAAO,iBACpCE,GAAQxjB,KAAKgY,QAIrBhY,OAVHA,KAAKmG,WACEnG,MALAA,MAyBfmH,QAAS,SAAUC,GACf,GAAI6I,GAAMuT,EAAQS,CAElB,OAAMjkB,MAAKmG,SAAYiB,GAIvB6I,EAAOvD,EAAMgF,KAAMjS,UAAW,GAC9B+jB,EAASP,EAAcjjB,KAAKmG,QAASiB,GACrC6c,EAAYhB,EAAcjjB,KAAKmG,QAAS,OAEjCwd,EAAgBH,EAAQvT,IACvB0T,EAAgBM,EAAWxkB,YARxBO,OAkBZZ,EAAEiR,QAQL6T,UAAW,SAAU7G,GACjB,MAAOje,GAAEiR,OAAQgN,EAAK4E,KAG3BA,KAKPtC,EAAO,YACH,OACA,YACD,SAAUqD,EAAMmB,GAiBf,QAASC,GAAUxP,GACf5U,KAAKK,QAAUjB,EAAEiR,QAAQ,KAAU+T,EAAS/jB,QAASuU,GACrD5U,KAAKqkB,MAAOrkB,KAAKK,SAjBrB,GAAIjB,GAAI4jB,EAAK5jB,CA6Lb,OAvKAglB,GAAS/jB,WACT8jB,EAASD,UAAWE,EAASzkB,WAG7BP,EAAEyJ,MACEyb,OAAQ,eACRC,KAAM,cACNC,QAAS,WACTC,SAAU,YACVC,QAAS,WACTC,SAAU,WACVlH,KAAM,aACNmH,WAAY,cACZC,WAAY,cACZC,SAAU,YACVC,MAAO,QACPC,aAAc,iBACdC,UAAW,aACXC,QAAS,WACTC,aAAc,gBACdC,UAAW,UACXC,mBAAoB,uBACpBC,QAAS,UACTC,QAAS,UACTC,OAAQ,SACR/e,MAAO,SACR,SAAUrC,EAAIqhB,GACbrB,EAASzkB,UAAWyE,GAAO,WACvB,MAAOpE,MAAK0lB,QAASD,EAAShmB,cAItCL,EAAEiR,OAAQ+T,EAASzkB,WACfgmB,MAAO,UAEPtB,MAAO,SAAUzP,GACb,GAAImP,GAAK/jB,IAET+jB,GAAG2B,QAAS,OAAQ9Q,EAAM,WACtBmP,EAAG4B,MAAQ,QACX5B,EAAG5c,QAAQ,YAsBnB6I,OAAQ,SAAUsN,EAAKhW,GACnB,GAAIsN,GAAO5U,KAAKK,OAGhB,OAAKZ,WAAUQ,OAAS,OAEfb,EAAEwmB,cAAete,IACdlI,EAAEwmB,cAAehR,EAAM0I,IAC3Ble,EAAEiR,OAAQuE,EAAM0I,GAAOhW,GAEvBsN,EAAM0I,GAAQhW,GAIXgW,EAAM1I,EAAM0I,GAAQ1I,GAgBnCiR,SAAU,WAEN,GAAIC,GAAQ9lB,KAAK0lB,QAAQ,YAEzB,OAAOI,IACHC,WAAYD,EAAME,aAClBC,YAAaH,EAAMI,cAInBC,UAAWL,EAAMM,YACjBC,WAAYP,EAAMQ,aAClBC,cAAeT,EAAMU,kBACrBC,SAAUX,EAAMY,WAChBC,aAAcb,EAAMc,oBAK5Bzf,QAAS,SAAUC,GACf,GAAI6I,MAAUvD,MAAMgF,KAAMjS,UAAW,GACjCmV,EAAO5U,KAAKK,QACZsc,EAAO,KAAOvV,EAAK2L,UAAW,EAAG,GAAI5G,cACjC/E,EAAK2L,UAAW,EAExB,OAEQoR,GAAShd,QAAQ3H,MAAOQ,KAAMP,cAAgB,GAG9CL,EAAEynB,WAAYjS,EAAM+H,KACpB/H,EAAM+H,GAAOnd,MAAOQ,KAAMiQ,MAAW,GAGrC7Q,EAAEynB,WAAY7mB,KAAM2c,KACpB3c,KAAM2c,GAAOnd,MAAOQ,KAAMiQ,MAAW,GAGrCkU,EAAShd,QAAQ3H,MAAO2kB,GACtBnkB,KAAMoH,GAAO0f,OAAQ7W,OAAa,GAEjC,GAGJ,GAQX8W,QAAS,WACL/mB,KAAK0lB,QAAS,UAAWjmB,WACzBO,KAAK4G,OAIT8e,QAAS1C,EAAKjC,OAUlBiC,EAAKlC,OAASsD,EAAStD,OAAS,SAAUlM,GACtC,MAAO,IAAIwP,GAAUxP,IAIzBoO,EAAKoB,SAAWA,EAETA,IAKXzE,EAAO,mBACH,OACA,YACD,SAAUqD,EAAMmB,GAgBf,QAAS6C,GAAS3mB,GACdL,KAAKK,QAAUjB,EAAEiR,QACb9P,UAAWoE,SAAS2E,MACrBjJ,GACHL,KAAKinB,IAAMjE,EAAKT,KAAK,OAlBzB,GAAInjB,GAAI4jB,EAAK5jB,EACT8nB,KAGAC,EAAc,SAAU9J,GACpB,IAAM,GAAIC,KAAOD,GACb,GAAKA,EAAIiC,eAAgBhC,GACrB,MAAOA,EAGf,OAAO,MAyFf,OA9EAle,GAAEiR,OAAQ2W,EAAQrnB,WAEdynB,aAAc,WACV,GACI1lB,GAAQnB,EADRqU,EAAO5U,KAAKK,OAGhB,OAAKL,MAAKqnB,WACCrnB,KAAKqnB,YAGhB3lB,EAAStC,EAAGwV,EAAKrU,WAAaoE,SAAS2E,MACvC/I,EAAYnB,EAAGuF,SAAS2iB,cAAc,QAEtC/mB,EAAUwV,KAAM,KAAM,MAAQ/V,KAAKinB,KACnC1mB,EAAUwI,KACNmP,SAAU,WACVjP,IAAK,MACLC,KAAM,MACNwO,MAAO,MACP7Q,OAAQ,MACR0gB,SAAU,WAGd7lB,EAAOoI,OAAQvJ,GACfmB,EAAO8C,SAAS,yBAChBxE,KAAKqnB,WAAa9mB,EAClBP,KAAKwnB,QAAU9lB,EACRnB,IAGXmV,KAAMsN,EAAKjC,KACXtP,KAAMuR,EAAKjC,KAEXgG,QAAS,WACL/mB,KAAKqnB,YAAcrnB,KAAKqnB,WAAW7f,SACnCxH,KAAKwnB,SAAWxnB,KAAKwnB,QAAQhb,YAAY,yBACzCxM,KAAK4G,SAIbogB,EAAQS,OAAS,cAQjBT,EAAQU,WAAa,SAAUtgB,EAAMgX,GACjC8I,EAAW9f,GAASgX,GAGxB4I,EAAQW,WAAa,SAAUvgB,GAC3B,SAAUA,EAAO8f,EAAW9f,GAAS+f,EAAaD,KAGtDF,EAAQlG,OAAS,SAAUlM,EAAM6S,GAC7B,GAAIrgB,GAAMwgB,CAYV,IAVAH,EAASA,GAAUT,EAAQS,OAC3BroB,EAAEyJ,KAAM4e,EAAO9mB,MAAO,YAAc,WAChC,MAAKumB,GAAWlnB,OACZoH,EAAOpH,MACA,GAFX,SAMJoH,EAAOA,GAAQ+f,EAAaD,IAEtB9f,EACF,KAAM,IAAI2J,OAAM,gBAIpB,OADA6W,GAAU,GAAIV,GAAW9f,GAAQwN,IAIrCuP,EAASD,UAAW8C,EAAQrnB,WACrBqnB,IAMXrH,EAAO,kBACH,OACA,WACA,mBACD,SAAUqD,EAAMmB,EAAU6C,GAqCzB,QAASa,GAAepmB,EAAWqmB,GAC/B,GACIF,GADAG,EAAW/E,EAAK/C,UAGpBjgB,MAAKinB,IAAMjE,EAAKT,KAAK,WAGrBviB,KAAKgoB,aAAe,SAAU1F,GAC1B,MAAOyF,GAASE,KAAM3F,IAG1BtiB,KAAKkoB,eAAiB,SAAUtT,EAAM0N,GAGlC,GAAKsF,EACD,KAAM,IAAI7W,OAAM,qBA4BpB,OAzBAgX,GAASE,KAAM3F,GAEM,gBAAT1N,IAAqBuT,EAAMhT,IAAKP,KACxCgT,EAAUO,EAAMhT,IAAKP,IAIzBgT,EAAUA,GAAWO,EAAMhT,IAAK,KAAM2S,GAGhCF,GASF5E,EAAK5jB,EAAEiR,OAAQuX,EAAQvnB,QAASuU,GAChCgT,EAAQQ,UAAU/H,KAAM0H,EAASM,SACjCT,EAAQU,aAVRV,EAAUZ,EAAQlG,OAAQlM,EAAMA,EAAK2T,cACrCX,EAAQQ,UAAYL,EAASzH,UAC7BsH,EAAQ5D,KAAM,QAAS+D,EAASM,SAChCT,EAAQlS,OACRyS,EAAMK,IAAKZ,GACXA,EAAQU,SAAW,GAQvBR,IAAeF,EAAQa,aAAeX,GAC/BF,GAGX5nB,KAAK0oB,WAAa,WACd,MAAOd,IAGX5nB,KAAK2oB,kBAAoB,WACff,IAINA,EAAQU,WAEHV,EAAQU,UAAY,IACrBH,EAAM3gB,OAAQogB,SACPA,GAAQQ,UACfR,EAAQb,WAGZa,EAAU,OAGd5nB,KAAKyR,KAAO,WACR,GAAMmW,EAAN,CAIA,GAAI3X,GAAO+S,EAAKtW,MAAOjN,UAGvB,OAFAgC,IAAawO,EAAK2Y,QAASnnB,GAEpBmmB,EAAQnW,KAAKjS,MAAOQ,KAAMiQ,KAGrCjQ,KAAK6oB,QAAU,WACX,MAAOjB,IAAWA,EAAQX,KAG9BjnB,KAAK+mB,QAAU,SAAWA,GACtB,MAAO,YACHA,GAAWA,EAAQvnB,MAAOQ,KAAMP,WAChCO,KAAKmH,QAAQ,WACbnH,KAAK4G,MACL5G,KAAKyR,KAAK,WACVzR,KAAK2oB,sBAET3oB,KAAK+mB,SA5Hb,GAAIoB,EAgIJ,OA9HAA,GAAQ,WACJ,GAAI9K,KAEJ,QACImL,IAAK,SAAUZ,GACXvK,EAAKuK,EAAQX,KAAQW,GAGzBzS,IAAK,SAAU2T,EAAMhB,GACjB,GAAIhoB,EAEJ,IAAKgpB,EACD,MAAOzL,GAAKyL,EAGhB,KAAMhpB,IAAKud,GAEP,IAAKyK,IAAczK,EAAKvd,GAAI2oB,aAI5B,MAAOpL,GAAKvd,EAGhB,OAAO,OAGX0H,OAAQ,SAAUogB,SACPvK,GAAKuK,EAAQX,UAiGhC9C,EAASD,UAAW2D,EAAcloB,WAC3BkoB,IAKXlI,EAAO,WACH,OACA,WACA,kBACD,SAAUqD,EAAMmB,EAAU4E,GAIzB,QAASC,GAAapU,GAClBA,EAAO5U,KAAKK,QAAUjB,EAAEiR,UAAW2Y,EAAY3oB,QAASuU,GAExDA,EAAKrU,UAAYnB,EAAGwV,EAAKrU,WAEnBqU,EAAKrU,UAAUN,QAIrB8oB,EAAarX,KAAM1R,KAAM,eAX7B,GAAIZ,GAAI4jB,EAAK5jB,CAkCb,OApBA4pB,GAAY3oB,SACR4oB,OAAQ,KACRC,kBAAkB,GAGtBlG,EAAKjB,SAAUgH,GACX7iB,YAAa8iB,EAEbtT,KAAM,WACF,GAAIqO,GAAK/jB,IAET+jB,GAAGmE,eAAgBnE,EAAG1jB,QAAS,WAC3B0jB,EAAGtS,KAAK,QACRsS,EAAG5c,QAAQ,cAKvBgd,EAASD,UAAW8E,EAAYrpB,WAEzBqpB,IAKXrJ,EAAO,kBACH,OACA,YACD,SAAUqD,EAAMoB,GAQf,QAAS+E,GAAa9L,GAClB,IAAMA,EACF,OAAO,CAGX,IAAIpd,GAASod,EAAIpd,OACbmH,EAAOhI,EAAEgI,KAAMiW,EAEnB,OAAsB,KAAjBA,EAAI+L,UAAkBnpB,GAChB,EAGK,UAATmH,GAA6B,aAATA,GAAgC,WAATA,IAC9B,IAAXnH,GAAkC,gBAAXA,IAAuBA,EAAS,GACvDA,EAAS,IAAMod,IAG5B,QAASgM,GAAQC,GACbtpB,KAAKupB,MAAQD,EACbtpB,KAAKK,QAAUipB,EAASjpB,QAzB5B,GAAIjB,GAAI4jB,EAAK5jB,EACTilB,EAAQD,EAASzkB,UAAU0kB,MAC3BmF,EAAWpF,EAASzkB,UAAUonB,QAC9B0C,KACAC,IAiOJ,OAzMAtqB,GAAEiR,OAAQgZ,EAAO1pB,WAEb+V,KAAMsN,EAAKjC,KAIX4I,OAAQ,SAAUC,EAAS3Z,GAOvB,GAAIvH,GAAM1I,KAAK6pB,WAGf,OAAMnhB,IAASkhB,IAAWlhB,IAAUA,EAAKkhB,IAAa5pB,OAC7CZ,EAAEynB,WAAY7mB,KAAM0I,EAAKkhB,KAK3B5pB,KAAM0I,EAAKkhB,IAAYpqB,MAAOQ,KAAMiQ,GAHhCwZ,GAcf/D,QAAS,WACL,MAAO1lB,MAAKupB,MAAM7D,QAAQlmB,MAAOQ,KAAKupB,MAAO9pB,cAKrDL,EAAEiR,OAAQ+T,EAASzkB,WAUf0kB,MAAO,WACH,GAAIN,GAAK/jB,KACL8pB,EAAU/F,EAAGgG,YACbC,EAAYjG,EAAG1jB,QAAQ4pB,gBAAkB,EAO7C,OALA7qB,GAAEyJ,KAAM6gB,EAAa,SAAU1J,EAAGkK,KAC5BF,KAAeA,EAAUpqB,QAASsqB,EAAMC,SACtCL,EAAQtjB,KAAM,GAAI0jB,GAAOnG,MAG1BM,EAAM7kB,MAAOukB,EAAItkB,YAG5BimB,QAAS,SAAUkE,EAAS3Z,EAAMwO,GAC9B,GAKI2L,GAAQC,EAAK/J,EAAShD,EALtBxd,EAAI,EACJgqB,EAAU9pB,KAAK+pB,SACfrL,EAAMoL,GAAWA,EAAQ7pB,OACzBqqB,KACAC,IAKJ,KAFAta,EAAOkZ,EAAalZ,GAASA,GAASA,GAE1ByO,EAAJ5e,EAASA,IACbsqB,EAASN,EAAShqB,GAClBuqB,EAAMD,EAAOT,OAAQC,EAAS3Z,GAEzBoa,IAAQZ,IAGJzG,EAAK7C,UAAWkK,GACjBE,EAAK/jB,KAAM6jB,GAEXC,EAAK9jB,KAAM6jB,GAMvB,OAAK5L,IAAY8L,EAAKtqB,QAClBqgB,EAAU0C,EAAK9C,KAAK1gB,MAAOwjB,EAAMuH,GACjCjN,EAAMgD,EAAQkK,KAAO,OAAS,OAIvBlK,EAAShD,GAAM,WACV,GAAIyK,GAAW/E,EAAK/C,WAChBhQ,EAAOxQ,SAUX,OARqB,KAAhBwQ,EAAKhQ,SACNgQ,EAAOA,EAAM,IAGjB9C,WAAW,WACP4a,EAASM,QAASpY,IACnB,GAEI8X,EAASzH,YAChB7B,EAAWnB,EAAM,QAAUmB,GAAYuE,EAAKjC,OAEjDuJ,EAAM,IAIrBvD,QAAS,WACLyC,EAAShqB,MAAOQ,KAAMP,WACtBO,KAAK+pB,SAAW,QA0BxB3F,EAASqG,SAAWpB,EAAOoB,SAAW,SAAUZ,EAAaa,GACzD,GACIR,GADAxhB,GAAQgN,KAAM,OAAQqR,QAAS,UAAWpK,KAAM,YAyBpD,OAtB0B,KAArBld,UAAUQ,QACXyqB,EAAcb,EAGdzqB,EAAEyJ,KAAK6hB,EAAa,SAASpN,GACzB,MAAgB,MAAXA,EAAI,IAAsB,SAARA,OACX,SAARA,IAAmB5U,EAAIiU,KAAO+N,EAAY/N,YAI9CjU,EAAI4U,EAAIzZ,QAAQ,SAAU,OAAOwJ,eAAiBiQ,MAItD5U,EAAMtJ,EAAEiR,OAAQ3H,EAAKmhB,GAGzBa,EAAYb,YAAcnhB,EAC1BwhB,EAAQlH,EAAKjB,SAAUsH,EAAQqB,GAC/BR,EAAMC,MAAQzhB,EAAIiU,KAClB+M,EAAYljB,KAAM0jB,GAEXA,GAqBX9F,EAASuG,WAAatB,EAAOsB,WAAa,SAAUhO,GAChD,GAAMA,GAAiB,cAATA,EAKd,IAAM,GAAI7c,GAAI4pB,EAAYzpB,OAAQH,KACzB4pB,EAAY5pB,GAAGqqB,QAAUxN,GAC1B+M,EAAYkB,OAAO9qB,EAAG,IAK3BupB,IAKX1J,EAAO,mBACH,OACA,WACA,UACA,kBACD,SAAUqD,EAAMoB,EAAUyG,GACzB,GAAIzrB,GAAI4jB,EAAK5jB,CAsBb,OApBAglB,GAAS/jB,QAAQyqB,IAAM,GAoBhB1G,EAASqG,UACZ9N,KAAM,MAENjH,KAAM,SAAUd,GAEZ,GAAMA,EAAKkW,KACsC,UAAzC9qB,KAAK0lB,QAAQ,wBADrB,CAKA,GAOIoF,GAPA/G,EAAK/jB,KACL+nB,EAAW/E,EAAK/C,WAChB5f,EAAUjB,EAAEiR,WACR6Y,iBAAkBtU,EAAKsU,iBACvB3oB,UAAWqU,EAAKkW,IAChB7B,OAAQrU,EAAKqU,QAkBrB,OAdAjpB,MAAK8qB,IAAMA,EAAM,GAAID,GAAKxqB,GAE1ByqB,EAAI9G,KAAM,QAAS+D,EAASM,SAC5ByC,EAAI9mB,GAAI,OAAQ,SAAU+mB,GACtBhH,EAAG2B,QAAS,YAAcqF,MAI9BD,EAAI9mB,GAAI,SAAU,SAAUgnB,GACxB,MAAOjH,GAAGwF,MAAMpiB,QAAS,YAAa6jB,KAG1CF,EAAIpV,OAEGqS,EAASzH,YAGpByG,QAAS,WACL/mB,KAAK8qB,KAAO9qB,KAAK8qB,IAAI/D,eAQjCpH,EAAO,iBACH,OACA,WACA,kBACD,SAAUqD,EAAMmB,EAAU4E,GAIzB,QAASkC,GAAWrW,GAChBA,EAAO5U,KAAKK,QAAUjB,EAAEiR,UAAWuE,GACnCA,EAAKrU,UAAYnB,EAAGwV,EAAKrU,WAAaoE,SAAS2E,MAC/Cyf,EAAarX,KAAM1R,KAAM,aAL7B,GAAIZ,GAAI4jB,EAAK5jB,CAuBb,OAfA4jB,GAAKjB,SAAUgH,GACX7iB,YAAa+kB,EAEbvV,KAAM,WACF,GAAIqO,GAAK/jB,IAET+jB,GAAGmE,eAAgBnE,EAAG1jB,QAAS,WAC3B0jB,EAAGtS,KAAK,QACRsS,EAAG5c,QAAQ,cAKvBgd,EAASD,UAAW+G,EAAUtrB,WAEvBsrB,IAKXtL,EAAO,qBACH,OACA,WACA,gBACA,kBACD,SAAUqD,EAAMoB,EAAU6G,GACzB,GAAI7rB,GAAI4jB,EAAK5jB,CAOb,OAAOglB,GAASqG,UACZ9N,KAAM,QAENjH,KAAM,SAAUd,GAEZ,GAAMA,EAAKsW,OACsC,UAAzClrB,KAAK0lB,QAAQ,wBADrB,CAKA,GAMIwF,GANAnH,EAAK/jB,KACL+nB,EAAW/E,EAAK/C,WAChB5f,EAAUjB,EAAEiR,WACR9P,UAAWqU,EAAKsW,MAChBjC,OAAQrU,EAAKqU,QAYrB,OARAjpB,MAAKkrB,MAAQA,EAAQ,GAAID,GAAW5qB,GAEpC6qB,EAAMlH,KAAM,QAAS+D,EAASM,SAC9B6C,EAAMlnB,GAAI,QAAS,SAAU+mB,GACzBhH,EAAGwF,MAAM7D,QAAS,YAAcqF,MAEpCG,EAAMxV,OAECqS,EAASzH,YAGpByG,QAAS,WACL/mB,KAAKkrB,OAASlrB,KAAKkrB,MAAMnE,eAOrCpH,EAAO,YACH,OACA,kBACD,SAAUqD,EAAM6E,GAEf,QAASsD,GAAMrC,EAAMsC,GACjB,GAAIrH,GAAK/jB,IAET+jB,GAAGqH,OAASA,EACZrH,EAAG+E,KAAOA,EACV9oB,KAAKkV,KAAOkW,EAAOlW,MAAQ,GAGrBkW,EAAOhkB,MAAQpH,KAAKqrB,MACjB,uBAAuBzrB,QAASI,KAAKqrB,KAC1CrrB,KAAKoH,KAAO,UAAyB,QAAbpH,KAAKqrB,IAAgB,OAASrrB,KAAKqrB,KAE3DrrB,KAAKoH,KAAOgkB,EAAOhkB,MAAQ,2BAG/BygB,EAAcnW,KAAMqS,EAAI,QACxB/jB,KAAKinB,IAAMmE,EAAOnE,KAAOjnB,KAAKinB,IAEzB6B,GACD/E,EAAGmE,eAAgBY,GAgB3B,MAZA9F,GAAKjB,SAAU8F,GACX3hB,YAAailB,EAEbze,MAAO,SAAU4e,EAAO/e,GACpB,MAAOvM,MAAKyR,KAAM,QAAS6Z,EAAO/e,IAGtCgf,UAAW,WACP,MAAOvrB,MAAKorB,UAIbD,IAOXxL,EAAO,YACH,OACA,YACD,SAAUqD,EAAMmI,GAKf,QAASK,GAAM1C,EAAM2C,GACjB,GAAIJ,EAEJrrB,MAAK2c,KAAO8O,EAAK9O,MAAS,WAAasK,IACvCoE,EAAMK,EAAKja,KAAMga,EAAK9O,MAASgP,OAAOxO,GAAG9P,cAAgB,IAInDge,GAAOI,EAAKrkB,OACdikB,EAAM,6BAA6B5Z,KAAMga,EAAKrkB,MACtCukB,OAAOxO,GAAG9P,cAAgB,GAClCrN,KAAK2c,MAAQ,IAAM0O,GAGvBrrB,KAAKqrB,IAAMA,EACXrrB,KAAK4rB,iBAAmBH,EAAKG,mBACrB,GAAKtsB,OAAQusB,iBAErBV,EAAK3rB,MAAOQ,KAAMP,WArBtB,GAAIwnB,GAAM,EACNyE,EAAO,YAuBX,OAAO1I,GAAKjB,SAAUoJ,EAAMK,KAMhC7L,EAAO,kBACH,OACA,iBACA,YACD,SAAUqD,EAAM+F,EAAcyC,GAI7B,QAASM,GAAYlX,GAKjB,GAJAA,EAAO5U,KAAKK,QAAUjB,EAAEiR,UAAWyb,EAAWzrB,QAASuU,GAEvDA,EAAKrU,UAAYnB,EAAGwV,EAAKoD,KAEnBpD,EAAKrU,UAAUN,OACjB,KAAM,IAAI8Q,OAAM,SAGpB6D,GAAKmX,UAAYnX,EAAKmX,WAAanX,EAAKoX,OAChCpX,EAAKrU,UAAUqJ,QAAU,GAEjCgL,EAAK6H,OAASrd,EAAGwV,EAAK6H,QAAU9X,SAAS2iB,cAAc,QACvD1S,EAAK6H,OAAO7S,KAAMgL,EAAKmX,WACvBnX,EAAKrU,UAAUqJ,KAAMgL,EAAK6H,QAE1BsM,EAAarX,KAAM1R,KAAM,cAAc,GAlB3C,GAAIZ,GAAI4jB,EAAK5jB,CAwHb,OAnGA0sB,GAAWzrB,SACPoc,OAAQ,KACRlc,UAAW,KACXyrB,MAAO,KACPD,UAAW,KACXE,UAAU,EACVhD,OAAQ,KACRtM,KAAM,QAGVqG,EAAKjB,SAAUgH,GACX7iB,YAAa4lB,EAEbpW,KAAM,WACF,GAAIqO,GAAK/jB,KACL4U,EAAOmP,EAAG1jB,QACVoc,EAAS7H,EAAK6H,MAElBA,GAAOjY,SAAS,oBAEhBuf,EAAG/f,GAAI,MAAO,SAAUoD,GACpB,GAAI2jB,EAEJ,QAAS3jB,GACL,IAAK,aACDqV,EAAOjY,SAAS,yBAChB,MAEJ,KAAK,aACDiY,EAAOjQ,YAAY,yBACnB,MAEJ,KAAK,SACDue,EAAQhH,EAAGtS,KAAK,YAChBsS,EAAG5c,QAAS,SAAU/H,EAAEsJ,IAAKqiB,EAAO,SAAUU,GAK1C,MAJAA,GAAO,GAAID,GAAMzH,EAAG8E,UAAW4C,GAG/BA,EAAKS,OAAStX,EAAKrU,UACZkrB,IACP7W,EAAKrU,cAKrBwjB,EAAGmE,eAAgBtT,EAAM,WACrBmP,EAAGuB,UACHvB,EAAGtS,KAAM,OAAQmD,GACjBmP,EAAG5c,QAAQ,WAGfnH,KAAKmsB,eAAiBnJ,EAAKxC,OAAQxgB,KAAKslB,QAAStlB,MACjDZ,EAAG4H,GAAShD,GAAI,SAAUhE,KAAKmsB,iBAGnC7G,QAAS,WACL,GAAI8G,GAAgBpsB,KAAK0oB,aAAatB,eAClC3K,EAASzc,KAAKK,QAAQoc,OACtB/E,EAAQ+E,EAAOrT,WACPqT,EAAOrT,aAAeqT,EAAO/E,QAErC7Q,EAAS4V,EAAO3V,YACR2V,EAAO3V,cAAgB2V,EAAO5V,SAEtC0O,EAAMkH,EAAOzT,QAEjB0O,IAAS7Q,GAAUulB,EAAcrjB,KAC7B0O,OAAQ,OACRD,MAAO,OACPE,MAAOA,EAAQ,KACf7Q,OAAQA,EAAS,OAClBmC,OAAQuM,IAGfiQ,OAAQ,WACJ,GAAI6G,GAAMrsB,KAAKK,QAAQoc,MAEvB4P,GAAI7f,YAAY,4BAChBxM,KAAKslB,WAGTC,QAAS,WACL,GAAI8G,GAAMrsB,KAAKK,QAAQoc,MAEvBzc,MAAK0oB,aAAatB,eAAere,KAC7BE,IAAK,aAGTojB,EAAI7nB,SAAS,6BAGjBuiB,QAAS,WACL,GAAIsF,GAAMrsB,KAAKK,QAAQoc,MACvBrd,GAAG4H,GAASJ,IAAK,SAAU5G,KAAKmsB,gBAChCE,EAAI7f,YAAY,uEAKjBsf,IAMXnM,EAAO,sBACH,OACA,WACA,iBACA,kBACD,SAAUqD,EAAMoB,EAAU0H,GACzB,GAAI1sB,GAAI4jB,EAAK5jB,CA4Cb,OA1CAA,GAAEiR,OAAQ+T,EAAS/jB,SAafisB,KAAM,KAsBNrD,OAAQ,OAOL7E,EAASqG,UACZ9N,KAAM,SAENjH,KAAM,SAAUd,GAEZ,MADA5U,MAAKusB,WACE3X,EAAK0X,MAAQtsB,KAAKwsB,OAAQ5X,EAAK0X,OAG1ChH,QAAS,WACLlmB,EAAEyJ,KAAM7I,KAAKusB,QAAS,WAClBvsB,KAAKslB,aAgBbkH,OAAQ,SAAUF,GACd,GAAIvI,GAAK/jB,KACL4U,EAAOmP,EAAG1jB,QACV4oB,EAASrU,EAAKqU,OACdwD,IAEJ,IAAMH,EAiCN,MA7BAltB,GAAEwmB,cAAe0G,KAAWA,GACxBtU,GAAIsU,IAGRltB,EAAGktB,EAAKtU,IAAKnP,KAAK,WACd,GAAIxI,GAASyD,EAAQikB,CAErBA,GAAW/E,EAAK/C,WAEhB5f,EAAUjB,EAAEiR,UAAWic,GACnBrD,OAAQ7pB,EAAEwmB,cAAeqD,IAAaA,GAAWA,EACjDyD,IAAK9X,EAAK8X,IACVnE,aAAc3T,EAAK2T,aACnBvQ,GAAIhY,OAGR8D,EAAS,GAAIgoB,GAAYzrB,GAEzByD,EAAOkgB,KAAM,QAAS+D,EAASM,SAC/BvkB,EAAOE,GAAI,SAAU,SAAU+mB,GAC3BhH,EAAGwF,MAAM7D,QAAS,YAAcqF,MAEpCjnB,EAAO4R,OAEPqO,EAAGwI,QAAQ/lB,KAAM1C,GAEjB2oB,EAASjmB,KAAMuhB,EAASzH,aAGrB0C,EAAK9C,KAAK1gB,MAAOwjB,EAAMyJ,IAGlClH,QAAS,WACLnmB,EAAEyJ,KAAM7I,KAAKusB,QAAS,WAClBvsB,KAAKulB,aAIbC,OAAQ,WACJpmB,EAAEyJ,KAAM7I,KAAKusB,QAAS,WAClBvsB,KAAKwlB,YAIbuB,QAAS,WACL3nB,EAAEyJ,KAAM7I,KAAKusB,QAAS,WAClBvsB,KAAK+mB,YAET/mB,KAAKusB,QAAU,UAO3B5M,EAAO,QACH,OACA,YACD,SAAUqD,EAAMmB,GAQf,QAASwI,KACL,MAAOC,GAAWC,IAUtB,QAASC,GAAQ1B,GAObprB,KAAK2c,KAAOyO,EAAOzO,MAAQ;AAQ3B3c,KAAKkV,KAAOkW,EAAOlW,MAAQ,EAQ3BlV,KAAKoH,KAAOgkB,EAAOhkB,MAAQ,2BAQ3BpH,KAAK4rB,iBAAmBR,EAAOQ,kBAAkC,EAAb,GAAItsB,MAOxDU,KAAKgY,GAAK2U,IAOV3sB,KAAKqrB,IAAMK,EAAKja,KAAMzR,KAAK2c,MAASgP,OAAOxO,GAAK,GAQhDnd,KAAK+sB,WAAa,GAGlBC,EAAWhtB,KAAKgY,IAAO8U,EAAOG,OAAOC,OAErCltB,KAAKorB,OAASA,EACdprB,KAAKmtB,OAAS,EAEdntB,KAAKgE,GAAI,QAAS,SAAUopB,GACxBptB,KAAKqtB,UAAWP,EAAOG,OAAOK,MAAOF,KA/E7C,GAAIhuB,GAAI4jB,EAAK5jB,EACTwtB,EAAW,WACXC,EAAW,EACXnB,EAAO,aACPsB,IA2KJ,OA5FA5tB,GAAEiR,OAAQyc,EAAOntB,WASb0tB,UAAW,SAAUE,EAAQviB,GAEzB,GAAIwiB,GAAaR,EAAWhtB,KAAKgY,GAEjB,oBAAThN,KAAyBhL,KAAK+sB,WAAa/hB,GAE7CuiB,IAAWC,IACZR,EAAWhtB,KAAKgY,IAAOuV,EAKvBvtB,KAAKmH,QAAS,eAAgBomB,EAAQC,KAyB9CC,UAAW,WACP,MAAOT,GAAWhtB,KAAKgY,KAO3BuT,UAAW,WACP,MAAOvrB,MAAKorB,QAGhBrE,QAAS,WACL/mB,KAAK4G,YACEomB,GAAWhtB,KAAKgY,OAI/BmM,EAASD,UAAW4I,EAAOntB,WAiB3BmtB,EAAOG,QACHC,OAAY,SACZQ,OAAY,SACZC,SAAY,WACZL,MAAY,QACZM,SAAY,WACZC,UAAY,YACZC,UAAY,YACZC,QAAY,WAGTjB,IAMXnN,EAAO,SACH,OACA,WACA,QACD,SAAUqD,EAAMmB,EAAU2I,GAUzB,QAASkB,KAaLhuB,KAAK8lB,OACDY,WAAY,EACZV,aAAc,EACdI,YAAa,EACbF,cAAe,EACfM,kBAAmB,EACnBF,aAAc,EACd2H,aAAc,EACdrH,eAAgB,GAIpB5mB,KAAKkuB,UAGLluB,KAAKmuB,QApCT,GAAI/uB,GAAI4jB,EAAK5jB,EACTgvB,EAAStB,EAAOG,MAuOpB,OAjMA7tB,GAAEiR,OAAQ2d,EAAMruB,WAQZmK,OAAQ,SAAU2hB,GAGd,MAFAzrB,MAAKkuB,OAAO1nB,KAAMilB,GAClBzrB,KAAKquB,WAAY5C,GACVzrB,MASXma,QAAS,SAAUsR,GAGf,MAFAzrB,MAAKkuB,OAAOtF,QAAS6C,GACrBzrB,KAAKquB,WAAY5C,GACVzrB,MAUXwkB,QAAS,SAAU8J,GACf,MAAuB,gBAAXA,GACDA,EAEJtuB,KAAKmuB,KAAMG,IAUtBC,MAAO,SAAUhB,GACb,GACIztB,GAAG2rB,EADH/M,EAAM1e,KAAKkuB,OAAOjuB,MAKtB,KAFAstB,EAASA,GAAUa,EAAOV,OAEpB5tB,EAAI,EAAO4e,EAAJ5e,EAASA,IAGlB,GAFA2rB,EAAOzrB,KAAKkuB,OAAQpuB,GAEfytB,IAAW9B,EAAKgC,YACjB,MAAOhC,EAIf,OAAO,OASXhO,KAAM,SAAUrZ,GACO,kBAAPA,IACRpE,KAAKkuB,OAAOzQ,KAAMrZ,IAU1BqgB,SAAU,WAON,IANA,GAIIgH,GAJA+C,KAAS9hB,MAAMgF,KAAMjS,UAAW,GAChC0hB,KACArhB,EAAI,EACJ4e,EAAM1e,KAAKkuB,OAAOjuB,OAGVye,EAAJ5e,EAASA,IACb2rB,EAAOzrB,KAAKkuB,OAAQpuB,KAEf0uB,EAAIvuB,SAAYb,EAAEuM,QAAS8f,EAAKgC,YAAae,KAIlDrN,EAAI3a,KAAMilB,EAGd,OAAOtK,IASXyD,WAAY,SAAU6G,GAClB,GACIgD,GAAWzuB,KAAKmuB,KAAM1C,EAAKzT,GAE1ByW,WACMzuB,MAAKmuB,KAAM1C,EAAKzT,IACvByT,EAAK1E,UACL/mB,KAAK8lB,MAAMmI,iBAInBI,WAAY,SAAU5C,GAClB,GAAI1H,GAAK/jB,KACLyuB,EAAWzuB,KAAKmuB,KAAM1C,EAAKzT,GAEzByW,KACFzuB,KAAKmuB,KAAM1C,EAAKzT,IAAOyT,EAEvBA,EAAKznB,GAAI,eAAgB,SAAU0qB,EAAKC,GACpC5K,EAAG6K,oBAAqBF,EAAKC,OAKzCC,oBAAqB,SAAUC,EAAWC,GACtC,GAAIhJ,GAAQ9lB,KAAK8lB,KAEjB,QAASgJ,GACL,IAAKV,GAAOT,SACR7H,EAAMI,eACN,MAEJ,KAAKkI,GAAOV,OACR5H,EAAMY,YACN,MAEJ,KAAK0H,GAAOd,MACRxH,EAAMU,mBACN,MAEJ,KAAK4H,GAAOL,QACRjI,EAAMQ,cACN,MAEJ,KAAK8H,GAAON,UACRhI,EAAMc,iBAId,OAASiI,GACL,IAAKT,GAAOV,OACR5H,EAAMY,YACN,MAEJ,KAAK0H,GAAOT,SACR7H,EAAMI,eACN,MAEJ,KAAKkI,GAAOd,MACRxH,EAAMU,mBACN,MAEJ,KAAK4H,GAAOR,SACR9H,EAAME,cACN,MAEJ,KAAKoI,GAAOP,UACR/H,EAAMM,aACN,MAGJ,KAAKgI,GAAOL,QACRjI,EAAMQ,cACN,MAEJ,KAAK8H,GAAON,UACRhI,EAAMc,qBAOtBzC,EAASD,UAAW8J,EAAMruB,WAEnBquB,IAKXrO,EAAO,iBACH,OACA,WACA,QACA,OACA,WACA,iBACA,kBACD,SAAUqD,EAAMoB,EAAU4J,EAAOlB,EAAQtB,EAAM3D,GAE9C,GAAIzoB,GAAI4jB,EAAK5jB,EACTssB,EAAO,SACPuB,EAASH,EAAOG,MAEpB,OAAO7I,GAASqG,UACZ9N,KAAM,QAENjH,KAAM,SAAUd,GACZ,GACImT,GAAUrJ,EAAK5e,EAAGyW,EAAM2M,EAAK+F,EAAQrB,EADrC7D,EAAK/jB,IAQT,IALKZ,EAAEwmB,cAAehR,EAAKqU,UACvBrU,EAAKqU,QAAWrU,EAAKqU,SAIpBrU,EAAKqU,OAAS,CAGf,IAFA/F,KAEMpjB,EAAI,EAAG4e,EAAM9J,EAAKqU,OAAOhpB,OAAYye,EAAJ5e,EAASA,IAC5CyW,EAAO3B,EAAKqU,OAAQnpB,GAAIivB,WACxBxY,GAAQ2M,EAAI1c,KAAM+P,EAGjB2M,GAAIjjB,SACLgpB,EAAS,MAAQ/F,EAAIrX,KAAK,KACjBhI,QAAS,KAAM,SACfA,QAAS,MAAO,MAAS,KAGtCkgB,EAAGkF,OAAS,GAAI0C,QAAQ1C,EAAQ,KAQpC,MALAlF,GAAGiL,MAAQ,GAAIhB,GACfjK,EAAG+B,MAAQ/B,EAAGiL,MAAMlJ,MAI0B,UAAzC9lB,KAAK0lB,QAAQ,yBAMlBqC,EAAW/E,EAAK/C,WAChBjgB,KAAKivB,YAAcrH,EAAU,GAAIC,GAAc,eAC/CD,EAAQM,gBACJK,aAAc,SACf,WACCxE,EAAGmL,MAAQtH,EAAQiB,UACnBd,EAASM,YAENN,EAASzH,WAdhB,QAmBJ6O,UAAW,SAAU1D,GACjB,KAAOA,YAAgBqB,IAAU,CAE7B,KAAOrB,YAAgBD,IAAQ,CAC3B,IAAMxrB,KAAKkvB,MACP,KAAM,IAAIne,OAAM,4BAEpB0a,GAAO,GAAID,GAAMxrB,KAAKkvB,MAAOzD,GAGjCA,EAAO,GAAIqB,GAAQrB,GAGvB,MAAOA,IAIX2D,WAAY,SAAU3D,GAClB,GAAI4D,IAAW5D,IAASA,EAAKvW,MAAQlV,KAAKipB,QAGlCyC,EAAKja,KAAMga,EAAK9O,QAAW3c,KAAKipB,OAAOha,KAAMwc,EAAK9O,KAE1D,QAAQ0S,GAkBZC,SAAU,SAAU7D,GAChB,GAAI1H,GAAK/jB,IAKT,OAHAyrB,GAAO1H,EAAGoL,UAAW1D,GAGf1H,EAAGwF,MAAMpiB,QAAS,mBAAoBskB,GAKtC1H,EAAGqL,WAAY3D,IAKrB1H,EAAGiL,MAAMllB,OAAQ2hB,GACjB1H,EAAGwF,MAAMpiB,QAAS,aAAcskB,GACzBA,OANH1H,GAAGwF,MAAMpiB,QAAS,QAAS,gBAAiBskB,GANhD,QAeJjH,QAAS,SAAU8J,GACf,MAAOtuB,MAAKgvB,MAAMxK,QAAS8J,IA0B/B5J,QAAS,SAAUqG,GACf,GAAIhH,GAAK/jB,IAEH+qB,GAAM9qB,SACR8qB,GAAUA,IAGdA,EAAQ3rB,EAAEsJ,IAAKqiB,EAAO,SAAUU,GAC5B,MAAO1H,GAAGuL,SAAU7D,KAGxB1H,EAAGwF,MAAMpiB,QAAS,cAAe4jB,GAE5BhH,EAAG1jB,QAAQkvB,MACZpiB,WAAW,WACP4W,EAAG2B,QAAQ,iBACZ,KAIXG,SAAU,WACN,MAAO7lB,MAAK8lB,OAyBhBlB,WAAY,SAAU6G,EAAMjkB,GACxB,GAAIuc,GAAK/jB,IAETyrB,GAAOA,EAAKzT,GAAKyT,EAAO1H,EAAGiL,MAAMxK,QAASiH,GAE1CzrB,KAAK0lB,QAAS,cAAe+F,GAExBjkB,GACDxH,KAAKgvB,MAAMpK,WAAY6G,IAc/BhH,SAAU,WACN,MAAOzkB,MAAKgvB,MAAMvK,SAASjlB,MAAOQ,KAAKgvB,MAAOvvB,YAGlD+vB,UAAW,WACP,MAAOxvB,MAAKgvB,MAAMT,MAAM/uB,MAAOQ,KAAKgvB,MAAOvvB,YAc/CslB,MAAO,SAAU0G,EAAMgE,GACnB,GACI1E,GAAOjrB,EAAG4e,EADVqF,EAAK/jB,IAGT,IAAKyrB,EAID,MAHAA,GAAOA,EAAKzT,GAAKyT,EAAO1H,EAAGiL,MAAMxK,QAASiH,GAC1CA,EAAK4B,UAAWJ,EAAOS,aACvB+B,GAAgB1L,EAAG2B,QAAQ,gBAQ/B,KAJAqF,EAAQhH,EAAGiL,MAAMvK,SAAUwI,EAAOK,OAClCxtB,EAAI,EACJ4e,EAAMqM,EAAM9qB,OAEAye,EAAJ5e,EAASA,IACb2rB,EAAOV,EAAOjrB,GACd2rB,EAAK4B,UAAWJ,EAAOS,OAG3B3J,GAAG2B,QAAQ,iBASfgK,UAAW,WACP,MAAO1vB,MAAKgvB,MAAMvR,KAAKje,MAAOQ,KAAKgvB,MAAOvvB,YAiB9CgH,MAAO,WACHzG,KAAKupB,MAAMpiB,QAAQ,SACnBnH,KAAKgvB,MAAQ,GAAIhB,GACjBhuB,KAAK8lB,MAAQ9lB,KAAKgvB,MAAMlJ,OAG5BiB,QAAS,WACL/mB,KAAKyG,QACLzG,KAAKivB,aAAejvB,KAAKivB,YAAYlI,eAQjDpH,EAAO,mBACH,WACA,kBACA,kBACD,SAAUyE,EAAU4C,GAMnB,MAJA5C,GAASuL,QAAU,WACf,MAAO3I,GAAQW,WAAWnoB,MAAOwnB,EAASvnB,YAGvC2kB,EAASqG,UACZ9N,KAAM,UAENjH,KAAM,WACF,IAAM1V,KAAKqlB,qBACP,KAAMtU,OAAM,kBAUpBsU,mBAAoB,WAChB,GAEIvlB,GAAG4e,EAFH+I,EAASznB,KAAKK,QAAQkoB,cAAgBvB,EAAQS,OAC9CrgB,EAAOpH,KAAKoH,IAGhB,KAAMA,EAGF,IAFAqgB,EAASA,EAAO9mB,MAAO,YAEjBb,EAAI,EAAG4e,EAAM+I,EAAOxnB,OAAYye,EAAJ5e,EAASA,IACvC,GAAKknB,EAAQW,WAAYF,EAAQ3nB,IAAQ,CACrCE,KAAKoH,KAAOA,EAAOqgB,EAAQ3nB,EAC3B,OAKZ,MAAOsH,QAOnBuY,EAAO,iBACH,OACA,iBACA,YACD,SAAUqD,EAAM6E,EAAe1D,GAI9B,QAASyL,GAAWhb,GAChB,GAAImP,GAAK/jB,IAET4U,GAAOmP,EAAG1jB,QAAUjB,EAAEiR,QAAQ,KAAUuf,EAAUvvB,QAASuU,OAC3DiT,EAAcnW,KAAM1R,KAAM,aAE1BA,KAAK6vB,MAAQ,KACb7vB,KAAK8vB,UAAYlb,EAAKmb,aACtB/vB,KAAKgwB,SAAWpb,EAAKqb,YAErBjwB,KAAKgE,GAAI,WAAYhE,KAAKkwB,UAC1BlwB,KAAKgE,GAAI,aAAc,WACnB+f,EAAG5c,QAAS,WAAY,GACxBgpB,aAAcpM,EAAGqM,UAfzB,GAAIhxB,GAAI4jB,EAAK5jB,CAuHb,OApGAwwB,GAAUvvB,SACNgwB,OAAQ,GACRC,OAAQ,OAGRC,iBAAiB,EACjBC,QAAS,OACTC,QAAS,KACTV,YACAE,WACAS,cAAc,GAGlBtxB,EAAEiR,OAAQuf,EAAUjwB,WAGhBgxB,WAAY,SAAUrT,EAAKsT,EAAMC,GAC7B,GAAI9M,GAAK/jB,KACL4U,EAAOmP,EAAG1jB,OAET0jB,GAAG8E,WACJ9E,EAAG4E,oBAIP5E,EAAGmE,eAAgB0I,EAAK9H,KAAM,WAC1B/E,EAAGtS,KAAK,UAGZsS,EAAG8L,MAAQe,EACXhc,EAAK4b,QAAUlT,GAAO1I,EAAK4b,QAC3B5b,EAAKic,SAAWA,GAAYjc,EAAKic,UAIrC/mB,OAAQ,SAAUwT,EAAKwT,GACC,gBAARxT,GACRle,EAAEiR,OAAQrQ,KAAK8vB,UAAWxS,GAE1Btd,KAAK8vB,UAAWxS,GAAQwT,GAIhCC,iBAAkB,SAAUzT,EAAKwT,GACT,gBAARxT,GACRle,EAAEiR,OAAQrQ,KAAKgwB,SAAU1S,GAEzBtd,KAAKgwB,SAAU1S,GAAQwT,GAI/BE,KAAM,SAAUV,GACZtwB,KAAKyR,KAAM,OAAQ6e,GACnBtwB,KAAKkwB,YAGTe,MAAO,WAEH,MADAd,cAAcnwB,KAAKowB,QACZpwB,KAAKyR,KAAK,UAGrBsV,QAAS,WACL/mB,KAAKmH,QAAQ,WACbnH,KAAK4G,MACL5G,KAAKyR,KAAK,WACVzR,KAAK2oB,qBAGTuI,YAAa,WACT,MAAOlxB,MAAKyR,KAAK,gBAGrB0f,kBAAmB,WACf,MAAOnxB,MAAKyR,KAAK,sBAGrBgc,UAAW,WACP,MAAOztB,MAAKyR,KAAK,cAGrBye,SAAU,WACN,GAAInM,GAAK/jB,KACLoxB,EAAWrN,EAAG1jB,QAAQowB,OAEpBW,KAINjB,aAAcpM,EAAGqM,QACjBrM,EAAGqM,OAASjjB,WAAW,WACnB4W,EAAGkN,QACHlN,EAAG5c,QAAS,QAAS,YACtBiqB,OAMXjN,EAASD,UAAW0L,EAAUjwB,WAEvBiwB,IAKXjQ,EAAO,kBACH,OACA,WACA,OACA,gBACA,kBACD,SAAUqD,EAAMoB,EAAU0I,EAAQ8C,GAqFjC,QAASyB,GAAU5F,EAAM6F,GACrB,GAMI5S,GAAK6S,EANLC,KACAZ,EAAOnF,EAAKL,OACZqG,EAAQb,EAAK1b,KACbwc,EAASJ,EAAYllB,KAAK6Q,KAAMwU,EAAQH,GAAc,EACtDhG,EAAQ,EACRld,EAAQ,CAmBZ,KAhBAmjB,GACI9F,KAAMA,EAENkG,IAAK,WACD,QAASH,EAAQvxB,QAGrBiQ,MAAO,WACH,MAAOshB,GAAQthB,SAGnB0Y,QAAS,SAAUgJ,GACfJ,EAAQ5I,QAASgJ,KAITF,EAARtjB,GACJsQ,EAAMtS,KAAKyD,IAAKyhB,EAAWG,EAAQnG,GAEnCkG,EAAQhrB,MACJilB,KAAMA,EACNH,MAAOA,EACP/e,IAAK+kB,EAAahG,EAAQ5M,EAAO+S,EACjCA,MAAOA,EACPC,OAAQA,EACRG,MAAOzjB,IACP0jB,MAAOP,IAEXjG,GAAS5M,CAMb,OAHA+M,GAAKsG,OAASP,EAAQ1K,SACtB2E,EAAKuG,SAAWR,EAAQvxB,OAEjBsxB,EA9HX,GAAInyB,GAAI4jB,EAAK5jB,EACT+gB,EAAY6C,EAAK7C,UACjB8M,EAASH,EAAOG,MAGpB7tB,GAAEiR,OAAQ+T,EAAS/jB,SAWf4xB,iBAAiB,EAQjBC,SAAS,EAQTZ,UAAW,QAQXa,WAAY,EAQZC,QAAS,EASTrC,cAwEJ3L,EAASqG,UACL9N,KAAM,SAENjH,KAAM,WACF,GAAI6T,GAAQvpB,KAAKupB,MACbxF,EAAK/jB,IAETA,MAAKqyB,QAAS,EACdryB,KAAKsyB,UAAW,EAEhB/I,EACKvlB,GAAI,cAAe,WAChB+f,EAAGuO,UAAW,IAEjBtuB,GAAI,iBAAkB,WACnB+f,EAAGuO,UAAW,IAItBtyB,KAAKuyB,QAGLvyB,KAAKwyB,SAGLxyB,KAAKwxB,WAGLxxB,KAAKgyB,SAAW,EAChBhyB,KAAKyyB,OAASzP,EAAKxC,OAAQxgB,KAAK0yB,MAAO1yB,MAEvCupB,EAAMvlB,GAAI,iBAAkB,SAAUynB,GAGlCA,EAAKsG,QAAU3yB,EAAEyJ,KAAM4iB,EAAKsG,OAAQ,SAAU/R,EAAG/N,GAC7CA,EAAE0gB,YAAc1gB,EAAE0gB,UAAU1B,QAAShf,EAAE0gB,UAAU5L,iBAC1C9U,GAAE0gB,kBAGNlH,GAAKsG,aACLtG,GAAKuG,YAIpBvrB,MAAO,WACHzG,KAAK0lB,QAAS,eAAe,GAC7B1lB,KAAKqyB,QAAS,EACdryB,KAAKuyB,QACLvyB,KAAKwyB,SACLxyB,KAAKwxB,WACLxxB,KAAKgyB,SAAW,EAChBhyB,KAAK4yB,UAAW,EAChB5yB,KAAK6yB,SAAW,MAkBpBC,YAAa,SAASrH,GAClB,GAAI1H,GAAK/jB,IAQT,IALAZ,EAAEyJ,KAAMkb,EAAG2B,QAAS,YAAauH,EAAOc,SAAW,WAC/ChK,EAAG2B,QAAS,cAAe1lB,QAI1ByrB,EAGD,GAFAA,EAAOA,EAAKzT,GAAKyT,EAAO1H,EAAG2B,QAAS,WAAY+F,GAE5CA,EAAKgC,cAAgBR,EAAOa,UAC5B1uB,EAAEyJ,KAAMkb,EAAGwO,KAAM,SAAUvS,EAAG/N,GAGtBA,EAAEwZ,OAASA,GAIfxZ,EAAE0gB,WAAa1gB,EAAE0gB,UAAU3B,SAG/BvF,EAAK4B,UAAWJ,EAAOS,YACpB,CAAA,GAAIjC,EAAKgC,cAAgBR,EAAOU,SACnC,MAEAlC,GAAK4B,UAAWJ,EAAOS,YAG3BtuB,GAAEyJ,KAAMkb,EAAG2B,QAAS,aAAeuH,EAAOC,SAAY,WAClDltB,KAAKqtB,UAAWJ,EAAOS,SAI1B3J,GAAGsO,SAIRtO,EAAGsO,QAAS,EAGZjzB,EAAEyJ,KAAMkb,EAAGwO,KAAM,SAAUvS,EAAG/N,GAC1B,GAAIwZ,GAAOxZ,EAAEwZ,IAERA,GAAKgC,cAAgBR,EAAOa,YAC7BrC,EAAK4B,UAAWJ,EAAOU,UACvB5J,EAAG6O,UAAW,EACd3gB,EAAE0gB,WAAa1gB,EAAE0gB,UAAU3B,UAInCvF,GAAQrsB,EAAEyJ,KAAMkb,EAAG2B,QAAS,YACpBuH,EAAOa,WAAa,WACxB9tB,KAAKqtB,UAAWJ,EAAOU,YAG3B5J,EAAG6O,UAAW,EACd5P,EAAKX,SAAU0B,EAAG0O,QAClB1O,EAAGwF,MAAMpiB,QAAQ,iBAmBrB4rB,WAAY,SAAUtH,EAAMuH,GACxB,GAAIjP,GAAK/jB,IAOT,IALIyrB,KAAS,IACTuH,EAAYvH,EACZA,EAAO,MAGN1H,EAAGsO,UAAW,EAAnB,CAKA,GAAK5G,EAAO,CAGR,GAFAA,EAAOA,EAAKzT,GAAKyT,EAAO1H,EAAG2B,QAAS,WAAY+F,GAE3CA,EAAKgC,cAAgBR,EAAOU,UACzBlC,EAAKgC,cAAgBR,EAAOS,OAChC,MAgBJ,OAbAjC,GAAK4B,UAAWJ,EAAOa,WACvB1uB,EAAEyJ,KAAMkb,EAAGwO,KAAM,SAAUvS,EAAG/N,GAGtBA,EAAEwZ,OAASA,IAIfxZ,EAAE0gB,WAAa1gB,EAAE0gB,UAAU1B,QAC3BlN,EAAGkP,SAAShhB,GACZ8R,EAAGmP,UAAUjhB,MAGV+Q,EAAKX,SAAU0B,EAAG0O,QAG7B1O,EAAGsO,QAAS,EAERryB,KAAK6yB,UAAY7yB,KAAK6yB,SAASpH,MAC/BzrB,KAAK6yB,SAASpH,KAAK4B,UAAWJ,EAAOa,WAGzCkF,GAAa5zB,EAAEyJ,KAAMkb,EAAGwO,KAAM,SAAUvS,EAAG/N,GACvCA,EAAE0gB,WAAa1gB,EAAE0gB,UAAU1B,QAC3Bhf,EAAEwZ,KAAK4B,UAAWJ,EAAOa,aAG7B/J,EAAGwF,MAAMpiB,QAAQ,gBAgBrB0d,WAAY,SAAU4G,GAClBA,EAAOA,EAAKzT,GAAKyT,EAAOzrB,KAAK0lB,QAAS,WAAY+F,GAGlDA,EAAKsG,QAAU3yB,EAAEyJ,KAAM4iB,EAAKsG,OAAQ,SAAU/R,EAAG/N,GAC7C,GAAIkhB,GAAMlhB,EAAE0gB,SAEPQ,KACDA,EAAIlC,QACJkC,EAAIpM,gBACG9U,GAAE0gB,aAIjBlH,EAAK4B,UAAWJ,EAAOY,WACvB7tB,KAAKupB,MAAMpiB,QAAS,eAAgBskB,IASxCzG,aAAc,WACV,QAAShlB,KAAKsyB,UAGlBc,UAAW,WACP,MAAOpzB,MAAK0lB,QAAQ,cASxBZ,SAAU,SAAU2G,EAAM8B,GACtB9B,EAAOA,EAAKzT,GAAKyT,EAAOzrB,KAAK0lB,QAAS,WAAY+F,GAElDA,EAAK4B,UAAWE,GAAUN,EAAOW,UACjCnC,EAAK4H,SAAU,EAGf5H,EAAKsG,QAAU3yB,EAAEyJ,KAAM4iB,EAAKsG,OAAQ,SAAU/R,EAAG/N,GAC7C,GAAIkhB,GAAMlhB,EAAE0gB,SAEPQ,KACDA,EAAIlC,QACJkC,EAAIpM,gBACG9U,GAAE0gB,aAIjB3yB,KAAKupB,MAAMpiB,QAAS,aAAcskB,IAQtCiH,MAAO,WACH,GAEItuB,GAAIkD,EAFJyc,EAAK/jB,KACL4U,EAAOmP,EAAG1jB,OAId,OAAK0jB,GAAG8O,SACG9O,EAAG8O,SAASS,OAAQvP,EAAG0O,aAI7B1O,EAAGwO,KAAKtyB,OAAS2U,EAAKwd,UAAY9qB,EAAMyc,EAAGwP,eAC5CxP,EAAG6O,UAAW,EAEdxuB,EAAK,SAAUkD,GACXyc,EAAG8O,SAAW,KAGdvrB,GAAOA,EAAImkB,MAAQ1H,EAAGyP,WAAYlsB,GAClC0b,EAAKX,SAAU0B,EAAG0O,SAGtB1O,EAAG8O,SAAW1S,EAAW7Y,GAAQA,EAAIgsB,OAAQlvB,GAAOA,EAAIkD,IAG/Cyc,EAAGiO,UAAajO,EAAGqP,YAAY1M,YACvC3C,EAAGqP,YAAYxM,iBAChB7C,EAAGsO,QAAS,EAEZtO,EAAG6O,UAAY5P,EAAKX,SAAS,WACzB0B,EAAGwF,MAAMpiB,QAAQ,oBAErB4c,EAAG6O,UAAW,KAItBK,SAAU,SAASrB,GACf,GAAIpX,EAEJoX,GAAME,MAAMlJ,QAAQgJ,GACpBpX,EAAMxa,KAAKwyB,MAAM5yB,QAAQgyB,EAAME,QAEzBtX,GACFxa,KAAKwyB,MAAM5J,QAAQgJ,EAAME,QAIjC2B,UAAW,WAIP,IAHA,GACIC,GADA5zB,EAAI,EAGC4zB,EAAM1zB,KAAKwyB,MAAO1yB,MAAS,CAChC,GAAK4zB,EAAI/B,OAAS+B,EAAIjI,KAAKgC,cAAgBR,EAAOU,SAC9C,MAAO+F,KACCA,EAAI/B,OACR+B,EAAIjI,KAAKgC,cAAgBR,EAAOU,UAChC+F,EAAIjI,KAAKgC,cAAgBR,EAAOa,YAIpC9tB,KAAKwyB,MAAM5H,SAAU9qB,EAAG,GAIhC,MAAO,OAGXyzB,WAAY,WACR,GAEIG,GAAK5b,EAAMmQ,EAAM0L,EAFjB5P,EAAK/jB,KACL4U,EAAOmP,EAAG1jB,OAId,QAAMqzB,EAAM1zB,KAAKyzB,cAGR7e,EAAKqd,kBAAoBlO,EAAGyN,QAAQvxB,QACrC8jB,EAAG6P,mBAGAF,EAAIxjB,SAGH6T,EAAGsO,SAGLtO,EAAGyN,QAAQvxB,QAAU8jB,EAAGqP,YAAY1M,YACtC3C,EAAG6P,mBAGP9b,EAAOiM,EAAGyN,QAAQthB,QAClB+X,EAAO,SAAUwD,GACb,MAAMA,IAINiI,EAAMrC,EAAU5F,EAAM7W,EAAKsd,QAAUtd,EAAK0c,UAAY,GACtDvN,EAAGyO,MAAMhsB,KAAKktB,GACPA,EAAIxjB,SALA,MASViQ,EAAWrI,IACZ6b,EAAY7b,EAAK2T,KACjB3T,EAAOA,EAAMA,EAAK0S,KAAO,OAAS,QAAUvC,GAC5CnQ,EAAK2T,KAAOkI,EACL7b,GAGJmQ,EAAMnQ,IA1BV,QAqCX8b,iBAAkB,WACd,GAGItT,GAHAyD,EAAK/jB,KACLyrB,EAAO1H,EAAG2B,QAAQ,cAClB8L,EAAUzN,EAAGyN,OAGZ/F,KACDnL,EAAUyD,EAAG2B,QAAS,mBAAoB+F,EAAM,WAG5C,MAAKA,GAAKgC,cAAgBR,EAAOU,UAC7BlC,EAAKgC,cAAgBR,EAAOa,UACrBrC,EAGJ1H,EAAG8P,YAAapI,KAG3B1H,EAAGwF,MAAMpiB,QAAS,cAAeskB,GACjCA,EAAK4B,UAAWJ,EAAOU,UAEvBrN,EAAQmL,KAAOA,EAGfnL,EAAQ2H,KAAK,WACT,GAAIzN,GAAMpb,EAAEuM,QAAS2U,EAASkR,IAE7BhX,GAAOgX,EAAQ5G,OAAQpQ,EAAK,EAAGiR,KAIpCnL,EAAQwT,KAAK,SAAUC,GACnBtI,EAAK4B,UAAWJ,EAAOK,MAAOyG,GAC9BhQ,EAAGwF,MAAMpiB,QAAS,cAAeskB,EAAMsI,GACvChQ,EAAGwF,MAAMpiB,QAAS,iBAAkBskB,KAGxC+F,EAAQhrB,KAAM8Z,KAKtB4S,UAAW,SAAUtB,GACjB,GAAIpX,GAAMpb,EAAEuM,QAASimB,EAAO5xB,KAAKuyB,KAEjCvyB,MAAKuyB,KAAK3H,OAAQpQ,EAAK,GACvBoX,EAAMnG,KAAKuG,WACXhyB,KAAKgyB,YAITwB,WAAY,SAAU5B,GAClB,GAEItR,GAFAyD,EAAK/jB,KACLyrB,EAAOmG,EAAMnG,IAMjB,OAAKA,GAAKgC,cAAgBR,EAAOU,cAGzBlC,EAAKgC,cAAgBR,EAAOa,WAC5B/J,EAAGkP,SAASrB,KAMpB7N,EAAGwO,KAAK/rB,KAAMorB,GACd7N,EAAGiO,WAIHJ,EAAMhB,KAAwB,IAAjBgB,EAAMF,OAAejG,EAAKL,OAC/BK,EAAKL,OAAO1e,MAAOklB,EAAMtG,MAAOsG,EAAMrlB,KAG9C+T,EAAUyD,EAAG2B,QAAS,cAAekM,EAAO,WAGnCnG,EAAKgC,cAAgBR,EAAOU,SAC7B5J,EAAGiQ,QAASpC,IAEZ7N,EAAGmP,UAAWtB,GACd5O,EAAKX,SAAU0B,EAAG0O,eAK1BnS,GAAQwT,KAAK,WACc,IAAlBrI,EAAKuG,SACNjO,EAAG8P,YAAapI,GAAO6H,OAAO,WAC1B1B,EAAMqC,WAAa,EACnBlQ,EAAGmP,UAAWtB,GACd7N,EAAGwF,MAAMpiB,QAAS,iBAAkBskB,GACpCzI,EAAKX,SAAU0B,EAAG0O,WAGtBb,EAAMqC,WAAa,EACnBlQ,EAAGmP,UAAWtB,GACd5O,EAAKX,SAAU0B,EAAG0O,aAwD9BuB,QAAS,SAAUpC,GACf,GAOIsC,GAAe/S,EAPf4C,EAAK/jB,KACLupB,EAAQxF,EAAGwF,MACX3U,EAAOmP,EAAG1jB,QACVorB,EAAOmG,EAAMnG,KACb0I,EAAK,GAAIvE,GAAWhb,GACpBnU,EAAOrB,EAAEiR,UAAWuE,EAAKmb,UACzBE,EAAU7wB,EAAEiR,UAAWuE,EAAKqb,QAGhC2B,GAAMe,UAAYwB,EAElBA,EAAGnwB,GAAI,UAAW,iBACP4tB,GAAMe,UACb5O,EAAGmP,UAAWtB,GACd5O,EAAKX,SAAU0B,EAAG0O,UAItB0B,EAAGnwB,GAAI,WAAY,SAAUiwB,GACzB,GAAIG,GAAe,EACfC,EAAW,CAOfD,GAAexC,EAAMqC,WAAaA,EAE7BrC,EAAMF,OAAS,IAChBtyB,EAAEyJ,KAAM4iB,EAAKsG,OAAQ,SAAU/R,EAAG/N,GAC9BoiB,IAAapiB,EAAEgiB,YAAc,IAAMhiB,EAAE1F,IAAM0F,EAAEqZ,SAGjD8I,EAAeC,EAAW5I,EAAKvW,MAGnCqU,EAAMpiB,QAAS,iBAAkBskB,EAAM2I,GAAgB,KAI3DF,EAAgB,SAAUI,GACtB,GAAIlwB,EAaJ,OAXA+c,GAAMgT,EAAGhD,wBACThQ,EAAIoT,KAAOJ,EAAGjD,cACd9sB,EAAK,SAAU0sB,GACXwD,EAASxD,GAIPvH,EAAMpiB,QAAS,eAAgByqB,EAAOzQ,EAAK/c,KAC7CkwB,EAASA,GAAU,UAGhBA,GAIXH,EAAGnwB,GAAI,QAAS,SAAUoD,EAAMotB,GAC5B5C,EAAM6C,QAAU7C,EAAM6C,SAAW,EAG5B7C,EAAMF,OAAS,IAAM,aAAa9xB,QAASwH,IACxCwqB,EAAM6C,QAAU7f,EAAKud,YAEzBP,EAAM6C,UACNN,EAAGnD,SAKGwD,GAAiB,WAATptB,IACVA,EAAO8sB,EAAe9sB,IAG1BqkB,EAAK4B,UAAWJ,EAAOK,MAAOlmB,GAC9BmiB,EAAMpiB,QAAS,cAAeskB,EAAMrkB,GACpCmiB,EAAMpiB,QAAS,iBAAkBskB,MAKzC0I,EAAGnwB,GAAI,OAAQ,WACX,GAAI+vB,EAGJ,QAAMA,EAASG,SACXC,GAAGhtB,QAAS,QAAS4sB,GAAQ,QAKV,IAAlBtI,EAAKuG,SACNjO,EAAG8P,YAAapI,EAAMtK,GAEtBgT,EAAGpN,aAKXtmB,EAAOrB,EAAEiR,OAAQ5P,GACbuX,GAAIyT,EAAKzT,GACT2E,KAAM8O,EAAK9O,KACXvV,KAAMqkB,EAAKrkB,KACXwkB,iBAAkBH,EAAKG,iBACvB1W,KAAMuW,EAAKvW,OAGf0c,EAAMF,OAAS,GAAKtyB,EAAEiR,OAAQ5P,GAC1BixB,OAAQE,EAAMF,OACdG,MAAOD,EAAMC,QAKjBtI,EAAMpiB,QAAS,mBAAoByqB,EAAOnxB,EAAMwvB,GAGhDkE,EAAGxD,WAAY/b,EAAK4b,QAASoB,EAAMhB,KAAMnF,EAAK9O,MAC9CwX,EAAGrqB,OAAQrJ,GACX0zB,EAAGpD,iBAAkBd,GACrBkE,EAAGnD,QAIP6C,YAAa,SAAUpI,EAAMtK,EAAKuT,GAC9B,GAAInL,GAAQvpB,KAAKupB,KAEjB,OAAOA,GACE7D,QAAS,kBAAmBjmB,UAAW,WACpCgsB,EAAK4B,UAAWJ,EAAOW,UACvBrE,EAAMpiB,QAAS,gBAAiBskB,EAAMtK,EAAKuT,KAE9CZ,KAAK,SAAUC,GAGPtI,EAAKgC,cAAgBR,EAAOU,UAC7BlC,EAAK4B,UAAWJ,EAAOK,MAAOyG,GAGlCxK,EAAMpiB,QAAS,cAAeskB,EAAMsI,KAEvCT,OAAO,WACJ/J,EAAMpiB,QAAS,iBAAkBskB,UAUzD9L,EAAO,qBACH,OACA,WACA,OACA,kBACD,SAAUqD,EAAMoB,EAAU0I,GAEzB,GAEIyE,GAFAnyB,EAAI4jB,EAAK5jB,EACTu1B,IAsNJ,OAvMApD,IAGIqD,aAAc,SAAUxtB,EAAMkb,GAC1BqS,EAAYvtB,GAASkb,GAIzBuS,gBAAiB,SAAUztB,SAChButB,GAAYvtB,KAK3Bgd,EAASqG,UACL9N,KAAM,YAENjH,KAAM,WACF,GAAIqO,GAAK/jB,IACTgjB,GAAKX,SAAS,WACVjjB,EAAEyJ,KAAM8rB,EAAY,WAChB30B,KAAK0R,KAAMqS,EAAGwF,cAY9BgI,EAAIqD,aAAc,eAAgB,WAC9B,GAAItL,GAAWtpB,KACX4U,EAAO0U,EAASjpB,QAChBy0B,EAAQ,EACRllB,EAAMjH,SAAUiM,EAAKmgB,aAAc,IACnCP,GAAO,CAEL5kB,KAIN0Z,EAAStlB,GAAI,mBAAoB,SAAUynB,GAUvC,MARKqJ,IAASllB,GAAO4kB,IACjBA,GAAO,EACPx0B,KAAKmH,QAAS,QAAS,qBAAsByI,EAAK6b,GAClDte,WAAW,WACPqnB,GAAO,GACR,IAGAM,GAASllB,GAAM,GAAQ,IAGlC0Z,EAAStlB,GAAI,aAAc,WACvB8wB,MAGJxL,EAAStlB,GAAI,eAAgB,WACzB8wB,MAGJxL,EAAStlB,GAAI,QAAS,WAClB8wB,EAAQ,OAWhBvD,EAAIqD,aAAc,gBAAiB,WAC/B,GAAItL,GAAWtpB,KACX4U,EAAO0U,EAASjpB,QAChBy0B,EAAQ,EACRllB,EAAMjH,SAAUiM,EAAKogB,cAAe,IACpCR,GAAO,CAEL5kB,KAIN0Z,EAAStlB,GAAI,mBAAoB,SAAUynB,GACvC,GAAI4D,GAAUyF,EAAQrJ,EAAKvW,KAAOtF,CAUlC,OARKyf,IAAWmF,IACZA,GAAO,EACPx0B,KAAKmH,QAAS,QAAS,sBAAuByI,EAAK6b,GACnDte,WAAW,WACPqnB,GAAO,GACR,IAGAnF,GAAU,GAAQ,IAG7B/F,EAAStlB,GAAI,aAAc,SAAUynB,GACjCqJ,GAASrJ,EAAKvW,OAGlBoU,EAAStlB,GAAI,eAAgB,SAAUynB,GACnCqJ,GAASrJ,EAAKvW,OAGlBoU,EAAStlB,GAAI,QAAS,WAClB8wB,EAAQ,OAUhBvD,EAAIqD,aAAc,sBAAuB,WACrC,GAAItL,GAAWtpB,KACX4U,EAAO0U,EAASjpB,QAChBuP,EAAMgF,EAAKqgB,mBAETrlB,IAIN0Z,EAAStlB,GAAI,mBAAoB,SAAUynB,GAEvC,MAAKA,GAAKvW,KAAOtF,GACb6b,EAAK4B,UAAWP,EAAOG,OAAOc,QAAS,eACvC/tB,KAAKmH,QAAS,QAAS,gBAAiByI,EAAK6b,IACtC,GAHX,WAgBR8F,EAAIqD,aAAc,YAAa,WAS3B,QAASM,GAAYtZ,GAMjB,IALA,GAGIuZ,GAHAC,EAAO,EACPt1B,EAAI,EACJ4e,EAAM9C,EAAI3b,OAGFye,EAAJ5e,EAASA,IACbq1B,EAAQvZ,EAAIyZ,WAAYv1B,GACxBs1B,EAAOD,GAASC,GAAQ,IAAMA,GAAQ,IAAMA,CAGhD,OAAOA,GAnBX,GAAI9L,GAAWtpB,KACX4U,EAAO0U,EAASjpB,QAChBi1B,IAEC1gB,GAAK2gB,YAkBVjM,EAAStlB,GAAI,mBAAoB,SAAUynB,GACvC,GAAI2J,GAAO3J,EAAK+J,SAAW/J,EAAK+J,OAASN,EAAYzJ,EAAK9O,KAClD8O,EAAKvW,KAAOuW,EAAKG,kBAGzB,OAAK0J,GAASF,IACVp1B,KAAKmH,QAAS,QAAS,cAAeskB,IAC/B,GAFX,SAMJnC,EAAStlB,GAAI,aAAc,SAAUynB,GACjC,GAAI2J,GAAO3J,EAAK+J,MAEhBJ,KAASE,EAASF,IAAS,KAG/B9L,EAAStlB,GAAI,eAAgB,SAAUynB,GACnC,GAAI2J,GAAO3J,EAAK+J,MAEhBJ,UAAgBE,GAASF,KAG7B9L,EAAStlB,GAAI,QAAS,WAClBsxB,UAID/D,IAMX5R,EAAO,sBAAsB,WAEzB,QAAS8V,GAAUlM,EAAO3B,GAEtB5nB,KAAKupB,MAAQA,EACbvpB,KAAKK,QAAUkpB,EAAMlpB,QAErBL,KAAK0oB,WAAa,WACd,MAAOd,IAGX5nB,KAAK6oB,QAAU,WACX,MAAOjB,GAAQX,KAGnBjnB,KAAKmH,QAAU,WACX,MAAOoiB,GAAMpiB,QAAQ3H,MAAO+pB,EAAO9pB,YAI3C,MAAOg2B,KAKX9V,EAAO,yBACH,OACA,kBACA,oBACD,SAAUqD,EAAMgE,EAASyO,GAKxB,QAASC,KACL,GAAInD,MACAxO,EAAK/jB,KACL+mB,EAAU/mB,KAAK+mB,OAEnBC,GAAQxnB,MAAOukB,EAAItkB,WACnBskB,EAAG3c,KAAOA,EAIV2c,EAAGtS,KAAO,SAAUkkB,EAAMvxB,GACtB,GAGIwxB,GAHAC,EAAS71B,KACTinB,EAAM4O,EAAO5O,IACbhX,EAAO+S,EAAKtW,MAAOjN,UAAW,EAGlC,OAAKq2B,GAAYH,KACbC,EAAWrD,EAAMtL,GAAQsL,EAAMtL,IACvB,GAAI6O,GAAYH,GAAQE,EAAQ9R,GAEnC6R,EAAUxxB,IACJwxB,EAAUxxB,GAAK5E,MAAOo2B,EAAU3lB,GAL/C,QAUJ8T,EAAGgD,QAAU,WAET,MAAOA,IAAWA,EAAQvnB,MAAOQ,KAAMP,YA/B/C,GAAI2H,GAAO,QACP0uB,IA2DJ,OAzBA9S,GAAKjB,SAAUiF,GACX9gB,YAAawvB,EAGbhgB,KAAM,WACF,GAAIqO,GAAK/jB,IACTmN,YAAW,WACP4W,EAAG5c,QAAQ,UACZ,MAMXuuB,EAAajL,SAAW,SAAU9N,EAAMlb,GACpC,GAAIyoB,GAAQ4L,EAAYnZ,GAASqG,EAAKjB,SAAU0T,EAAUh0B,EAC1D,OAAOyoB,IAKNljB,EAAOmkB,MAAQnkB,EAAO+uB,YAAc/uB,EAAOgvB,UAC5ChP,EAAQU,WAAYtgB,EAAMsuB,GAGvBA,IAKX/V,EAAO,sBACH,wBACA,YACD,SAAU+V,EAAcvK,GAEvB,MAAOuK,GAAajL,SAAU,QAC1B/d,MAAO,SAAU4e,EAAO/e,GACpB,GAAIqkB,GAAO5wB,KAAKupB,MAAM6B,OAClB1e,EAAQkkB,EAAKlkB,OAASkkB,EAAKqF,aAAerF,EAAKsF,QAInD,OAFAtF,GAAOlkB,EAAMgF,KAAMkf,EAAMtF,EAAO/e,GAEzB,GAAI4e,GAAMnrB,KAAK6oB,UAAW+H,QAO7CjR,EAAO,qBACH,OACA,wBACA,YACD,SAAUqD,EAAM0S,EAAclK,GAE7B,GAAIpsB,GAAI4jB,EAAK5jB,EACTqjB,EAAS,kBAEb,OAAOiT,GAAajL,SAAU,eAC1B/U,KAAM,WACF,GAAIygB,GAAOn2B,KAAKm2B,KAAOn2B,KAAKK,QAAQE,SAEpCP,MAAKo2B,iBAAmBpT,EAAKxC,OAAQxgB,KAAKq2B,kBAAmBr2B,MAC7DA,KAAKs2B,gBAAkBtT,EAAKxC,OAAQxgB,KAAKu2B,iBAAkBv2B,MAC3DA,KAAKw2B,iBAAmBxT,EAAKxC,OAAQxgB,KAAKy2B,kBAAmBz2B,MAC7DA,KAAK02B,YAAc1T,EAAKxC,OAAQxgB,KAAK22B,aAAc32B,MACnDA,KAAK42B,SAAU,EAEfT,EAAKnyB,GAAI,YAAahE,KAAKo2B,kBAC3BD,EAAKnyB,GAAI,WAAYhE,KAAKs2B,iBAC1BH,EAAKnyB,GAAI,YAAahE,KAAKw2B,kBAC3BL,EAAKnyB,GAAI,OAAQhE,KAAK02B,aAEjB12B,KAAKK,QAAQ6oB,mBACd9pB,EAAGuF,UAAWX,GAAI,WAAYhE,KAAKs2B,iBACnCl3B,EAAGuF,UAAWX,GAAI,OAAQhE,KAAK02B,eAIvCL,kBAAmB,SAAU3zB,GACzB,GAEIsoB,GAFAjH,EAAK/jB,KACL62B,EAAS9S,EAAG+S,UAAW,CAsB3B,OAnBAp0B,GAAIA,EAAEqK,eAAiBrK,EAEjBqhB,EAAG6S,UACL7S,EAAG6S,SAAU,EAGb5L,EAAQtoB,EAAEq0B,aAAa/L,MAElBA,GAASA,EAAM/qB,SAChB8jB,EAAG+S,QAAUD,GAAU9S,EAAG5c,QAAS,SAAU6jB,IAGjDjH,EAAGoS,KAAK3xB,SAAUie,EAAS,QAC3BsB,EAAGoS,KAAMU,EAAS,WACV,eAAiBpU,EAAS,WAGtC/f,EAAEq0B,aAAaC,WAAaH,EAAS,OAAS,QAEvC,GAGXN,iBAAkB,SAAU7zB,GAExB,GAAIu0B,GAAaj3B,KAAKm2B,KAAKz0B,SAASyT,IAAK,EACzC,OAAK8hB,KAAe73B,EAAE83B,SAAUD,EAAYv0B,EAAE4Y,gBACnC,GAGX6U,aAAcnwB,KAAKm3B,aACnBn3B,KAAKq2B,kBAAkB3kB,KAAM1R,KAAM0C,IAE5B,IAGX+zB,kBAAmB,WACf,GACIrT,GADAW,EAAK/jB,IAUT,OAPAojB,GAAU,WACNW,EAAG6S,SAAU,EACb7S,EAAGoS,KAAK3pB,YAAaiW,EAAS,QAAUA,EAAS,WAGrD0N,aAAcpM,EAAGoT,aACjBpT,EAAGoT,YAAchqB,WAAYiW,EAAS,MAC/B,GAGXuT,aAAc,SAAUj0B,GACpB,GAGIq0B,GAAct2B,EAHdsjB,EAAK/jB,KACL8oB,EAAO/E,EAAG8E,UACVoO,EAAalT,EAAGoS,KAAKz0B,SAASyT,IAAK,EAIvC,IAAK8hB,IAAe73B,EAAE83B,SAAUD,EAAYv0B,EAAE4Y,eAC1C,OAAO,CAGX5Y,GAAIA,EAAEqK,eAAiBrK,EACvBq0B,EAAer0B,EAAEq0B,YAIjB,KACIt2B,EAAOs2B,EAAaK,QAAQ,aAC9B,MAAOC,IAGT,MAAK52B,GAAL,QAIAsjB,EAAGuT,iBAAkBP,EAAc,SAAUQ,GACzCxT,EAAG5c,QAAS,OAAQ/H,EAAEsJ,IAAK6uB,EAAS,SAAU9L,GAC1C,MAAO,IAAID,GAAM1C,EAAM2C,QAI/B1H,EAAG6S,SAAU,EACb7S,EAAGoS,KAAK3pB,YAAaiW,EAAS,SACvB,IAIX6U,iBAAkB,SAAUP,EAActY,GACtC,GAEIuM,GAAOD,EAAOU,EAAMlV,EAAMzW,EAAG4e,EAAK8Y,EAFlCD,KACA9K,IAQJ,KALAzB,EAAQ+L,EAAa/L,MACrBD,EAAQgM,EAAahM,MAErByM,KAAqBxM,IAASA,EAAO,GAAIyM,kBAEnC33B,EAAI,EAAG4e,EAAMqM,EAAM9qB,OAAYye,EAAJ5e,EAASA,IACtC2rB,EAAOV,EAAOjrB,GACdyW,EAAOyU,GAASA,EAAOlrB,GAElB03B,GAAmBjhB,EAAKkhB,mBAAmBC,YAE5CjL,EAASjmB,KAAMxG,KAAK23B,uBACZphB,EAAKkhB,mBAAoBF,IAEjCA,EAAQ/wB,KAAMilB,EAItBzI,GAAK9C,KAAK1gB,MAAOwjB,EAAMyJ,GAAWxE,KAAK,WAE7BsP,EAAQt3B,QAIdwe,EAAU8Y,MAIlBI,uBAAwB,SAAUC,EAAOL,GACrC,GAAIxP,GAAW/E,EAAK/C,WAChB8D,EAAK/jB,IA0BT,OAxBK43B,GAAMC,OACPD,EAAMnM,KAAK,SAAUA,GACjB8L,EAAQ/wB,KAAMilB,GACd1D,EAASM,YAELuP,EAAMF,aACdE,EAAME,eAAeC,YAAY,SAAUC,GACvC,GAGIl4B,GAHA4e,EAAMsZ,EAAQ/3B,OACdwsB,KACAvJ,IAGJ,KAAMpjB,EAAI,EAAO4e,EAAJ5e,EAASA,IAClB2sB,EAASjmB,KAAMud,EAAG4T,uBACVK,EAASl4B,GAAKojB,GAG1BF,GAAK9C,KAAK1gB,MAAOwjB,EAAMyJ,GAAWpM,KAAK,WACnCkX,EAAQ/wB,KAAKhH,MAAO+3B,EAASrU,GAC7B6E,EAASM,WACVN,EAASuM,UAIbvM,EAASzH,WAGpByG,QAAS,WACL,GAAIoP,GAAOn2B,KAAKm2B,IAGXA,KAILA,EAAKvvB,IAAK,YAAa5G,KAAKo2B,kBAC5BD,EAAKvvB,IAAK,WAAY5G,KAAKs2B,iBAC3BH,EAAKvvB,IAAK,YAAa5G,KAAKw2B,kBAC5BL,EAAKvvB,IAAK,OAAQ5G,KAAK02B,aAElB12B,KAAKK,QAAQ6oB,mBACd9pB,EAAGuF,UAAWiC,IAAK,WAAY5G,KAAKs2B,iBACpCl3B,EAAGuF,UAAWiC,IAAK,OAAQ5G,KAAK02B,oBAShD/W,EAAO,2BACH,OACA,wBACA,YACD,SAAUqD,EAAM0S,EAAclK,GAE7B,MAAOkK,GAAajL,SAAU,aAC1B/U,KAAM,WACF,GAGIwN,GAAKpjB,EAAG4e,EAAKnI,EAHb3B,EAAO5U,KAAKK,QACZ81B,EAAOn2B,KAAKm2B,KAAOvhB,EAAKrU,UACxB0oB,EAAS,IAIb,IAAKrU,EAAKqU,OAAS,CAGf,IAFA/F,KAEMpjB,EAAI,EAAG4e,EAAM9J,EAAKqU,OAAOhpB,OAAYye,EAAJ5e,EAASA,IAC5CyW,EAAO3B,EAAKqU,OAAQnpB,GAAIm4B,UACxB1hB,GAAQ2M,EAAI1c,KAAM+P,EAGjB2M,GAAIjjB,SACLgpB,EAAS/F,EAAIrX,KAAK,KAClBod,EAASA,EAAOplB,QAAS,KAAM,KAAMA,QAAS,MAAO,OAG7D7D,KAAKipB,OAASA,EAAS,GAAI0C,QAAQ1C,EAAQ,KAC3CjpB,KAAKk4B,OAASlV,EAAKxC,OAAQxgB,KAAKm4B,aAAcn4B,MAC9Cm2B,EAAKnyB,GAAI,QAAShE,KAAKk4B,SAG3BC,aAAc,SAAUz1B,GACpB,GAEIsoB,GAAOzU,EAAMqa,EAAM9wB,EAAG4e,EAFtB0Z,KACAtP,EAAO9oB,KAAK6oB,SAMhB,KAHAnmB,EAAIA,EAAEqK,eAAiBrK,EACvBsoB,EAAQtoB,EAAE21B,cAAcrN,MAElBlrB,EAAI,EAAG4e,EAAMsM,EAAM/qB,OAAYye,EAAJ5e,EAASA,IACtCyW,EAAOyU,EAAOlrB,GAEK,SAAdyW,EAAK+hB,OAAqB1H,EAAOra,EAAKgiB,cAI3CH,EAAQ5xB,KAAM,GAAIglB,GAAM1C,EAAM8H,GAG7BwH,GAAQn4B,SAETyC,EAAEwE,iBACFxE,EAAEuE,kBACFjH,KAAKmH,QAAS,QAASixB,KAI/BrR,QAAS,WACL/mB,KAAKm2B,KAAKvvB,IAAK,QAAS5G,KAAKk4B,aAQzCvY,EAAO,4BACH,OACA,yBACD,SAAUqD,EAAM0S,GAEf,GAAIt2B,GAAI4jB,EAAK5jB,CAEb,OAAOs2B,GAAajL,SAAU,cAC1B/U,KAAM,WACF,GAMIwN,GAAKpjB,EAAG4e,EAAK8Z,EANbj4B,EAAYP,KAAK0oB,aAAatB,eAC9BrD,EAAK/jB,KACLupB,EAAQxF,EAAGwF,MACX3U,EAAOmP,EAAG1jB,QACV2rB,EAAQhsB,KAAKgsB,MAAQ5sB,EAAGuF,SAAS2iB,cAAc,UAC/CmR,EAASz4B,KAAKy4B,MAAQr5B,EAAGuF,SAAS2iB,cAAc,SAyBpD,IAtBAmR,EAAM1iB,KAAM,OAAQ,QACpB0iB,EAAM1iB,KAAM,OAAQnB,EAAK+H,MACzB8b,EAAMj0B,SAAS,iCAEfwnB,EAAMhoB,GAAI,QAAS,WACfy0B,EAAMtxB,QAAQ,WAGlB6kB,EAAMjjB,KACFoP,QAAS,EACTT,MAAO,OACP7Q,OAAQ,OACR6xB,QAAS,QACTpiB,OAAQ,UACRqiB,WAAY,YAGX/jB,EAAKqX,UACNwM,EAAM1iB,KAAM,WAAY,YAIvBnB,EAAKqU,QAAUrU,EAAKqU,OAAOhpB,OAAS,EAAI,CAGzC,IAFAijB,KAEMpjB,EAAI,EAAG4e,EAAM9J,EAAKqU,OAAOhpB,OAAYye,EAAJ5e,EAASA,IAC5CojB,EAAI1c,KAAMoO,EAAKqU,OAAQnpB,GAAIm4B,UAG/BQ,GAAM1iB,KAAM,SAAUmN,EAAIrX,KAAK,MAGnCtL,EAAUuJ,OAAQ2uB,GAClBl4B,EAAUuJ,OAAQkiB,GAElBwM,EAAe,SAAU91B,GACrB6mB,EAAMpiB,QAASzE,EAAE0E,OAGrBqxB,EAAMz0B,GAAI,SAAU,SAAUtB,GAC1B,GACIiV,GADAvT,EAAK3E,UAAUm5B,MAGnB7U,GAAGgH,MAAQroB,EAAEC,OAAOooB,MAGpBpT,EAAQ3X,KAAK64B,WAAW,GACxBlhB,EAAMmZ,MAAQ,KACd9wB,KAAK2W,WAAWmiB,aAAcnhB,EAAO3X,MAErCy4B,EAAM7xB,MACN6xB,EAAQr5B,EAAGuY,GAAQ3T,GAAI,SAAUI,GACxBJ,GAAI,wBAAyBw0B,GAEtCjP,EAAMpiB,QAAQ,YAGlB6kB,EAAMhoB,GAAI,wBAAyBw0B,IAKvC/T,SAAU,WACN,MAAOzkB,MAAK+qB,OAGhBhE,QAAS,WACL/mB,KAAKy4B,MAAM7xB,MACX5G,KAAKgsB,MAAMplB,WAUvB+Y,EAAO,2BACH,OACA,yBACD,SAAUqD,EAAM0S,GAEf,GAAI3U,GAAOiC,EAAKjC,KACZ3hB,EAAI4jB,EAAK5jB,CAEb,OAAOs2B,GAAajL,SAAU,aAC1B/U,KAAM,WACF1V,KAAK+4B,QAAU,EACf/4B,KAAKg5B,UAAY,MAGrBhI,KAAM,WACF,GAKIjB,GAAUkJ,EAAQC,EALlB3P,EAAQvpB,KAAKupB,MACb3U,EAAO5U,KAAKK,QACZ84B,EAAMn5B,KAAKo5B,YACXxI,EAAOrH,EAAMsG,MACbQ,EAASzb,EAAKyb,MAGbzb,GAAK8b,cACNL,IAAW,KAAKphB,KAAMohB,GAAW,IAAM,KAC/BjxB,EAAEi6B,MAAO9P,EAAMuG,WAEvBmJ,EAASrI,EAAKrF,cAEdwE,EAAW,GAAIuJ,UACfl6B,EAAEyJ,KAAM0gB,EAAMuG,UAAW,SAAUyJ,EAAGtnB,GAClC8d,EAASjmB,OAAQyvB,EAAGtnB,KAGxB8d,EAASjmB,OAAQ8K,EAAK4b,QAASI,EAAKrF,YAC5B3W,EAAKic,UAAYtH,EAAMuG,UAAUnT,MAAQ,KAGhD/H,EAAK2b,iBAAmB,mBAAqB4I,IAC9CA,EAAIle,KAAMrG,EAAK0b,OAAQD,GAAQ,GAC/B8I,EAAI5I,iBAAkB,GAEtB4I,EAAIle,KAAMrG,EAAK0b,OAAQD,GAG3BrwB,KAAKw5B,kBAAmBL,EAAKvkB,EAAKqb,SAE7BgJ,GAEDE,EAAIM,kBACIN,EAAIM,iBAAiB,4BAMxBzW,EAAKpB,GAAGC,SACTqX,EAAK,GAAInD,YAETmD,EAAGQ,OAAS,WACRP,EAAInI,KAAMhxB,KAAK25B,QACfT,EAAKA,EAAGQ,OAAS,MAGrBR,EAAGU,kBAAmBX,IAEtBE,EAAInI,KAAMiI,IAGdE,EAAInI,KAAMjB,IAIlBmB,YAAa,WACT,MAAOlxB,MAAKg5B,WAGhB7H,kBAAmB,WACf,MAAOnxB,MAAK65B,WAAY75B,KAAKg5B,YAGjCvL,UAAW,WACP,MAAOztB,MAAK+4B,SAGhB9H,MAAO,WACH,GAAIkI,GAAMn5B,KAAK85B,IAEVX,KACDA,EAAI7U,OAAOyV,WAAahZ,EACxBoY,EAAIa,mBAAqBjZ,EACzBoY,EAAIlI,QAEJjxB,KAAK85B,KAAOX,EAAM,OAI1BpS,QAAS,WACL/mB,KAAKixB,SAGTmI,UAAW,WACP,GAAIrV,GAAK/jB,KACLm5B,EAAM,GAAIc,gBACVrlB,EAAO5U,KAAKK,OAyChB,QAvCKuU,EAAK2b,iBAAqB,mBAAqB4I,IAClB,mBAAnBe,kBACXf,EAAM,GAAIe,iBAGdf,EAAI7U,OAAOyV,WAAa,SAAUr3B,GAC9B,GAAIuxB,GAAa,CAMjB,OAJKvxB,GAAEy3B,mBACHlG,EAAavxB,EAAEyqB,OAASzqB,EAAE+uB,OAGvB1N,EAAG5c,QAAS,WAAY8sB,IAGnCkF,EAAIa,mBAAqB,WAErB,MAAwB,KAAnBb,EAAIiB,YAITjB,EAAI7U,OAAOyV,WAAahZ,EACxBoY,EAAIa,mBAAqBjZ,EACzBgD,EAAG+V,KAAO,KACV/V,EAAGgV,QAAUI,EAAI5L,OAEZ4L,EAAI5L,QAAU,KAAO4L,EAAI5L,OAAS,KACnCxJ,EAAGiV,UAAYG,EAAIkB,aACZtW,EAAG5c,QAAQ,SACVgyB,EAAI5L,QAAU,KAAO4L,EAAI5L,OAAS,KAC1CxJ,EAAGiV,UAAYG,EAAIkB,aACZtW,EAAG5c,QAAS,QAAS,WAIzB4c,EAAG5c,QAAS,QAAS4c,EAAGgV,QAAU,OAAS,UAlBlD,QAqBJhV,EAAG+V,KAAOX,EACHA,GAGXK,kBAAmB,SAAUL,EAAKlJ,GAC9B7wB,EAAEyJ,KAAMonB,EAAS,SAAU3S,EAAKhW,GAC5B6xB,EAAIpI,iBAAkBzT,EAAKhW,MAInCuyB,WAAY,SAAUje,GAClB,GAAI0e,EAEJ,KACIA,EAAOC,KAAKC,MAAO5e,GACrB,MAAQ6e,GACNH,KAGJ,MAAOA,QAOnB3a,EAAO,yBACH,OACA,kBACA,oBACD,SAAUqD,EAAMgE,EAASyO,GAOxB,QAASiF,KACL,GAAIzZ,EAEJ,KACIA,EAAUS,UAAUiZ,QAAS,mBAC7B1Z,EAAUA,EAAQ2Z,YACpB,MAAQH,GACN,IACIxZ,EAAU,GAAI4Z,eAAc,iCACnBC,YAAY,YACvB,MAAQC,GACN9Z,EAAU,OAIlB,MADAA,GAAUA,EAAQ7P,MAAO,QAClBqQ,WAAYR,EAAS,GAAM,IAAMA,EAAS,GAAK,IAG1D,QAAS+Z,KAmCL,QAAS5X,GAAS6X,EAAK5d,GACnB,GACIlM,GAAO8V,EADP7f,EAAO6zB,EAAI7zB,MAAQ6zB,CAGvB9pB,GAAQ/J,EAAKzG,MAAM,MACnBsmB,EAAM9V,EAAO,GACb/J,EAAO+J,EAAO,GAIA,UAAT/J,GAAoB6f,IAAQlD,EAAGkD,IAChClD,EAAG5c,QAAQ,SACH+zB,EAASjU,IACjBiU,EAASjU,GAAM9f,QAASC,EAAKiG,cAAe4tB,EAAK5d,GA/CzD,GAAIkV,MACA2I,KACAnU,EAAU/mB,KAAK+mB,QACfhD,EAAK/jB,KACLm7B,EAAYnY,EAAKT,KAAK,eAE1ByE,GAAQxnB,MAAOukB,EAAItkB,WACnBskB,EAAG3c,KAAOA,EAIV2c,EAAGtS,KAAO,SAAUkkB,EAAMvxB,GACtB,GAGIwxB,GAHAC,EAAS71B,KACTinB,EAAM4O,EAAO5O,IACbhX,EAAO+S,EAAKtW,MAAOjN,UAAW,EAKlC,OAFAy7B,GAASjU,GAAQ4O,EAEZC,EAAYH,KACPpD,EAAMtL,KACRsL,EAAMtL,GAAQ,GAAI6O,GAAYH,GAAQE,EAAQ9R,IAGlD6R,EAAWrD,EAAMtL,GAEZ2O,EAAUxxB,IACJwxB,EAAUxxB,GAAK5E,MAAOo2B,EAAU3lB,GAIxC8T,EAAGqX,UAAU57B,MAAOq2B,EAAQp2B,YAuBvCuH,EAAQm0B,GAAc,WAClB,GAAIlrB,GAAOxQ,SAGX0N,YAAW,WACPiW,EAAQ5jB,MAAO,KAAMyQ,IACtB,IAGPjQ,KAAKm7B,UAAYA,EAEjBn7B,KAAK+mB,QAAU,WAEX,MAAOA,IAAWA,EAAQvnB,MAAOQ,KAAMP,YAG3CO,KAAKo7B,UAAY,SAAUzF,EAAMvxB,GAC7B,GAAIi3B,GAAQtX,EAAGuX,WACXrrB,EAAO+S,EAAKtW,MAAOjN,UAAW,EAElC,OAAO47B,GAAM5pB,KAAMzR,KAAKinB,IAAK0O,EAAMvxB,EAAI6L,IAlG/C,GAAI7Q,GAAI4jB,EAAK5jB,EACTgI,EAAO,QACP0uB,IA0KJ,OApEA9S,GAAKjB,SAAUiF,GACX9gB,YAAa80B,EAEbtlB,KAAM,WACF,GAEI9L,GAFArJ,EAAYP,KAAKonB,eACjBxS,EAAO5U,KAAKK,OAKhBE,GAAUwI,KACNmP,SAAU,WACVjP,IAAK,OACLC,KAAM,OACNwO,MAAO,MACP7Q,OAAQ,MACR0gB,SAAU,WAId3d,EAAO,eAAiB5J,KAAKinB,IAAM,gDACIrS,EAAK8X,IAAM,KAE7C1J,EAAKxJ,QAAQ8H,KACd1X,GAAQ,yDAGZA,GAAQ,2EAC4BgL,EAAK8X,IAAM,0CACH1sB,KAAKinB,IAC7C,cAAgBjnB,KAAKm7B,UAAY,2GAKrC56B,EAAUqJ,KAAMA,IAGpB0xB,SAAU,WACN,MAAKt7B,MAAKu7B,OACCv7B,KAAKu7B,QAGhBv7B,KAAKu7B,OAASn8B,EAAG,IAAMY,KAAKinB,KAAM9R,IAAK,GAChCnV,KAAKu7B,WAKpBP,EAAavQ,SAAW,SAAU9N,EAAMlb,GAYpC,MAXAA,GAAYq0B,EAAYnZ,GAASqG,EAAKjB,SAAU0T,EAAUr2B,EAAEiR,QAGxD+qB,UAAW,WACP,GAAI7R,GAAQvpB,KAAKupB,MACb3B,EAAU5nB,KAAK0oB,YAEnB,OAAOd,GAAQwT,UAAU57B,MAAO+pB,EAAO9pB,aAE5CgC,KAKFi5B,KAAqB,MACtB1T,EAAQU,WAAYtgB,EAAM4zB,GAGvBA,IAKXrb,EAAO,4BACH,OACA,yBACD,SAAUqD,EAAMgY,GACf,GAAI57B,GAAI4jB,EAAK5jB,CAEb,OAAO47B,GAAavQ,SAAU,cAC1B/U,KAAM,SAAUd,GACZ,GACI8J,GAAK5e,EADL07B,EAAOp8B,EAAEiR,UAAWuE,EAKxB,KADA8J,EAAM8c,EAAKvS,QAAUuS,EAAKvS,OAAOhpB,OAC1BH,EAAI,EAAO4e,EAAJ5e,EAASA,IACb07B,EAAKvS,OAAQnpB,GAAI4c,QACnB8e,EAAKvS,OAAQnpB,GAAI4c,MAAQ,eAI1B8e,GAAK/e,aACL+e,GAAKxjB,SACLwjB,GAAKj7B,UAEZP,KAAKo7B,UAAW,aAAc,OAAQI,IAG1CzU,QAAS,WACL/mB,KAAKo7B,UAAW,aAAc,gBAO1Czb,EAAO,2BACH,OACA,wBACA,kBACD,SAAUqD,EAAMgY,EAAcnT,GAC7B,GAAIzoB,GAAI4jB,EAAK5jB,CAEb,OAAO47B,GAAavQ,SAAU,aAC1B/U,KAAM,WACF1V,KAAK+4B,QAAU,EACf/4B,KAAKg5B,UAAY,KACjBh5B,KAAKy7B,cAAgB,MAGzBzK,KAAM,WACF,GAKIiI,GALA1P,EAAQvpB,KAAKupB,MACb3U,EAAO5U,KAAKK,QACZ84B,EAAMn5B,KAAKo5B,YACXxI,EAAOrH,EAAMsG,MACbQ,EAASzb,EAAKyb,MAGlB8I,GAAIjR,eAAgB0I,EAAK9H,MAEpBlU,EAAK8b,cACNL,IAAW,KAAKphB,KAAMohB,GAAW,IAAM,KAC/BjxB,EAAEi6B,MAAO9P,EAAMuG,WAEvBmJ,EAASrI,EAAK3J,MAEd7nB,EAAEyJ,KAAM0gB,EAAMuG,UAAW,SAAUyJ,EAAGtnB,GAClCknB,EAAI1nB,KAAM,SAAU8nB,EAAGtnB,KAG3BknB,EAAI1nB,KAAM,aAAcmD,EAAK4b,QAASI,EAAK3J,IACnCrS,EAAKic,UAAYtH,EAAMuG,UAAUnT,MAAQ,KAGrD3c,KAAKw5B,kBAAmBL,EAAKvkB,EAAKqb,SAClCkJ,EAAI1nB,KAAM,QACN6e,OAAQ1b,EAAK0b,OACboL,IAAKrL,EACLsL,eAAgB/mB,EAAK+mB,eACrBC,SAAU,4BACX3C,IAGPxL,UAAW,WACP,MAAOztB,MAAK+4B,SAGhB7H,YAAa,WACT,MAAOlxB,MAAKg5B,WAAa,IAG7B7H,kBAAmB,WACf,MAAOnxB,MAAKy7B,eAGhBxK,MAAO,WACH,GAAIkI,GAAMn5B,KAAK85B,IAEVX,KACDA,EAAI1nB,KAAK,SACT0nB,EAAIpS,UACJ/mB,KAAK85B,KAAOX,EAAM,OAI1BpS,QAAS,WACL/mB,KAAKixB,SAGTmI,UAAW,WACP,GAAIrV,GAAK/jB,KACLm5B,EAAM,GAAItR,GAAc,iBA4D5B,OA1DAsR,GAAIn1B,GAAI,0BAA2B,SAAUtB,GACzC,GAAIm5B,GAAUn5B,EAAEyqB,OAASzqB,EAAE+uB,KAE3B,OADAoK,GAAUzvB,KAAKyD,IAAK,EAAGzD,KAAKwD,IAAK,EAAGisB,IAC7B9X,EAAG5c,QAAS,WAAY00B,KAGnC1C,EAAIn1B,GAAI,OAAQ,WACZ,GAGI6O,GAHA0a,EAAS4L,EAAI1nB,KAAK,aAClBqqB,GAAW,EACXzE,EAAM,EAuCV,OApCA8B,GAAIvyB,MACJmd,EAAG+V,KAAO,KAELvM,GAAU,KAAgB,IAATA,EAClBuO,GAAW,EACHvO,GAAU,KAAgB,IAATA,GACzBuO,GAAW,EACXzE,EAAM,UAENA,EAAM,OAGLyE,IACD/X,EAAGiV,UAAYG,EAAI1nB,KAAK,eACxBsS,EAAGiV,UAAY+C,mBAAoBhY,EAAGiV,WAOtCnmB,EAAI7L,EAAOuzB,MAAQvzB,EAAOuzB,KAAKC,OAAS,SAAUhoB,GAC9C,IACI,MAAO,IAAIwO,UAAS,UAAYxO,GAAGd,OACrC,MAAQ2lB,GACN,WAGRtT,EAAG0X,cAAiB1X,EAAGiV,UAAYnmB,EAAEkR,EAAGiV,eAK5CG,EAAIpS,UACJoS,EAAM,KAEC9B,EAAMtT,EAAG5c,QAAS,QAASkwB,GAAQtT,EAAG5c,QAAQ,UAGzDgyB,EAAIn1B,GAAI,QAAS,WACbm1B,EAAIvyB,MACJmd,EAAG+V,KAAO,KACV/V,EAAG5c,QAAS,QAAS,UAGzB4c,EAAG+V,KAAOX,EACHA,GAGXK,kBAAmB,SAAUL,EAAKlJ,GAC9B7wB,EAAEyJ,KAAMonB,EAAS,SAAU3S,EAAKhW,GAC5B6xB,EAAI1nB,KAAM,mBAAoB6L,EAAKhW,UAQnDqY,EAAO,uBACH,OAGA,kBACA,oBACA,qBACA,gBACA,kBACA,iBACA,oBAIA,qBACA,oBACA,0BACA,2BACA,0BAGA,2BACA,2BACD,SAAUqD,GACT,MAAOA,KAEXrD,EAAO,eACH,uBACD,SAAUqc,GACT,MAAOA,KAEJlc,EAAQ","file":"cui.extend.min.js","sourcesContent":["/* =========================================================\n * bootstrap-datetimepicker.js\n * =========================================================\n * Copyright 2012 Stefan Petre\n *\n * Improvements by Andrew Rowls\n * Improvements by Sébastien Malot\n * Improvements by Yun Lai\n * Improvements by Kenneth Henderick\n * Improvements by CuGBabyBeaR\n * Improvements by Christian Vaas\n *\n * Project URL : http://www.malot.fr/bootstrap-datetimepicker\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ========================================================= */\n!function ($) {\n\n  // Add ECMA262-5 Array methods if not supported natively (IE8)\n  if (!('indexOf' in Array.prototype)) {\n    Array.prototype.indexOf = function (find, i) {\n      if (i === undefined) i = 0;\n      if (i < 0) i += this.length;\n      if (i < 0) i = 0;\n      for (var n = this.length; i < n; i++) {\n        if (i in this && this[i] === find) {\n          return i;\n        }\n      }\n      return -1;\n    }\n  }\n\n  function elementOrParentIsFixed (element) {\n    var $element = $(element);\n    var $checkElements = $element.add($element.parents());\n    var isFixed = false;\n    $checkElements.each(function(){\n      if ($(this).css('position') === 'fixed') {\n        isFixed = true;\n        return false;\n      }\n    });\n    return isFixed;\n  }\n\n  function UTCDate() {\n    return new Date(Date.UTC.apply(Date, arguments));\n  }\n\n  function UTCToday() {\n    var today = new Date();\n    return UTCDate(today.getUTCFullYear(), today.getUTCMonth(), today.getUTCDate(), today.getUTCHours(), today.getUTCMinutes(), today.getUTCSeconds(), 0);\n  }\n\n  // Picker object\n  var Datetimepicker = function (element, options) {\n    var that = this;\n\n    this.element = $(element);\n\n    // add container for single page application\n    // when page switch the datetimepicker div will be removed also.\n    this.container = options.container || 'body';\n\n    this.language = options.language || this.element.data('date-language') || 'en';\n    this.language = this.language in dates ? this.language : this.language.split('-')[0]; // fr-CA fallback to fr\n    this.language = this.language in dates ? this.language : 'en';\n    this.isRTL = dates[this.language].rtl || false;\n    this.formatType = options.formatType || this.element.data('format-type') || 'standard';\n    this.format = DPGlobal.parseFormat(options.format || this.element.data('date-format') || dates[this.language].format || DPGlobal.getDefaultFormat(this.formatType, 'input'), this.formatType);\n    this.isInline = false;\n    this.isVisible = false;\n    this.isInput = this.element.is('input');\n    this.fontAwesome = options.fontAwesome || this.element.data('font-awesome') || false;\n\n    this.bootcssVer = options.bootcssVer || (this.isInput ? (this.element.is('.form-control') ? 3 : 2) : ( this.bootcssVer = this.element.is('.input-group') ? 3 : 2 ));\n\n    this.component = this.element.is('.date') ? ( this.bootcssVer == 3 ? this.element.find('.input-group-addon .glyphicon-th, .input-group-addon .glyphicon-time, .input-group-addon .glyphicon-calendar, .input-group-addon .glyphicon-calendar, .input-group-addon .fa-calendar, .input-group-addon .fa-clock-o').parent() : this.element.find('.add-on .icon-th, .add-on .icon-time, .add-on .icon-calendar .fa-calendar .fa-clock-o').parent()) : false;\n    this.componentReset = this.element.is('.date') ? ( this.bootcssVer == 3 ? this.element.find('.input-group-addon .glyphicon-remove, .input-group-addon .fa-times').parent():this.element.find('.add-on .icon-remove, .add-on .fa-times').parent()) : false;\n    this.hasInput = this.component && this.element.find('input').length;\n    if (this.component && this.component.length === 0) {\n      this.component = false;\n    }\n    this.linkField = options.linkField || this.element.data('link-field') || false;\n    this.linkFormat = DPGlobal.parseFormat(options.linkFormat || this.element.data('link-format') || DPGlobal.getDefaultFormat(this.formatType, 'link'), this.formatType);\n    this.minuteStep = options.minuteStep || this.element.data('minute-step') || 5;\n    this.pickerPosition = options.pickerPosition || this.element.data('picker-position') || 'bottom-right';\n    this.showMeridian = options.showMeridian || this.element.data('show-meridian') || false;\n    this.initialDate = options.initialDate || new Date();\n    this.zIndex = options.zIndex || this.element.data('z-index') || undefined;\n\n    this.icons = {\n      leftArrow: this.fontAwesome ? 'fa-arrow-left' : (this.bootcssVer === 3 ? 'glyphicon-arrow-left' : 'icon-arrow-left'),\n      rightArrow: this.fontAwesome ? 'fa-arrow-right' : (this.bootcssVer === 3 ? 'glyphicon-arrow-right' : 'icon-arrow-right')\n    }\n    this.icontype = this.fontAwesome ? 'fa' : 'glyphicon';\n\n    this._attachEvents();\n\n    this.clickedOutside = function (e) {\n        // Clicked outside the datetimepicker, hide it\n        if ($(e.target).closest('.datetimepicker').length === 0) {\n            that.hide();\n        }\n    }\n\n    this.formatViewType = 'datetime';\n    if ('formatViewType' in options) {\n      this.formatViewType = options.formatViewType;\n    } else if ('formatViewType' in this.element.data()) {\n      this.formatViewType = this.element.data('formatViewType');\n    }\n\n    this.minView = 0;\n    if ('minView' in options) {\n      this.minView = options.minView;\n    } else if ('minView' in this.element.data()) {\n      this.minView = this.element.data('min-view');\n    }\n    this.minView = DPGlobal.convertViewMode(this.minView);\n\n    this.maxView = DPGlobal.modes.length - 1;\n    if ('maxView' in options) {\n      this.maxView = options.maxView;\n    } else if ('maxView' in this.element.data()) {\n      this.maxView = this.element.data('max-view');\n    }\n    this.maxView = DPGlobal.convertViewMode(this.maxView);\n\n    this.wheelViewModeNavigation = false;\n    if ('wheelViewModeNavigation' in options) {\n      this.wheelViewModeNavigation = options.wheelViewModeNavigation;\n    } else if ('wheelViewModeNavigation' in this.element.data()) {\n      this.wheelViewModeNavigation = this.element.data('view-mode-wheel-navigation');\n    }\n\n    this.wheelViewModeNavigationInverseDirection = false;\n\n    if ('wheelViewModeNavigationInverseDirection' in options) {\n      this.wheelViewModeNavigationInverseDirection = options.wheelViewModeNavigationInverseDirection;\n    } else if ('wheelViewModeNavigationInverseDirection' in this.element.data()) {\n      this.wheelViewModeNavigationInverseDirection = this.element.data('view-mode-wheel-navigation-inverse-dir');\n    }\n\n    this.wheelViewModeNavigationDelay = 100;\n    if ('wheelViewModeNavigationDelay' in options) {\n      this.wheelViewModeNavigationDelay = options.wheelViewModeNavigationDelay;\n    } else if ('wheelViewModeNavigationDelay' in this.element.data()) {\n      this.wheelViewModeNavigationDelay = this.element.data('view-mode-wheel-navigation-delay');\n    }\n\n    this.startViewMode = 2;\n    if ('startView' in options) {\n      this.startViewMode = options.startView;\n    } else if ('startView' in this.element.data()) {\n      this.startViewMode = this.element.data('start-view');\n    }\n    this.startViewMode = DPGlobal.convertViewMode(this.startViewMode);\n    this.viewMode = this.startViewMode;\n\n    this.viewSelect = this.minView;\n    if ('viewSelect' in options) {\n      this.viewSelect = options.viewSelect;\n    } else if ('viewSelect' in this.element.data()) {\n      this.viewSelect = this.element.data('view-select');\n    }\n    this.viewSelect = DPGlobal.convertViewMode(this.viewSelect);\n\n    this.forceParse = true;\n    if ('forceParse' in options) {\n      this.forceParse = options.forceParse;\n    } else if ('dateForceParse' in this.element.data()) {\n      this.forceParse = this.element.data('date-force-parse');\n    }\n    var template = this.bootcssVer === 3 ? DPGlobal.templateV3 : DPGlobal.template;\n    while (template.indexOf('{iconType}') !== -1) {\n      template = template.replace('{iconType}', this.icontype);\n    }\n    while (template.indexOf('{leftArrow}') !== -1) {\n      template = template.replace('{leftArrow}', this.icons.leftArrow);\n    }\n    while (template.indexOf('{rightArrow}') !== -1) {\n      template = template.replace('{rightArrow}', this.icons.rightArrow);\n    }\n    this.picker = $(template)\n      .appendTo(this.isInline ? this.element : this.container) // 'body')\n      .on({\n        click:     $.proxy(this.click, this),\n        mousedown: $.proxy(this.mousedown, this)\n      });\n\n    if (this.wheelViewModeNavigation) {\n      if ($.fn.mousewheel) {\n        this.picker.on({mousewheel: $.proxy(this.mousewheel, this)});\n      } else {\n        console.log('Mouse Wheel event is not supported. Please include the jQuery Mouse Wheel plugin before enabling this option');\n      }\n    }\n\n    if (this.isInline) {\n      this.picker.addClass('datetimepicker-inline');\n    } else {\n      this.picker.addClass('datetimepicker-dropdown-' + this.pickerPosition + ' dropdown-menu');\n    }\n    if (this.isRTL) {\n      this.picker.addClass('datetimepicker-rtl');\n      var selector = this.bootcssVer === 3 ? '.prev span, .next span' : '.prev i, .next i';\n      this.picker.find(selector).toggleClass(this.icons.leftArrow + ' ' + this.icons.rightArrow);\n    }\n\n    $(document).on('mousedown', this.clickedOutside);\n\n    this.autoclose = false;\n    if ('autoclose' in options) {\n      this.autoclose = options.autoclose;\n    } else if ('dateAutoclose' in this.element.data()) {\n      this.autoclose = this.element.data('date-autoclose');\n    }\n\n    this.keyboardNavigation = true;\n    if ('keyboardNavigation' in options) {\n      this.keyboardNavigation = options.keyboardNavigation;\n    } else if ('dateKeyboardNavigation' in this.element.data()) {\n      this.keyboardNavigation = this.element.data('date-keyboard-navigation');\n    }\n\n    this.todayBtn = (options.todayBtn || this.element.data('date-today-btn') || false);\n    this.todayHighlight = (options.todayHighlight || this.element.data('date-today-highlight') || false);\n\n    this.weekStart = ((options.weekStart || this.element.data('date-weekstart') || dates[this.language].weekStart || 0) % 7);\n    this.weekEnd = ((this.weekStart + 6) % 7);\n    this.startDate = -Infinity;\n    this.endDate = Infinity;\n    this.daysOfWeekDisabled = [];\n    this.setStartDate(options.startDate || this.element.data('date-startdate'));\n    this.setEndDate(options.endDate || this.element.data('date-enddate'));\n    this.setDaysOfWeekDisabled(options.daysOfWeekDisabled || this.element.data('date-days-of-week-disabled'));\n    this.setMinutesDisabled(options.minutesDisabled || this.element.data('date-minute-disabled'));\n    this.setHoursDisabled(options.hoursDisabled || this.element.data('date-hour-disabled'));\n    this.fillDow();\n    this.fillMonths();\n    this.update();\n    this.showMode();\n\n    if (this.isInline) {\n      this.show();\n    }\n  };\n\n  Datetimepicker.prototype = {\n    constructor: Datetimepicker,\n\n    _events:       [],\n    _attachEvents: function () {\n      this._detachEvents();\n      if (this.isInput) { // single input\n        this._events = [\n          [this.element, {\n            focus:   $.proxy(this.show, this),\n            keyup:   $.proxy(this.update, this),\n            keydown: $.proxy(this.keydown, this)\n          }]\n        ];\n      }\n      else if (this.component && this.hasInput) { // component: input + button\n        this._events = [\n          // For components that are not readonly, allow keyboard nav\n          [this.element.find('input'), {\n            focus:   $.proxy(this.show, this),\n            keyup:   $.proxy(this.update, this),\n            keydown: $.proxy(this.keydown, this)\n          }],\n          [this.component, {\n            click: $.proxy(this.show, this)\n          }]\n        ];\n        if (this.componentReset) {\n          this._events.push([\n            this.componentReset,\n            {click: $.proxy(this.reset, this)}\n          ]);\n        }\n      }\n      else if (this.element.is('div')) {  // inline datetimepicker\n        this.isInline = true;\n      }\n      else {\n        this._events = [\n          [this.element, {\n            click: $.proxy(this.show, this)\n          }]\n        ];\n      }\n      for (var i = 0, el, ev; i < this._events.length; i++) {\n        el = this._events[i][0];\n        ev = this._events[i][1];\n        el.on(ev);\n      }\n    },\n\n    _detachEvents: function () {\n      for (var i = 0, el, ev; i < this._events.length; i++) {\n        el = this._events[i][0];\n        ev = this._events[i][1];\n        el.off(ev);\n      }\n      this._events = [];\n    },\n\n    show: function (e) {\n      this.picker.show();\n      this.height = this.component ? this.component.outerHeight() : this.element.outerHeight();\n      if (this.forceParse) {\n        this.update();\n      }\n      this.place();\n      $(window).on('resize', $.proxy(this.place, this));\n      if (e) {\n        e.stopPropagation();\n        e.preventDefault();\n      }\n      this.isVisible = true;\n      this.element.trigger({\n        type: 'show',\n        date: this.date\n      });\n    },\n\n    hide: function (e) {\n      if (!this.isVisible) return;\n      if (this.isInline) return;\n      this.picker.hide();\n      $(window).off('resize', this.place);\n      this.viewMode = this.startViewMode;\n      this.showMode();\n      if (!this.isInput) {\n        $(document).off('mousedown', this.hide);\n      }\n\n      if (\n        this.forceParse &&\n          (\n            this.isInput && this.element.val() ||\n              this.hasInput && this.element.find('input').val()\n            )\n        )\n        this.setValue();\n      this.isVisible = false;\n      this.element.trigger({\n        type: 'hide',\n        date: this.date\n      });\n    },\n\n    remove: function () {\n      this._detachEvents();\n      $(document).off('mousedown', this.clickedOutside);\n      this.picker.remove();\n      delete this.picker;\n      delete this.element.data().datetimepicker;\n    },\n\n    getDate: function () {\n      var d = this.getUTCDate();\n      return new Date(d.getTime() + (d.getTimezoneOffset() * 60000));\n    },\n\n    getUTCDate: function () {\n      return this.date;\n    },\n\n    setDate: function (d) {\n      this.setUTCDate(new Date(d.getTime() - (d.getTimezoneOffset() * 60000)));\n    },\n\n    setUTCDate: function (d) {\n      if (d >= this.startDate && d <= this.endDate) {\n        this.date = d;\n        this.setValue();\n        this.viewDate = this.date;\n        this.fill();\n      } else {\n        this.element.trigger({\n          type:      'outOfRange',\n          date:      d,\n          startDate: this.startDate,\n          endDate:   this.endDate\n        });\n      }\n    },\n\n    setFormat: function (format) {\n      this.format = DPGlobal.parseFormat(format, this.formatType);\n      var element;\n      if (this.isInput) {\n        element = this.element;\n      } else if (this.component) {\n        element = this.element.find('input');\n      }\n      if (element && element.val()) {\n        this.setValue();\n      }\n    },\n\n    setValue: function () {\n      var formatted = this.getFormattedDate();\n      if (!this.isInput) {\n        if (this.component) {\n          this.element.find('input').val(formatted);\n        }\n        this.element.data('date', formatted);\n      } else {\n        this.element.val(formatted);\n      }\n      if (this.linkField) {\n        $('#' + this.linkField).val(this.getFormattedDate(this.linkFormat));\n      }\n    },\n\n    getFormattedDate: function (format) {\n      if (format == undefined) format = this.format;\n      return DPGlobal.formatDate(this.date, format, this.language, this.formatType);\n    },\n\n    setStartDate: function (startDate) {\n      this.startDate = startDate || -Infinity;\n      if (this.startDate !== -Infinity) {\n        this.startDate = DPGlobal.parseDate(this.startDate, this.format, this.language, this.formatType);\n      }\n      this.update();\n      this.updateNavArrows();\n    },\n\n    setEndDate: function (endDate) {\n      this.endDate = endDate || Infinity;\n      if (this.endDate !== Infinity) {\n        this.endDate = DPGlobal.parseDate(this.endDate, this.format, this.language, this.formatType);\n      }\n      this.update();\n      this.updateNavArrows();\n    },\n\n    setDaysOfWeekDisabled: function (daysOfWeekDisabled) {\n      this.daysOfWeekDisabled = daysOfWeekDisabled || [];\n      if (!$.isArray(this.daysOfWeekDisabled)) {\n        this.daysOfWeekDisabled = this.daysOfWeekDisabled.split(/,\\s*/);\n      }\n      this.daysOfWeekDisabled = $.map(this.daysOfWeekDisabled, function (d) {\n        return parseInt(d, 10);\n      });\n      this.update();\n      this.updateNavArrows();\n    },\n\n    setMinutesDisabled: function (minutesDisabled) {\n      this.minutesDisabled = minutesDisabled || [];\n      if (!$.isArray(this.minutesDisabled)) {\n        this.minutesDisabled = this.minutesDisabled.split(/,\\s*/);\n      }\n      this.minutesDisabled = $.map(this.minutesDisabled, function (d) {\n        return parseInt(d, 10);\n      });\n      this.update();\n      this.updateNavArrows();\n    },\n\n    setHoursDisabled: function (hoursDisabled) {\n      this.hoursDisabled = hoursDisabled || [];\n      if (!$.isArray(this.hoursDisabled)) {\n        this.hoursDisabled = this.hoursDisabled.split(/,\\s*/);\n      }\n      this.hoursDisabled = $.map(this.hoursDisabled, function (d) {\n        return parseInt(d, 10);\n      });\n      this.update();\n      this.updateNavArrows();\n    },\n\n    place: function () {\n      if (this.isInline) return;\n\n      if (!this.zIndex) {\n        var index_highest = 0;\n        $('div').each(function () {\n          var index_current = parseInt($(this).css('zIndex'), 10);\n          if (index_current > index_highest) {\n            index_highest = index_current;\n          }\n        });\n        this.zIndex = index_highest + 10;\n      }\n\n      var offset, top, left, containerOffset;\n      if (this.container instanceof $) {\n        containerOffset = this.container.offset();\n      } else {\n        containerOffset = $(this.container).offset();\n      }\n\n      if (this.component) {\n        offset = this.component.offset();\n        left = offset.left;\n        if (this.pickerPosition == 'bottom-left' || this.pickerPosition == 'top-left') {\n          left += this.component.outerWidth() - this.picker.outerWidth();\n        }\n      } else {\n        offset = this.element.offset();\n        left = offset.left;\n      }\n\n      var bodyWidth = document.body.clientWidth || window.innerWidth;\n      if (left + 220 > bodyWidth) {\n        left = bodyWidth - 220;\n      }\n\n      if (this.pickerPosition == 'top-left' || this.pickerPosition == 'top-right') {\n        top = offset.top - this.picker.outerHeight();\n      } else {\n        top = offset.top + this.height;\n      }\n\n      top = top - containerOffset.top;\n      left = left - containerOffset.left;\n\n      this.picker.css({\n        top:    top,\n        left:   left,\n        zIndex: this.zIndex\n      });\n    },\n\n    update: function () {\n      var date, fromArgs = false;\n      if (arguments && arguments.length && (typeof arguments[0] === 'string' || arguments[0] instanceof Date)) {\n        date = arguments[0];\n        fromArgs = true;\n      } else {\n        date = (this.isInput ? this.element.val() : this.element.find('input').val()) || this.element.data('date') || this.initialDate;\n        if (typeof date == 'string' || date instanceof String) {\n          date = date.replace(/^\\s+|\\s+$/g,'');\n        }\n      }\n\n      if (!date) {\n        date = new Date();\n        fromArgs = false;\n      }\n\n      this.date = DPGlobal.parseDate(date, this.format, this.language, this.formatType);\n\n      if (fromArgs) this.setValue();\n\n      if (this.date < this.startDate) {\n        this.viewDate = new Date(this.startDate);\n      } else if (this.date > this.endDate) {\n        this.viewDate = new Date(this.endDate);\n      } else {\n        this.viewDate = new Date(this.date);\n      }\n      this.fill();\n    },\n\n    fillDow: function () {\n      var dowCnt = this.weekStart,\n        html = '<tr>';\n      while (dowCnt < this.weekStart + 7) {\n        html += '<th class=\"dow\">' + dates[this.language].daysMin[(dowCnt++) % 7] + '</th>';\n      }\n      html += '</tr>';\n      this.picker.find('.datetimepicker-days thead').append(html);\n    },\n\n    fillMonths: function () {\n      var html = '',\n        i = 0;\n      while (i < 12) {\n        html += '<span class=\"month\">' + dates[this.language].monthsShort[i++] + '</span>';\n      }\n      this.picker.find('.datetimepicker-months td').html(html);\n    },\n\n    fill: function () {\n      if (this.date == null || this.viewDate == null) {\n        return;\n      }\n      var d = new Date(this.viewDate),\n        year = d.getUTCFullYear(),\n        month = d.getUTCMonth(),\n        dayMonth = d.getUTCDate(),\n        hours = d.getUTCHours(),\n        minutes = d.getUTCMinutes(),\n        startYear = this.startDate !== -Infinity ? this.startDate.getUTCFullYear() : -Infinity,\n        startMonth = this.startDate !== -Infinity ? this.startDate.getUTCMonth() + 1 : -Infinity,\n        endYear = this.endDate !== Infinity ? this.endDate.getUTCFullYear() : Infinity,\n        endMonth = this.endDate !== Infinity ? this.endDate.getUTCMonth() + 1 : Infinity,\n        currentDate = (new UTCDate(this.date.getUTCFullYear(), this.date.getUTCMonth(), this.date.getUTCDate())).valueOf(),\n        today = new Date();\n      this.picker.find('.datetimepicker-days thead th:eq(1)')\n        .text(dates[this.language].months[month] + ' ' + year);\n      if (this.formatViewType == 'time') {\n        var formatted = this.getFormattedDate();\n        this.picker.find('.datetimepicker-hours thead th:eq(1)').text(formatted);\n        this.picker.find('.datetimepicker-minutes thead th:eq(1)').text(formatted);\n      } else {\n        this.picker.find('.datetimepicker-hours thead th:eq(1)')\n          .text(dayMonth + ' ' + dates[this.language].months[month] + ' ' + year);\n        this.picker.find('.datetimepicker-minutes thead th:eq(1)')\n          .text(dayMonth + ' ' + dates[this.language].months[month] + ' ' + year);\n      }\n      this.picker.find('tfoot th.today')\n        .text(dates[this.language].today)\n        .toggle(this.todayBtn !== false);\n      this.updateNavArrows();\n      this.fillMonths();\n      /*var prevMonth = UTCDate(year, month, 0,0,0,0,0);\n       prevMonth.setUTCDate(prevMonth.getDate() - (prevMonth.getUTCDay() - this.weekStart + 7)%7);*/\n      var prevMonth = UTCDate(year, month - 1, 28, 0, 0, 0, 0),\n        day = DPGlobal.getDaysInMonth(prevMonth.getUTCFullYear(), prevMonth.getUTCMonth());\n      prevMonth.setUTCDate(day);\n      prevMonth.setUTCDate(day - (prevMonth.getUTCDay() - this.weekStart + 7) % 7);\n      var nextMonth = new Date(prevMonth);\n      nextMonth.setUTCDate(nextMonth.getUTCDate() + 42);\n      nextMonth = nextMonth.valueOf();\n      var html = [];\n      var clsName;\n      while (prevMonth.valueOf() < nextMonth) {\n        if (prevMonth.getUTCDay() == this.weekStart) {\n          html.push('<tr>');\n        }\n        clsName = '';\n        if (prevMonth.getUTCFullYear() < year || (prevMonth.getUTCFullYear() == year && prevMonth.getUTCMonth() < month)) {\n          clsName += ' old';\n        } else if (prevMonth.getUTCFullYear() > year || (prevMonth.getUTCFullYear() == year && prevMonth.getUTCMonth() > month)) {\n          clsName += ' new';\n        }\n        // Compare internal UTC date with local today, not UTC today\n        if (this.todayHighlight &&\n          prevMonth.getUTCFullYear() == today.getFullYear() &&\n          prevMonth.getUTCMonth() == today.getMonth() &&\n          prevMonth.getUTCDate() == today.getDate()) {\n          clsName += ' today';\n        }\n        if (prevMonth.valueOf() == currentDate) {\n          clsName += ' active';\n        }\n        if ((prevMonth.valueOf() + 86400000) <= this.startDate || prevMonth.valueOf() > this.endDate ||\n          $.inArray(prevMonth.getUTCDay(), this.daysOfWeekDisabled) !== -1) {\n          clsName += ' disabled';\n        }\n        html.push('<td class=\"day' + clsName + '\">' + prevMonth.getUTCDate() + '</td>');\n        if (prevMonth.getUTCDay() == this.weekEnd) {\n          html.push('</tr>');\n        }\n        prevMonth.setUTCDate(prevMonth.getUTCDate() + 1);\n      }\n      this.picker.find('.datetimepicker-days tbody').empty().append(html.join(''));\n\n      html = [];\n      var txt = '', meridian = '', meridianOld = '';\n      var hoursDisabled = this.hoursDisabled || [];\n      for (var i = 0; i < 24; i++) {\n        if (hoursDisabled.indexOf(i) !== -1) continue;\n        var actual = UTCDate(year, month, dayMonth, i);\n        clsName = '';\n        // We want the previous hour for the startDate\n        if ((actual.valueOf() + 3600000) <= this.startDate || actual.valueOf() > this.endDate) {\n          clsName += ' disabled';\n        } else if (hours == i) {\n          clsName += ' active';\n        }\n        if (this.showMeridian && dates[this.language].meridiem.length == 2) {\n          meridian = (i < 12 ? dates[this.language].meridiem[0] : dates[this.language].meridiem[1]);\n          if (meridian != meridianOld) {\n            if (meridianOld != '') {\n              html.push('</fieldset>');\n            }\n            html.push('<fieldset class=\"hour\"><legend>' + meridian.toUpperCase() + '</legend>');\n          }\n          meridianOld = meridian;\n          txt = (i % 12 ? i % 12 : 12);\n          html.push('<span class=\"hour' + clsName + ' hour_' + (i < 12 ? 'am' : 'pm') + '\">' + txt + '</span>');\n          if (i == 23) {\n            html.push('</fieldset>');\n          }\n        } else {\n          txt = i + ':00';\n          html.push('<span class=\"hour' + clsName + '\">' + txt + '</span>');\n        }\n      }\n      this.picker.find('.datetimepicker-hours td').html(html.join(''));\n\n      html = [];\n      txt = '', meridian = '', meridianOld = '';\n      var minutesDisabled = this.minutesDisabled || [];\n      for (var i = 0; i < 60; i += this.minuteStep) {\n        if (minutesDisabled.indexOf(i) !== -1) continue;\n        var actual = UTCDate(year, month, dayMonth, hours, i, 0);\n        clsName = '';\n        if (actual.valueOf() < this.startDate || actual.valueOf() > this.endDate) {\n          clsName += ' disabled';\n        } else if (Math.floor(minutes / this.minuteStep) == Math.floor(i / this.minuteStep)) {\n          clsName += ' active';\n        }\n        if (this.showMeridian && dates[this.language].meridiem.length == 2) {\n          meridian = (hours < 12 ? dates[this.language].meridiem[0] : dates[this.language].meridiem[1]);\n          if (meridian != meridianOld) {\n            if (meridianOld != '') {\n              html.push('</fieldset>');\n            }\n            html.push('<fieldset class=\"minute\"><legend>' + meridian.toUpperCase() + '</legend>');\n          }\n          meridianOld = meridian;\n          txt = (hours % 12 ? hours % 12 : 12);\n          //html.push('<span class=\"minute'+clsName+' minute_'+(hours<12?'am':'pm')+'\">'+txt+'</span>');\n          html.push('<span class=\"minute' + clsName + '\">' + txt + ':' + (i < 10 ? '0' + i : i) + '</span>');\n          if (i == 59) {\n            html.push('</fieldset>');\n          }\n        } else {\n          txt = i + ':00';\n          //html.push('<span class=\"hour'+clsName+'\">'+txt+'</span>');\n          html.push('<span class=\"minute' + clsName + '\">' + hours + ':' + (i < 10 ? '0' + i : i) + '</span>');\n        }\n      }\n      this.picker.find('.datetimepicker-minutes td').html(html.join(''));\n\n      var currentYear = this.date.getUTCFullYear();\n      var months = this.picker.find('.datetimepicker-months')\n        .find('th:eq(1)')\n        .text(year)\n        .end()\n        .find('span').removeClass('active');\n      if (currentYear == year) {\n        // getUTCMonths() returns 0 based, and we need to select the next one\n                // To cater bootstrap 2 we don't need to select the next one\n                var offset = months.length - 12;\n        months.eq(this.date.getUTCMonth() + offset).addClass('active');\n      }\n      if (year < startYear || year > endYear) {\n        months.addClass('disabled');\n      }\n      if (year == startYear) {\n        months.slice(0, startMonth + 1).addClass('disabled');\n      }\n      if (year == endYear) {\n        months.slice(endMonth).addClass('disabled');\n      }\n\n      html = '';\n      year = parseInt(year / 10, 10) * 10;\n      var yearCont = this.picker.find('.datetimepicker-years')\n        .find('th:eq(1)')\n        .text(year + '-' + (year + 9))\n        .end()\n        .find('td');\n      year -= 1;\n      for (var i = -1; i < 11; i++) {\n        html += '<span class=\"year' + (i == -1 || i == 10 ? ' old' : '') + (currentYear == year ? ' active' : '') + (year < startYear || year > endYear ? ' disabled' : '') + '\">' + year + '</span>';\n        year += 1;\n      }\n      yearCont.html(html);\n      this.place();\n    },\n\n    updateNavArrows: function () {\n      var d = new Date(this.viewDate),\n        year = d.getUTCFullYear(),\n        month = d.getUTCMonth(),\n        day = d.getUTCDate(),\n        hour = d.getUTCHours();\n      switch (this.viewMode) {\n        case 0:\n          if (this.startDate !== -Infinity && year <= this.startDate.getUTCFullYear()\n            && month <= this.startDate.getUTCMonth()\n            && day <= this.startDate.getUTCDate()\n            && hour <= this.startDate.getUTCHours()) {\n            this.picker.find('.prev').css({visibility: 'hidden'});\n          } else {\n            this.picker.find('.prev').css({visibility: 'visible'});\n          }\n          if (this.endDate !== Infinity && year >= this.endDate.getUTCFullYear()\n            && month >= this.endDate.getUTCMonth()\n            && day >= this.endDate.getUTCDate()\n            && hour >= this.endDate.getUTCHours()) {\n            this.picker.find('.next').css({visibility: 'hidden'});\n          } else {\n            this.picker.find('.next').css({visibility: 'visible'});\n          }\n          break;\n        case 1:\n          if (this.startDate !== -Infinity && year <= this.startDate.getUTCFullYear()\n            && month <= this.startDate.getUTCMonth()\n            && day <= this.startDate.getUTCDate()) {\n            this.picker.find('.prev').css({visibility: 'hidden'});\n          } else {\n            this.picker.find('.prev').css({visibility: 'visible'});\n          }\n          if (this.endDate !== Infinity && year >= this.endDate.getUTCFullYear()\n            && month >= this.endDate.getUTCMonth()\n            && day >= this.endDate.getUTCDate()) {\n            this.picker.find('.next').css({visibility: 'hidden'});\n          } else {\n            this.picker.find('.next').css({visibility: 'visible'});\n          }\n          break;\n        case 2:\n          if (this.startDate !== -Infinity && year <= this.startDate.getUTCFullYear()\n            && month <= this.startDate.getUTCMonth()) {\n            this.picker.find('.prev').css({visibility: 'hidden'});\n          } else {\n            this.picker.find('.prev').css({visibility: 'visible'});\n          }\n          if (this.endDate !== Infinity && year >= this.endDate.getUTCFullYear()\n            && month >= this.endDate.getUTCMonth()) {\n            this.picker.find('.next').css({visibility: 'hidden'});\n          } else {\n            this.picker.find('.next').css({visibility: 'visible'});\n          }\n          break;\n        case 3:\n        case 4:\n          if (this.startDate !== -Infinity && year <= this.startDate.getUTCFullYear()) {\n            this.picker.find('.prev').css({visibility: 'hidden'});\n          } else {\n            this.picker.find('.prev').css({visibility: 'visible'});\n          }\n          if (this.endDate !== Infinity && year >= this.endDate.getUTCFullYear()) {\n            this.picker.find('.next').css({visibility: 'hidden'});\n          } else {\n            this.picker.find('.next').css({visibility: 'visible'});\n          }\n          break;\n      }\n    },\n\n    mousewheel: function (e) {\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (this.wheelPause) {\n        return;\n      }\n\n      this.wheelPause = true;\n\n      var originalEvent = e.originalEvent;\n\n      var delta = originalEvent.wheelDelta;\n\n      var mode = delta > 0 ? 1 : (delta === 0) ? 0 : -1;\n\n      if (this.wheelViewModeNavigationInverseDirection) {\n        mode = -mode;\n      }\n\n      this.showMode(mode);\n\n      setTimeout($.proxy(function () {\n\n        this.wheelPause = false\n\n      }, this), this.wheelViewModeNavigationDelay);\n\n    },\n\n    click: function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      var target = $(e.target).closest('span, td, th, legend');\n      if (target.is('.' + this.icontype)) {\n        target = $(target).parent().closest('span, td, th, legend');\n      }\n      if (target.length == 1) {\n        if (target.is('.disabled')) {\n          this.element.trigger({\n            type:      'outOfRange',\n            date:      this.viewDate,\n            startDate: this.startDate,\n            endDate:   this.endDate\n          });\n          return;\n        }\n        switch (target[0].nodeName.toLowerCase()) {\n          case 'th':\n            switch (target[0].className) {\n              case 'switch':\n                this.showMode(1);\n                break;\n              case 'prev':\n              case 'next':\n                var dir = DPGlobal.modes[this.viewMode].navStep * (target[0].className == 'prev' ? -1 : 1);\n                switch (this.viewMode) {\n                  case 0:\n                    this.viewDate = this.moveHour(this.viewDate, dir);\n                    break;\n                  case 1:\n                    this.viewDate = this.moveDate(this.viewDate, dir);\n                    break;\n                  case 2:\n                    this.viewDate = this.moveMonth(this.viewDate, dir);\n                    break;\n                  case 3:\n                  case 4:\n                    this.viewDate = this.moveYear(this.viewDate, dir);\n                    break;\n                }\n                this.fill();\n                this.element.trigger({\n                  type:      target[0].className + ':' + this.convertViewModeText(this.viewMode),\n                  date:      this.viewDate,\n                  startDate: this.startDate,\n                  endDate:   this.endDate\n                });\n                break;\n              case 'today':\n                var date = new Date();\n                date = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds(), 0);\n\n                // Respect startDate and endDate.\n                if (date < this.startDate) date = this.startDate;\n                else if (date > this.endDate) date = this.endDate;\n\n                this.viewMode = this.startViewMode;\n                this.showMode(0);\n                this._setDate(date);\n                this.fill();\n                if (this.autoclose) {\n                  this.hide();\n                }\n                break;\n            }\n            break;\n          case 'span':\n            if (!target.is('.disabled')) {\n              var year = this.viewDate.getUTCFullYear(),\n                month = this.viewDate.getUTCMonth(),\n                day = this.viewDate.getUTCDate(),\n                hours = this.viewDate.getUTCHours(),\n                minutes = this.viewDate.getUTCMinutes(),\n                seconds = this.viewDate.getUTCSeconds();\n\n              if (target.is('.month')) {\n                this.viewDate.setUTCDate(1);\n                month = target.parent().find('span').index(target);\n                day = this.viewDate.getUTCDate();\n                this.viewDate.setUTCMonth(month);\n                this.element.trigger({\n                  type: 'changeMonth',\n                  date: this.viewDate\n                });\n                if (this.viewSelect >= 3) {\n                  this._setDate(UTCDate(year, month, day, hours, minutes, seconds, 0));\n                }\n              } else if (target.is('.year')) {\n                this.viewDate.setUTCDate(1);\n                year = parseInt(target.text(), 10) || 0;\n                this.viewDate.setUTCFullYear(year);\n                this.element.trigger({\n                  type: 'changeYear',\n                  date: this.viewDate\n                });\n                if (this.viewSelect >= 4) {\n                  this._setDate(UTCDate(year, month, day, hours, minutes, seconds, 0));\n                }\n              } else if (target.is('.hour')) {\n                hours = parseInt(target.text(), 10) || 0;\n                if (target.hasClass('hour_am') || target.hasClass('hour_pm')) {\n                  if (hours == 12 && target.hasClass('hour_am')) {\n                    hours = 0;\n                  } else if (hours != 12 && target.hasClass('hour_pm')) {\n                    hours += 12;\n                  }\n                }\n                this.viewDate.setUTCHours(hours);\n                this.element.trigger({\n                  type: 'changeHour',\n                  date: this.viewDate\n                });\n                if (this.viewSelect >= 1) {\n                  this._setDate(UTCDate(year, month, day, hours, minutes, seconds, 0));\n                }\n              } else if (target.is('.minute')) {\n                minutes = parseInt(target.text().substr(target.text().indexOf(':') + 1), 10) || 0;\n                this.viewDate.setUTCMinutes(minutes);\n                this.element.trigger({\n                  type: 'changeMinute',\n                  date: this.viewDate\n                });\n                if (this.viewSelect >= 0) {\n                  this._setDate(UTCDate(year, month, day, hours, minutes, seconds, 0));\n                }\n              }\n              if (this.viewMode != 0) {\n                var oldViewMode = this.viewMode;\n                this.showMode(-1);\n                this.fill();\n                if (oldViewMode == this.viewMode && this.autoclose) {\n                  this.hide();\n                }\n              } else {\n                this.fill();\n                if (this.autoclose) {\n                  this.hide();\n                }\n              }\n            }\n            break;\n          case 'td':\n            if (target.is('.day') && !target.is('.disabled')) {\n              var day = parseInt(target.text(), 10) || 1;\n              var year = this.viewDate.getUTCFullYear(),\n                month = this.viewDate.getUTCMonth(),\n                hours = this.viewDate.getUTCHours(),\n                minutes = this.viewDate.getUTCMinutes(),\n                seconds = this.viewDate.getUTCSeconds();\n              if (target.is('.old')) {\n                if (month === 0) {\n                  month = 11;\n                  year -= 1;\n                } else {\n                  month -= 1;\n                }\n              } else if (target.is('.new')) {\n                if (month == 11) {\n                  month = 0;\n                  year += 1;\n                } else {\n                  month += 1;\n                }\n              }\n              this.viewDate.setUTCFullYear(year);\n              this.viewDate.setUTCMonth(month, day);\n              this.element.trigger({\n                type: 'changeDay',\n                date: this.viewDate\n              });\n              if (this.viewSelect >= 2) {\n                this._setDate(UTCDate(year, month, day, hours, minutes, seconds, 0));\n              }\n            }\n            var oldViewMode = this.viewMode;\n            this.showMode(-1);\n            this.fill();\n            if (oldViewMode == this.viewMode && this.autoclose) {\n              this.hide();\n            }\n            break;\n        }\n      }\n    },\n\n    _setDate: function (date, which) {\n      if (!which || which == 'date')\n        this.date = date;\n      if (!which || which == 'view')\n        this.viewDate = date;\n      this.fill();\n      this.setValue();\n      var element;\n      if (this.isInput) {\n        element = this.element;\n      } else if (this.component) {\n        element = this.element.find('input');\n      }\n      if (element) {\n        element.change();\n        if (this.autoclose && (!which || which == 'date')) {\n          //this.hide();\n        }\n      }\n      this.element.trigger({\n        type: 'changeDate',\n        date: this.date\n      });\n      if(date == null)\n        this.date = this.viewDate;\n    },\n\n    moveMinute: function (date, dir) {\n      if (!dir) return date;\n      var new_date = new Date(date.valueOf());\n      //dir = dir > 0 ? 1 : -1;\n      new_date.setUTCMinutes(new_date.getUTCMinutes() + (dir * this.minuteStep));\n      return new_date;\n    },\n\n    moveHour: function (date, dir) {\n      if (!dir) return date;\n      var new_date = new Date(date.valueOf());\n      //dir = dir > 0 ? 1 : -1;\n      new_date.setUTCHours(new_date.getUTCHours() + dir);\n      return new_date;\n    },\n\n    moveDate: function (date, dir) {\n      if (!dir) return date;\n      var new_date = new Date(date.valueOf());\n      //dir = dir > 0 ? 1 : -1;\n      new_date.setUTCDate(new_date.getUTCDate() + dir);\n      return new_date;\n    },\n\n    moveMonth: function (date, dir) {\n      if (!dir) return date;\n      var new_date = new Date(date.valueOf()),\n        day = new_date.getUTCDate(),\n        month = new_date.getUTCMonth(),\n        mag = Math.abs(dir),\n        new_month, test;\n      dir = dir > 0 ? 1 : -1;\n      if (mag == 1) {\n        test = dir == -1\n          // If going back one month, make sure month is not current month\n          // (eg, Mar 31 -> Feb 31 == Feb 28, not Mar 02)\n          ? function () {\n          return new_date.getUTCMonth() == month;\n        }\n          // If going forward one month, make sure month is as expected\n          // (eg, Jan 31 -> Feb 31 == Feb 28, not Mar 02)\n          : function () {\n          return new_date.getUTCMonth() != new_month;\n        };\n        new_month = month + dir;\n        new_date.setUTCMonth(new_month);\n        // Dec -> Jan (12) or Jan -> Dec (-1) -- limit expected date to 0-11\n        if (new_month < 0 || new_month > 11)\n          new_month = (new_month + 12) % 12;\n      } else {\n        // For magnitudes >1, move one month at a time...\n        for (var i = 0; i < mag; i++)\n          // ...which might decrease the day (eg, Jan 31 to Feb 28, etc)...\n          new_date = this.moveMonth(new_date, dir);\n        // ...then reset the day, keeping it in the new month\n        new_month = new_date.getUTCMonth();\n        new_date.setUTCDate(day);\n        test = function () {\n          return new_month != new_date.getUTCMonth();\n        };\n      }\n      // Common date-resetting loop -- if date is beyond end of month, make it\n      // end of month\n      while (test()) {\n        new_date.setUTCDate(--day);\n        new_date.setUTCMonth(new_month);\n      }\n      return new_date;\n    },\n\n    moveYear: function (date, dir) {\n      return this.moveMonth(date, dir * 12);\n    },\n\n    dateWithinRange: function (date) {\n      return date >= this.startDate && date <= this.endDate;\n    },\n\n    keydown: function (e) {\n      if (this.picker.is(':not(:visible)')) {\n        if (e.keyCode == 27) // allow escape to hide and re-show picker\n          this.show();\n        return;\n      }\n      var dateChanged = false,\n        dir, day, month,\n        newDate, newViewDate;\n      switch (e.keyCode) {\n        case 27: // escape\n          this.hide();\n          e.preventDefault();\n          break;\n        case 37: // left\n        case 39: // right\n          if (!this.keyboardNavigation) break;\n          dir = e.keyCode == 37 ? -1 : 1;\n          viewMode = this.viewMode;\n          if (e.ctrlKey) {\n            viewMode += 2;\n          } else if (e.shiftKey) {\n            viewMode += 1;\n          }\n          if (viewMode == 4) {\n            newDate = this.moveYear(this.date, dir);\n            newViewDate = this.moveYear(this.viewDate, dir);\n          } else if (viewMode == 3) {\n            newDate = this.moveMonth(this.date, dir);\n            newViewDate = this.moveMonth(this.viewDate, dir);\n          } else if (viewMode == 2) {\n            newDate = this.moveDate(this.date, dir);\n            newViewDate = this.moveDate(this.viewDate, dir);\n          } else if (viewMode == 1) {\n            newDate = this.moveHour(this.date, dir);\n            newViewDate = this.moveHour(this.viewDate, dir);\n          } else if (viewMode == 0) {\n            newDate = this.moveMinute(this.date, dir);\n            newViewDate = this.moveMinute(this.viewDate, dir);\n          }\n          if (this.dateWithinRange(newDate)) {\n            this.date = newDate;\n            this.viewDate = newViewDate;\n            this.setValue();\n            this.update();\n            e.preventDefault();\n            dateChanged = true;\n          }\n          break;\n        case 38: // up\n        case 40: // down\n          if (!this.keyboardNavigation) break;\n          dir = e.keyCode == 38 ? -1 : 1;\n          viewMode = this.viewMode;\n          if (e.ctrlKey) {\n            viewMode += 2;\n          } else if (e.shiftKey) {\n            viewMode += 1;\n          }\n          if (viewMode == 4) {\n            newDate = this.moveYear(this.date, dir);\n            newViewDate = this.moveYear(this.viewDate, dir);\n          } else if (viewMode == 3) {\n            newDate = this.moveMonth(this.date, dir);\n            newViewDate = this.moveMonth(this.viewDate, dir);\n          } else if (viewMode == 2) {\n            newDate = this.moveDate(this.date, dir * 7);\n            newViewDate = this.moveDate(this.viewDate, dir * 7);\n          } else if (viewMode == 1) {\n            if (this.showMeridian) {\n              newDate = this.moveHour(this.date, dir * 6);\n              newViewDate = this.moveHour(this.viewDate, dir * 6);\n            } else {\n              newDate = this.moveHour(this.date, dir * 4);\n              newViewDate = this.moveHour(this.viewDate, dir * 4);\n            }\n          } else if (viewMode == 0) {\n            newDate = this.moveMinute(this.date, dir * 4);\n            newViewDate = this.moveMinute(this.viewDate, dir * 4);\n          }\n          if (this.dateWithinRange(newDate)) {\n            this.date = newDate;\n            this.viewDate = newViewDate;\n            this.setValue();\n            this.update();\n            e.preventDefault();\n            dateChanged = true;\n          }\n          break;\n        case 13: // enter\n          if (this.viewMode != 0) {\n            var oldViewMode = this.viewMode;\n            this.showMode(-1);\n            this.fill();\n            if (oldViewMode == this.viewMode && this.autoclose) {\n              this.hide();\n            }\n          } else {\n            this.fill();\n            if (this.autoclose) {\n              this.hide();\n            }\n          }\n          e.preventDefault();\n          break;\n        case 9: // tab\n          this.hide();\n          break;\n      }\n      if (dateChanged) {\n        var element;\n        if (this.isInput) {\n          element = this.element;\n        } else if (this.component) {\n          element = this.element.find('input');\n        }\n        if (element) {\n          element.change();\n        }\n        this.element.trigger({\n          type: 'changeDate',\n          date: this.date\n        });\n      }\n    },\n\n    showMode: function (dir) {\n      if (dir) {\n        var newViewMode = Math.max(0, Math.min(DPGlobal.modes.length - 1, this.viewMode + dir));\n        if (newViewMode >= this.minView && newViewMode <= this.maxView) {\n          this.element.trigger({\n            type:        'changeMode',\n            date:        this.viewDate,\n            oldViewMode: this.viewMode,\n            newViewMode: newViewMode\n          });\n\n          this.viewMode = newViewMode;\n        }\n      }\n      /*\n       vitalets: fixing bug of very special conditions:\n       jquery 1.7.1 + webkit + show inline datetimepicker in bootstrap popover.\n       Method show() does not set display css correctly and datetimepicker is not shown.\n       Changed to .css('display', 'block') solve the problem.\n       See https://github.com/vitalets/x-editable/issues/37\n\n       In jquery 1.7.2+ everything works fine.\n       */\n      //this.picker.find('>div').hide().filter('.datetimepicker-'+DPGlobal.modes[this.viewMode].clsName).show();\n      this.picker.find('>div').hide().filter('.datetimepicker-' + DPGlobal.modes[this.viewMode].clsName).css('display', 'block');\n      this.updateNavArrows();\n    },\n\n    reset: function (e) {\n      this._setDate(null, 'date');\n    },\n\n    convertViewModeText:  function (viewMode) {\n      switch (viewMode) {\n        case 4:\n          return 'decade';\n        case 3:\n          return 'year';\n        case 2:\n          return 'month';\n        case 1:\n          return 'day';\n        case 0:\n          return 'hour';\n      }\n    }\n  };\n\n  var old = $.fn.datetimepicker;\n  $.fn.datetimepicker = function (option) {\n    var args = Array.apply(null, arguments);\n    args.shift();\n    var internal_return;\n    this.each(function () {\n      var $this = $(this),\n        data = $this.data('datetimepicker'),\n        options = typeof option == 'object' && option;\n      if (!data) {\n        $this.data('datetimepicker', (data = new Datetimepicker(this, $.extend({}, $.fn.datetimepicker.defaults, options))));\n      }\n      if (typeof option == 'string' && typeof data[option] == 'function') {\n        internal_return = data[option].apply(data, args);\n        if (internal_return !== undefined) {\n          return false;\n        }\n      }\n    });\n    if (internal_return !== undefined)\n      return internal_return;\n    else\n      return this;\n  };\n\n  $.fn.datetimepicker.defaults = {\n  };\n  $.fn.datetimepicker.Constructor = Datetimepicker;\n  var dates = $.fn.datetimepicker.dates = {\n    en: {\n      days:        ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],\n      daysShort:   ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],\n      daysMin:     ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa', 'Su'],\n      months:      ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],\n      monthsShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\n      meridiem:    ['am', 'pm'],\n      suffix:      ['st', 'nd', 'rd', 'th'],\n      today:       'Today'\n    }\n  };\n\n  var DPGlobal = {\n    modes:            [\n      {\n        clsName: 'minutes',\n        navFnc:  'Hours',\n        navStep: 1\n      },\n      {\n        clsName: 'hours',\n        navFnc:  'Date',\n        navStep: 1\n      },\n      {\n        clsName: 'days',\n        navFnc:  'Month',\n        navStep: 1\n      },\n      {\n        clsName: 'months',\n        navFnc:  'FullYear',\n        navStep: 1\n      },\n      {\n        clsName: 'years',\n        navFnc:  'FullYear',\n        navStep: 10\n      }\n    ],\n    isLeapYear:       function (year) {\n      return (((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0))\n    },\n    getDaysInMonth:   function (year, month) {\n      return [31, (DPGlobal.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month]\n    },\n    getDefaultFormat: function (type, field) {\n      if (type == 'standard') {\n        if (field == 'input')\n          return 'yyyy-mm-dd hh:ii';\n        else\n          return 'yyyy-mm-dd hh:ii:ss';\n      } else if (type == 'php') {\n        if (field == 'input')\n          return 'Y-m-d H:i';\n        else\n          return 'Y-m-d H:i:s';\n      } else {\n        throw new Error('Invalid format type.');\n      }\n    },\n    validParts: function (type) {\n      if (type == 'standard') {\n        return /hh?|HH?|p|P|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;\n      } else if (type == 'php') {\n        return /[dDjlNwzFmMnStyYaABgGhHis]/g;\n      } else {\n        throw new Error('Invalid format type.');\n      }\n    },\n    nonpunctuation: /[^ -\\/:-@\\[-`{-~\\t\\n\\rTZ]+/g,\n    parseFormat: function (format, type) {\n      // IE treats \\0 as a string end in inputs (truncating the value),\n      // so it's a bad format delimiter, anyway\n      var separators = format.replace(this.validParts(type), '\\0').split('\\0'),\n        parts = format.match(this.validParts(type));\n      if (!separators || !separators.length || !parts || parts.length == 0) {\n        throw new Error('Invalid date format.');\n      }\n      return {separators: separators, parts: parts};\n    },\n    parseDate: function (date, format, language, type) {\n      if (date instanceof Date) {\n        var dateUTC = new Date(date.valueOf() - date.getTimezoneOffset() * 60000);\n        dateUTC.setMilliseconds(0);\n        return dateUTC;\n      }\n      if (/^\\d{4}\\-\\d{1,2}\\-\\d{1,2}$/.test(date)) {\n        format = this.parseFormat('yyyy-mm-dd', type);\n      }\n      if (/^\\d{4}\\-\\d{1,2}\\-\\d{1,2}[T ]\\d{1,2}\\:\\d{1,2}$/.test(date)) {\n        format = this.parseFormat('yyyy-mm-dd hh:ii', type);\n      }\n      if (/^\\d{4}\\-\\d{1,2}\\-\\d{1,2}[T ]\\d{1,2}\\:\\d{1,2}\\:\\d{1,2}[Z]{0,1}$/.test(date)) {\n        format = this.parseFormat('yyyy-mm-dd hh:ii:ss', type);\n      }\n      if (/^[-+]\\d+[dmwy]([\\s,]+[-+]\\d+[dmwy])*$/.test(date)) {\n        var part_re = /([-+]\\d+)([dmwy])/,\n          parts = date.match(/([-+]\\d+)([dmwy])/g),\n          part, dir;\n        date = new Date();\n        for (var i = 0; i < parts.length; i++) {\n          part = part_re.exec(parts[i]);\n          dir = parseInt(part[1]);\n          switch (part[2]) {\n            case 'd':\n              date.setUTCDate(date.getUTCDate() + dir);\n              break;\n            case 'm':\n              date = Datetimepicker.prototype.moveMonth.call(Datetimepicker.prototype, date, dir);\n              break;\n            case 'w':\n              date.setUTCDate(date.getUTCDate() + dir * 7);\n              break;\n            case 'y':\n              date = Datetimepicker.prototype.moveYear.call(Datetimepicker.prototype, date, dir);\n              break;\n          }\n        }\n        return UTCDate(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds(), 0);\n      }\n      var parts = date && date.toString().match(this.nonpunctuation) || [],\n        date = new Date(0, 0, 0, 0, 0, 0, 0),\n        parsed = {},\n        setters_order = ['hh', 'h', 'ii', 'i', 'ss', 's', 'yyyy', 'yy', 'M', 'MM', 'm', 'mm', 'D', 'DD', 'd', 'dd', 'H', 'HH', 'p', 'P'],\n        setters_map = {\n          hh:   function (d, v) {\n            return d.setUTCHours(v);\n          },\n          h:    function (d, v) {\n            return d.setUTCHours(v);\n          },\n          HH:   function (d, v) {\n            return d.setUTCHours(v == 12 ? 0 : v);\n          },\n          H:    function (d, v) {\n            return d.setUTCHours(v == 12 ? 0 : v);\n          },\n          ii:   function (d, v) {\n            return d.setUTCMinutes(v);\n          },\n          i:    function (d, v) {\n            return d.setUTCMinutes(v);\n          },\n          ss:   function (d, v) {\n            return d.setUTCSeconds(v);\n          },\n          s:    function (d, v) {\n            return d.setUTCSeconds(v);\n          },\n          yyyy: function (d, v) {\n            return d.setUTCFullYear(v);\n          },\n          yy:   function (d, v) {\n            return d.setUTCFullYear(2000 + v);\n          },\n          m:    function (d, v) {\n            v -= 1;\n            while (v < 0) v += 12;\n            v %= 12;\n            d.setUTCMonth(v);\n            while (d.getUTCMonth() != v)\n              if (isNaN(d.getUTCMonth()))\n                return d;\n              else\n                d.setUTCDate(d.getUTCDate() - 1);\n            return d;\n          },\n          d:    function (d, v) {\n            return d.setUTCDate(v);\n          },\n          p:    function (d, v) {\n            return d.setUTCHours(v == 1 ? d.getUTCHours() + 12 : d.getUTCHours());\n          }\n        },\n        val, filtered, part;\n      setters_map['M'] = setters_map['MM'] = setters_map['mm'] = setters_map['m'];\n      setters_map['dd'] = setters_map['d'];\n      setters_map['P'] = setters_map['p'];\n      date = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds());\n      if (parts.length == format.parts.length) {\n        for (var i = 0, cnt = format.parts.length; i < cnt; i++) {\n          val = parseInt(parts[i], 10);\n          part = format.parts[i];\n          if (isNaN(val)) {\n            switch (part) {\n              case 'MM':\n                filtered = $(dates[language].months).filter(function () {\n                  var m = this.slice(0, parts[i].length),\n                    p = parts[i].slice(0, m.length);\n                  return m == p;\n                });\n                val = $.inArray(filtered[0], dates[language].months) + 1;\n                break;\n              case 'M':\n                filtered = $(dates[language].monthsShort).filter(function () {\n                  var m = this.slice(0, parts[i].length),\n                    p = parts[i].slice(0, m.length);\n                  return m.toLowerCase() == p.toLowerCase();\n                });\n                val = $.inArray(filtered[0], dates[language].monthsShort) + 1;\n                break;\n              case 'p':\n              case 'P':\n                val = $.inArray(parts[i].toLowerCase(), dates[language].meridiem);\n                break;\n            }\n          }\n          parsed[part] = val;\n        }\n        for (var i = 0, s; i < setters_order.length; i++) {\n          s = setters_order[i];\n          if (s in parsed && !isNaN(parsed[s]))\n            setters_map[s](date, parsed[s])\n        }\n      }\n      return date;\n    },\n    formatDate:       function (date, format, language, type) {\n      if (date == null) {\n        return '';\n      }\n      var val;\n      if (type == 'standard') {\n        val = {\n          // year\n          yy:   date.getUTCFullYear().toString().substring(2),\n          yyyy: date.getUTCFullYear(),\n          // month\n          m:    date.getUTCMonth() + 1,\n          M:    dates[language].monthsShort[date.getUTCMonth()],\n          MM:   dates[language].months[date.getUTCMonth()],\n          // day\n          d:    date.getUTCDate(),\n          D:    dates[language].daysShort[date.getUTCDay()],\n          DD:   dates[language].days[date.getUTCDay()],\n          p:    (dates[language].meridiem.length == 2 ? dates[language].meridiem[date.getUTCHours() < 12 ? 0 : 1] : ''),\n          // hour\n          h:    date.getUTCHours(),\n          // minute\n          i:    date.getUTCMinutes(),\n          // second\n          s:    date.getUTCSeconds()\n        };\n\n        if (dates[language].meridiem.length == 2) {\n          val.H = (val.h % 12 == 0 ? 12 : val.h % 12);\n        }\n        else {\n          val.H = val.h;\n        }\n        val.HH = (val.H < 10 ? '0' : '') + val.H;\n        val.P = val.p.toUpperCase();\n        val.hh = (val.h < 10 ? '0' : '') + val.h;\n        val.ii = (val.i < 10 ? '0' : '') + val.i;\n        val.ss = (val.s < 10 ? '0' : '') + val.s;\n        val.dd = (val.d < 10 ? '0' : '') + val.d;\n        val.mm = (val.m < 10 ? '0' : '') + val.m;\n      } else if (type == 'php') {\n        // php format\n        val = {\n          // year\n          y: date.getUTCFullYear().toString().substring(2),\n          Y: date.getUTCFullYear(),\n          // month\n          F: dates[language].months[date.getUTCMonth()],\n          M: dates[language].monthsShort[date.getUTCMonth()],\n          n: date.getUTCMonth() + 1,\n          t: DPGlobal.getDaysInMonth(date.getUTCFullYear(), date.getUTCMonth()),\n          // day\n          j: date.getUTCDate(),\n          l: dates[language].days[date.getUTCDay()],\n          D: dates[language].daysShort[date.getUTCDay()],\n          w: date.getUTCDay(), // 0 -> 6\n          N: (date.getUTCDay() == 0 ? 7 : date.getUTCDay()),       // 1 -> 7\n          S: (date.getUTCDate() % 10 <= dates[language].suffix.length ? dates[language].suffix[date.getUTCDate() % 10 - 1] : ''),\n          // hour\n          a: (dates[language].meridiem.length == 2 ? dates[language].meridiem[date.getUTCHours() < 12 ? 0 : 1] : ''),\n          g: (date.getUTCHours() % 12 == 0 ? 12 : date.getUTCHours() % 12),\n          G: date.getUTCHours(),\n          // minute\n          i: date.getUTCMinutes(),\n          // second\n          s: date.getUTCSeconds()\n        };\n        val.m = (val.n < 10 ? '0' : '') + val.n;\n        val.d = (val.j < 10 ? '0' : '') + val.j;\n        val.A = val.a.toString().toUpperCase();\n        val.h = (val.g < 10 ? '0' : '') + val.g;\n        val.H = (val.G < 10 ? '0' : '') + val.G;\n        val.i = (val.i < 10 ? '0' : '') + val.i;\n        val.s = (val.s < 10 ? '0' : '') + val.s;\n      } else {\n        throw new Error('Invalid format type.');\n      }\n      var date = [],\n        seps = $.extend([], format.separators);\n      for (var i = 0, cnt = format.parts.length; i < cnt; i++) {\n        if (seps.length) {\n          date.push(seps.shift());\n        }\n        date.push(val[format.parts[i]]);\n      }\n      if (seps.length) {\n        date.push(seps.shift());\n      }\n      return date.join('');\n    },\n    convertViewMode:  function (viewMode) {\n      switch (viewMode) {\n        case 4:\n        case 'decade':\n          viewMode = 4;\n          break;\n        case 3:\n        case 'year':\n          viewMode = 3;\n          break;\n        case 2:\n        case 'month':\n          viewMode = 2;\n          break;\n        case 1:\n        case 'day':\n          viewMode = 1;\n          break;\n        case 0:\n        case 'hour':\n          viewMode = 0;\n          break;\n      }\n\n      return viewMode;\n    },\n    headTemplate: '<thead>' +\n                '<tr>' +\n                '<th class=\"prev\"><i class=\"{iconType} {leftArrow}\"/></th>' +\n                '<th colspan=\"5\" class=\"switch\"></th>' +\n                '<th class=\"next\"><i class=\"{iconType} {rightArrow}\"/></th>' +\n                '</tr>' +\n      '</thead>',\n    headTemplateV3: '<thead>' +\n                '<tr>' +\n                '<th class=\"prev\"><span class=\"{iconType} {leftArrow}\"></span> </th>' +\n                '<th colspan=\"5\" class=\"switch\"></th>' +\n                '<th class=\"next\"><span class=\"{iconType} {rightArrow}\"></span> </th>' +\n                '</tr>' +\n      '</thead>',\n    contTemplate: '<tbody><tr><td colspan=\"7\"></td></tr></tbody>',\n    footTemplate: '<tfoot><tr><th colspan=\"7\" class=\"today\"></th></tr></tfoot>'\n  };\n  DPGlobal.template = '<div class=\"datetimepicker\">' +\n    '<div class=\"datetimepicker-minutes\">' +\n    '<table class=\" table-condensed\">' +\n    DPGlobal.headTemplate +\n    DPGlobal.contTemplate +\n    DPGlobal.footTemplate +\n    '</table>' +\n    '</div>' +\n    '<div class=\"datetimepicker-hours\">' +\n    '<table class=\" table-condensed\">' +\n    DPGlobal.headTemplate +\n    DPGlobal.contTemplate +\n    DPGlobal.footTemplate +\n    '</table>' +\n    '</div>' +\n    '<div class=\"datetimepicker-days\">' +\n    '<table class=\" table-condensed\">' +\n    DPGlobal.headTemplate +\n    '<tbody></tbody>' +\n    DPGlobal.footTemplate +\n    '</table>' +\n    '</div>' +\n    '<div class=\"datetimepicker-months\">' +\n    '<table class=\"table-condensed\">' +\n    DPGlobal.headTemplate +\n    DPGlobal.contTemplate +\n    DPGlobal.footTemplate +\n    '</table>' +\n    '</div>' +\n    '<div class=\"datetimepicker-years\">' +\n    '<table class=\"table-condensed\">' +\n    DPGlobal.headTemplate +\n    DPGlobal.contTemplate +\n    DPGlobal.footTemplate +\n    '</table>' +\n    '</div>' +\n    '</div>';\n  DPGlobal.templateV3 = '<div class=\"datetimepicker\">' +\n    '<div class=\"datetimepicker-minutes\">' +\n    '<table class=\" table-condensed\">' +\n    DPGlobal.headTemplateV3 +\n    DPGlobal.contTemplate +\n    DPGlobal.footTemplate +\n    '</table>' +\n    '</div>' +\n    '<div class=\"datetimepicker-hours\">' +\n    '<table class=\" table-condensed\">' +\n    DPGlobal.headTemplateV3 +\n    DPGlobal.contTemplate +\n    DPGlobal.footTemplate +\n    '</table>' +\n    '</div>' +\n    '<div class=\"datetimepicker-days\">' +\n    '<table class=\" table-condensed\">' +\n    DPGlobal.headTemplateV3 +\n    '<tbody></tbody>' +\n    DPGlobal.footTemplate +\n    '</table>' +\n    '</div>' +\n    '<div class=\"datetimepicker-months\">' +\n    '<table class=\"table-condensed\">' +\n    DPGlobal.headTemplateV3 +\n    DPGlobal.contTemplate +\n    DPGlobal.footTemplate +\n    '</table>' +\n    '</div>' +\n    '<div class=\"datetimepicker-years\">' +\n    '<table class=\"table-condensed\">' +\n    DPGlobal.headTemplateV3 +\n    DPGlobal.contTemplate +\n    DPGlobal.footTemplate +\n    '</table>' +\n    '</div>' +\n    '</div>';\n  $.fn.datetimepicker.DPGlobal = DPGlobal;\n\n  /* DATETIMEPICKER NO CONFLICT\n   * =================== */\n\n  $.fn.datetimepicker.noConflict = function () {\n    $.fn.datetimepicker = old;\n    return this;\n  };\n\n  /* DATETIMEPICKER DATA-API\n   * ================== */\n\n  $(document).on(\n    'focus.datetimepicker.data-api click.datetimepicker.data-api',\n    '[data-provide=\"datetimepicker\"]',\n    function (e) {\n      var $this = $(this);\n      if ($this.data('datetimepicker')) return;\n      e.preventDefault();\n      // component click requires us to explicitly show it\n      $this.datetimepicker('show');\n    }\n  );\n  $(function () {\n    $('[data-provide=\"datetimepicker-inline\"]').datetimepicker();\n  });\n\n}(window.jQuery);\n\n\n/**\n * Simplified Chinese translation for bootstrap-datetimepicker\n * Yuan Cheung <advanimal@gmail.com>\n */\n;(function($){\n    $.fn.datetimepicker.dates['zh-CN'] = {\n            days: [\"星期日\", \"星期一\", \"星期二\", \"星期三\", \"星期四\", \"星期五\", \"星期六\", \"星期日\"],\n            daysShort: [\"周日\", \"周一\", \"周二\", \"周三\", \"周四\", \"周五\", \"周六\", \"周日\"],\n            daysMin:  [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\", \"日\"],\n            months: [\"一月\", \"二月\", \"三月\", \"四月\", \"五月\", \"六月\", \"七月\", \"八月\", \"九月\", \"十月\", \"十一\", \"十二\"],\n            monthsShort: [\"一月\", \"二月\", \"三月\", \"四月\", \"五月\", \"六月\", \"七月\", \"八月\", \"九月\", \"十月\", \"十一\", \"十二\"],\n            today: \"今天\",\n            suffix: [],\n            meridiem: [\"上午\", \"下午\"]\n    };\n}(jQuery));\n\n\n// jQuery List DragSort v0.5.1-cmaish\n// Website: http://dragsort.codeplex.com/\n// License: http://dragsort.codeplex.com/license\n// This version from: https://github.com/cmaish/dragsort\n\n(function($) {\n\n\t$.fn.dragsort = function(options) {\n\t\tif (options == \"destroy\") {\n\t\t\t$(this.selector).trigger(\"dragsort-uninit\");\n\t\t\treturn;\n\t\t}\n\n\t\tvar opts = $.extend({}, $.fn.dragsort.defaults, options);\n\t\tvar lists = [];\n\t\tvar list = null, lastPos = null;\n\n\t\tthis.each(function(i, cont) {\n\n\t\t\t//if list container is table, the browser automatically wraps rows in tbody if not specified so change list container to tbody so that children returns rows as user expected\n\t\t\tif ($(cont).is(\"table\") && $(cont).children().size() == 1 && $(cont).children().is(\"tbody\"))\n\t\t\t\tcont = $(cont).children().get(0);\n\n\t\t\tvar newList = {\n\t\t\t\tdraggedItem: null,\n\t\t\t\tplaceHolderItem: null,\n\t\t\t\tpos: null,\n\t\t\t\toffset: null,\n\t\t\t\toffsetLimit: null,\n\t\t\t\tscroll: null,\n\t\t\t\tcontainer: cont,\n\n\t\t\t\tinit: function() {\n\t\t\t\t\t//set options to default values if not set\n\t\t\t\t\topts.tagName = $(this.container).children().size() == 0 ? \"li\" : $(this.container).children().get(0).tagName.toLowerCase();\n\t\t\t\t\tif (opts.itemSelector == \"\")\n\t\t\t\t\t\topts.itemSelector = opts.tagName;\n\t\t\t\t\tif (opts.dragSelector == \"\")\n\t\t\t\t\t\topts.dragSelector = opts.tagName;\n\t\t\t\t\tif (opts.placeHolderTemplate == \"\")\n\t\t\t\t\t\topts.placeHolderTemplate = \"<\" + opts.tagName + \">&nbsp;</\" + opts.tagName + \">\";\n\n\t\t\t\t\t//listidx allows reference back to correct list variable instance\n\t\t\t\t\t$(this.container).attr(\"data-listidx\", i).mousedown(this.grabItem).bind(\"dragsort-uninit\", this.uninit);\n\t\t\t\t\tthis.styleDragHandlers(true);\n\t\t\t\t},\n\n\t\t\t\tuninit: function() {\n\t\t\t\t\tvar list = lists[$(this).attr(\"data-listidx\")];\n\t\t\t\t\t$(list.container).unbind(\"mousedown\", list.grabItem).unbind(\"dragsort-uninit\");\n\t\t\t\t\tlist.styleDragHandlers(false);\n\t\t\t\t},\n\n\t\t\t\tgetItems: function() {\n\t\t\t\t\treturn $(this.container).children(opts.itemSelector);\n\t\t\t\t},\n\n\t\t\t\tstyleDragHandlers: function(cursor) {\n\t\t\t\t\tthis.getItems().map(function() { return $(this).is(opts.dragSelector) ? this : $(this).find(opts.dragSelector).get(); }).css(\"cursor\", cursor ? \"pointer\" : \"\");\n\t\t\t\t},\n\n\t\t\t\tgrabItem: function(e) {\n\t\t\t\t\tvar list = lists[$(this).attr(\"data-listidx\")];\n\t\t\t\t\tvar item = $(e.target).closest(\"[data-listidx] > \" + opts.tagName).get(0);\n\t\t\t\t\tvar insideMoveableItem = list.getItems().filter(function() { return this == item; }).size() > 0;\n\n\t\t\t\t\t//if not left click or if clicked on excluded element (e.g. text box) or not a moveable list item return\n\t\t\t\t\tif (e.which != 1 || $(e.target).is(opts.dragSelectorExclude) || $(e.target).closest(opts.dragSelectorExclude).size() > 0 || !insideMoveableItem)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t//prevents selection, stops issue on Fx where dragging hyperlink doesn't work and on IE where it triggers mousemove even though mouse hasn't moved,\n\t\t\t\t\t//does also stop being able to click text boxes hence dragging on text boxes by default is disabled in dragSelectorExclude\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t//change cursor to move while dragging\n\t\t\t\t\tvar dragHandle = e.target;\n\t\t\t\t\twhile (!$(dragHandle).is(opts.dragSelector)) {\n\t\t\t\t\t\tif (dragHandle == this) return;\n\t\t\t\t\t\tdragHandle = dragHandle.parentNode;\n\t\t\t\t\t}\n\t\t\t\t\t$(dragHandle).attr(\"data-cursor\", $(dragHandle).css(\"cursor\"));\n\t\t\t\t\t$(dragHandle).css(\"cursor\", \"move\");\n\n\t\t\t\t\t//on mousedown wait for movement of mouse before triggering dragsort script (dragStart) to allow clicking of hyperlinks to work\n\t\t\t\t\tvar listElem = this;\n\t\t\t\t\tvar trigger = function() {\n\t\t\t\t\t\tlist.dragStart.call(listElem, e);\n\t\t\t\t\t\t$(list.container).unbind(\"mousemove\", trigger);\n\t\t\t\t\t};\n\t\t\t\t\t$(list.container).mousemove(trigger).mouseup(function() { $(list.container).unbind(\"mousemove\", trigger); $(dragHandle).css(\"cursor\", $(dragHandle).attr(\"data-cursor\")); });\n\t\t\t\t},\n\n\t\t\t\tdragStart: function(e) {\n\t\t\t\t\tif (list != null && list.draggedItem != null)\n\t\t\t\t\t\tlist.dropItem();\n\n\t\t\t\t\tlist = lists[$(this).attr(\"data-listidx\")];\n\t\t\t\t\tlist.draggedItem = $(e.target).closest(\"[data-listidx] > \" + opts.tagName)\n\t\t\t\t\t\n\t\t\t\t\t//raise event\n\t\t\t\t\tif (opts.dragStart.apply(list.draggedItem) === false) {\n\t\t\t\t\t    list.draggedItem = null;\n\t\t\t\t\t    return;\n\t\t\t\t\t}\n\n\t\t\t\t\t//record current position so on dragend we know if the dragged item changed position or not, not using getItems to allow dragsort to restore dragged item to original location in relation to fixed items\n\t\t\t\t\tlist.draggedItem.attr(\"data-origpos\", $(this).attr(\"data-listidx\") + \"-\" + $(list.container).children().index(list.draggedItem));\n\n\t\t\t\t\t//calculate mouse offset relative to draggedItem\n\t\t\t\t\tvar mt = parseInt(list.draggedItem.css(\"marginTop\"));\n\t\t\t\t\tvar ml = parseInt(list.draggedItem.css(\"marginLeft\"));\n\t\t\t\t\tlist.offset = list.draggedItem.offset();\n\t\t\t\t\tlist.offset.top = e.pageY - list.offset.top + (isNaN(mt) ? 0 : mt) - 1;\n\t\t\t\t\tlist.offset.left = e.pageX - list.offset.left + (isNaN(ml) ? 0 : ml) - 1;\n\n\t\t\t\t\t//calculate box the dragged item can't be dragged outside of\n\t\t\t\t\tif (!opts.dragBetween) {\n\t\t\t\t\t\tvar containerHeight = $(list.container).outerHeight() == 0 ? Math.max(1, Math.round(0.5 + list.getItems().size() * list.draggedItem.outerWidth() / $(list.container).outerWidth())) * list.draggedItem.outerHeight() : $(list.container).outerHeight();\n\t\t\t\t\t\tlist.offsetLimit = $(list.container).offset();\n\t\t\t\t\t\tlist.offsetLimit.right = list.offsetLimit.left + $(list.container).outerWidth() - list.draggedItem.outerWidth();\n\t\t\t\t\t\tlist.offsetLimit.bottom = list.offsetLimit.top + containerHeight - list.draggedItem.outerHeight();\n\t\t\t\t\t}\n\n\t\t\t\t\t//create placeholder item\n\t\t\t\t\tvar h = list.draggedItem.height();\n\t\t\t\t\tvar w = list.draggedItem.width();\n\t\t\t\t\tif (opts.tagName == \"tr\") {\n\t\t\t\t\t\tlist.draggedItem.children().each(function() { $(this).width($(this).width()); });\n\t\t\t\t\t\tlist.placeHolderItem = list.draggedItem.clone().attr(\"data-placeholder\", true);\n\t\t\t\t\t\tlist.draggedItem.after(list.placeHolderItem);\n\t\t\t\t\t\tlist.placeHolderItem.children().each(function() { $(this).css({ borderWidth:0, width: $(this).width() + 1, height: $(this).height() + 1 }).html(\"&nbsp;\"); });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlist.draggedItem.after(opts.placeHolderTemplate);\n\t\t\t\t\t\tlist.placeHolderItem = list.draggedItem.next().css({ height: h, width: w }).attr(\"data-placeholder\", true);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (opts.tagName == \"td\") {\n\t\t\t\t\t\tvar listTable = list.draggedItem.closest(\"table\").get(0);\n\t\t\t\t\t\t$(\"<table id='\" + listTable.id + \"' style='border-width: 0px;' class='dragSortItem \" + listTable.className + \"'><tr></tr></table>\").appendTo(\"body\").children().append(list.draggedItem);\n\t\t\t\t\t}\n\n\t\t\t\t\t//style draggedItem while dragging\n\t\t\t\t\tvar orig = list.draggedItem.attr(\"style\");\n\t\t\t\t\tlist.draggedItem.attr(\"data-origstyle\", orig ? orig : \"\");\n\t\t\t\t\tlist.draggedItem.css({ position: \"absolute\", opacity: 0.8, \"z-index\": 999, height: h, width: w });\n\n\t\t\t\t\t//auto-scroll setup\n\t\t\t\t\tlist.scroll = { moveX: 0, moveY: 0, maxX: $(document).width() - $(window).width(), maxY: $(document).height() - $(window).height() };\n\t\t\t\t\tlist.scroll.scrollY = window.setInterval(function() {\n\t\t\t\t\t\tif (opts.scrollContainer != window) {\n\t\t\t\t\t\t\t$(opts.scrollContainer).scrollTop($(opts.scrollContainer).scrollTop() + list.scroll.moveY);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar t = $(opts.scrollContainer).scrollTop();\n\t\t\t\t\t\tif (list.scroll.moveY > 0 && t < list.scroll.maxY || list.scroll.moveY < 0 && t > 0) {\n\t\t\t\t\t\t\t$(opts.scrollContainer).scrollTop(t + list.scroll.moveY);\n\t\t\t\t\t\t\tlist.draggedItem.css(\"top\", list.draggedItem.offset().top + list.scroll.moveY + 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 10);\n\t\t\t\t\tlist.scroll.scrollX = window.setInterval(function() {\n\t\t\t\t\t\tif (opts.scrollContainer != window) {\n\t\t\t\t\t\t\t$(opts.scrollContainer).scrollLeft($(opts.scrollContainer).scrollLeft() + list.scroll.moveX);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar l = $(opts.scrollContainer).scrollLeft();\n\t\t\t\t\t\tif (list.scroll.moveX > 0 && l < list.scroll.maxX || list.scroll.moveX < 0 && l > 0) {\n\t\t\t\t\t\t\t$(opts.scrollContainer).scrollLeft(l + list.scroll.moveX);\n\t\t\t\t\t\t\tlist.draggedItem.css(\"left\", list.draggedItem.offset().left + list.scroll.moveX + 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 10);\n\n\t\t\t\t\t//misc\n\t\t\t\t\t$(lists).each(function(i, l) { l.createDropTargets(); l.buildPositionTable(); });\n\t\t\t\t\tlist.setPos(e.pageX, e.pageY);\n\t\t\t\t\t$(document).bind(\"mousemove\", list.swapItems);\n\t\t\t\t\t$(document).bind(\"mouseup\", list.dropItem);\n\t\t\t\t\tif (opts.scrollContainer != window)\n\t\t\t\t\t\t$(window).bind(\"DOMMouseScroll mousewheel\", list.wheel);\n\t\t\t\t},\n\n\t\t\t\t//set position of draggedItem\n\t\t\t\tsetPos: function(x, y) { \n\t\t\t\t\t//remove mouse offset so mouse cursor remains in same place on draggedItem instead of top left corner\n\t\t\t\t\tvar top = y - this.offset.top;\n\t\t\t\t\tvar left = x - this.offset.left;\n\n\t\t\t\t\t//limit top, left to within box draggedItem can't be dragged outside of\n\t\t\t\t\tif (!opts.dragBetween) {\n\t\t\t\t\t\ttop = Math.min(this.offsetLimit.bottom, Math.max(top, this.offsetLimit.top));\n\t\t\t\t\t\tleft = Math.min(this.offsetLimit.right, Math.max(left, this.offsetLimit.left));\n\t\t\t\t\t}\n\n\t\t\t\t\t//adjust top & left calculations to parent offset\n\t\t\t\t\tvar parent = this.draggedItem.offsetParent().not(\"body\").offset(); //offsetParent returns body even when it's static, if not static offset is only factoring margin\n\t\t\t\t\tif (parent != null) {\n\t\t\t\t\t\ttop -= parent.top;\n\t\t\t\t\t\tleft -= parent.left;\n\t\t\t\t\t}\n\n\t\t\t\t\t//set x or y auto-scroll amount\n\t\t\t\t\tif (opts.scrollContainer == window) {\n\t\t\t\t\t\ty -= $(window).scrollTop();\n\t\t\t\t\t\tx -= $(window).scrollLeft();\n\t\t\t\t\t\ty = Math.max(0, y - $(window).height() + 5) + Math.min(0, y - 5);\n\t\t\t\t\t\tx = Math.max(0, x - $(window).width() + 5) + Math.min(0, x - 5);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar cont = $(opts.scrollContainer);\n\t\t\t\t\t\tvar offset = cont.offset();\n\t\t\t\t\t\ty = Math.max(0, y - cont.height() - offset.top) + Math.min(0, y - offset.top);\n\t\t\t\t\t\tx = Math.max(0, x - cont.width() - offset.left) + Math.min(0, x - offset.left);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tlist.scroll.moveX = x == 0 ? 0 : x * opts.scrollSpeed / Math.abs(x);\n\t\t\t\t\tlist.scroll.moveY = y == 0 ? 0 : y * opts.scrollSpeed / Math.abs(y);\n\n\t\t\t\t\t//move draggedItem to new mouse cursor location\n\t\t\t\t\tthis.draggedItem.css({ top: top, left: left });\n\t\t\t\t},\n\n\t\t\t\t//if scroll container is a div allow mouse wheel to scroll div instead of window when mouse is hovering over\n\t\t\t\twheel: function(e) {\n\t\t\t\t\tif (($.browser.safari || $.browser.mozilla) && list && opts.scrollContainer != window) {\n\t\t\t\t\t\tvar cont = $(opts.scrollContainer);\n\t\t\t\t\t\tvar offset = cont.offset();\n\t\t\t\t\t\tif (e.pageX > offset.left && e.pageX < offset.left + cont.width() && e.pageY > offset.top && e.pageY < offset.top + cont.height()) {\n\t\t\t\t\t\t\tvar delta = e.detail ? e.detail * 5 : e.wheelDelta / -2;\n\t\t\t\t\t\t\tcont.scrollTop(cont.scrollTop() + delta);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t//build a table recording all the positions of the moveable list items\n\t\t\t\tbuildPositionTable: function() {\n\t\t\t\t\tvar pos = [];\n\t\t\t\t\tthis.getItems().not([list.draggedItem[0], list.placeHolderItem[0]]).each(function(i) {\n\t\t\t\t\t\tvar loc = $(this).offset();\n\t\t\t\t\t\tloc.right = loc.left + $(this).outerWidth();\n\t\t\t\t\t\tloc.bottom = loc.top + $(this).outerHeight();\n\t\t\t\t\t\tloc.elm = this;\n\t\t\t\t\t\tpos[i] = loc;\n\t\t\t\t\t});\n\t\t\t\t\tthis.pos = pos;\n\t\t\t\t},\n\n\t\t\t\tdropItem: function() {\n\t\t\t\t\tif (list.draggedItem == null)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t//list.draggedItem.attr(\"style\", \"\") doesn't work on IE8 and jQuery 1.5 or lower\n\t\t\t\t\t//list.draggedItem.removeAttr(\"style\") doesn't work on chrome and jQuery 1.6 (works jQuery 1.5 or lower)\n\t\t\t\t\tvar orig = list.draggedItem.attr(\"data-origstyle\");\n\t\t\t\t\tlist.draggedItem.attr(\"style\", orig);\n\t\t\t\t\tif (orig == \"\")\n\t\t\t\t\t\tlist.draggedItem.removeAttr(\"style\");\n\t\t\t\t\tlist.draggedItem.removeAttr(\"data-origstyle\");\n\n\t\t\t\t\tlist.styleDragHandlers(true);\n\n\t\t\t\t\tlist.placeHolderItem.before(list.draggedItem);\n\t\t\t\t\tlist.placeHolderItem.remove();\n\n\t\t\t\t\t$(\"[data-droptarget], .dragSortItem\").remove();\n\n\t\t\t\t\twindow.clearInterval(list.scroll.scrollY);\n\t\t\t\t\twindow.clearInterval(list.scroll.scrollX);\n\n\t\t\t\t\t//if position changed call dragEnd\n\t\t\t\t\tif (list.draggedItem.attr(\"data-origpos\") != $(lists).index(list) + \"-\" + $(list.container).children().index(list.draggedItem))\n\t\t\t\t\t\tif (opts.dragEnd.apply(list.draggedItem) == false) { //if dragEnd returns false revert order\n\t\t\t\t\t\t\tvar pos = list.draggedItem.attr(\"data-origpos\").split('-');\n\t\t\t\t\t\t\tvar nextItem = $(lists[pos[0]].container).children().not(list.draggedItem).eq(pos[1]);\n\t\t\t\t\t\t\tif (nextItem.size() > 0)\n\t\t\t\t\t\t\t\tnextItem.before(list.draggedItem);\n\t\t\t\t\t\t\telse if (pos[1] == 0) //was the only item in list\n\t\t\t\t\t\t\t\t$(lists[pos[0]].container).prepend(list.draggedItem);\n\t\t\t\t\t\t\telse //was the last item in list\n\t\t\t\t\t\t\t\t$(lists[pos[0]].container).append(list.draggedItem);\n\t\t\t\t\t\t}\n\t\t\t\t\tlist.draggedItem.removeAttr(\"data-origpos\");\n\n\t\t\t\t\tlist.draggedItem = null;\n\t\t\t\t\t$(document).unbind(\"mousemove\", list.swapItems);\n\t\t\t\t\t$(document).unbind(\"mouseup\", list.dropItem);\n\t\t\t\t\tif (opts.scrollContainer != window)\n\t\t\t\t\t\t$(window).unbind(\"DOMMouseScroll mousewheel\", list.wheel);\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\n\t\t\t\t//swap the draggedItem (represented visually by placeholder) with the list item the it has been dragged on top of\n\t\t\t\tswapItems: function(e) {\n\t\t\t\t\tif (list.draggedItem == null)\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t//move draggedItem to mouse location\n\t\t\t\t\tlist.setPos(e.pageX, e.pageY);\n\n\t\t\t\t\t//retrieve list and item position mouse cursor is over\n\t\t\t\t\tvar ei = list.findPos(e.pageX, e.pageY);\n\t\t\t\t\tvar nlist = list;\n\t\t\t\t\tfor (var i = 0; ei == -1 && opts.dragBetween && i < lists.length; i++) {\n\t\t\t\t\t\tei = lists[i].findPos(e.pageX, e.pageY);\n\t\t\t\t\t\tnlist = lists[i];\n\t\t\t\t\t}\n\n\t\t\t\t\t//if not over another moveable list item return\n\t\t\t\t\tif (ei == -1)\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t//save fixed items locations\n\t\t\t\t\tvar children = function() { return $(nlist.container).children().not(nlist.draggedItem); };\n\t\t\t\t\tvar fixed = children().not(opts.itemSelector).each(function(i) { this.idx = children().index(this); });\n\n\t\t\t\t\t//if moving draggedItem up or left place placeHolder before list item the dragged item is hovering over otherwise place it after\n\t\t\t\t\tif (lastPos == null || lastPos.top > list.draggedItem.offset().top || lastPos.left > list.draggedItem.offset().left)\n\t\t\t\t\t\t$(nlist.pos[ei].elm).before(list.placeHolderItem);\n\t\t\t\t\telse\n\t\t\t\t\t\t$(nlist.pos[ei].elm).after(list.placeHolderItem);\n\n\t\t\t\t\t//restore fixed items location\n\t\t\t\t\tfixed.each(function() {\n\t\t\t\t\t\tvar elm = children().eq(this.idx).get(0);\n\t\t\t\t\t\tif (this != elm && children().index(this) < this.idx)\n\t\t\t\t\t\t\t$(this).insertAfter(elm);\n\t\t\t\t\t\telse if (this != elm)\n\t\t\t\t\t\t\t$(this).insertBefore(elm);\n\t\t\t\t\t});\n\n\t\t\t\t\t//misc\n\t\t\t\t\t$(lists).each(function(i, l) { l.createDropTargets(); l.buildPositionTable(); });\n\t\t\t\t\tlastPos = list.draggedItem.offset();\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\n\t\t\t\t//returns the index of the list item the mouse is over\n\t\t\t\tfindPos: function(x, y) {\n\t\t\t\t\tfor (var i = 0; i < this.pos.length; i++) {\n\t\t\t\t\t\tif (this.pos[i].left < x && this.pos[i].right > x && this.pos[i].top < y && this.pos[i].bottom > y)\n\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t}\n\t\t\t\t\treturn -1;\n\t\t\t\t},\n\n\t\t\t\t//create drop targets which are placeholders at the end of other lists to allow dragging straight to the last position\n\t\t\t\tcreateDropTargets: function() {\n\t\t\t\t\tif (!opts.dragBetween)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t$(lists).each(function() {\n\t\t\t\t\t\tvar ph = $(this.container).find(\"[data-placeholder]\");\n\t\t\t\t\t\tvar dt = $(this.container).find(\"[data-droptarget]\");\n\t\t\t\t\t\tif (ph.size() > 0 && dt.size() > 0)\n\t\t\t\t\t\t\tdt.remove();\n\t\t\t\t\t\telse if (ph.size() == 0 && dt.size() == 0) {\n\t\t\t\t\t\t\tif (opts.tagName == \"td\")\n\t\t\t\t\t\t\t\t$(opts.placeHolderTemplate).attr(\"data-droptarget\", true).appendTo(this.container);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t//list.placeHolderItem.clone().removeAttr(\"data-placeholder\") crashes in IE7 and jquery 1.5.1 (doesn't in jquery 1.4.2 or IE8)\n\t\t\t\t\t\t\t\t$(this.container).append(list.placeHolderItem.removeAttr(\"data-placeholder\").clone().attr(\"data-droptarget\", true));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlist.placeHolderItem.attr(\"data-placeholder\", true);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tnewList.init();\n\t\t\tlists.push(newList);\n\t\t});\n\n\t\treturn this;\n\t};\n\n\t$.fn.dragsort.defaults = {\n\t\titemSelector: \"\",\n\t\tdragSelector: \"\",\n\t\tdragSelectorExclude: \"input, textarea\",\n\t\tdragStart: function () { },\n\t\tdragEnd: function() { },\n\t\tdragBetween: false,\n\t\tplaceHolderTemplate: \"\",\n\t\tscrollContainer: window,\n\t\tscrollSpeed: 5\n\t};\n\n})(jQuery);\n(function($) {\n    $.fn.iconpicker = function(options) {\n\n        var self = this;\n        this.buttonSize = 'sm';\n        this.columns = 10;\n        this.height = 400;\n        this.extend(options);\n        this.open = false;\n        this.allowedSizes = [\"sm\", \"lg\", \"2x\", \"3x\", \"4x\", \"5x\"];\n\n        //Templates\n        this.templates = {\n            filter: \"<div class='row'><div class='col-xs-12 form-group'><div class='icon-filter-box input-group'><span class='input-group-addon'>Filter: </span><input type='text' class='icon-filter form-control'></div></div></div>\",\n            sizes: \"<div class='row'><div class='col-xs-12 btn-group'><a class='btn btn-default' href='#' data-size='sm'>SM</a><a class='btn btn-default' href='#' data-size='lg'>LG</a><a class='btn btn-default' href='#' data-size='2x'>2X</a><a class='btn btn-default' href='#' data-size='3x'>3X</a><a class='btn btn-default' href='#' data-size='4x'>4X</a><a class='btn btn-default' href='#' data-size='5x'>5X</a></div></div>\",\n        };\n\n        //Icon List\n        this.icons = options.icons;\n\n        //Bind open menu function to element click\n        $(this).on(\"click\", function(e) {\n            self.$el = $(e.currentTarget);\n            if ($(e.currentTarget).find(\".icon-menu\").length) {\n                self.closeMenu();\n            } else {\n                self.openMenu();\n            }\n        });\n\n        //Bind event to icon click\n        $(this).on(\"click\", \".icon\", function(e) {\n            e.stopPropagation();\n            var icon = $(e.currentTarget).data(\"icon\");\n            if (self.clickCallback !== undefined) {\n                self.clickCallback(icon);\n            } else {\n                self.$el.find(\"> .form-control\").val(icon).focus().select();\n            }\n            self.closeMenu();\n        });\n\n        //Stop menu from closing if click in menu\n        $(this).on(\"click\", \".icon-menu\", function(e) {\n            e.stopPropagation();\n        });\n\n        //Bind event to filter input\n        $(this).on(\"keyup\", \".icon-filter\", function(e) {\n            var str = $(e.target).val();\n            self.doFilter(str);\n        });\n\n        //Bind event to size menu\n        $(this).on(\"click\", \".btn-group .btn\", function(e) {\n            var size = ($(e.currentTarget).data('size') == 'sm') ? '' : 'fa-' + $(e.currentTarget).data('size') ;\n            self.$sizeSelector.find('.btn').removeClass(\"active\");\n            $(e.currentTarget).addClass(\"active\");\n            self.$container.find('i').removeClass('fa-lg fa-2x fa-3x fa-4x fa-5x').addClass(size);\n            self.resize();\n        });\n\n        //Create html element\n        this.createMenu = function() {\n            this.icons = eval(this.icons);\n            this.$menu = $(\"<div>\", {class: \"icon-menu\", style: \"height:\" + this.height + \"px\"});\n            if (this.filter !== false) {\n                this.$filter = $(this.templates.filter);\n                this.$menu.append(this.$filter);\n            }\n            if (this.sizeSelector !== false) {\n                this.$sizeSelector = $(this.templates.sizes);\n                this.$sizeSelector.find('a[data-size=' + this.buttonSize + ']').addClass('active');\n                this.$menu.append(this.$sizeSelector);\n            }\n            this.$container = $(\"<div>\", {class: \"icon-container\", style: \"height:\" + this.innerHeight + \"px\"});\n            for (var i in this.icons) {\n                var size = ($.inArray(this.buttonSize, this.allowedSizes) > -1) ? \" fa-\" + this.buttonSize : \"\" ;\n                var button = $(\"<a>\", {class: \"icon\", title: this.icons[i].name, \"data-icon\": this.icons[i].selector, \"data-filter\": this.icons[i].filter});\n                button.html(\"<i class='fa fa-fw \" + this.icons[i].selector + size + \"'></i>\");\n                this.$container.append(button);\n            }\n            this.$menu.append(this.$container);\n        }\n\n        //Open Menu\n        this.openMenu = function(e) {\n            this.open = true;\n            $(this.$el).append(this.$menu);\n            this.resize();\n            this.$menu.find('.icon-filter').focus();\n        }\n\n        //Close Menu\n        this.closeMenu = function() {\n            this.open = false;\n            this.$menu.detach();\n        }\n\n        //Resize menu\n        this.resize = function(columns) {\n            this.scrollbarWidth = this.scrollbarWidth || this.getScrollbarWidth();\n            var width = Math.ceil($('.icon').outerWidth(true) * this.columns + this.scrollbarWidth) + \"px\";\n            var height = this.height - (parseInt(this.$menu.css('padding-top')) * 2);\n                height -= (this.filter !== false) ? this.$filter.outerHeight(true) : 0 ;\n                height -= (this.sizeSelector !== false) ? this.$sizeSelector.outerHeight(true) : 0 ;\n            this.$container.css({width: width, height: height});\n\n        }\n\n        //Filter function\n        this.doFilter = function(str) {\n            if (str !== \"\") {\n                $(this).find(\"a.icon[data-filter*='\" + str + \"']\").show();\n                $(this).find(\"a.icon:not([data-filter*='\" + str + \"'])\").hide();\n            } else {\n                $(this).find(\"a.icon\").show();\n            }\n        }\n\n        //Uppercase words function\n        this.ucwords = function(str) {\n            return (str.replace(/-/g, ' ') + '')\n                .replace(/^([a-z\\u00E0-\\u00FC])|\\s+([a-z\\u00E0-\\u00FC])/g, function($1) {\n                    return $1.toUpperCase();\n            });\n        }\n\n        //Object sorting function\n        this.sortObj = function(obj) {\n            var key,\n                tempArry = [],\n                i,\n                tempObj = {};\n            for ( key in obj ) {\n                tempArry.push(key);\n            }\n            tempArry.sort(\n                function(a, b) {\n                    return a.toLowerCase().localeCompare( b.toLowerCase() );\n                }\n            );\n            for ( i = 0; i < tempArry.length; i++ ) {\n                tempObj[ tempArry[i] ] = obj[ tempArry[i] ];\n            }\n            return tempObj;\n        }\n\n        //Scrollbar width\n        this.getScrollbarWidth = function() {\n            var $inner = $('<div style=\"width: 100%; height:200px;\">test</div>'),\n                $outer = $('<div style=\"width:200px;height:150px; position: absolute; top: 0; left: 0; visibility: hidden; overflow:hidden;\"></div>').append($inner),\n                inner = $inner[0],\n                outer = $outer[0];\n            $('body').append(outer);\n            var width1 = inner.offsetWidth;\n            $outer.css('overflow', 'scroll');\n            var width2 = outer.clientWidth;\n            $outer.remove();\n            return (width1 - width2);\n        }\n\n        self.createMenu();\n\n        return this;\n    };\n}( jQuery ));\n/*! WebUploader 0.1.5 */\n\n\n/**\n * @fileOverview 让内部各个部件的代码可以用[amd](https://github.com/amdjs/amdjs-api/wiki/AMD)模块定义方式组织起来。\n *\n * AMD API 内部的简单不完全实现，请忽略。只有当WebUploader被合并成一个文件的时候才会引入。\n */\n(function( root, factory ) {\n    var modules = {},\n\n        // 内部require, 简单不完全实现。\n        // https://github.com/amdjs/amdjs-api/wiki/require\n        _require = function( deps, callback ) {\n            var args, len, i;\n\n            // 如果deps不是数组，则直接返回指定module\n            if ( typeof deps === 'string' ) {\n                return getModule( deps );\n            } else {\n                args = [];\n                for( len = deps.length, i = 0; i < len; i++ ) {\n                    args.push( getModule( deps[ i ] ) );\n                }\n\n                return callback.apply( null, args );\n            }\n        },\n\n        // 内部define，暂时不支持不指定id.\n        _define = function( id, deps, factory ) {\n            if ( arguments.length === 2 ) {\n                factory = deps;\n                deps = null;\n            }\n\n            _require( deps || [], function() {\n                setModule( id, factory, arguments );\n            });\n        },\n\n        // 设置module, 兼容CommonJs写法。\n        setModule = function( id, factory, args ) {\n            var module = {\n                    exports: factory\n                },\n                returned;\n\n            if ( typeof factory === 'function' ) {\n                args.length || (args = [ _require, module.exports, module ]);\n                returned = factory.apply( null, args );\n                returned !== undefined && (module.exports = returned);\n            }\n\n            modules[ id ] = module.exports;\n        },\n\n        // 根据id获取module\n        getModule = function( id ) {\n            var module = modules[ id ] || root[ id ];\n\n            if ( !module ) {\n                throw new Error( '`' + id + '` is undefined' );\n            }\n\n            return module;\n        },\n\n        // 将所有modules，将路径ids装换成对象。\n        exportsTo = function( obj ) {\n            var key, host, parts, part, last, ucFirst;\n\n            // make the first character upper case.\n            ucFirst = function( str ) {\n                return str && (str.charAt( 0 ).toUpperCase() + str.substr( 1 ));\n            };\n\n            for ( key in modules ) {\n                host = obj;\n\n                if ( !modules.hasOwnProperty( key ) ) {\n                    continue;\n                }\n\n                parts = key.split('/');\n                last = ucFirst( parts.pop() );\n\n                while( (part = ucFirst( parts.shift() )) ) {\n                    host[ part ] = host[ part ] || {};\n                    host = host[ part ];\n                }\n\n                host[ last ] = modules[ key ];\n            }\n\n            return obj;\n        },\n\n        makeExport = function( dollar ) {\n            root.__dollar = dollar;\n\n            // exports every module.\n            return exportsTo( factory( root, _define, _require ) );\n        },\n\n        origin;\n\n    if ( typeof module === 'object' && typeof module.exports === 'object' ) {\n\n        // For CommonJS and CommonJS-like environments where a proper window is present,\n        module.exports = makeExport();\n    } else if ( typeof define === 'function' && define.amd ) {\n\n        // Allow using this built library as an AMD module\n        // in another project. That other project will only\n        // see this AMD call, not the internal modules in\n        // the closure below.\n        define([ 'jquery' ], makeExport );\n    } else {\n\n        // Browser globals case. Just assign the\n        // result to a property on the global.\n        origin = root.WebUploader;\n        root.WebUploader = makeExport();\n        root.WebUploader.noConflict = function() {\n            root.WebUploader = origin;\n        };\n    }\n})( window, function( window, define, require ) {\n\n\n    /**\n     * @fileOverview jQuery or Zepto\n     */\n    define('dollar-third',[],function() {\n        var $ = window.__dollar || window.jQuery || window.Zepto;\n    \n        if ( !$ ) {\n            throw new Error('jQuery or Zepto not found!');\n        }\n    \n        return $;\n    });\n    /**\n     * @fileOverview Dom 操作相关\n     */\n    define('dollar',[\n        'dollar-third'\n    ], function( _ ) {\n        return _;\n    });\n    /**\n     * @fileOverview 使用jQuery的Promise\n     */\n    define('promise-third',[\n        'dollar'\n    ], function( $ ) {\n        return {\n            Deferred: $.Deferred,\n            when: $.when,\n    \n            isPromise: function( anything ) {\n                return anything && typeof anything.then === 'function';\n            }\n        };\n    });\n    /**\n     * @fileOverview Promise/A+\n     */\n    define('promise',[\n        'promise-third'\n    ], function( _ ) {\n        return _;\n    });\n    /**\n     * @fileOverview 基础类方法。\n     */\n    \n    /**\n     * Web Uploader内部类的详细说明，以下提及的功能类，都可以在`WebUploader`这个变量中访问到。\n     *\n     * As you know, Web Uploader的每个文件都是用过[AMD](https://github.com/amdjs/amdjs-api/wiki/AMD)规范中的`define`组织起来的, 每个Module都会有个module id.\n     * 默认module id为该文件的路径，而此路径将会转化成名字空间存放在WebUploader中。如：\n     *\n     * * module `base`：WebUploader.Base\n     * * module `file`: WebUploader.File\n     * * module `lib/dnd`: WebUploader.Lib.Dnd\n     * * module `runtime/html5/dnd`: WebUploader.Runtime.Html5.Dnd\n     *\n     *\n     * 以下文档中对类的使用可能省略掉了`WebUploader`前缀。\n     * @module WebUploader\n     * @title WebUploader API文档\n     */\n    define('base',[\n        'dollar',\n        'promise'\n    ], function( $, promise ) {\n    \n        var noop = function() {},\n            call = Function.call;\n    \n        // http://jsperf.com/uncurrythis\n        // 反科里化\n        function uncurryThis( fn ) {\n            return function() {\n                return call.apply( fn, arguments );\n            };\n        }\n    \n        function bindFn( fn, context ) {\n            return function() {\n                return fn.apply( context, arguments );\n            };\n        }\n    \n        function createObject( proto ) {\n            var f;\n    \n            if ( Object.create ) {\n                return Object.create( proto );\n            } else {\n                f = function() {};\n                f.prototype = proto;\n                return new f();\n            }\n        }\n    \n    \n        /**\n         * 基础类，提供一些简单常用的方法。\n         * @class Base\n         */\n        return {\n    \n            /**\n             * @property {String} version 当前版本号。\n             */\n            version: '0.1.5',\n    \n            /**\n             * @property {jQuery|Zepto} $ 引用依赖的jQuery或者Zepto对象。\n             */\n            $: $,\n    \n            Deferred: promise.Deferred,\n    \n            isPromise: promise.isPromise,\n    \n            when: promise.when,\n    \n            /**\n             * @description  简单的浏览器检查结果。\n             *\n             * * `webkit`  webkit版本号，如果浏览器为非webkit内核，此属性为`undefined`。\n             * * `chrome`  chrome浏览器版本号，如果浏览器为chrome，此属性为`undefined`。\n             * * `ie`  ie浏览器版本号，如果浏览器为非ie，此属性为`undefined`。**暂不支持ie10+**\n             * * `firefox`  firefox浏览器版本号，如果浏览器为非firefox，此属性为`undefined`。\n             * * `safari`  safari浏览器版本号，如果浏览器为非safari，此属性为`undefined`。\n             * * `opera`  opera浏览器版本号，如果浏览器为非opera，此属性为`undefined`。\n             *\n             * @property {Object} [browser]\n             */\n            browser: (function( ua ) {\n                var ret = {},\n                    webkit = ua.match( /WebKit\\/([\\d.]+)/ ),\n                    chrome = ua.match( /Chrome\\/([\\d.]+)/ ) ||\n                        ua.match( /CriOS\\/([\\d.]+)/ ),\n    \n                    ie = ua.match( /MSIE\\s([\\d\\.]+)/ ) ||\n                        ua.match( /(?:trident)(?:.*rv:([\\w.]+))?/i ),\n                    firefox = ua.match( /Firefox\\/([\\d.]+)/ ),\n                    safari = ua.match( /Safari\\/([\\d.]+)/ ),\n                    opera = ua.match( /OPR\\/([\\d.]+)/ );\n    \n                webkit && (ret.webkit = parseFloat( webkit[ 1 ] ));\n                chrome && (ret.chrome = parseFloat( chrome[ 1 ] ));\n                ie && (ret.ie = parseFloat( ie[ 1 ] ));\n                firefox && (ret.firefox = parseFloat( firefox[ 1 ] ));\n                safari && (ret.safari = parseFloat( safari[ 1 ] ));\n                opera && (ret.opera = parseFloat( opera[ 1 ] ));\n    \n                return ret;\n            })( navigator.userAgent ),\n    \n            /**\n             * @description  操作系统检查结果。\n             *\n             * * `android`  如果在android浏览器环境下，此值为对应的android版本号，否则为`undefined`。\n             * * `ios` 如果在ios浏览器环境下，此值为对应的ios版本号，否则为`undefined`。\n             * @property {Object} [os]\n             */\n            os: (function( ua ) {\n                var ret = {},\n    \n                    // osx = !!ua.match( /\\(Macintosh\\; Intel / ),\n                    android = ua.match( /(?:Android);?[\\s\\/]+([\\d.]+)?/ ),\n                    ios = ua.match( /(?:iPad|iPod|iPhone).*OS\\s([\\d_]+)/ );\n    \n                // osx && (ret.osx = true);\n                android && (ret.android = parseFloat( android[ 1 ] ));\n                ios && (ret.ios = parseFloat( ios[ 1 ].replace( /_/g, '.' ) ));\n    \n                return ret;\n            })( navigator.userAgent ),\n    \n            /**\n             * 实现类与类之间的继承。\n             * @method inherits\n             * @grammar Base.inherits( super ) => child\n             * @grammar Base.inherits( super, protos ) => child\n             * @grammar Base.inherits( super, protos, statics ) => child\n             * @param  {Class} super 父类\n             * @param  {Object | Function} [protos] 子类或者对象。如果对象中包含constructor，子类将是用此属性值。\n             * @param  {Function} [protos.constructor] 子类构造器，不指定的话将创建个临时的直接执行父类构造器的方法。\n             * @param  {Object} [statics] 静态属性或方法。\n             * @return {Class} 返回子类。\n             * @example\n             * function Person() {\n             *     console.log( 'Super' );\n             * }\n             * Person.prototype.hello = function() {\n             *     console.log( 'hello' );\n             * };\n             *\n             * var Manager = Base.inherits( Person, {\n             *     world: function() {\n             *         console.log( 'World' );\n             *     }\n             * });\n             *\n             * // 因为没有指定构造器，父类的构造器将会执行。\n             * var instance = new Manager();    // => Super\n             *\n             * // 继承子父类的方法\n             * instance.hello();    // => hello\n             * instance.world();    // => World\n             *\n             * // 子类的__super__属性指向父类\n             * console.log( Manager.__super__ === Person );    // => true\n             */\n            inherits: function( Super, protos, staticProtos ) {\n                var child;\n    \n                if ( typeof protos === 'function' ) {\n                    child = protos;\n                    protos = null;\n                } else if ( protos && protos.hasOwnProperty('constructor') ) {\n                    child = protos.constructor;\n                } else {\n                    child = function() {\n                        return Super.apply( this, arguments );\n                    };\n                }\n    \n                // 复制静态方法\n                $.extend( true, child, Super, staticProtos || {} );\n    \n                /* jshint camelcase: false */\n    \n                // 让子类的__super__属性指向父类。\n                child.__super__ = Super.prototype;\n    \n                // 构建原型，添加原型方法或属性。\n                // 暂时用Object.create实现。\n                child.prototype = createObject( Super.prototype );\n                protos && $.extend( true, child.prototype, protos );\n    \n                return child;\n            },\n    \n            /**\n             * 一个不做任何事情的方法。可以用来赋值给默认的callback.\n             * @method noop\n             */\n            noop: noop,\n    \n            /**\n             * 返回一个新的方法，此方法将已指定的`context`来执行。\n             * @grammar Base.bindFn( fn, context ) => Function\n             * @method bindFn\n             * @example\n             * var doSomething = function() {\n             *         console.log( this.name );\n             *     },\n             *     obj = {\n             *         name: 'Object Name'\n             *     },\n             *     aliasFn = Base.bind( doSomething, obj );\n             *\n             *  aliasFn();    // => Object Name\n             *\n             */\n            bindFn: bindFn,\n    \n            /**\n             * 引用Console.log如果存在的话，否则引用一个[空函数noop](#WebUploader:Base.noop)。\n             * @grammar Base.log( args... ) => undefined\n             * @method log\n             */\n            log: (function() {\n                if ( window.console ) {\n                    return bindFn( console.log, console );\n                }\n                return noop;\n            })(),\n    \n            nextTick: (function() {\n    \n                return function( cb ) {\n                    setTimeout( cb, 1 );\n                };\n    \n                // @bug 当浏览器不在当前窗口时就停了。\n                // var next = window.requestAnimationFrame ||\n                //     window.webkitRequestAnimationFrame ||\n                //     window.mozRequestAnimationFrame ||\n                //     function( cb ) {\n                //         window.setTimeout( cb, 1000 / 60 );\n                //     };\n    \n                // // fix: Uncaught TypeError: Illegal invocation\n                // return bindFn( next, window );\n            })(),\n    \n            /**\n             * 被[uncurrythis](http://www.2ality.com/2011/11/uncurrying-this.html)的数组slice方法。\n             * 将用来将非数组对象转化成数组对象。\n             * @grammar Base.slice( target, start[, end] ) => Array\n             * @method slice\n             * @example\n             * function doSomthing() {\n             *     var args = Base.slice( arguments, 1 );\n             *     console.log( args );\n             * }\n             *\n             * doSomthing( 'ignored', 'arg2', 'arg3' );    // => Array [\"arg2\", \"arg3\"]\n             */\n            slice: uncurryThis( [].slice ),\n    \n            /**\n             * 生成唯一的ID\n             * @method guid\n             * @grammar Base.guid() => String\n             * @grammar Base.guid( prefx ) => String\n             */\n            guid: (function() {\n                var counter = 0;\n    \n                return function( prefix ) {\n                    var guid = (+new Date()).toString( 32 ),\n                        i = 0;\n    \n                    for ( ; i < 5; i++ ) {\n                        guid += Math.floor( Math.random() * 65535 ).toString( 32 );\n                    }\n    \n                    return (prefix || 'wu_') + guid + (counter++).toString( 32 );\n                };\n            })(),\n    \n            /**\n             * 格式化文件大小, 输出成带单位的字符串\n             * @method formatSize\n             * @grammar Base.formatSize( size ) => String\n             * @grammar Base.formatSize( size, pointLength ) => String\n             * @grammar Base.formatSize( size, pointLength, units ) => String\n             * @param {Number} size 文件大小\n             * @param {Number} [pointLength=2] 精确到的小数点数。\n             * @param {Array} [units=[ 'B', 'K', 'M', 'G', 'TB' ]] 单位数组。从字节，到千字节，一直往上指定。如果单位数组里面只指定了到了K(千字节)，同时文件大小大于M, 此方法的输出将还是显示成多少K.\n             * @example\n             * console.log( Base.formatSize( 100 ) );    // => 100B\n             * console.log( Base.formatSize( 1024 ) );    // => 1.00K\n             * console.log( Base.formatSize( 1024, 0 ) );    // => 1K\n             * console.log( Base.formatSize( 1024 * 1024 ) );    // => 1.00M\n             * console.log( Base.formatSize( 1024 * 1024 * 1024 ) );    // => 1.00G\n             * console.log( Base.formatSize( 1024 * 1024 * 1024, 0, ['B', 'KB', 'MB'] ) );    // => 1024MB\n             */\n            formatSize: function( size, pointLength, units ) {\n                var unit;\n    \n                units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\n    \n                while ( (unit = units.shift()) && size > 1024 ) {\n                    size = size / 1024;\n                }\n    \n                return (unit === 'B' ? size : size.toFixed( pointLength || 2 )) +\n                        unit;\n            }\n        };\n    });\n    /**\n     * 事件处理类，可以独立使用，也可以扩展给对象使用。\n     * @fileOverview Mediator\n     */\n    define('mediator',[\n        'base'\n    ], function( Base ) {\n        var $ = Base.$,\n            slice = [].slice,\n            separator = /\\s+/,\n            protos;\n    \n        // 根据条件过滤出事件handlers.\n        function findHandlers( arr, name, callback, context ) {\n            return $.grep( arr, function( handler ) {\n                return handler &&\n                        (!name || handler.e === name) &&\n                        (!callback || handler.cb === callback ||\n                        handler.cb._cb === callback) &&\n                        (!context || handler.ctx === context);\n            });\n        }\n    \n        function eachEvent( events, callback, iterator ) {\n            // 不支持对象，只支持多个event用空格隔开\n            $.each( (events || '').split( separator ), function( _, key ) {\n                iterator( key, callback );\n            });\n        }\n    \n        function triggerHanders( events, args ) {\n            var stoped = false,\n                i = -1,\n                len = events.length,\n                handler;\n    \n            while ( ++i < len ) {\n                handler = events[ i ];\n    \n                if ( handler.cb.apply( handler.ctx2, args ) === false ) {\n                    stoped = true;\n                    break;\n                }\n            }\n    \n            return !stoped;\n        }\n    \n        protos = {\n    \n            /**\n             * 绑定事件。\n             *\n             * `callback`方法在执行时，arguments将会来源于trigger的时候携带的参数。如\n             * ```javascript\n             * var obj = {};\n             *\n             * // 使得obj有事件行为\n             * Mediator.installTo( obj );\n             *\n             * obj.on( 'testa', function( arg1, arg2 ) {\n             *     console.log( arg1, arg2 ); // => 'arg1', 'arg2'\n             * });\n             *\n             * obj.trigger( 'testa', 'arg1', 'arg2' );\n             * ```\n             *\n             * 如果`callback`中，某一个方法`return false`了，则后续的其他`callback`都不会被执行到。\n             * 切会影响到`trigger`方法的返回值，为`false`。\n             *\n             * `on`还可以用来添加一个特殊事件`all`, 这样所有的事件触发都会响应到。同时此类`callback`中的arguments有一个不同处，\n             * 就是第一个参数为`type`，记录当前是什么事件在触发。此类`callback`的优先级比脚低，会再正常`callback`执行完后触发。\n             * ```javascript\n             * obj.on( 'all', function( type, arg1, arg2 ) {\n             *     console.log( type, arg1, arg2 ); // => 'testa', 'arg1', 'arg2'\n             * });\n             * ```\n             *\n             * @method on\n             * @grammar on( name, callback[, context] ) => self\n             * @param  {String}   name     事件名，支持多个事件用空格隔开\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             * @class Mediator\n             */\n            on: function( name, callback, context ) {\n                var me = this,\n                    set;\n    \n                if ( !callback ) {\n                    return this;\n                }\n    \n                set = this._events || (this._events = []);\n    \n                eachEvent( name, callback, function( name, callback ) {\n                    var handler = { e: name };\n    \n                    handler.cb = callback;\n                    handler.ctx = context;\n                    handler.ctx2 = context || me;\n                    handler.id = set.length;\n    \n                    set.push( handler );\n                });\n    \n                return this;\n            },\n    \n            /**\n             * 绑定事件，且当handler执行完后，自动解除绑定。\n             * @method once\n             * @grammar once( name, callback[, context] ) => self\n             * @param  {String}   name     事件名\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n            once: function( name, callback, context ) {\n                var me = this;\n    \n                if ( !callback ) {\n                    return me;\n                }\n    \n                eachEvent( name, callback, function( name, callback ) {\n                    var once = function() {\n                            me.off( name, once );\n                            return callback.apply( context || me, arguments );\n                        };\n    \n                    once._cb = callback;\n                    me.on( name, once, context );\n                });\n    \n                return me;\n            },\n    \n            /**\n             * 解除事件绑定\n             * @method off\n             * @grammar off( [name[, callback[, context] ] ] ) => self\n             * @param  {String}   [name]     事件名\n             * @param  {Function} [callback] 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n            off: function( name, cb, ctx ) {\n                var events = this._events;\n    \n                if ( !events ) {\n                    return this;\n                }\n    \n                if ( !name && !cb && !ctx ) {\n                    this._events = [];\n                    return this;\n                }\n    \n                eachEvent( name, cb, function( name, cb ) {\n                    $.each( findHandlers( events, name, cb, ctx ), function() {\n                        delete events[ this.id ];\n                    });\n                });\n    \n                return this;\n            },\n    \n            /**\n             * 触发事件\n             * @method trigger\n             * @grammar trigger( name[, args...] ) => self\n             * @param  {String}   type     事件名\n             * @param  {*} [...] 任意参数\n             * @return {Boolean} 如果handler中return false了，则返回false, 否则返回true\n             */\n            trigger: function( type ) {\n                var args, events, allEvents;\n    \n                if ( !this._events || !type ) {\n                    return this;\n                }\n    \n                args = slice.call( arguments, 1 );\n                events = findHandlers( this._events, type );\n                allEvents = findHandlers( this._events, 'all' );\n    \n                return triggerHanders( events, args ) &&\n                        triggerHanders( allEvents, arguments );\n            }\n        };\n    \n        /**\n         * 中介者，它本身是个单例，但可以通过[installTo](#WebUploader:Mediator:installTo)方法，使任何对象具备事件行为。\n         * 主要目的是负责模块与模块之间的合作，降低耦合度。\n         *\n         * @class Mediator\n         */\n        return $.extend({\n    \n            /**\n             * 可以通过这个接口，使任何对象具备事件功能。\n             * @method installTo\n             * @param  {Object} obj 需要具备事件行为的对象。\n             * @return {Object} 返回obj.\n             */\n            installTo: function( obj ) {\n                return $.extend( obj, protos );\n            }\n    \n        }, protos );\n    });\n    /**\n     * @fileOverview Uploader上传类\n     */\n    define('uploader',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n    \n        var $ = Base.$;\n    \n        /**\n         * 上传入口类。\n         * @class Uploader\n         * @constructor\n         * @grammar new Uploader( opts ) => Uploader\n         * @example\n         * var uploader = WebUploader.Uploader({\n         *     swf: 'path_of_swf/Uploader.swf',\n         *\n         *     // 开起分片上传。\n         *     chunked: true\n         * });\n         */\n        function Uploader( opts ) {\n            this.options = $.extend( true, {}, Uploader.options, opts );\n            this._init( this.options );\n        }\n    \n        // default Options\n        // widgets中有相应扩展\n        Uploader.options = {};\n        Mediator.installTo( Uploader.prototype );\n    \n        // 批量添加纯命令式方法。\n        $.each({\n            upload: 'start-upload',\n            stop: 'stop-upload',\n            getFile: 'get-file',\n            getFiles: 'get-files',\n            addFile: 'add-file',\n            addFiles: 'add-file',\n            sort: 'sort-files',\n            removeFile: 'remove-file',\n            cancelFile: 'cancel-file',\n            skipFile: 'skip-file',\n            retry: 'retry',\n            isInProgress: 'is-in-progress',\n            makeThumb: 'make-thumb',\n            md5File: 'md5-file',\n            getDimension: 'get-dimension',\n            addButton: 'add-btn',\n            predictRuntimeType: 'predict-runtime-type',\n            refresh: 'refresh',\n            disable: 'disable',\n            enable: 'enable',\n            reset: 'reset'\n        }, function( fn, command ) {\n            Uploader.prototype[ fn ] = function() {\n                return this.request( command, arguments );\n            };\n        });\n    \n        $.extend( Uploader.prototype, {\n            state: 'pending',\n    \n            _init: function( opts ) {\n                var me = this;\n    \n                me.request( 'init', opts, function() {\n                    me.state = 'ready';\n                    me.trigger('ready');\n                });\n            },\n    \n            /**\n             * 获取或者设置Uploader配置项。\n             * @method option\n             * @grammar option( key ) => *\n             * @grammar option( key, val ) => self\n             * @example\n             *\n             * // 初始状态图片上传前不会压缩\n             * var uploader = new WebUploader.Uploader({\n             *     compress: null;\n             * });\n             *\n             * // 修改后图片上传前，尝试将图片压缩到1600 * 1600\n             * uploader.option( 'compress', {\n             *     width: 1600,\n             *     height: 1600\n             * });\n             */\n            option: function( key, val ) {\n                var opts = this.options;\n    \n                // setter\n                if ( arguments.length > 1 ) {\n    \n                    if ( $.isPlainObject( val ) &&\n                            $.isPlainObject( opts[ key ] ) ) {\n                        $.extend( opts[ key ], val );\n                    } else {\n                        opts[ key ] = val;\n                    }\n    \n                } else {    // getter\n                    return key ? opts[ key ] : opts;\n                }\n            },\n    \n            /**\n             * 获取文件统计信息。返回一个包含一下信息的对象。\n             * * `successNum` 上传成功的文件数\n             * * `progressNum` 上传中的文件数\n             * * `cancelNum` 被删除的文件数\n             * * `invalidNum` 无效的文件数\n             * * `uploadFailNum` 上传失败的文件数\n             * * `queueNum` 还在队列中的文件数\n             * * `interruptNum` 被暂停的文件数\n             * @method getStats\n             * @grammar getStats() => Object\n             */\n            getStats: function() {\n                // return this._mgr.getStats.apply( this._mgr, arguments );\n                var stats = this.request('get-stats');\n    \n                return stats ? {\n                    successNum: stats.numOfSuccess,\n                    progressNum: stats.numOfProgress,\n    \n                    // who care?\n                    // queueFailNum: 0,\n                    cancelNum: stats.numOfCancel,\n                    invalidNum: stats.numOfInvalid,\n                    uploadFailNum: stats.numOfUploadFailed,\n                    queueNum: stats.numOfQueue,\n                    interruptNum: stats.numofInterrupt\n                } : {};\n            },\n    \n            // 需要重写此方法来来支持opts.onEvent和instance.onEvent的处理器\n            trigger: function( type/*, args...*/ ) {\n                var args = [].slice.call( arguments, 1 ),\n                    opts = this.options,\n                    name = 'on' + type.substring( 0, 1 ).toUpperCase() +\n                        type.substring( 1 );\n    \n                if (\n                        // 调用通过on方法注册的handler.\n                        Mediator.trigger.apply( this, arguments ) === false ||\n    \n                        // 调用opts.onEvent\n                        $.isFunction( opts[ name ] ) &&\n                        opts[ name ].apply( this, args ) === false ||\n    \n                        // 调用this.onEvent\n                        $.isFunction( this[ name ] ) &&\n                        this[ name ].apply( this, args ) === false ||\n    \n                        // 广播所有uploader的事件。\n                        Mediator.trigger.apply( Mediator,\n                        [ this, type ].concat( args ) ) === false ) {\n    \n                    return false;\n                }\n    \n                return true;\n            },\n    \n            /**\n             * 销毁 webuploader 实例\n             * @method destroy\n             * @grammar destroy() => undefined\n             */\n            destroy: function() {\n                this.request( 'destroy', arguments );\n                this.off();\n            },\n    \n            // widgets/widget.js将补充此方法的详细文档。\n            request: Base.noop\n        });\n    \n        /**\n         * 创建Uploader实例，等同于new Uploader( opts );\n         * @method create\n         * @class Base\n         * @static\n         * @grammar Base.create( opts ) => Uploader\n         */\n        Base.create = Uploader.create = function( opts ) {\n            return new Uploader( opts );\n        };\n    \n        // 暴露Uploader，可以通过它来扩展业务逻辑。\n        Base.Uploader = Uploader;\n    \n        return Uploader;\n    });\n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/runtime',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n    \n        var $ = Base.$,\n            factories = {},\n    \n            // 获取对象的第一个key\n            getFirstKey = function( obj ) {\n                for ( var key in obj ) {\n                    if ( obj.hasOwnProperty( key ) ) {\n                        return key;\n                    }\n                }\n                return null;\n            };\n    \n        // 接口类。\n        function Runtime( options ) {\n            this.options = $.extend({\n                container: document.body\n            }, options );\n            this.uid = Base.guid('rt_');\n        }\n    \n        $.extend( Runtime.prototype, {\n    \n            getContainer: function() {\n                var opts = this.options,\n                    parent, container;\n    \n                if ( this._container ) {\n                    return this._container;\n                }\n    \n                parent = $( opts.container || document.body );\n                container = $( document.createElement('div') );\n    \n                container.attr( 'id', 'rt_' + this.uid );\n                container.css({\n                    position: 'absolute',\n                    top: '0px',\n                    left: '0px',\n                    width: '1px',\n                    height: '1px',\n                    overflow: 'hidden'\n                });\n    \n                parent.append( container );\n                parent.addClass('webuploader-container');\n                this._container = container;\n                this._parent = parent;\n                return container;\n            },\n    \n            init: Base.noop,\n            exec: Base.noop,\n    \n            destroy: function() {\n                this._container && this._container.remove();\n                this._parent && this._parent.removeClass('webuploader-container');\n                this.off();\n            }\n        });\n    \n        Runtime.orders = 'html5,flash';\n    \n    \n        /**\n         * 添加Runtime实现。\n         * @param {String} type    类型\n         * @param {Runtime} factory 具体Runtime实现。\n         */\n        Runtime.addRuntime = function( type, factory ) {\n            factories[ type ] = factory;\n        };\n    \n        Runtime.hasRuntime = function( type ) {\n            return !!(type ? factories[ type ] : getFirstKey( factories ));\n        };\n    \n        Runtime.create = function( opts, orders ) {\n            var type, runtime;\n    \n            orders = orders || Runtime.orders;\n            $.each( orders.split( /\\s*,\\s*/g ), function() {\n                if ( factories[ this ] ) {\n                    type = this;\n                    return false;\n                }\n            });\n    \n            type = type || getFirstKey( factories );\n    \n            if ( !type ) {\n                throw new Error('Runtime Error');\n            }\n    \n            runtime = new factories[ type ]( opts );\n            return runtime;\n        };\n    \n        Mediator.installTo( Runtime.prototype );\n        return Runtime;\n    });\n    \n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/client',[\n        'base',\n        'mediator',\n        'runtime/runtime'\n    ], function( Base, Mediator, Runtime ) {\n    \n        var cache;\n    \n        cache = (function() {\n            var obj = {};\n    \n            return {\n                add: function( runtime ) {\n                    obj[ runtime.uid ] = runtime;\n                },\n    \n                get: function( ruid, standalone ) {\n                    var i;\n    \n                    if ( ruid ) {\n                        return obj[ ruid ];\n                    }\n    \n                    for ( i in obj ) {\n                        // 有些类型不能重用，比如filepicker.\n                        if ( standalone && obj[ i ].__standalone ) {\n                            continue;\n                        }\n    \n                        return obj[ i ];\n                    }\n    \n                    return null;\n                },\n    \n                remove: function( runtime ) {\n                    delete obj[ runtime.uid ];\n                }\n            };\n        })();\n    \n        function RuntimeClient( component, standalone ) {\n            var deferred = Base.Deferred(),\n                runtime;\n    \n            this.uid = Base.guid('client_');\n    \n            // 允许runtime没有初始化之前，注册一些方法在初始化后执行。\n            this.runtimeReady = function( cb ) {\n                return deferred.done( cb );\n            };\n    \n            this.connectRuntime = function( opts, cb ) {\n    \n                // already connected.\n                if ( runtime ) {\n                    throw new Error('already connected!');\n                }\n    \n                deferred.done( cb );\n    \n                if ( typeof opts === 'string' && cache.get( opts ) ) {\n                    runtime = cache.get( opts );\n                }\n    \n                // 像filePicker只能独立存在，不能公用。\n                runtime = runtime || cache.get( null, standalone );\n    \n                // 需要创建\n                if ( !runtime ) {\n                    runtime = Runtime.create( opts, opts.runtimeOrder );\n                    runtime.__promise = deferred.promise();\n                    runtime.once( 'ready', deferred.resolve );\n                    runtime.init();\n                    cache.add( runtime );\n                    runtime.__client = 1;\n                } else {\n                    // 来自cache\n                    Base.$.extend( runtime.options, opts );\n                    runtime.__promise.then( deferred.resolve );\n                    runtime.__client++;\n                }\n    \n                standalone && (runtime.__standalone = standalone);\n                return runtime;\n            };\n    \n            this.getRuntime = function() {\n                return runtime;\n            };\n    \n            this.disconnectRuntime = function() {\n                if ( !runtime ) {\n                    return;\n                }\n    \n                runtime.__client--;\n    \n                if ( runtime.__client <= 0 ) {\n                    cache.remove( runtime );\n                    delete runtime.__promise;\n                    runtime.destroy();\n                }\n    \n                runtime = null;\n            };\n    \n            this.exec = function() {\n                if ( !runtime ) {\n                    return;\n                }\n    \n                var args = Base.slice( arguments );\n                component && args.unshift( component );\n    \n                return runtime.exec.apply( this, args );\n            };\n    \n            this.getRuid = function() {\n                return runtime && runtime.uid;\n            };\n    \n            this.destroy = (function( destroy ) {\n                return function() {\n                    destroy && destroy.apply( this, arguments );\n                    this.trigger('destroy');\n                    this.off();\n                    this.exec('destroy');\n                    this.disconnectRuntime();\n                };\n            })( this.destroy );\n        }\n    \n        Mediator.installTo( RuntimeClient.prototype );\n        return RuntimeClient;\n    });\n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/dnd',[\n        'base',\n        'mediator',\n        'runtime/client'\n    ], function( Base, Mediator, RuntimeClent ) {\n    \n        var $ = Base.$;\n    \n        function DragAndDrop( opts ) {\n            opts = this.options = $.extend({}, DragAndDrop.options, opts );\n    \n            opts.container = $( opts.container );\n    \n            if ( !opts.container.length ) {\n                return;\n            }\n    \n            RuntimeClent.call( this, 'DragAndDrop' );\n        }\n    \n        DragAndDrop.options = {\n            accept: null,\n            disableGlobalDnd: false\n        };\n    \n        Base.inherits( RuntimeClent, {\n            constructor: DragAndDrop,\n    \n            init: function() {\n                var me = this;\n    \n                me.connectRuntime( me.options, function() {\n                    me.exec('init');\n                    me.trigger('ready');\n                });\n            }\n        });\n    \n        Mediator.installTo( DragAndDrop.prototype );\n    \n        return DragAndDrop;\n    });\n    /**\n     * @fileOverview 组件基类。\n     */\n    define('widgets/widget',[\n        'base',\n        'uploader'\n    ], function( Base, Uploader ) {\n    \n        var $ = Base.$,\n            _init = Uploader.prototype._init,\n            _destroy = Uploader.prototype.destroy,\n            IGNORE = {},\n            widgetClass = [];\n    \n        function isArrayLike( obj ) {\n            if ( !obj ) {\n                return false;\n            }\n    \n            var length = obj.length,\n                type = $.type( obj );\n    \n            if ( obj.nodeType === 1 && length ) {\n                return true;\n            }\n    \n            return type === 'array' || type !== 'function' && type !== 'string' &&\n                    (length === 0 || typeof length === 'number' && length > 0 &&\n                    (length - 1) in obj);\n        }\n    \n        function Widget( uploader ) {\n            this.owner = uploader;\n            this.options = uploader.options;\n        }\n    \n        $.extend( Widget.prototype, {\n    \n            init: Base.noop,\n    \n            // 类Backbone的事件监听声明，监听uploader实例上的事件\n            // widget直接无法监听事件，事件只能通过uploader来传递\n            invoke: function( apiName, args ) {\n    \n                /*\n                    {\n                        'make-thumb': 'makeThumb'\n                    }\n                 */\n                var map = this.responseMap;\n    \n                // 如果无API响应声明则忽略\n                if ( !map || !(apiName in map) || !(map[ apiName ] in this) ||\n                        !$.isFunction( this[ map[ apiName ] ] ) ) {\n    \n                    return IGNORE;\n                }\n    \n                return this[ map[ apiName ] ].apply( this, args );\n    \n            },\n    \n            /**\n             * 发送命令。当传入`callback`或者`handler`中返回`promise`时。返回一个当所有`handler`中的promise都完成后完成的新`promise`。\n             * @method request\n             * @grammar request( command, args ) => * | Promise\n             * @grammar request( command, args, callback ) => Promise\n             * @for  Uploader\n             */\n            request: function() {\n                return this.owner.request.apply( this.owner, arguments );\n            }\n        });\n    \n        // 扩展Uploader.\n        $.extend( Uploader.prototype, {\n    \n            /**\n             * @property {String | Array} [disableWidgets=undefined]\n             * @namespace options\n             * @for Uploader\n             * @description 默认所有 Uploader.register 了的 widget 都会被加载，如果禁用某一部分，请通过此 option 指定黑名单。\n             */\n    \n            // 覆写_init用来初始化widgets\n            _init: function() {\n                var me = this,\n                    widgets = me._widgets = [],\n                    deactives = me.options.disableWidgets || '';\n    \n                $.each( widgetClass, function( _, klass ) {\n                    (!deactives || !~deactives.indexOf( klass._name )) &&\n                        widgets.push( new klass( me ) );\n                });\n    \n                return _init.apply( me, arguments );\n            },\n    \n            request: function( apiName, args, callback ) {\n                var i = 0,\n                    widgets = this._widgets,\n                    len = widgets && widgets.length,\n                    rlts = [],\n                    dfds = [],\n                    widget, rlt, promise, key;\n    \n                args = isArrayLike( args ) ? args : [ args ];\n    \n                for ( ; i < len; i++ ) {\n                    widget = widgets[ i ];\n                    rlt = widget.invoke( apiName, args );\n    \n                    if ( rlt !== IGNORE ) {\n    \n                        // Deferred对象\n                        if ( Base.isPromise( rlt ) ) {\n                            dfds.push( rlt );\n                        } else {\n                            rlts.push( rlt );\n                        }\n                    }\n                }\n    \n                // 如果有callback，则用异步方式。\n                if ( callback || dfds.length ) {\n                    promise = Base.when.apply( Base, dfds );\n                    key = promise.pipe ? 'pipe' : 'then';\n    \n                    // 很重要不能删除。删除了会死循环。\n                    // 保证执行顺序。让callback总是在下一个 tick 中执行。\n                    return promise[ key ](function() {\n                                var deferred = Base.Deferred(),\n                                    args = arguments;\n    \n                                if ( args.length === 1 ) {\n                                    args = args[ 0 ];\n                                }\n    \n                                setTimeout(function() {\n                                    deferred.resolve( args );\n                                }, 1 );\n    \n                                return deferred.promise();\n                            })[ callback ? key : 'done' ]( callback || Base.noop );\n                } else {\n                    return rlts[ 0 ];\n                }\n            },\n    \n            destroy: function() {\n                _destroy.apply( this, arguments );\n                this._widgets = null;\n            }\n        });\n    \n        /**\n         * 添加组件\n         * @grammar Uploader.register(proto);\n         * @grammar Uploader.register(map, proto);\n         * @param  {object} responseMap API 名称与函数实现的映射\n         * @param  {object} proto 组件原型，构造函数通过 constructor 属性定义\n         * @method Uploader.register\n         * @for Uploader\n         * @example\n         * Uploader.register({\n         *     'make-thumb': 'makeThumb'\n         * }, {\n         *     init: function( options ) {},\n         *     makeThumb: function() {}\n         * });\n         *\n         * Uploader.register({\n         *     'make-thumb': function() {\n         *         \n         *     }\n         * });\n         */\n        Uploader.register = Widget.register = function( responseMap, widgetProto ) {\n            var map = { init: 'init', destroy: 'destroy', name: 'anonymous' },\n                klass;\n    \n            if ( arguments.length === 1 ) {\n                widgetProto = responseMap;\n    \n                // 自动生成 map 表。\n                $.each(widgetProto, function(key) {\n                    if ( key[0] === '_' || key === 'name' ) {\n                        key === 'name' && (map.name = widgetProto.name);\n                        return;\n                    }\n    \n                    map[key.replace(/[A-Z]/g, '-$&').toLowerCase()] = key;\n                });\n    \n            } else {\n                map = $.extend( map, responseMap );\n            }\n    \n            widgetProto.responseMap = map;\n            klass = Base.inherits( Widget, widgetProto );\n            klass._name = map.name;\n            widgetClass.push( klass );\n    \n            return klass;\n        };\n    \n        /**\n         * 删除插件，只有在注册时指定了名字的才能被删除。\n         * @grammar Uploader.unRegister(name);\n         * @param  {string} name 组件名字\n         * @method Uploader.unRegister\n         * @for Uploader\n         * @example\n         *\n         * Uploader.register({\n         *     name: 'custom',\n         *     \n         *     'make-thumb': function() {\n         *         \n         *     }\n         * });\n         *\n         * Uploader.unRegister('custom');\n         */\n        Uploader.unRegister = Widget.unRegister = function( name ) {\n            if ( !name || name === 'anonymous' ) {\n                return;\n            }\n            \n            // 删除指定的插件。\n            for ( var i = widgetClass.length; i--; ) {\n                if ( widgetClass[i]._name === name ) {\n                    widgetClass.splice(i, 1)\n                }\n            }\n        };\n    \n        return Widget;\n    });\n    /**\n     * @fileOverview DragAndDrop Widget。\n     */\n    define('widgets/filednd',[\n        'base',\n        'uploader',\n        'lib/dnd',\n        'widgets/widget'\n    ], function( Base, Uploader, Dnd ) {\n        var $ = Base.$;\n    \n        Uploader.options.dnd = '';\n    \n        /**\n         * @property {Selector} [dnd=undefined]  指定Drag And Drop拖拽的容器，如果不指定，则不启动。\n         * @namespace options\n         * @for Uploader\n         */\n        \n        /**\n         * @property {Selector} [disableGlobalDnd=false]  是否禁掉整个页面的拖拽功能，如果不禁用，图片拖进来的时候会默认被浏览器打开。\n         * @namespace options\n         * @for Uploader\n         */\n    \n        /**\n         * @event dndAccept\n         * @param {DataTransferItemList} items DataTransferItem\n         * @description 阻止此事件可以拒绝某些类型的文件拖入进来。目前只有 chrome 提供这样的 API，且只能通过 mime-type 验证。\n         * @for  Uploader\n         */\n        return Uploader.register({\n            name: 'dnd',\n            \n            init: function( opts ) {\n    \n                if ( !opts.dnd ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n    \n                var me = this,\n                    deferred = Base.Deferred(),\n                    options = $.extend({}, {\n                        disableGlobalDnd: opts.disableGlobalDnd,\n                        container: opts.dnd,\n                        accept: opts.accept\n                    }),\n                    dnd;\n    \n                this.dnd = dnd = new Dnd( options );\n    \n                dnd.once( 'ready', deferred.resolve );\n                dnd.on( 'drop', function( files ) {\n                    me.request( 'add-file', [ files ]);\n                });\n    \n                // 检测文件是否全部允许添加。\n                dnd.on( 'accept', function( items ) {\n                    return me.owner.trigger( 'dndAccept', items );\n                });\n    \n                dnd.init();\n    \n                return deferred.promise();\n            },\n    \n            destroy: function() {\n                this.dnd && this.dnd.destroy();\n            }\n        });\n    });\n    \n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/filepaste',[\n        'base',\n        'mediator',\n        'runtime/client'\n    ], function( Base, Mediator, RuntimeClent ) {\n    \n        var $ = Base.$;\n    \n        function FilePaste( opts ) {\n            opts = this.options = $.extend({}, opts );\n            opts.container = $( opts.container || document.body );\n            RuntimeClent.call( this, 'FilePaste' );\n        }\n    \n        Base.inherits( RuntimeClent, {\n            constructor: FilePaste,\n    \n            init: function() {\n                var me = this;\n    \n                me.connectRuntime( me.options, function() {\n                    me.exec('init');\n                    me.trigger('ready');\n                });\n            }\n        });\n    \n        Mediator.installTo( FilePaste.prototype );\n    \n        return FilePaste;\n    });\n    /**\n     * @fileOverview 组件基类。\n     */\n    define('widgets/filepaste',[\n        'base',\n        'uploader',\n        'lib/filepaste',\n        'widgets/widget'\n    ], function( Base, Uploader, FilePaste ) {\n        var $ = Base.$;\n    \n        /**\n         * @property {Selector} [paste=undefined]  指定监听paste事件的容器，如果不指定，不启用此功能。此功能为通过粘贴来添加截屏的图片。建议设置为`document.body`.\n         * @namespace options\n         * @for Uploader\n         */\n        return Uploader.register({\n            name: 'paste',\n            \n            init: function( opts ) {\n    \n                if ( !opts.paste ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n    \n                var me = this,\n                    deferred = Base.Deferred(),\n                    options = $.extend({}, {\n                        container: opts.paste,\n                        accept: opts.accept\n                    }),\n                    paste;\n    \n                this.paste = paste = new FilePaste( options );\n    \n                paste.once( 'ready', deferred.resolve );\n                paste.on( 'paste', function( files ) {\n                    me.owner.request( 'add-file', [ files ]);\n                });\n                paste.init();\n    \n                return deferred.promise();\n            },\n    \n            destroy: function() {\n                this.paste && this.paste.destroy();\n            }\n        });\n    });\n    /**\n     * @fileOverview Blob\n     */\n    define('lib/blob',[\n        'base',\n        'runtime/client'\n    ], function( Base, RuntimeClient ) {\n    \n        function Blob( ruid, source ) {\n            var me = this;\n    \n            me.source = source;\n            me.ruid = ruid;\n            this.size = source.size || 0;\n    \n            // 如果没有指定 mimetype, 但是知道文件后缀。\n            if ( !source.type && this.ext &&\n                    ~'jpg,jpeg,png,gif,bmp'.indexOf( this.ext ) ) {\n                this.type = 'image/' + (this.ext === 'jpg' ? 'jpeg' : this.ext);\n            } else {\n                this.type = source.type || 'application/octet-stream';\n            }\n    \n            RuntimeClient.call( me, 'Blob' );\n            this.uid = source.uid || this.uid;\n    \n            if ( ruid ) {\n                me.connectRuntime( ruid );\n            }\n        }\n    \n        Base.inherits( RuntimeClient, {\n            constructor: Blob,\n    \n            slice: function( start, end ) {\n                return this.exec( 'slice', start, end );\n            },\n    \n            getSource: function() {\n                return this.source;\n            }\n        });\n    \n        return Blob;\n    });\n    /**\n     * 为了统一化Flash的File和HTML5的File而存在。\n     * 以至于要调用Flash里面的File，也可以像调用HTML5版本的File一下。\n     * @fileOverview File\n     */\n    define('lib/file',[\n        'base',\n        'lib/blob'\n    ], function( Base, Blob ) {\n    \n        var uid = 1,\n            rExt = /\\.([^.]+)$/;\n    \n        function File( ruid, file ) {\n            var ext;\n    \n            this.name = file.name || ('untitled' + uid++);\n            ext = rExt.exec( file.name ) ? RegExp.$1.toLowerCase() : '';\n    \n            // todo 支持其他类型文件的转换。\n            // 如果有 mimetype, 但是文件名里面没有找出后缀规律\n            if ( !ext && file.type ) {\n                ext = /\\/(jpg|jpeg|png|gif|bmp)$/i.exec( file.type ) ?\n                        RegExp.$1.toLowerCase() : '';\n                this.name += '.' + ext;\n            }\n    \n            this.ext = ext;\n            this.lastModifiedDate = file.lastModifiedDate ||\n                    (new Date()).toLocaleString();\n    \n            Blob.apply( this, arguments );\n        }\n    \n        return Base.inherits( Blob, File );\n    });\n    \n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/filepicker',[\n        'base',\n        'runtime/client',\n        'lib/file'\n    ], function( Base, RuntimeClent, File ) {\n    \n        var $ = Base.$;\n    \n        function FilePicker( opts ) {\n            opts = this.options = $.extend({}, FilePicker.options, opts );\n    \n            opts.container = $( opts.id );\n    \n            if ( !opts.container.length ) {\n                throw new Error('按钮指定错误');\n            }\n    \n            opts.innerHTML = opts.innerHTML || opts.label ||\n                    opts.container.html() || '';\n    \n            opts.button = $( opts.button || document.createElement('div') );\n            opts.button.html( opts.innerHTML );\n            opts.container.html( opts.button );\n    \n            RuntimeClent.call( this, 'FilePicker', true );\n        }\n    \n        FilePicker.options = {\n            button: null,\n            container: null,\n            label: null,\n            innerHTML: null,\n            multiple: true,\n            accept: null,\n            name: 'file'\n        };\n    \n        Base.inherits( RuntimeClent, {\n            constructor: FilePicker,\n    \n            init: function() {\n                var me = this,\n                    opts = me.options,\n                    button = opts.button;\n    \n                button.addClass('webuploader-pick');\n    \n                me.on( 'all', function( type ) {\n                    var files;\n    \n                    switch ( type ) {\n                        case 'mouseenter':\n                            button.addClass('webuploader-pick-hover');\n                            break;\n    \n                        case 'mouseleave':\n                            button.removeClass('webuploader-pick-hover');\n                            break;\n    \n                        case 'change':\n                            files = me.exec('getFiles');\n                            me.trigger( 'select', $.map( files, function( file ) {\n                                file = new File( me.getRuid(), file );\n    \n                                // 记录来源。\n                                file._refer = opts.container;\n                                return file;\n                            }), opts.container );\n                            break;\n                    }\n                });\n    \n                me.connectRuntime( opts, function() {\n                    me.refresh();\n                    me.exec( 'init', opts );\n                    me.trigger('ready');\n                });\n    \n                this._resizeHandler = Base.bindFn( this.refresh, this );\n                $( window ).on( 'resize', this._resizeHandler );\n            },\n    \n            refresh: function() {\n                var shimContainer = this.getRuntime().getContainer(),\n                    button = this.options.button,\n                    width = button.outerWidth ?\n                            button.outerWidth() : button.width(),\n    \n                    height = button.outerHeight ?\n                            button.outerHeight() : button.height(),\n    \n                    pos = button.offset();\n    \n                width && height && shimContainer.css({\n                    bottom: 'auto',\n                    right: 'auto',\n                    width: width + 'px',\n                    height: height + 'px'\n                }).offset( pos );\n            },\n    \n            enable: function() {\n                var btn = this.options.button;\n    \n                btn.removeClass('webuploader-pick-disable');\n                this.refresh();\n            },\n    \n            disable: function() {\n                var btn = this.options.button;\n    \n                this.getRuntime().getContainer().css({\n                    top: '-99999px'\n                });\n    \n                btn.addClass('webuploader-pick-disable');\n            },\n    \n            destroy: function() {\n                var btn = this.options.button;\n                $( window ).off( 'resize', this._resizeHandler );\n                btn.removeClass('webuploader-pick-disable webuploader-pick-hover ' +\n                    'webuploader-pick');\n            }\n        });\n    \n        return FilePicker;\n    });\n    \n    /**\n     * @fileOverview 文件选择相关\n     */\n    define('widgets/filepicker',[\n        'base',\n        'uploader',\n        'lib/filepicker',\n        'widgets/widget'\n    ], function( Base, Uploader, FilePicker ) {\n        var $ = Base.$;\n    \n        $.extend( Uploader.options, {\n    \n            /**\n             * @property {Selector | Object} [pick=undefined]\n             * @namespace options\n             * @for Uploader\n             * @description 指定选择文件的按钮容器，不指定则不创建按钮。\n             *\n             * * `id` {Seletor} 指定选择文件的按钮容器，不指定则不创建按钮。\n             * * `label` {String} 请采用 `innerHTML` 代替\n             * * `innerHTML` {String} 指定按钮文字。不指定时优先从指定的容器中看是否自带文字。\n             * * `multiple` {Boolean} 是否开起同时选择多个文件能力。\n             */\n            pick: null,\n    \n            /**\n             * @property {Arroy} [accept=null]\n             * @namespace options\n             * @for Uploader\n             * @description 指定接受哪些类型的文件。 由于目前还有ext转mimeType表，所以这里需要分开指定。\n             *\n             * * `title` {String} 文字描述\n             * * `extensions` {String} 允许的文件后缀，不带点，多个用逗号分割。\n             * * `mimeTypes` {String} 多个用逗号分割。\n             *\n             * 如：\n             *\n             * ```\n             * {\n             *     title: 'Images',\n             *     extensions: 'gif,jpg,jpeg,bmp,png',\n             *     mimeTypes: 'image/*'\n             * }\n             * ```\n             */\n            accept: null/*{\n                title: 'Images',\n                extensions: 'gif,jpg,jpeg,bmp,png',\n                mimeTypes: 'image/*'\n            }*/\n        });\n    \n        return Uploader.register({\n            name: 'picker',\n    \n            init: function( opts ) {\n                this.pickers = [];\n                return opts.pick && this.addBtn( opts.pick );\n            },\n    \n            refresh: function() {\n                $.each( this.pickers, function() {\n                    this.refresh();\n                });\n            },\n    \n            /**\n             * @method addButton\n             * @for Uploader\n             * @grammar addButton( pick ) => Promise\n             * @description\n             * 添加文件选择按钮，如果一个按钮不够，需要调用此方法来添加。参数跟[options.pick](#WebUploader:Uploader:options)一致。\n             * @example\n             * uploader.addButton({\n             *     id: '#btnContainer',\n             *     innerHTML: '选择文件'\n             * });\n             */\n            addBtn: function( pick ) {\n                var me = this,\n                    opts = me.options,\n                    accept = opts.accept,\n                    promises = [];\n    \n                if ( !pick ) {\n                    return;\n                }\n                \n                $.isPlainObject( pick ) || (pick = {\n                    id: pick\n                });\n    \n                $( pick.id ).each(function() {\n                    var options, picker, deferred;\n    \n                    deferred = Base.Deferred();\n    \n                    options = $.extend({}, pick, {\n                        accept: $.isPlainObject( accept ) ? [ accept ] : accept,\n                        swf: opts.swf,\n                        runtimeOrder: opts.runtimeOrder,\n                        id: this\n                    });\n    \n                    picker = new FilePicker( options );\n    \n                    picker.once( 'ready', deferred.resolve );\n                    picker.on( 'select', function( files ) {\n                        me.owner.request( 'add-file', [ files ]);\n                    });\n                    picker.init();\n    \n                    me.pickers.push( picker );\n    \n                    promises.push( deferred.promise() );\n                });\n    \n                return Base.when.apply( Base, promises );\n            },\n    \n            disable: function() {\n                $.each( this.pickers, function() {\n                    this.disable();\n                });\n            },\n    \n            enable: function() {\n                $.each( this.pickers, function() {\n                    this.enable();\n                });\n            },\n    \n            destroy: function() {\n                $.each( this.pickers, function() {\n                    this.destroy();\n                });\n                this.pickers = null;\n            }\n        });\n    });\n    /**\n     * @fileOverview 文件属性封装\n     */\n    define('file',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n    \n        var $ = Base.$,\n            idPrefix = 'WU_FILE_',\n            idSuffix = 0,\n            rExt = /\\.([^.]+)$/,\n            statusMap = {};\n    \n        function gid() {\n            return idPrefix + idSuffix++;\n        }\n    \n        /**\n         * 文件类\n         * @class File\n         * @constructor 构造函数\n         * @grammar new File( source ) => File\n         * @param {Lib.File} source [lib.File](#Lib.File)实例, 此source对象是带有Runtime信息的。\n         */\n        function WUFile( source ) {\n    \n            /**\n             * 文件名，包括扩展名（后缀）\n             * @property name\n             * @type {string}\n             */\n            this.name = source.name || 'Untitled';\n    \n            /**\n             * 文件体积（字节）\n             * @property size\n             * @type {uint}\n             * @default 0\n             */\n            this.size = source.size || 0;\n    \n            /**\n             * 文件MIMETYPE类型，与文件类型的对应关系请参考[http://t.cn/z8ZnFny](http://t.cn/z8ZnFny)\n             * @property type\n             * @type {string}\n             * @default 'application/octet-stream'\n             */\n            this.type = source.type || 'application/octet-stream';\n    \n            /**\n             * 文件最后修改日期\n             * @property lastModifiedDate\n             * @type {int}\n             * @default 当前时间戳\n             */\n            this.lastModifiedDate = source.lastModifiedDate || (new Date() * 1);\n    \n            /**\n             * 文件ID，每个对象具有唯一ID，与文件名无关\n             * @property id\n             * @type {string}\n             */\n            this.id = gid();\n    \n            /**\n             * 文件扩展名，通过文件名获取，例如test.png的扩展名为png\n             * @property ext\n             * @type {string}\n             */\n            this.ext = rExt.exec( this.name ) ? RegExp.$1 : '';\n    \n    \n            /**\n             * 状态文字说明。在不同的status语境下有不同的用途。\n             * @property statusText\n             * @type {string}\n             */\n            this.statusText = '';\n    \n            // 存储文件状态，防止通过属性直接修改\n            statusMap[ this.id ] = WUFile.Status.INITED;\n    \n            this.source = source;\n            this.loaded = 0;\n    \n            this.on( 'error', function( msg ) {\n                this.setStatus( WUFile.Status.ERROR, msg );\n            });\n        }\n    \n        $.extend( WUFile.prototype, {\n    \n            /**\n             * 设置状态，状态变化时会触发`change`事件。\n             * @method setStatus\n             * @grammar setStatus( status[, statusText] );\n             * @param {File.Status|String} status [文件状态值](#WebUploader:File:File.Status)\n             * @param {String} [statusText=''] 状态说明，常在error时使用，用http, abort,server等来标记是由于什么原因导致文件错误。\n             */\n            setStatus: function( status, text ) {\n    \n                var prevStatus = statusMap[ this.id ];\n    \n                typeof text !== 'undefined' && (this.statusText = text);\n    \n                if ( status !== prevStatus ) {\n                    statusMap[ this.id ] = status;\n                    /**\n                     * 文件状态变化\n                     * @event statuschange\n                     */\n                    this.trigger( 'statuschange', status, prevStatus );\n                }\n    \n            },\n    \n            /**\n             * 获取文件状态\n             * @return {File.Status}\n             * @example\n                     文件状态具体包括以下几种类型：\n                     {\n                         // 初始化\n                        INITED:     0,\n                        // 已入队列\n                        QUEUED:     1,\n                        // 正在上传\n                        PROGRESS:     2,\n                        // 上传出错\n                        ERROR:         3,\n                        // 上传成功\n                        COMPLETE:     4,\n                        // 上传取消\n                        CANCELLED:     5\n                    }\n             */\n            getStatus: function() {\n                return statusMap[ this.id ];\n            },\n    \n            /**\n             * 获取文件原始信息。\n             * @return {*}\n             */\n            getSource: function() {\n                return this.source;\n            },\n    \n            destroy: function() {\n                this.off();\n                delete statusMap[ this.id ];\n            }\n        });\n    \n        Mediator.installTo( WUFile.prototype );\n    \n        /**\n         * 文件状态值，具体包括以下几种类型：\n         * * `inited` 初始状态\n         * * `queued` 已经进入队列, 等待上传\n         * * `progress` 上传中\n         * * `complete` 上传完成。\n         * * `error` 上传出错，可重试\n         * * `interrupt` 上传中断，可续传。\n         * * `invalid` 文件不合格，不能重试上传。会自动从队列中移除。\n         * * `cancelled` 文件被移除。\n         * @property {Object} Status\n         * @namespace File\n         * @class File\n         * @static\n         */\n        WUFile.Status = {\n            INITED:     'inited',    // 初始状态\n            QUEUED:     'queued',    // 已经进入队列, 等待上传\n            PROGRESS:   'progress',    // 上传中\n            ERROR:      'error',    // 上传出错，可重试\n            COMPLETE:   'complete',    // 上传完成。\n            CANCELLED:  'cancelled',    // 上传取消。\n            INTERRUPT:  'interrupt',    // 上传中断，可续传。\n            INVALID:    'invalid'    // 文件不合格，不能重试上传。\n        };\n    \n        return WUFile;\n    });\n    \n    /**\n     * @fileOverview 文件队列\n     */\n    define('queue',[\n        'base',\n        'mediator',\n        'file'\n    ], function( Base, Mediator, WUFile ) {\n    \n        var $ = Base.$,\n            STATUS = WUFile.Status;\n    \n        /**\n         * 文件队列, 用来存储各个状态中的文件。\n         * @class Queue\n         * @extends Mediator\n         */\n        function Queue() {\n    \n            /**\n             * 统计文件数。\n             * * `numOfQueue` 队列中的文件数。\n             * * `numOfSuccess` 上传成功的文件数\n             * * `numOfCancel` 被取消的文件数\n             * * `numOfProgress` 正在上传中的文件数\n             * * `numOfUploadFailed` 上传错误的文件数。\n             * * `numOfInvalid` 无效的文件数。\n             * * `numofDeleted` 被移除的文件数。\n             * @property {Object} stats\n             */\n            this.stats = {\n                numOfQueue: 0,\n                numOfSuccess: 0,\n                numOfCancel: 0,\n                numOfProgress: 0,\n                numOfUploadFailed: 0,\n                numOfInvalid: 0,\n                numofDeleted: 0,\n                numofInterrupt: 0,\n            };\n    \n            // 上传队列，仅包括等待上传的文件\n            this._queue = [];\n    \n            // 存储所有文件\n            this._map = {};\n        }\n    \n        $.extend( Queue.prototype, {\n    \n            /**\n             * 将新文件加入对队列尾部\n             *\n             * @method append\n             * @param  {File} file   文件对象\n             */\n            append: function( file ) {\n                this._queue.push( file );\n                this._fileAdded( file );\n                return this;\n            },\n    \n            /**\n             * 将新文件加入对队列头部\n             *\n             * @method prepend\n             * @param  {File} file   文件对象\n             */\n            prepend: function( file ) {\n                this._queue.unshift( file );\n                this._fileAdded( file );\n                return this;\n            },\n    \n            /**\n             * 获取文件对象\n             *\n             * @method getFile\n             * @param  {String} fileId   文件ID\n             * @return {File}\n             */\n            getFile: function( fileId ) {\n                if ( typeof fileId !== 'string' ) {\n                    return fileId;\n                }\n                return this._map[ fileId ];\n            },\n    \n            /**\n             * 从队列中取出一个指定状态的文件。\n             * @grammar fetch( status ) => File\n             * @method fetch\n             * @param {String} status [文件状态值](#WebUploader:File:File.Status)\n             * @return {File} [File](#WebUploader:File)\n             */\n            fetch: function( status ) {\n                var len = this._queue.length,\n                    i, file;\n    \n                status = status || STATUS.QUEUED;\n    \n                for ( i = 0; i < len; i++ ) {\n                    file = this._queue[ i ];\n    \n                    if ( status === file.getStatus() ) {\n                        return file;\n                    }\n                }\n    \n                return null;\n            },\n    \n            /**\n             * 对队列进行排序，能够控制文件上传顺序。\n             * @grammar sort( fn ) => undefined\n             * @method sort\n             * @param {Function} fn 排序方法\n             */\n            sort: function( fn ) {\n                if ( typeof fn === 'function' ) {\n                    this._queue.sort( fn );\n                }\n            },\n    \n            /**\n             * 获取指定类型的文件列表, 列表中每一个成员为[File](#WebUploader:File)对象。\n             * @grammar getFiles( [status1[, status2 ...]] ) => Array\n             * @method getFiles\n             * @param {String} [status] [文件状态值](#WebUploader:File:File.Status)\n             */\n            getFiles: function() {\n                var sts = [].slice.call( arguments, 0 ),\n                    ret = [],\n                    i = 0,\n                    len = this._queue.length,\n                    file;\n    \n                for ( ; i < len; i++ ) {\n                    file = this._queue[ i ];\n    \n                    if ( sts.length && !~$.inArray( file.getStatus(), sts ) ) {\n                        continue;\n                    }\n    \n                    ret.push( file );\n                }\n    \n                return ret;\n            },\n    \n            /**\n             * 在队列中删除文件。\n             * @grammar removeFile( file ) => Array\n             * @method removeFile\n             * @param {File} 文件对象。\n             */\n            removeFile: function( file ) {\n                var me = this,\n                    existing = this._map[ file.id ];\n    \n                if ( existing ) {\n                    delete this._map[ file.id ];\n                    file.destroy();\n                    this.stats.numofDeleted++;\n                }\n            },\n    \n            _fileAdded: function( file ) {\n                var me = this,\n                    existing = this._map[ file.id ];\n    \n                if ( !existing ) {\n                    this._map[ file.id ] = file;\n    \n                    file.on( 'statuschange', function( cur, pre ) {\n                        me._onFileStatusChange( cur, pre );\n                    });\n                }\n            },\n    \n            _onFileStatusChange: function( curStatus, preStatus ) {\n                var stats = this.stats;\n    \n                switch ( preStatus ) {\n                    case STATUS.PROGRESS:\n                        stats.numOfProgress--;\n                        break;\n    \n                    case STATUS.QUEUED:\n                        stats.numOfQueue --;\n                        break;\n    \n                    case STATUS.ERROR:\n                        stats.numOfUploadFailed--;\n                        break;\n    \n                    case STATUS.INVALID:\n                        stats.numOfInvalid--;\n                        break;\n    \n                    case STATUS.INTERRUPT:\n                        stats.numofInterrupt--;\n                        break;\n                }\n    \n                switch ( curStatus ) {\n                    case STATUS.QUEUED:\n                        stats.numOfQueue++;\n                        break;\n    \n                    case STATUS.PROGRESS:\n                        stats.numOfProgress++;\n                        break;\n    \n                    case STATUS.ERROR:\n                        stats.numOfUploadFailed++;\n                        break;\n    \n                    case STATUS.COMPLETE:\n                        stats.numOfSuccess++;\n                        break;\n    \n                    case STATUS.CANCELLED:\n                        stats.numOfCancel++;\n                        break;\n    \n    \n                    case STATUS.INVALID:\n                        stats.numOfInvalid++;\n                        break;\n    \n                    case STATUS.INTERRUPT:\n                        stats.numofInterrupt++;\n                        break;\n                }\n            }\n    \n        });\n    \n        Mediator.installTo( Queue.prototype );\n    \n        return Queue;\n    });\n    /**\n     * @fileOverview 队列\n     */\n    define('widgets/queue',[\n        'base',\n        'uploader',\n        'queue',\n        'file',\n        'lib/file',\n        'runtime/client',\n        'widgets/widget'\n    ], function( Base, Uploader, Queue, WUFile, File, RuntimeClient ) {\n    \n        var $ = Base.$,\n            rExt = /\\.\\w+$/,\n            Status = WUFile.Status;\n    \n        return Uploader.register({\n            name: 'queue',\n    \n            init: function( opts ) {\n                var me = this,\n                    deferred, len, i, item, arr, accept, runtime;\n    \n                if ( $.isPlainObject( opts.accept ) ) {\n                    opts.accept = [ opts.accept ];\n                }\n    \n                // accept中的中生成匹配正则。\n                if ( opts.accept ) {\n                    arr = [];\n    \n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n                        item = opts.accept[ i ].extensions;\n                        item && arr.push( item );\n                    }\n    \n                    if ( arr.length ) {\n                        accept = '\\\\.' + arr.join(',')\n                                .replace( /,/g, '$|\\\\.' )\n                                .replace( /\\*/g, '.*' ) + '$';\n                    }\n    \n                    me.accept = new RegExp( accept, 'i' );\n                }\n    \n                me.queue = new Queue();\n                me.stats = me.queue.stats;\n    \n                // 如果当前不是html5运行时，那就算了。\n                // 不执行后续操作\n                if ( this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n    \n                // 创建一个 html5 运行时的 placeholder\n                // 以至于外部添加原生 File 对象的时候能正确包裹一下供 webuploader 使用。\n                deferred = Base.Deferred();\n                this.placeholder = runtime = new RuntimeClient('Placeholder');\n                runtime.connectRuntime({\n                    runtimeOrder: 'html5'\n                }, function() {\n                    me._ruid = runtime.getRuid();\n                    deferred.resolve();\n                });\n                return deferred.promise();\n            },\n    \n    \n            // 为了支持外部直接添加一个原生File对象。\n            _wrapFile: function( file ) {\n                if ( !(file instanceof WUFile) ) {\n    \n                    if ( !(file instanceof File) ) {\n                        if ( !this._ruid ) {\n                            throw new Error('Can\\'t add external files.');\n                        }\n                        file = new File( this._ruid, file );\n                    }\n    \n                    file = new WUFile( file );\n                }\n    \n                return file;\n            },\n    \n            // 判断文件是否可以被加入队列\n            acceptFile: function( file ) {\n                var invalid = !file || !file.size || this.accept &&\n    \n                        // 如果名字中有后缀，才做后缀白名单处理。\n                        rExt.exec( file.name ) && !this.accept.test( file.name );\n    \n                return !invalid;\n            },\n    \n    \n            /**\n             * @event beforeFileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列之前触发，此事件的handler返回值为`false`，则此文件不会被添加进入队列。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event fileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列以后触发。\n             * @for  Uploader\n             */\n    \n            _addFile: function( file ) {\n                var me = this;\n    \n                file = me._wrapFile( file );\n    \n                // 不过类型判断允许不允许，先派送 `beforeFileQueued`\n                if ( !me.owner.trigger( 'beforeFileQueued', file ) ) {\n                    return;\n                }\n    \n                // 类型不匹配，则派送错误事件，并返回。\n                if ( !me.acceptFile( file ) ) {\n                    me.owner.trigger( 'error', 'Q_TYPE_DENIED', file );\n                    return;\n                }\n    \n                me.queue.append( file );\n                me.owner.trigger( 'fileQueued', file );\n                return file;\n            },\n    \n            getFile: function( fileId ) {\n                return this.queue.getFile( fileId );\n            },\n    \n            /**\n             * @event filesQueued\n             * @param {File} files 数组，内容为原始File(lib/File）对象。\n             * @description 当一批文件添加进队列以后触发。\n             * @for  Uploader\n             */\n            \n            /**\n             * @property {Boolean} [auto=false]\n             * @namespace options\n             * @for Uploader\n             * @description 设置为 true 后，不需要手动调用上传，有文件选择即开始上传。\n             * \n             */\n    \n            /**\n             * @method addFiles\n             * @grammar addFiles( file ) => undefined\n             * @grammar addFiles( [file1, file2 ...] ) => undefined\n             * @param {Array of File or File} [files] Files 对象 数组\n             * @description 添加文件到队列\n             * @for  Uploader\n             */\n            addFile: function( files ) {\n                var me = this;\n    \n                if ( !files.length ) {\n                    files = [ files ];\n                }\n    \n                files = $.map( files, function( file ) {\n                    return me._addFile( file );\n                });\n    \n                me.owner.trigger( 'filesQueued', files );\n    \n                if ( me.options.auto ) {\n                    setTimeout(function() {\n                        me.request('start-upload');\n                    }, 20 );\n                }\n            },\n    \n            getStats: function() {\n                return this.stats;\n            },\n    \n            /**\n             * @event fileDequeued\n             * @param {File} file File对象\n             * @description 当文件被移除队列后触发。\n             * @for  Uploader\n             */\n    \n             /**\n             * @method removeFile\n             * @grammar removeFile( file ) => undefined\n             * @grammar removeFile( id ) => undefined\n             * @grammar removeFile( file, true ) => undefined\n             * @grammar removeFile( id, true ) => undefined\n             * @param {File|id} file File对象或这File对象的id\n             * @description 移除某一文件, 默认只会标记文件状态为已取消，如果第二个参数为 `true` 则会从 queue 中移除。\n             * @for  Uploader\n             * @example\n             *\n             * $li.on('click', '.remove-this', function() {\n             *     uploader.removeFile( file );\n             * })\n             */\n            removeFile: function( file, remove ) {\n                var me = this;\n    \n                file = file.id ? file : me.queue.getFile( file );\n    \n                this.request( 'cancel-file', file );\n    \n                if ( remove ) {\n                    this.queue.removeFile( file );\n                }\n            },\n    \n            /**\n             * @method getFiles\n             * @grammar getFiles() => Array\n             * @grammar getFiles( status1, status2, status... ) => Array\n             * @description 返回指定状态的文件集合，不传参数将返回所有状态的文件。\n             * @for  Uploader\n             * @example\n             * console.log( uploader.getFiles() );    // => all files\n             * console.log( uploader.getFiles('error') )    // => all error files.\n             */\n            getFiles: function() {\n                return this.queue.getFiles.apply( this.queue, arguments );\n            },\n    \n            fetchFile: function() {\n                return this.queue.fetch.apply( this.queue, arguments );\n            },\n    \n            /**\n             * @method retry\n             * @grammar retry() => undefined\n             * @grammar retry( file ) => undefined\n             * @description 重试上传，重试指定文件，或者从出错的文件开始重新上传。\n             * @for  Uploader\n             * @example\n             * function retry() {\n             *     uploader.retry();\n             * }\n             */\n            retry: function( file, noForceStart ) {\n                var me = this,\n                    files, i, len;\n    \n                if ( file ) {\n                    file = file.id ? file : me.queue.getFile( file );\n                    file.setStatus( Status.QUEUED );\n                    noForceStart || me.request('start-upload');\n                    return;\n                }\n    \n                files = me.queue.getFiles( Status.ERROR );\n                i = 0;\n                len = files.length;\n    \n                for ( ; i < len; i++ ) {\n                    file = files[ i ];\n                    file.setStatus( Status.QUEUED );\n                }\n    \n                me.request('start-upload');\n            },\n    \n            /**\n             * @method sort\n             * @grammar sort( fn ) => undefined\n             * @description 排序队列中的文件，在上传之前调整可以控制上传顺序。\n             * @for  Uploader\n             */\n            sortFiles: function() {\n                return this.queue.sort.apply( this.queue, arguments );\n            },\n    \n            /**\n             * @event reset\n             * @description 当 uploader 被重置的时候触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * @method reset\n             * @grammar reset() => undefined\n             * @description 重置uploader。目前只重置了队列。\n             * @for  Uploader\n             * @example\n             * uploader.reset();\n             */\n            reset: function() {\n                this.owner.trigger('reset');\n                this.queue = new Queue();\n                this.stats = this.queue.stats;\n            },\n    \n            destroy: function() {\n                this.reset();\n                this.placeholder && this.placeholder.destroy();\n            }\n        });\n    \n    });\n    /**\n     * @fileOverview 添加获取Runtime相关信息的方法。\n     */\n    define('widgets/runtime',[\n        'uploader',\n        'runtime/runtime',\n        'widgets/widget'\n    ], function( Uploader, Runtime ) {\n    \n        Uploader.support = function() {\n            return Runtime.hasRuntime.apply( Runtime, arguments );\n        };\n    \n        return Uploader.register({\n            name: 'runtime',\n    \n            init: function() {\n                if ( !this.predictRuntimeType() ) {\n                    throw Error('Runtime Error');\n                }\n            },\n    \n            /**\n             * 预测Uploader将采用哪个`Runtime`\n             * @grammar predictRuntimeType() => String\n             * @method predictRuntimeType\n             * @for  Uploader\n             */\n            predictRuntimeType: function() {\n                var orders = this.options.runtimeOrder || Runtime.orders,\n                    type = this.type,\n                    i, len;\n    \n                if ( !type ) {\n                    orders = orders.split( /\\s*,\\s*/g );\n    \n                    for ( i = 0, len = orders.length; i < len; i++ ) {\n                        if ( Runtime.hasRuntime( orders[ i ] ) ) {\n                            this.type = type = orders[ i ];\n                            break;\n                        }\n                    }\n                }\n    \n                return type;\n            }\n        });\n    });\n    /**\n     * @fileOverview Transport\n     */\n    define('lib/transport',[\n        'base',\n        'runtime/client',\n        'mediator'\n    ], function( Base, RuntimeClient, Mediator ) {\n    \n        var $ = Base.$;\n    \n        function Transport( opts ) {\n            var me = this;\n    \n            opts = me.options = $.extend( true, {}, Transport.options, opts || {} );\n            RuntimeClient.call( this, 'Transport' );\n    \n            this._blob = null;\n            this._formData = opts.formData || {};\n            this._headers = opts.headers || {};\n    \n            this.on( 'progress', this._timeout );\n            this.on( 'load error', function() {\n                me.trigger( 'progress', 1 );\n                clearTimeout( me._timer );\n            });\n        }\n    \n        Transport.options = {\n            server: '',\n            method: 'POST',\n    \n            // 跨域时，是否允许携带cookie, 只有html5 runtime才有效\n            withCredentials: false,\n            fileVal: 'file',\n            timeout: 2 * 60 * 1000,    // 2分钟\n            formData: {},\n            headers: {},\n            sendAsBinary: false\n        };\n    \n        $.extend( Transport.prototype, {\n    \n            // 添加Blob, 只能添加一次，最后一次有效。\n            appendBlob: function( key, blob, filename ) {\n                var me = this,\n                    opts = me.options;\n    \n                if ( me.getRuid() ) {\n                    me.disconnectRuntime();\n                }\n    \n                // 连接到blob归属的同一个runtime.\n                me.connectRuntime( blob.ruid, function() {\n                    me.exec('init');\n                });\n    \n                me._blob = blob;\n                opts.fileVal = key || opts.fileVal;\n                opts.filename = filename || opts.filename;\n            },\n    \n            // 添加其他字段\n            append: function( key, value ) {\n                if ( typeof key === 'object' ) {\n                    $.extend( this._formData, key );\n                } else {\n                    this._formData[ key ] = value;\n                }\n            },\n    \n            setRequestHeader: function( key, value ) {\n                if ( typeof key === 'object' ) {\n                    $.extend( this._headers, key );\n                } else {\n                    this._headers[ key ] = value;\n                }\n            },\n    \n            send: function( method ) {\n                this.exec( 'send', method );\n                this._timeout();\n            },\n    \n            abort: function() {\n                clearTimeout( this._timer );\n                return this.exec('abort');\n            },\n    \n            destroy: function() {\n                this.trigger('destroy');\n                this.off();\n                this.exec('destroy');\n                this.disconnectRuntime();\n            },\n    \n            getResponse: function() {\n                return this.exec('getResponse');\n            },\n    \n            getResponseAsJson: function() {\n                return this.exec('getResponseAsJson');\n            },\n    \n            getStatus: function() {\n                return this.exec('getStatus');\n            },\n    \n            _timeout: function() {\n                var me = this,\n                    duration = me.options.timeout;\n    \n                if ( !duration ) {\n                    return;\n                }\n    \n                clearTimeout( me._timer );\n                me._timer = setTimeout(function() {\n                    me.abort();\n                    me.trigger( 'error', 'timeout' );\n                }, duration );\n            }\n    \n        });\n    \n        // 让Transport具备事件功能。\n        Mediator.installTo( Transport.prototype );\n    \n        return Transport;\n    });\n    /**\n     * @fileOverview 负责文件上传相关。\n     */\n    define('widgets/upload',[\n        'base',\n        'uploader',\n        'file',\n        'lib/transport',\n        'widgets/widget'\n    ], function( Base, Uploader, WUFile, Transport ) {\n    \n        var $ = Base.$,\n            isPromise = Base.isPromise,\n            Status = WUFile.Status;\n    \n        // 添加默认配置项\n        $.extend( Uploader.options, {\n    \n    \n            /**\n             * @property {Boolean} [prepareNextFile=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否允许在文件传输时提前把下一个文件准备好。\n             * 对于一个文件的准备工作比较耗时，比如图片压缩，md5序列化。\n             * 如果能提前在当前文件传输期处理，可以节省总体耗时。\n             */\n            prepareNextFile: false,\n    \n            /**\n             * @property {Boolean} [chunked=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否要分片处理大文件上传。\n             */\n            chunked: false,\n    \n            /**\n             * @property {Boolean} [chunkSize=5242880]\n             * @namespace options\n             * @for Uploader\n             * @description 如果要分片，分多大一片？ 默认大小为5M.\n             */\n            chunkSize: 5 * 1024 * 1024,\n    \n            /**\n             * @property {Boolean} [chunkRetry=2]\n             * @namespace options\n             * @for Uploader\n             * @description 如果某个分片由于网络问题出错，允许自动重传多少次？\n             */\n            chunkRetry: 2,\n    \n            /**\n             * @property {Boolean} [threads=3]\n             * @namespace options\n             * @for Uploader\n             * @description 上传并发数。允许同时最大上传进程数。\n             */\n            threads: 3,\n    \n    \n            /**\n             * @property {Object} [formData={}]\n             * @namespace options\n             * @for Uploader\n             * @description 文件上传请求的参数表，每次发送都会发送此对象中的参数。\n             */\n            formData: {}\n    \n            /**\n             * @property {Object} [fileVal='file']\n             * @namespace options\n             * @for Uploader\n             * @description 设置文件上传域的name。\n             */\n    \n            /**\n             * @property {Object} [method='POST']\n             * @namespace options\n             * @for Uploader\n             * @description 文件上传方式，`POST`或者`GET`。\n             */\n    \n            /**\n             * @property {Object} [sendAsBinary=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否已二进制的流的方式发送文件，这样整个上传内容`php://input`都为文件内容，\n             * 其他参数在$_GET数组中。\n             */\n        });\n    \n        // 负责将文件切片。\n        function CuteFile( file, chunkSize ) {\n            var pending = [],\n                blob = file.source,\n                total = blob.size,\n                chunks = chunkSize ? Math.ceil( total / chunkSize ) : 1,\n                start = 0,\n                index = 0,\n                len, api;\n    \n            api = {\n                file: file,\n    \n                has: function() {\n                    return !!pending.length;\n                },\n    \n                shift: function() {\n                    return pending.shift();\n                },\n    \n                unshift: function( block ) {\n                    pending.unshift( block );\n                }\n            };\n    \n            while ( index < chunks ) {\n                len = Math.min( chunkSize, total - start );\n    \n                pending.push({\n                    file: file,\n                    start: start,\n                    end: chunkSize ? (start + len) : total,\n                    total: total,\n                    chunks: chunks,\n                    chunk: index++,\n                    cuted: api\n                });\n                start += len;\n            }\n    \n            file.blocks = pending.concat();\n            file.remaning = pending.length;\n    \n            return api;\n        }\n    \n        Uploader.register({\n            name: 'upload',\n    \n            init: function() {\n                var owner = this.owner,\n                    me = this;\n    \n                this.runing = false;\n                this.progress = false;\n    \n                owner\n                    .on( 'startUpload', function() {\n                        me.progress = true;\n                    })\n                    .on( 'uploadFinished', function() {\n                        me.progress = false;\n                    });\n    \n                // 记录当前正在传的数据，跟threads相关\n                this.pool = [];\n    \n                // 缓存分好片的文件。\n                this.stack = [];\n    \n                // 缓存即将上传的文件。\n                this.pending = [];\n    \n                // 跟踪还有多少分片在上传中但是没有完成上传。\n                this.remaning = 0;\n                this.__tick = Base.bindFn( this._tick, this );\n    \n                owner.on( 'uploadComplete', function( file ) {\n                    \n                    // 把其他块取消了。\n                    file.blocks && $.each( file.blocks, function( _, v ) {\n                        v.transport && (v.transport.abort(), v.transport.destroy());\n                        delete v.transport;\n                    });\n    \n                    delete file.blocks;\n                    delete file.remaning;\n                });\n            },\n    \n            reset: function() {\n                this.request( 'stop-upload', true );\n                this.runing = false;\n                this.pool = [];\n                this.stack = [];\n                this.pending = [];\n                this.remaning = 0;\n                this._trigged = false;\n                this._promise = null;\n            },\n    \n            /**\n             * @event startUpload\n             * @description 当开始上传流程时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * 开始上传。此方法可以从初始状态调用开始上传流程，也可以从暂停状态调用，继续上传流程。\n             *\n             * 可以指定开始某一个文件。\n             * @grammar upload() => undefined\n             * @grammar upload( file | fileId) => undefined\n             * @method upload\n             * @for  Uploader\n             */\n            startUpload: function(file) {\n                var me = this;\n    \n                // 移出invalid的文件\n                $.each( me.request( 'get-files', Status.INVALID ), function() {\n                    me.request( 'remove-file', this );\n                });\n    \n                // 如果指定了开始某个文件，则只开始指定文件。\n                if ( file ) {\n                    file = file.id ? file : me.request( 'get-file', file );\n    \n                    if (file.getStatus() === Status.INTERRUPT) {\n                        $.each( me.pool, function( _, v ) {\n                        \n                            // 之前暂停过。\n                            if (v.file !== file) {\n                                return;\n                            }\n    \n                            v.transport && v.transport.send();\n                        });\n                        \n                        file.setStatus( Status.QUEUED );\n                    } else if (file.getStatus() === Status.PROGRESS) {\n                        return;\n                    } else {\n                        file.setStatus( Status.QUEUED );\n                    }\n                } else {\n                    $.each( me.request( 'get-files', [ Status.INITED ] ), function() {\n                        this.setStatus( Status.QUEUED );\n                    });\n                }\n    \n                if ( me.runing ) {\n                    return;\n                }\n    \n                me.runing = true;\n    \n                // 如果有暂停的，则续传\n                $.each( me.pool, function( _, v ) {\n                    var file = v.file;\n    \n                    if ( file.getStatus() === Status.INTERRUPT ) {\n                        file.setStatus( Status.PROGRESS );\n                        me._trigged = false;\n                        v.transport && v.transport.send();\n                    }\n                });\n    \n                file || $.each( me.request( 'get-files',\n                        Status.INTERRUPT ), function() {\n                    this.setStatus( Status.PROGRESS );\n                });\n    \n                me._trigged = false;\n                Base.nextTick( me.__tick );\n                me.owner.trigger('startUpload');\n            },\n    \n            /**\n             * @event stopUpload\n             * @description 当开始上传流程暂停时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * 暂停上传。第一个参数为是否中断上传当前正在上传的文件。\n             *\n             * 如果第一个参数是文件，则只暂停指定文件。\n             * @grammar stop() => undefined\n             * @grammar stop( true ) => undefined\n             * @grammar stop( file ) => undefined\n             * @method stop\n             * @for  Uploader\n             */\n            stopUpload: function( file, interrupt ) {\n                var me = this;\n    \n                if (file === true) {\n                    interrupt = file;\n                    file = null;\n                }\n    \n                if ( me.runing === false ) {\n                    return;\n                }\n    \n                // 如果只是暂停某个文件。\n                if ( file ) {\n                    file = file.id ? file : me.request( 'get-file', file );\n    \n                    if ( file.getStatus() !== Status.PROGRESS &&\n                            file.getStatus() !== Status.QUEUED ) {\n                        return;\n                    }\n    \n                    file.setStatus( Status.INTERRUPT );\n                    $.each( me.pool, function( _, v ) {\n                        \n                        // 只 abort 指定的文件。\n                        if (v.file !== file) {\n                            return;\n                        }\n    \n                        v.transport && v.transport.abort();\n                        me._putback(v);\n                        me._popBlock(v);\n                    });\n    \n                    return Base.nextTick( me.__tick );\n                }\n    \n                me.runing = false;\n    \n                if (this._promise && this._promise.file) {\n                    this._promise.file.setStatus( Status.INTERRUPT );\n                }\n    \n                interrupt && $.each( me.pool, function( _, v ) {\n                    v.transport && v.transport.abort();\n                    v.file.setStatus( Status.INTERRUPT );\n                });\n    \n                me.owner.trigger('stopUpload');\n            },\n    \n            /**\n             * @method cancelFile\n             * @grammar cancelFile( file ) => undefined\n             * @grammar cancelFile( id ) => undefined\n             * @param {File|id} file File对象或这File对象的id\n             * @description 标记文件状态为已取消, 同时将中断文件传输。\n             * @for  Uploader\n             * @example\n             *\n             * $li.on('click', '.remove-this', function() {\n             *     uploader.cancelFile( file );\n             * })\n             */\n            cancelFile: function( file ) {\n                file = file.id ? file : this.request( 'get-file', file );\n    \n                // 如果正在上传。\n                file.blocks && $.each( file.blocks, function( _, v ) {\n                    var _tr = v.transport;\n    \n                    if ( _tr ) {\n                        _tr.abort();\n                        _tr.destroy();\n                        delete v.transport;\n                    }\n                });\n    \n                file.setStatus( Status.CANCELLED );\n                this.owner.trigger( 'fileDequeued', file );\n            },\n    \n            /**\n             * 判断`Uplaode`r是否正在上传中。\n             * @grammar isInProgress() => Boolean\n             * @method isInProgress\n             * @for  Uploader\n             */\n            isInProgress: function() {\n                return !!this.progress;\n            },\n    \n            _getStats: function() {\n                return this.request('get-stats');\n            },\n    \n            /**\n             * 掉过一个文件上传，直接标记指定文件为已上传状态。\n             * @grammar skipFile( file ) => undefined\n             * @method skipFile\n             * @for  Uploader\n             */\n            skipFile: function( file, status ) {\n                file = file.id ? file : this.request( 'get-file', file );\n    \n                file.setStatus( status || Status.COMPLETE );\n                file.skipped = true;\n    \n                // 如果正在上传。\n                file.blocks && $.each( file.blocks, function( _, v ) {\n                    var _tr = v.transport;\n    \n                    if ( _tr ) {\n                        _tr.abort();\n                        _tr.destroy();\n                        delete v.transport;\n                    }\n                });\n    \n                this.owner.trigger( 'uploadSkip', file );\n            },\n    \n            /**\n             * @event uploadFinished\n             * @description 当所有文件上传结束时触发。\n             * @for  Uploader\n             */\n            _tick: function() {\n                var me = this,\n                    opts = me.options,\n                    fn, val;\n    \n                // 上一个promise还没有结束，则等待完成后再执行。\n                if ( me._promise ) {\n                    return me._promise.always( me.__tick );\n                }\n    \n                // 还有位置，且还有文件要处理的话。\n                if ( me.pool.length < opts.threads && (val = me._nextBlock()) ) {\n                    me._trigged = false;\n    \n                    fn = function( val ) {\n                        me._promise = null;\n    \n                        // 有可能是reject过来的，所以要检测val的类型。\n                        val && val.file && me._startSend( val );\n                        Base.nextTick( me.__tick );\n                    };\n    \n                    me._promise = isPromise( val ) ? val.always( fn ) : fn( val );\n    \n                // 没有要上传的了，且没有正在传输的了。\n                } else if ( !me.remaning && !me._getStats().numOfQueue &&\n                    !me._getStats().numofInterrupt ) {\n                    me.runing = false;\n    \n                    me._trigged || Base.nextTick(function() {\n                        me.owner.trigger('uploadFinished');\n                    });\n                    me._trigged = true;\n                }\n            },\n    \n            _putback: function(block) {\n                var idx;\n    \n                block.cuted.unshift(block);\n                idx = this.stack.indexOf(block.cuted);\n    \n                if (!~idx) {\n                    this.stack.unshift(block.cuted);\n                }\n            },\n    \n            _getStack: function() {\n                var i = 0,\n                    act;\n    \n                while ( (act = this.stack[ i++ ]) ) {\n                    if ( act.has() && act.file.getStatus() === Status.PROGRESS ) {\n                        return act;\n                    } else if (!act.has() ||\n                            act.file.getStatus() !== Status.PROGRESS &&\n                            act.file.getStatus() !== Status.INTERRUPT ) {\n    \n                        // 把已经处理完了的，或者，状态为非 progress（上传中）、\n                        // interupt（暂停中） 的移除。\n                        this.stack.splice( --i, 1 );\n                    }\n                }\n    \n                return null;\n            },\n    \n            _nextBlock: function() {\n                var me = this,\n                    opts = me.options,\n                    act, next, done, preparing;\n    \n                // 如果当前文件还有没有需要传输的，则直接返回剩下的。\n                if ( (act = this._getStack()) ) {\n    \n                    // 是否提前准备下一个文件\n                    if ( opts.prepareNextFile && !me.pending.length ) {\n                        me._prepareNextFile();\n                    }\n    \n                    return act.shift();\n    \n                // 否则，如果正在运行，则准备下一个文件，并等待完成后返回下个分片。\n                } else if ( me.runing ) {\n    \n                    // 如果缓存中有，则直接在缓存中取，没有则去queue中取。\n                    if ( !me.pending.length && me._getStats().numOfQueue ) {\n                        me._prepareNextFile();\n                    }\n    \n                    next = me.pending.shift();\n                    done = function( file ) {\n                        if ( !file ) {\n                            return null;\n                        }\n                            \n                        act = CuteFile( file, opts.chunked ? opts.chunkSize : 0 );\n                        me.stack.push(act);\n                        return act.shift();\n                    };\n    \n                    // 文件可能还在prepare中，也有可能已经完全准备好了。\n                    if ( isPromise( next) ) {\n                        preparing = next.file;\n                        next = next[ next.pipe ? 'pipe' : 'then' ]( done );\n                        next.file = preparing;\n                        return next;\n                    }\n    \n                    return done( next );\n                }\n            },\n    \n    \n            /**\n             * @event uploadStart\n             * @param {File} file File对象\n             * @description 某个文件开始上传前触发，一个文件只会触发一次。\n             * @for  Uploader\n             */\n            _prepareNextFile: function() {\n                var me = this,\n                    file = me.request('fetch-file'),\n                    pending = me.pending,\n                    promise;\n    \n                if ( file ) {\n                    promise = me.request( 'before-send-file', file, function() {\n    \n                        // 有可能文件被skip掉了。文件被skip掉后，状态坑定不是Queued.\n                        if ( file.getStatus() === Status.PROGRESS || \n                            file.getStatus() === Status.INTERRUPT ) {\n                            return file;\n                        }\n    \n                        return me._finishFile( file );\n                    });\n    \n                    me.owner.trigger( 'uploadStart', file );\n                    file.setStatus( Status.PROGRESS );\n    \n                    promise.file = file;\n    \n                    // 如果还在pending中，则替换成文件本身。\n                    promise.done(function() {\n                        var idx = $.inArray( promise, pending );\n    \n                        ~idx && pending.splice( idx, 1, file );\n                    });\n    \n                    // befeore-send-file的钩子就有错误发生。\n                    promise.fail(function( reason ) {\n                        file.setStatus( Status.ERROR, reason );\n                        me.owner.trigger( 'uploadError', file, reason );\n                        me.owner.trigger( 'uploadComplete', file );\n                    });\n    \n                    pending.push( promise );\n                }\n            },\n    \n            // 让出位置了，可以让其他分片开始上传\n            _popBlock: function( block ) {\n                var idx = $.inArray( block, this.pool );\n    \n                this.pool.splice( idx, 1 );\n                block.file.remaning--;\n                this.remaning--;\n            },\n    \n            // 开始上传，可以被掉过。如果promise被reject了，则表示跳过此分片。\n            _startSend: function( block ) {\n                var me = this,\n                    file = block.file,\n                    promise;\n    \n                // 有可能在 before-send-file 的 promise 期间改变了文件状态。\n                // 如：暂停，取消\n                // 我们不能中断 promise, 但是可以在 promise 完后，不做上传操作。\n                if ( file.getStatus() !== Status.PROGRESS ) {\n                    \n                    // 如果是中断，则还需要放回去。\n                    if (file.getStatus() === Status.INTERRUPT) {\n                        me._putback(block);\n                    }\n    \n                    return;\n                }\n    \n                me.pool.push( block );\n                me.remaning++;\n    \n                // 如果没有分片，则直接使用原始的。\n                // 不会丢失content-type信息。\n                block.blob = block.chunks === 1 ? file.source :\n                        file.source.slice( block.start, block.end );\n    \n                // hook, 每个分片发送之前可能要做些异步的事情。\n                promise = me.request( 'before-send', block, function() {\n    \n                    // 有可能文件已经上传出错了，所以不需要再传输了。\n                    if ( file.getStatus() === Status.PROGRESS ) {\n                        me._doSend( block );\n                    } else {\n                        me._popBlock( block );\n                        Base.nextTick( me.__tick );\n                    }\n                });\n    \n                // 如果为fail了，则跳过此分片。\n                promise.fail(function() {\n                    if ( file.remaning === 1 ) {\n                        me._finishFile( file ).always(function() {\n                            block.percentage = 1;\n                            me._popBlock( block );\n                            me.owner.trigger( 'uploadComplete', file );\n                            Base.nextTick( me.__tick );\n                        });\n                    } else {\n                        block.percentage = 1;\n                        me._popBlock( block );\n                        Base.nextTick( me.__tick );\n                    }\n                });\n            },\n    \n    \n            /**\n             * @event uploadBeforeSend\n             * @param {Object} object\n             * @param {Object} data 默认的上传参数，可以扩展此对象来控制上传参数。\n             * @param {Object} headers 可以扩展此对象来控制上传头部。\n             * @description 当某个文件的分块在发送前触发，主要用来询问是否要添加附带参数，大文件在开起分片上传的前提下此事件可能会触发多次。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadAccept\n             * @param {Object} object\n             * @param {Object} ret 服务端的返回数据，json格式，如果服务端不是json格式，从ret._raw中取数据，自行解析。\n             * @description 当某个文件上传到服务端响应后，会派送此事件来询问服务端响应是否有效。如果此事件handler返回值为`false`, 则此文件将派送`server`类型的`uploadError`事件。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadProgress\n             * @param {File} file File对象\n             * @param {Number} percentage 上传进度\n             * @description 上传过程中触发，携带上传进度。\n             * @for  Uploader\n             */\n    \n    \n            /**\n             * @event uploadError\n             * @param {File} file File对象\n             * @param {String} reason 出错的code\n             * @description 当文件上传出错时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadSuccess\n             * @param {File} file File对象\n             * @param {Object} response 服务端返回的数据\n             * @description 当文件上传成功时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadComplete\n             * @param {File} [file] File对象\n             * @description 不管成功或者失败，文件上传完成时触发。\n             * @for  Uploader\n             */\n    \n            // 做上传操作。\n            _doSend: function( block ) {\n                var me = this,\n                    owner = me.owner,\n                    opts = me.options,\n                    file = block.file,\n                    tr = new Transport( opts ),\n                    data = $.extend({}, opts.formData ),\n                    headers = $.extend({}, opts.headers ),\n                    requestAccept, ret;\n    \n                block.transport = tr;\n    \n                tr.on( 'destroy', function() {\n                    delete block.transport;\n                    me._popBlock( block );\n                    Base.nextTick( me.__tick );\n                });\n    \n                // 广播上传进度。以文件为单位。\n                tr.on( 'progress', function( percentage ) {\n                    var totalPercent = 0,\n                        uploaded = 0;\n    \n                    // 可能没有abort掉，progress还是执行进来了。\n                    // if ( !file.blocks ) {\n                    //     return;\n                    // }\n    \n                    totalPercent = block.percentage = percentage;\n    \n                    if ( block.chunks > 1 ) {    // 计算文件的整体速度。\n                        $.each( file.blocks, function( _, v ) {\n                            uploaded += (v.percentage || 0) * (v.end - v.start);\n                        });\n    \n                        totalPercent = uploaded / file.size;\n                    }\n    \n                    owner.trigger( 'uploadProgress', file, totalPercent || 0 );\n                });\n    \n                // 用来询问，是否返回的结果是有错误的。\n                requestAccept = function( reject ) {\n                    var fn;\n    \n                    ret = tr.getResponseAsJson() || {};\n                    ret._raw = tr.getResponse();\n                    fn = function( value ) {\n                        reject = value;\n                    };\n    \n                    // 服务端响应了，不代表成功了，询问是否响应正确。\n                    if ( !owner.trigger( 'uploadAccept', block, ret, fn ) ) {\n                        reject = reject || 'server';\n                    }\n    \n                    return reject;\n                };\n    \n                // 尝试重试，然后广播文件上传出错。\n                tr.on( 'error', function( type, flag ) {\n                    block.retried = block.retried || 0;\n    \n                    // 自动重试\n                    if ( block.chunks > 1 && ~'http,abort'.indexOf( type ) &&\n                            block.retried < opts.chunkRetry ) {\n    \n                        block.retried++;\n                        tr.send();\n    \n                    } else {\n    \n                        // http status 500 ~ 600\n                        if ( !flag && type === 'server' ) {\n                            type = requestAccept( type );\n                        }\n    \n                        file.setStatus( Status.ERROR, type );\n                        owner.trigger( 'uploadError', file, type );\n                        owner.trigger( 'uploadComplete', file );\n                    }\n                });\n    \n                // 上传成功\n                tr.on( 'load', function() {\n                    var reason;\n    \n                    // 如果非预期，转向上传出错。\n                    if ( (reason = requestAccept()) ) {\n                        tr.trigger( 'error', reason, true );\n                        return;\n                    }\n    \n                    // 全部上传完成。\n                    if ( file.remaning === 1 ) {\n                        me._finishFile( file, ret );\n                    } else {\n                        tr.destroy();\n                    }\n                });\n    \n                // 配置默认的上传字段。\n                data = $.extend( data, {\n                    id: file.id,\n                    name: file.name,\n                    type: file.type,\n                    lastModifiedDate: file.lastModifiedDate,\n                    size: file.size\n                });\n    \n                block.chunks > 1 && $.extend( data, {\n                    chunks: block.chunks,\n                    chunk: block.chunk\n                });\n    \n                // 在发送之间可以添加字段什么的。。。\n                // 如果默认的字段不够使用，可以通过监听此事件来扩展\n                owner.trigger( 'uploadBeforeSend', block, data, headers );\n    \n                // 开始发送。\n                tr.appendBlob( opts.fileVal, block.blob, file.name );\n                tr.append( data );\n                tr.setRequestHeader( headers );\n                tr.send();\n            },\n    \n            // 完成上传。\n            _finishFile: function( file, ret, hds ) {\n                var owner = this.owner;\n    \n                return owner\n                        .request( 'after-send-file', arguments, function() {\n                            file.setStatus( Status.COMPLETE );\n                            owner.trigger( 'uploadSuccess', file, ret, hds );\n                        })\n                        .fail(function( reason ) {\n    \n                            // 如果外部已经标记为invalid什么的，不再改状态。\n                            if ( file.getStatus() === Status.PROGRESS ) {\n                                file.setStatus( Status.ERROR, reason );\n                            }\n    \n                            owner.trigger( 'uploadError', file, reason );\n                        })\n                        .always(function() {\n                            owner.trigger( 'uploadComplete', file );\n                        });\n            }\n    \n        });\n    });\n    /**\n     * @fileOverview 各种验证，包括文件总大小是否超出、单文件是否超出和文件是否重复。\n     */\n    \n    define('widgets/validator',[\n        'base',\n        'uploader',\n        'file',\n        'widgets/widget'\n    ], function( Base, Uploader, WUFile ) {\n    \n        var $ = Base.$,\n            validators = {},\n            api;\n    \n        /**\n         * @event error\n         * @param {String} type 错误类型。\n         * @description 当validate不通过时，会以派送错误事件的形式通知调用者。通过`upload.on('error', handler)`可以捕获到此类错误，目前有以下错误会在特定的情况下派送错来。\n         *\n         * * `Q_EXCEED_NUM_LIMIT` 在设置了`fileNumLimit`且尝试给`uploader`添加的文件数量超出这个值时派送。\n         * * `Q_EXCEED_SIZE_LIMIT` 在设置了`Q_EXCEED_SIZE_LIMIT`且尝试给`uploader`添加的文件总大小超出这个值时派送。\n         * * `Q_TYPE_DENIED` 当文件类型不满足时触发。。\n         * @for  Uploader\n         */\n    \n        // 暴露给外面的api\n        api = {\n    \n            // 添加验证器\n            addValidator: function( type, cb ) {\n                validators[ type ] = cb;\n            },\n    \n            // 移除验证器\n            removeValidator: function( type ) {\n                delete validators[ type ];\n            }\n        };\n    \n        // 在Uploader初始化的时候启动Validators的初始化\n        Uploader.register({\n            name: 'validator',\n    \n            init: function() {\n                var me = this;\n                Base.nextTick(function() {\n                    $.each( validators, function() {\n                        this.call( me.owner );\n                    });\n                });\n            }\n        });\n    \n        /**\n         * @property {int} [fileNumLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总数量, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileNumLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                count = 0,\n                max = parseInt( opts.fileNumLimit, 10 ),\n                flag = true;\n    \n            if ( !max ) {\n                return;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n    \n                if ( count >= max && flag ) {\n                    flag = false;\n                    this.trigger( 'error', 'Q_EXCEED_NUM_LIMIT', max, file );\n                    setTimeout(function() {\n                        flag = true;\n                    }, 1 );\n                }\n    \n                return count >= max ? false : true;\n            });\n    \n            uploader.on( 'fileQueued', function() {\n                count++;\n            });\n    \n            uploader.on( 'fileDequeued', function() {\n                count--;\n            });\n    \n            uploader.on( 'reset', function() {\n                count = 0;\n            });\n        });\n    \n    \n        /**\n         * @property {int} [fileSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总大小是否超出限制, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileSizeLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                count = 0,\n                max = parseInt( opts.fileSizeLimit, 10 ),\n                flag = true;\n    \n            if ( !max ) {\n                return;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n                var invalid = count + file.size > max;\n    \n                if ( invalid && flag ) {\n                    flag = false;\n                    this.trigger( 'error', 'Q_EXCEED_SIZE_LIMIT', max, file );\n                    setTimeout(function() {\n                        flag = true;\n                    }, 1 );\n                }\n    \n                return invalid ? false : true;\n            });\n    \n            uploader.on( 'fileQueued', function( file ) {\n                count += file.size;\n            });\n    \n            uploader.on( 'fileDequeued', function( file ) {\n                count -= file.size;\n            });\n    \n            uploader.on( 'reset', function() {\n                count = 0;\n            });\n        });\n    \n        /**\n         * @property {int} [fileSingleSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证单个文件大小是否超出限制, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileSingleSizeLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                max = opts.fileSingleSizeLimit;\n    \n            if ( !max ) {\n                return;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n    \n                if ( file.size > max ) {\n                    file.setStatus( WUFile.Status.INVALID, 'exceed_size' );\n                    this.trigger( 'error', 'F_EXCEED_SIZE', max, file );\n                    return false;\n                }\n    \n            });\n    \n        });\n    \n        /**\n         * @property {Boolean} [duplicate=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 去重， 根据文件名字、文件大小和最后修改时间来生成hash Key.\n         */\n        api.addValidator( 'duplicate', function() {\n            var uploader = this,\n                opts = uploader.options,\n                mapping = {};\n    \n            if ( opts.duplicate ) {\n                return;\n            }\n    \n            function hashString( str ) {\n                var hash = 0,\n                    i = 0,\n                    len = str.length,\n                    _char;\n    \n                for ( ; i < len; i++ ) {\n                    _char = str.charCodeAt( i );\n                    hash = _char + (hash << 6) + (hash << 16) - hash;\n                }\n    \n                return hash;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n                var hash = file.__hash || (file.__hash = hashString( file.name +\n                        file.size + file.lastModifiedDate ));\n    \n                // 已经重复了\n                if ( mapping[ hash ] ) {\n                    this.trigger( 'error', 'F_DUPLICATE', file );\n                    return false;\n                }\n            });\n    \n            uploader.on( 'fileQueued', function( file ) {\n                var hash = file.__hash;\n    \n                hash && (mapping[ hash ] = true);\n            });\n    \n            uploader.on( 'fileDequeued', function( file ) {\n                var hash = file.__hash;\n    \n                hash && (delete mapping[ hash ]);\n            });\n    \n            uploader.on( 'reset', function() {\n                mapping = {};\n            });\n        });\n    \n        return api;\n    });\n    \n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/compbase',[],function() {\n    \n        function CompBase( owner, runtime ) {\n    \n            this.owner = owner;\n            this.options = owner.options;\n    \n            this.getRuntime = function() {\n                return runtime;\n            };\n    \n            this.getRuid = function() {\n                return runtime.uid;\n            };\n    \n            this.trigger = function() {\n                return owner.trigger.apply( owner, arguments );\n            };\n        }\n    \n        return CompBase;\n    });\n    /**\n     * @fileOverview Html5Runtime\n     */\n    define('runtime/html5/runtime',[\n        'base',\n        'runtime/runtime',\n        'runtime/compbase'\n    ], function( Base, Runtime, CompBase ) {\n    \n        var type = 'html5',\n            components = {};\n    \n        function Html5Runtime() {\n            var pool = {},\n                me = this,\n                destroy = this.destroy;\n    \n            Runtime.apply( me, arguments );\n            me.type = type;\n    \n    \n            // 这个方法的调用者，实际上是RuntimeClient\n            me.exec = function( comp, fn/*, args...*/) {\n                var client = this,\n                    uid = client.uid,\n                    args = Base.slice( arguments, 2 ),\n                    instance;\n    \n                if ( components[ comp ] ) {\n                    instance = pool[ uid ] = pool[ uid ] ||\n                            new components[ comp ]( client, me );\n    \n                    if ( instance[ fn ] ) {\n                        return instance[ fn ].apply( instance, args );\n                    }\n                }\n            };\n    \n            me.destroy = function() {\n                // @todo 删除池子中的所有实例\n                return destroy && destroy.apply( this, arguments );\n            };\n        }\n    \n        Base.inherits( Runtime, {\n            constructor: Html5Runtime,\n    \n            // 不需要连接其他程序，直接执行callback\n            init: function() {\n                var me = this;\n                setTimeout(function() {\n                    me.trigger('ready');\n                }, 1 );\n            }\n    \n        });\n    \n        // 注册Components\n        Html5Runtime.register = function( name, component ) {\n            var klass = components[ name ] = Base.inherits( CompBase, component );\n            return klass;\n        };\n    \n        // 注册html5运行时。\n        // 只有在支持的前提下注册。\n        if ( window.Blob && window.FileReader && window.DataView ) {\n            Runtime.addRuntime( type, Html5Runtime );\n        }\n    \n        return Html5Runtime;\n    });\n    /**\n     * @fileOverview Blob Html实现\n     */\n    define('runtime/html5/blob',[\n        'runtime/html5/runtime',\n        'lib/blob'\n    ], function( Html5Runtime, Blob ) {\n    \n        return Html5Runtime.register( 'Blob', {\n            slice: function( start, end ) {\n                var blob = this.owner.source,\n                    slice = blob.slice || blob.webkitSlice || blob.mozSlice;\n    \n                blob = slice.call( blob, start, end );\n    \n                return new Blob( this.getRuid(), blob );\n            }\n        });\n    });\n    /**\r\n     * @fileOverview FilePaste\r\n     */\r\n    define('runtime/html5/dnd',[\r\n        'base',\r\n        'runtime/html5/runtime',\r\n        'lib/file'\r\n    ], function( Base, Html5Runtime, File ) {\r\n    \r\n        var $ = Base.$,\r\n            prefix = 'webuploader-dnd-';\r\n    \r\n        return Html5Runtime.register( 'DragAndDrop', {\r\n            init: function() {\r\n                var elem = this.elem = this.options.container;\r\n    \r\n                this.dragEnterHandler = Base.bindFn( this._dragEnterHandler, this );\r\n                this.dragOverHandler = Base.bindFn( this._dragOverHandler, this );\r\n                this.dragLeaveHandler = Base.bindFn( this._dragLeaveHandler, this );\r\n                this.dropHandler = Base.bindFn( this._dropHandler, this );\r\n                this.dndOver = false;\r\n    \r\n                elem.on( 'dragenter', this.dragEnterHandler );\r\n                elem.on( 'dragover', this.dragOverHandler );\r\n                elem.on( 'dragleave', this.dragLeaveHandler );\r\n                elem.on( 'drop', this.dropHandler );\r\n    \r\n                if ( this.options.disableGlobalDnd ) {\r\n                    $( document ).on( 'dragover', this.dragOverHandler );\r\n                    $( document ).on( 'drop', this.dropHandler );\r\n                }\r\n            },\r\n    \r\n            _dragEnterHandler: function( e ) {\r\n                var me = this,\r\n                    denied = me._denied || false,\r\n                    items;\r\n    \r\n                e = e.originalEvent || e;\r\n    \r\n                if ( !me.dndOver ) {\r\n                    me.dndOver = true;\r\n    \r\n                    // 注意只有 chrome 支持。\r\n                    items = e.dataTransfer.items;\r\n    \r\n                    if ( items && items.length ) {\r\n                        me._denied = denied = !me.trigger( 'accept', items );\r\n                    }\r\n    \r\n                    me.elem.addClass( prefix + 'over' );\r\n                    me.elem[ denied ? 'addClass' :\r\n                            'removeClass' ]( prefix + 'denied' );\r\n                }\r\n    \r\n                e.dataTransfer.dropEffect = denied ? 'none' : 'copy';\r\n    \r\n                return false;\r\n            },\r\n    \r\n            _dragOverHandler: function( e ) {\r\n                // 只处理框内的。\r\n                var parentElem = this.elem.parent().get( 0 );\r\n                if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\r\n                    return false;\r\n                }\r\n    \r\n                clearTimeout( this._leaveTimer );\r\n                this._dragEnterHandler.call( this, e );\r\n    \r\n                return false;\r\n            },\r\n    \r\n            _dragLeaveHandler: function() {\r\n                var me = this,\r\n                    handler;\r\n    \r\n                handler = function() {\r\n                    me.dndOver = false;\r\n                    me.elem.removeClass( prefix + 'over ' + prefix + 'denied' );\r\n                };\r\n    \r\n                clearTimeout( me._leaveTimer );\r\n                me._leaveTimer = setTimeout( handler, 100 );\r\n                return false;\r\n            },\r\n    \r\n            _dropHandler: function( e ) {\r\n                var me = this,\r\n                    ruid = me.getRuid(),\r\n                    parentElem = me.elem.parent().get( 0 ),\r\n                    dataTransfer, data;\r\n    \r\n                // 只处理框内的。\r\n                if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\r\n                    return false;\r\n                }\r\n    \r\n                e = e.originalEvent || e;\r\n                dataTransfer = e.dataTransfer;\r\n    \r\n                // 如果是页面内拖拽，还不能处理，不阻止事件。\r\n                // 此处 ie11 下会报参数错误，\r\n                try {\r\n                    data = dataTransfer.getData('text/html');\r\n                } catch( err ) {\r\n                }\r\n    \r\n                if ( data ) {\r\n                    return;\r\n                }\r\n    \r\n                me._getTansferFiles( dataTransfer, function( results ) {\r\n                    me.trigger( 'drop', $.map( results, function( file ) {\r\n                        return new File( ruid, file );\r\n                    }) );\r\n                });\r\n    \r\n                me.dndOver = false;\r\n                me.elem.removeClass( prefix + 'over' );\r\n                return false;\r\n            },\r\n    \r\n            // 如果传入 callback 则去查看文件夹，否则只管当前文件夹。\r\n            _getTansferFiles: function( dataTransfer, callback ) {\r\n                var results  = [],\r\n                    promises = [],\r\n                    items, files, file, item, i, len, canAccessFolder;\r\n    \r\n                items = dataTransfer.items;\r\n                files = dataTransfer.files;\r\n    \r\n                canAccessFolder = !!(items && items[ 0 ].webkitGetAsEntry);\r\n    \r\n                for ( i = 0, len = files.length; i < len; i++ ) {\r\n                    file = files[ i ];\r\n                    item = items && items[ i ];\r\n    \r\n                    if ( canAccessFolder && item.webkitGetAsEntry().isDirectory ) {\r\n    \r\n                        promises.push( this._traverseDirectoryTree(\r\n                                item.webkitGetAsEntry(), results ) );\r\n                    } else {\r\n                        results.push( file );\r\n                    }\r\n                }\r\n    \r\n                Base.when.apply( Base, promises ).done(function() {\r\n    \r\n                    if ( !results.length ) {\r\n                        return;\r\n                    }\r\n    \r\n                    callback( results );\r\n                });\r\n            },\r\n    \r\n            _traverseDirectoryTree: function( entry, results ) {\r\n                var deferred = Base.Deferred(),\r\n                    me = this;\r\n    \r\n                if ( entry.isFile ) {\r\n                    entry.file(function( file ) {\r\n                        results.push( file );\r\n                        deferred.resolve();\r\n                    });\r\n                } else if ( entry.isDirectory ) {\r\n                    entry.createReader().readEntries(function( entries ) {\r\n                        var len = entries.length,\r\n                            promises = [],\r\n                            arr = [],    // 为了保证顺序。\r\n                            i;\r\n    \r\n                        for ( i = 0; i < len; i++ ) {\r\n                            promises.push( me._traverseDirectoryTree(\r\n                                    entries[ i ], arr ) );\r\n                        }\r\n    \r\n                        Base.when.apply( Base, promises ).then(function() {\r\n                            results.push.apply( results, arr );\r\n                            deferred.resolve();\r\n                        }, deferred.reject );\r\n                    });\r\n                }\r\n    \r\n                return deferred.promise();\r\n            },\r\n    \r\n            destroy: function() {\r\n                var elem = this.elem;\r\n    \r\n                // 还没 init 就调用 destroy\r\n                if (!elem) {\r\n                    return;\r\n                }\r\n                \r\n                elem.off( 'dragenter', this.dragEnterHandler );\r\n                elem.off( 'dragover', this.dragOverHandler );\r\n                elem.off( 'dragleave', this.dragLeaveHandler );\r\n                elem.off( 'drop', this.dropHandler );\r\n    \r\n                if ( this.options.disableGlobalDnd ) {\r\n                    $( document ).off( 'dragover', this.dragOverHandler );\r\n                    $( document ).off( 'drop', this.dropHandler );\r\n                }\r\n            }\r\n        });\r\n    });\r\n    \n    /**\r\n     * @fileOverview FilePaste\r\n     */\r\n    define('runtime/html5/filepaste',[\r\n        'base',\r\n        'runtime/html5/runtime',\r\n        'lib/file'\r\n    ], function( Base, Html5Runtime, File ) {\r\n    \r\n        return Html5Runtime.register( 'FilePaste', {\r\n            init: function() {\r\n                var opts = this.options,\r\n                    elem = this.elem = opts.container,\r\n                    accept = '.*',\r\n                    arr, i, len, item;\r\n    \r\n                // accetp的mimeTypes中生成匹配正则。\r\n                if ( opts.accept ) {\r\n                    arr = [];\r\n    \r\n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\r\n                        item = opts.accept[ i ].mimeTypes;\r\n                        item && arr.push( item );\r\n                    }\r\n    \r\n                    if ( arr.length ) {\r\n                        accept = arr.join(',');\r\n                        accept = accept.replace( /,/g, '|' ).replace( /\\*/g, '.*' );\r\n                    }\r\n                }\r\n                this.accept = accept = new RegExp( accept, 'i' );\r\n                this.hander = Base.bindFn( this._pasteHander, this );\r\n                elem.on( 'paste', this.hander );\r\n            },\r\n    \r\n            _pasteHander: function( e ) {\r\n                var allowed = [],\r\n                    ruid = this.getRuid(),\r\n                    items, item, blob, i, len;\r\n    \r\n                e = e.originalEvent || e;\r\n                items = e.clipboardData.items;\r\n    \r\n                for ( i = 0, len = items.length; i < len; i++ ) {\r\n                    item = items[ i ];\r\n    \r\n                    if ( item.kind !== 'file' || !(blob = item.getAsFile()) ) {\r\n                        continue;\r\n                    }\r\n    \r\n                    allowed.push( new File( ruid, blob ) );\r\n                }\r\n    \r\n                if ( allowed.length ) {\r\n                    // 不阻止非文件粘贴（文字粘贴）的事件冒泡\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    this.trigger( 'paste', allowed );\r\n                }\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.elem.off( 'paste', this.hander );\r\n            }\r\n        });\r\n    });\r\n    \n    /**\r\n     * @fileOverview FilePicker\r\n     */\r\n    define('runtime/html5/filepicker',[\r\n        'base',\r\n        'runtime/html5/runtime'\r\n    ], function( Base, Html5Runtime ) {\r\n    \r\n        var $ = Base.$;\r\n    \r\n        return Html5Runtime.register( 'FilePicker', {\r\n            init: function() {\r\n                var container = this.getRuntime().getContainer(),\r\n                    me = this,\r\n                    owner = me.owner,\r\n                    opts = me.options,\r\n                    label = this.label = $( document.createElement('label') ),\r\n                    input =  this.input = $( document.createElement('input') ),\r\n                    arr, i, len, mouseHandler;\r\n    \r\n                input.attr( 'type', 'file' );\r\n                input.attr( 'name', opts.name );\r\n                input.addClass('webuploader-element-invisible');\r\n    \r\n                label.on( 'click', function() {\r\n                    input.trigger('click');\r\n                });\r\n    \r\n                label.css({\r\n                    opacity: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    display: 'block',\r\n                    cursor: 'pointer',\r\n                    background: '#ffffff'\r\n                });\r\n    \r\n                if ( opts.multiple ) {\r\n                    input.attr( 'multiple', 'multiple' );\r\n                }\r\n    \r\n                // @todo Firefox不支持单独指定后缀\r\n                if ( opts.accept && opts.accept.length > 0 ) {\r\n                    arr = [];\r\n    \r\n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\r\n                        arr.push( opts.accept[ i ].mimeTypes );\r\n                    }\r\n    \r\n                    input.attr( 'accept', arr.join(',') );\r\n                }\r\n    \r\n                container.append( input );\r\n                container.append( label );\r\n    \r\n                mouseHandler = function( e ) {\r\n                    owner.trigger( e.type );\r\n                };\r\n    \r\n                input.on( 'change', function( e ) {\r\n                    var fn = arguments.callee,\r\n                        clone;\r\n    \r\n                    me.files = e.target.files;\r\n    \r\n                    // reset input\r\n                    clone = this.cloneNode( true );\r\n                    clone.value = null;\r\n                    this.parentNode.replaceChild( clone, this );\r\n    \r\n                    input.off();\r\n                    input = $( clone ).on( 'change', fn )\r\n                            .on( 'mouseenter mouseleave', mouseHandler );\r\n    \r\n                    owner.trigger('change');\r\n                });\r\n    \r\n                label.on( 'mouseenter mouseleave', mouseHandler );\r\n    \r\n            },\r\n    \r\n    \r\n            getFiles: function() {\r\n                return this.files;\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.input.off();\r\n                this.label.off();\r\n            }\r\n        });\r\n    });\n    /**\n     * @fileOverview Transport\n     * @todo 支持chunked传输，优势：\n     * 可以将大文件分成小块，挨个传输，可以提高大文件成功率，当失败的时候，也只需要重传那小部分，\n     * 而不需要重头再传一次。另外断点续传也需要用chunked方式。\n     */\n    define('runtime/html5/transport',[\n        'base',\n        'runtime/html5/runtime'\n    ], function( Base, Html5Runtime ) {\n    \n        var noop = Base.noop,\n            $ = Base.$;\n    \n        return Html5Runtime.register( 'Transport', {\n            init: function() {\n                this._status = 0;\n                this._response = null;\n            },\n    \n            send: function() {\n                var owner = this.owner,\n                    opts = this.options,\n                    xhr = this._initAjax(),\n                    blob = owner._blob,\n                    server = opts.server,\n                    formData, binary, fr;\n    \n                if ( opts.sendAsBinary ) {\n                    server += (/\\?/.test( server ) ? '&' : '?') +\n                            $.param( owner._formData );\n    \n                    binary = blob.getSource();\n                } else {\n                    formData = new FormData();\n                    $.each( owner._formData, function( k, v ) {\n                        formData.append( k, v );\n                    });\n    \n                    formData.append( opts.fileVal, blob.getSource(),\n                            opts.filename || owner._formData.name || '' );\n                }\n    \n                if ( opts.withCredentials && 'withCredentials' in xhr ) {\n                    xhr.open( opts.method, server, true );\n                    xhr.withCredentials = true;\n                } else {\n                    xhr.open( opts.method, server );\n                }\n    \n                this._setRequestHeader( xhr, opts.headers );\n    \n                if ( binary ) {\n                    // 强制设置成 content-type 为文件流。\n                    xhr.overrideMimeType &&\n                            xhr.overrideMimeType('application/octet-stream');\n    \n                    // android直接发送blob会导致服务端接收到的是空文件。\n                    // bug详情。\n                    // https://code.google.com/p/android/issues/detail?id=39882\n                    // 所以先用fileReader读取出来再通过arraybuffer的方式发送。\n                    if ( Base.os.android ) {\n                        fr = new FileReader();\n    \n                        fr.onload = function() {\n                            xhr.send( this.result );\n                            fr = fr.onload = null;\n                        };\n    \n                        fr.readAsArrayBuffer( binary );\n                    } else {\n                        xhr.send( binary );\n                    }\n                } else {\n                    xhr.send( formData );\n                }\n            },\n    \n            getResponse: function() {\n                return this._response;\n            },\n    \n            getResponseAsJson: function() {\n                return this._parseJson( this._response );\n            },\n    \n            getStatus: function() {\n                return this._status;\n            },\n    \n            abort: function() {\n                var xhr = this._xhr;\n    \n                if ( xhr ) {\n                    xhr.upload.onprogress = noop;\n                    xhr.onreadystatechange = noop;\n                    xhr.abort();\n    \n                    this._xhr = xhr = null;\n                }\n            },\n    \n            destroy: function() {\n                this.abort();\n            },\n    \n            _initAjax: function() {\n                var me = this,\n                    xhr = new XMLHttpRequest(),\n                    opts = this.options;\n    \n                if ( opts.withCredentials && !('withCredentials' in xhr) &&\n                        typeof XDomainRequest !== 'undefined' ) {\n                    xhr = new XDomainRequest();\n                }\n    \n                xhr.upload.onprogress = function( e ) {\n                    var percentage = 0;\n    \n                    if ( e.lengthComputable ) {\n                        percentage = e.loaded / e.total;\n                    }\n    \n                    return me.trigger( 'progress', percentage );\n                };\n    \n                xhr.onreadystatechange = function() {\n    \n                    if ( xhr.readyState !== 4 ) {\n                        return;\n                    }\n    \n                    xhr.upload.onprogress = noop;\n                    xhr.onreadystatechange = noop;\n                    me._xhr = null;\n                    me._status = xhr.status;\n    \n                    if ( xhr.status >= 200 && xhr.status < 300 ) {\n                        me._response = xhr.responseText;\n                        return me.trigger('load');\n                    } else if ( xhr.status >= 500 && xhr.status < 600 ) {\n                        me._response = xhr.responseText;\n                        return me.trigger( 'error', 'server' );\n                    }\n    \n    \n                    return me.trigger( 'error', me._status ? 'http' : 'abort' );\n                };\n    \n                me._xhr = xhr;\n                return xhr;\n            },\n    \n            _setRequestHeader: function( xhr, headers ) {\n                $.each( headers, function( key, val ) {\n                    xhr.setRequestHeader( key, val );\n                });\n            },\n    \n            _parseJson: function( str ) {\n                var json;\n    \n                try {\n                    json = JSON.parse( str );\n                } catch ( ex ) {\n                    json = {};\n                }\n    \n                return json;\n            }\n        });\n    });\n    /**\n     * @fileOverview FlashRuntime\n     */\n    define('runtime/flash/runtime',[\n        'base',\n        'runtime/runtime',\n        'runtime/compbase'\n    ], function( Base, Runtime, CompBase ) {\n    \n        var $ = Base.$,\n            type = 'flash',\n            components = {};\n    \n    \n        function getFlashVersion() {\n            var version;\n    \n            try {\n                version = navigator.plugins[ 'Shockwave Flash' ];\n                version = version.description;\n            } catch ( ex ) {\n                try {\n                    version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\n                            .GetVariable('$version');\n                } catch ( ex2 ) {\n                    version = '0.0';\n                }\n            }\n            version = version.match( /\\d+/g );\n            return parseFloat( version[ 0 ] + '.' + version[ 1 ], 10 );\n        }\n    \n        function FlashRuntime() {\n            var pool = {},\n                clients = {},\n                destroy = this.destroy,\n                me = this,\n                jsreciver = Base.guid('webuploader_');\n    \n            Runtime.apply( me, arguments );\n            me.type = type;\n    \n    \n            // 这个方法的调用者，实际上是RuntimeClient\n            me.exec = function( comp, fn/*, args...*/ ) {\n                var client = this,\n                    uid = client.uid,\n                    args = Base.slice( arguments, 2 ),\n                    instance;\n    \n                clients[ uid ] = client;\n    \n                if ( components[ comp ] ) {\n                    if ( !pool[ uid ] ) {\n                        pool[ uid ] = new components[ comp ]( client, me );\n                    }\n    \n                    instance = pool[ uid ];\n    \n                    if ( instance[ fn ] ) {\n                        return instance[ fn ].apply( instance, args );\n                    }\n                }\n    \n                return me.flashExec.apply( client, arguments );\n            };\n    \n            function handler( evt, obj ) {\n                var type = evt.type || evt,\n                    parts, uid;\n    \n                parts = type.split('::');\n                uid = parts[ 0 ];\n                type = parts[ 1 ];\n    \n                // console.log.apply( console, arguments );\n    \n                if ( type === 'Ready' && uid === me.uid ) {\n                    me.trigger('ready');\n                } else if ( clients[ uid ] ) {\n                    clients[ uid ].trigger( type.toLowerCase(), evt, obj );\n                }\n    \n                // Base.log( evt, obj );\n            }\n    \n            // flash的接受器。\n            window[ jsreciver ] = function() {\n                var args = arguments;\n    \n                // 为了能捕获得到。\n                setTimeout(function() {\n                    handler.apply( null, args );\n                }, 1 );\n            };\n    \n            this.jsreciver = jsreciver;\n    \n            this.destroy = function() {\n                // @todo 删除池子中的所有实例\n                return destroy && destroy.apply( this, arguments );\n            };\n    \n            this.flashExec = function( comp, fn ) {\n                var flash = me.getFlash(),\n                    args = Base.slice( arguments, 2 );\n    \n                return flash.exec( this.uid, comp, fn, args );\n            };\n    \n            // @todo\n        }\n    \n        Base.inherits( Runtime, {\n            constructor: FlashRuntime,\n    \n            init: function() {\n                var container = this.getContainer(),\n                    opts = this.options,\n                    html;\n    \n                // if not the minimal height, shims are not initialized\n                // in older browsers (e.g FF3.6, IE6,7,8, Safari 4.0,5.0, etc)\n                container.css({\n                    position: 'absolute',\n                    top: '-8px',\n                    left: '-8px',\n                    width: '9px',\n                    height: '9px',\n                    overflow: 'hidden'\n                });\n    \n                // insert flash object\n                html = '<object id=\"' + this.uid + '\" type=\"application/' +\n                        'x-shockwave-flash\" data=\"' +  opts.swf + '\" ';\n    \n                if ( Base.browser.ie ) {\n                    html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\n                }\n    \n                html += 'width=\"100%\" height=\"100%\" style=\"outline:0\">'  +\n                    '<param name=\"movie\" value=\"' + opts.swf + '\" />' +\n                    '<param name=\"flashvars\" value=\"uid=' + this.uid +\n                    '&jsreciver=' + this.jsreciver + '\" />' +\n                    '<param name=\"wmode\" value=\"transparent\" />' +\n                    '<param name=\"allowscriptaccess\" value=\"always\" />' +\n                '</object>';\n    \n                container.html( html );\n            },\n    \n            getFlash: function() {\n                if ( this._flash ) {\n                    return this._flash;\n                }\n    \n                this._flash = $( '#' + this.uid ).get( 0 );\n                return this._flash;\n            }\n    \n        });\n    \n        FlashRuntime.register = function( name, component ) {\n            component = components[ name ] = Base.inherits( CompBase, $.extend({\n    \n                // @todo fix this later\n                flashExec: function() {\n                    var owner = this.owner,\n                        runtime = this.getRuntime();\n    \n                    return runtime.flashExec.apply( owner, arguments );\n                }\n            }, component ) );\n    \n            return component;\n        };\n    \n        if ( getFlashVersion() >= 11.4 ) {\n            Runtime.addRuntime( type, FlashRuntime );\n        }\n    \n        return FlashRuntime;\n    });\n    /**\n     * @fileOverview FilePicker\n     */\n    define('runtime/flash/filepicker',[\n        'base',\n        'runtime/flash/runtime'\n    ], function( Base, FlashRuntime ) {\n        var $ = Base.$;\n    \n        return FlashRuntime.register( 'FilePicker', {\n            init: function( opts ) {\n                var copy = $.extend({}, opts ),\n                    len, i;\n    \n                // 修复Flash再没有设置title的情况下无法弹出flash文件选择框的bug.\n                len = copy.accept && copy.accept.length;\n                for (  i = 0; i < len; i++ ) {\n                    if ( !copy.accept[ i ].title ) {\n                        copy.accept[ i ].title = 'Files';\n                    }\n                }\n    \n                delete copy.button;\n                delete copy.id;\n                delete copy.container;\n    \n                this.flashExec( 'FilePicker', 'init', copy );\n            },\n    \n            destroy: function() {\n                this.flashExec( 'FilePicker', 'destroy' );\n            }\n        });\n    });\n    /**\n     * @fileOverview  Transport flash实现\n     */\n    define('runtime/flash/transport',[\n        'base',\n        'runtime/flash/runtime',\n        'runtime/client'\n    ], function( Base, FlashRuntime, RuntimeClient ) {\n        var $ = Base.$;\n    \n        return FlashRuntime.register( 'Transport', {\n            init: function() {\n                this._status = 0;\n                this._response = null;\n                this._responseJson = null;\n            },\n    \n            send: function() {\n                var owner = this.owner,\n                    opts = this.options,\n                    xhr = this._initAjax(),\n                    blob = owner._blob,\n                    server = opts.server,\n                    binary;\n    \n                xhr.connectRuntime( blob.ruid );\n    \n                if ( opts.sendAsBinary ) {\n                    server += (/\\?/.test( server ) ? '&' : '?') +\n                            $.param( owner._formData );\n    \n                    binary = blob.uid;\n                } else {\n                    $.each( owner._formData, function( k, v ) {\n                        xhr.exec( 'append', k, v );\n                    });\n    \n                    xhr.exec( 'appendBlob', opts.fileVal, blob.uid,\n                            opts.filename || owner._formData.name || '' );\n                }\n    \n                this._setRequestHeader( xhr, opts.headers );\n                xhr.exec( 'send', {\n                    method: opts.method,\n                    url: server,\n                    forceURLStream: opts.forceURLStream,\n                    mimeType: 'application/octet-stream'\n                }, binary );\n            },\n    \n            getStatus: function() {\n                return this._status;\n            },\n    \n            getResponse: function() {\n                return this._response || '';\n            },\n    \n            getResponseAsJson: function() {\n                return this._responseJson;\n            },\n    \n            abort: function() {\n                var xhr = this._xhr;\n    \n                if ( xhr ) {\n                    xhr.exec('abort');\n                    xhr.destroy();\n                    this._xhr = xhr = null;\n                }\n            },\n    \n            destroy: function() {\n                this.abort();\n            },\n    \n            _initAjax: function() {\n                var me = this,\n                    xhr = new RuntimeClient('XMLHttpRequest');\n    \n                xhr.on( 'uploadprogress progress', function( e ) {\n                    var percent = e.loaded / e.total;\n                    percent = Math.min( 1, Math.max( 0, percent ) );\n                    return me.trigger( 'progress', percent );\n                });\n    \n                xhr.on( 'load', function() {\n                    var status = xhr.exec('getStatus'),\n                        readBody = false,\n                        err = '',\n                        p;\n    \n                    xhr.off();\n                    me._xhr = null;\n    \n                    if ( status >= 200 && status < 300 ) {\n                        readBody = true;\n                    } else if ( status >= 500 && status < 600 ) {\n                        readBody = true;\n                        err = 'server';\n                    } else {\n                        err = 'http';\n                    }\n    \n                    if ( readBody ) {\n                        me._response = xhr.exec('getResponse');\n                        me._response = decodeURIComponent( me._response );\n    \n                        // flash 处理可能存在 bug, 没辙只能靠 js 了\n                        // try {\n                        //     me._responseJson = xhr.exec('getResponseAsJson');\n                        // } catch ( error ) {\n                            \n                        p = window.JSON && window.JSON.parse || function( s ) {\n                            try {\n                                return new Function('return ' + s).call();\n                            } catch ( err ) {\n                                return {};\n                            }\n                        };\n                        me._responseJson  = me._response ? p(me._response) : {};\n                            \n                        // }\n                    }\n                    \n                    xhr.destroy();\n                    xhr = null;\n    \n                    return err ? me.trigger( 'error', err ) : me.trigger('load');\n                });\n    \n                xhr.on( 'error', function() {\n                    xhr.off();\n                    me._xhr = null;\n                    me.trigger( 'error', 'http' );\n                });\n    \n                me._xhr = xhr;\n                return xhr;\n            },\n    \n            _setRequestHeader: function( xhr, headers ) {\n                $.each( headers, function( key, val ) {\n                    xhr.exec( 'setRequestHeader', key, val );\n                });\n            }\n        });\n    });\n    /**\n     * @fileOverview 没有图像处理的版本。\n     */\n    define('preset/withoutimage',[\n        'base',\n    \n        // widgets\n        'widgets/filednd',\n        'widgets/filepaste',\n        'widgets/filepicker',\n        'widgets/queue',\n        'widgets/runtime',\n        'widgets/upload',\n        'widgets/validator',\n    \n        // runtimes\n        // html5\n        'runtime/html5/blob',\n        'runtime/html5/dnd',\n        'runtime/html5/filepaste',\n        'runtime/html5/filepicker',\n        'runtime/html5/transport',\n    \n        // flash\n        'runtime/flash/filepicker',\n        'runtime/flash/transport'\n    ], function( Base ) {\n        return Base;\n    });\n    define('webuploader',[\n        'preset/withoutimage'\n    ], function( preset ) {\n        return preset;\n    });\n    return require('webuploader');\n});\n"],"sourceRoot":"/source/"}